import { flows } from "/snippets/data/flows.jsx";
import { InteractiveDiagramFrame } from "/snippets/flow-diagrams/InteractiveDiagramFrame.jsx";

## Why using this feature

- **Secure**: Protects sensitive actions with trusted-device approval.
- **Flexible**: Lets users approve requests anytime.
- **Controlled**: Keeps humans in charge of critical tasks.

<CodeGroup>

```javascript src/lib/auth0-ai.ts
import { Auth0AI } from "@auth0/ai-langchain";

// Create Auth0AI client
const auth0AI = new Auth0AI();

// Define async user confirmation flow for buying stocks
const buyStockAuthorizer = auth0AI.withAsyncUserConfirmation({
  // Identify the user
  userID: (params: { userID: string }, ctx) => params.userID,
  // Message shown to user for confirmation
  bindingMessage: async ({ qty, ticker }) =>
    `Confirm the purchase of ${qty} ${ticker}`,
  // Details of the authorization request
  authorizationDetails: async ({ qty, ticker }) => [
    { type: "trade_authorization", qty, ticker, action: "buy" }
  ],
  // Target API and required scopes
  audience: process.env["AUDIENCE"],
  scopes: ["stock:trade"]
});
```

</CodeGroup>

## How it works

Generative AI apps and agents often need to act on events that happen asynchronously—for example:

- Buy tickets when they become available.
- Approve a purchase only after prices drop.
- Trigger workflows when a system alert fires.


Asynchronous Authorization ensures the agent pauses for user consent before executing the action, keeping automation safe, transparent, and user-controlled. This process relies on a decoupled authentication flow where the user provides consent on a trusted device, such as their mobile phone, separate from the device where the agent was initially engaged.

<InteractiveDiagramFrame
  flowId="async-auth"
  flowData={flows["async-auth"]}
/>

<Steps>
  <Step title="User Request & Task Setup">
    In this first step, the user initiates the flow by issuing a natural language instruction to the AI agent. For example: “Buy tickets for event when available.”
    - Intent Expression: The user specifies the desired automation — purchasing event tickets when they become available.
    - Input Capture: The AI agent receives the request and records the parameters (event type, ticket availability trigger).
    Purpose: This step establishes the user’s request and schedules the background task.
  </Step>
  <Step title="Monitoring for Ticket Availability">
    The AI agent begins monitoring the external ticketing system for availability.
    - Polling Process: The agent continuously polls the events API, waiting for a matching event state (tickets available).
    - Event Trigger: When the tickets are released, the system captures this state change.
    - Purpose: This step ensures the AI agent can act immediately when the desired tickets become available.
  </Step>
  <Step title="User Authorization & Consent">
    Once availability is confirmed, the AI agent requests explicit authorization from the user before executing the purchase.
    - Authorization Request: The user receives a notification with clear options to approve or deny the purchase.
    - Consent Capture: The system waits for the user’s approval before proceeding.
    - Purpose: This step enforces user control, preventing unintended or automated purchases without consent.
  </Step>
  <Step title="Secure Ticket Purchase & Confirmation">
    If the user approves, the AI agent proceeds with the purchase workflow.
    - Permission Validation: Auth0 AI validates the user’s approval and grants the necessary permission.
    - Execution: The AI agent executes the “Buy Tickets” action with the event provider.
    - Result Delivery: The user is notified of the transaction outcome and receives the event tickets.
    - Purpose: This completes the flow, fulfilling the original request while maintaining security and transparency.
  </Step>
</Steps>

## Use cases

AI agents often need to perform actions that are long-running, are executed at a later time, or involve sensitive operations. For example:

- **Transactional approvals:** An agent arranging a business trip might find a flight and hotel, but needs the user's final approval to complete the purchase.
- **Accessing sensitive data:** An agent might need to access a protected user's health records to answer a query.
- **Executing high-privilege tasks:** A DevOps agent might need permission to deploy a new version of an application to a production environment.

In these scenarios, the agent needs the user to approve an action at a later time. Asynchronous authorization allows the agent to initiate this request and let the user approve it at their convenience, creating a more seamless and secure user experience.

This decoupled mechanism is also ideal for human-in-the-loop interactions, such as approving a stock purchase through a chatbot or completing a financial transaction with a banking agent.


## Get started

To begin using Auth0 for calling your APIs in your GenAI applications, refer to the following resources:

<Columns>
  <Card
    title="Secure Human-in-the-Loop Approvals"
    horizontal
    href="/async-authorization/langgraph/get-started/asynchronous-authorization"
  >
    Learn how Auth0 for AI Agents enables AI agents to asynchronously authorize users.
  </Card>
</Columns>
