---
title: Call Your API on User's Behalf
description: Learn how to call an Auth0-protected API from your MCP server.
sidebarTitle: Call Your API on User's Behalf
---

import MCPGetStartedPrerequisites from "/snippets/mcp/get-started/pre-reqs/prerequisites.mdx";
import MCPGetStartedConfigTenantSettings from "/snippets/mcp/get-started/config-tenant/config-tenant-settings.mdx";
import CreateProfile from "/snippets/mcp/get-started/create-custom-token-exchange-profile.mdx";
import CreateMCPAPI from "/snippets/mcp/get-started/create-mcp-api.mdx";
import { DownloadQuickstartButton } from "/snippets/download-quickstart/DownloadQuickstartButton.jsx";
import MCPGetStartedTestingInstructions from "/snippets/mcp/get-started/testing-instructions.mdx";
import CreateEnvFile from "/snippets/mcp/get-started/call-your-apis/create-env-file.mdx";
import CustomTokenExchangeAction from "/snippets/mcp/get-started/call-your-apis/custom-token-exchange-action.mdx";
import RunMcpServerJs from "/snippets/mcp/get-started/call-your-apis/run-mcp-server-js.mdx";
import RunMcpServerPython from "/snippets/mcp/get-started/call-your-apis/run-mcp-server-python.mdx";
import ExchangeAccessTokenJs from "/snippets/mcp/get-started/call-your-apis/exchange-access-token-js.mdx";
import ExchangeAccessTokenPython from "/snippets/mcp/get-started/call-your-apis/exchange-access-token-python.mdx";

To call your APIs on behalf of your users, the MCP server needs to exchange the Auth0 access token it received from the MCP client (with the audience set to the MCP server itself) for a new Auth0 access token with the audience set to your API.

In Auth0, this is called Custom Token Exchange and uses [RFC 8693](https://www.rfc-editor.org/rfc/rfc8693.html). This flow involves the MCP server acting as both a resource server (for the client) and a client (for the upstream API).

By the end of this quickstart, you should have an MCP server that can:

* Exchange an Auth0 access token for another Auth0 access token with a different audience using Custom Token Exchange
* Verify the access token using the `@auth0/auth0-api-js` library (which uses `jose` under the hood) or the `auth0-api-python` library for Python against your tenant JWKS, enforcing issuer, audience, and RS256

<MCPGetStartedPrerequisites />

<MCPGetStartedConfigTenantSettings />

## Set up the Auth0 Applications and APIs

When an MCP server needs to call underlying APIs, it needs to perform a Custom Token Exchange to obtain an access token with the audience set to the API rather than the MCP server itself. Because of this architecture, the MCP server acts in a dual role.

1. To the MCP client (e.g., an IDE, an AI assistant), the MCP server acts as a **Resource Server** (an API).
2. To the underlying API (e.g., your own API), the MCP server acts as a **Client**.

Because of this duality, you need to set up the MCP server twich on your Auth0 tenant, both as an API and as a Client, as described below.

### Create an API to represent your MCP server

<CreateMCPAPI />

### Create an Application for your MCP server

In the custom token exchange scenario, the MCP server acts as a client in order to obtain an Auth0 access token with custom token exchange:

```shell wrap lines
auth0 api post clients --data '{
  "name": "MCP Server Client",
  "app_type": "non_interactive",
  "is_first_party": true,
  "grant_types": ["authorization_code"],
  "token_endpoint_auth_method": "client_secret_post",
  "oidc_conformant": true,
  "jwt_configuration": { "alg": "RS256" }
}' | jq -r '"{\"client_id\":\"" + .client_id + "\",\"client_secret\": \"" +  .client_secret + "\"}"' > auth0-app-details.json
```

The output of the command will be a JSON object with the `client_id` and `client_secret` of the newly created client, which will be used in the next steps to configure the MCP server environment.

Next, we need to indicate Auth0 that the client can use Custom Token Exchange.

```shell
CLIENT_ID=$(jq -r '.client_id' auth0-app-details.json) \
&& auth0 api patch clients/${CLIENT_ID} --data '{
  "token_exchange": {
    "allow_any_profile_of_type": ["custom_authentication"]
  }
}'
```

And finally, because you need an API to call to, let's create one.

### Create a first-party API to call from the MCP server

Since your objective is to have the MCP server make a tool call that calls a protected first-party API you need to configure an API in Auth0, this will be your upstream API:

```shell
auth0 api post resource-servers --data '{
  "identifier": "http://localhost:8787/",
  "name": "Protected First Party API",
  "signing_alg": "RS256",
  "enforce_policies": true,
  "scopes": [
    {"value": "read:private", "description": "Private scope"}
  ]
}' | jq -r '"Audience: " + .identifier'
```

Save the `Audience` from the command output, you'll need it on a later step.

## Sample app
<Tabs>
  <Tab title="Javascript" icon="js">
    <Tabs>
      <Tab title="Use sample app (recommended)">
        Start by downloading the sample app for this quickstart. The sample includes a FastMCP MCP server with an Auth0 integration and a protected API built with
        [Fastify](https://fastify.dev/).

        <DownloadQuickstartButton
          category="auth-for-mcp"
          framework="fastmcp-mcp-customtokenexchange-js"
        />

        Once downloaded, extract the files and open the project in your preferred IDE.
      </Tab>
      <Tab title="Clone GitHub repository">
        Clone the repository and navigate to the sample app folder which includes a FastMCP MCP server with an Auth0 integration and a protected API built with
        [Fastify](https://fastify.dev/).

        ```shell wrap lines
        git clone https://github.com/auth0-samples/auth0-ai-samples.git
        cd auth0-ai-samples/auth-for-mcp/fastmcp-mcp-customtokenexchange-js
        ```

        Once cloned, open the project in your preferred IDE.
      </Tab>
    </Tabs>

    The sample app demonstrates custom token exchange with a `greet` tool that calls your protected API on behalf of the authenticated user.

    ## Install packages

    Ensure you have npm installed or follow the instructions to [install npm](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) in its documentation. From the root of your sample app directory, install the required packages:

    ```shell
    npm install
    ```

    ## Create your environment file
    <CreateEnvFile/>

    ## Use Custom Token Exchange Action
    <CustomTokenExchangeAction/>

    ## Setup the token exchange profile

    <CreateProfile />

    ## Run the MCP server and the API
    <RunMcpServerJs/>

    ## Exchange your access token
    <ExchangeAccessTokenJs/>
  </Tab>

  <Tab title="Python" icon="python">
    <Tabs>
      <Tab title="Use sample app (recommended)">
        Start by downloading the sample app for this quickstart. The sample includes a FastMCP MCP server with an Auth0 integration and a protected API built with
        [Fastify](https://fastify.dev/).

        <DownloadQuickstartButton
          category="auth-for-mcp"
          framework="fastmcp-mcp-customtokenexchange-python"
        />

        Once downloaded, extract the files and open the project in your preferred IDE.
      </Tab>
      <Tab title="Clone GitHub repository">
        Clone the repository and navigate to the sample app folder which includes a FastMCP MCP server with an Auth0 integration and a protected Starlette-based API.

        ```shell wrap lines
        git clone https://github.com/auth0-samples/auth0-ai-samples.git
        cd auth0-ai-samples/auth-for-mcp/fastmcp-mcp-customtokenexchange-python
        ```

        Once cloned, open the project in your preferred IDE.
      </Tab>
    </Tabs>
      The sample app demonstrates custom token exchange with a `greet` tool that calls your protected API on behalf of the authenticated user.

      ## Install packages

      Ensure you have poetry installed or follow the instructions to [install poetry](https://python-poetry.org/docs/) in its documentation. From the root of your sample app directory, install the required packages:

      ```shell
      poetry install
      ```

      ## Create your environment file
      <CreateEnvFile/>

      ## Use Custom Token Exchange Action
      <CustomTokenExchangeAction/>

      ## Setup the token exchange profile

      <CreateProfile />

      ## Run the MCP server and the API
      <RunMcpServerPython/>

      ## Exchange your access token
      <ExchangeAccessTokenPython/>
  </Tab>
</Tabs>

<MCPGetStartedTestingInstructions />

## Next steps

* To set up MCP server authorization, complete the [Authorization for Your MCP Server](./authorization-for-your-mcp-server) quickstart.
