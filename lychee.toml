# Central configuration for link checking with Lychee for consistency between
# local runs and CI.

# See Lychee docs for more config info: https://lychee.cli.rs/guides/config/

cache = true               # TODO: Update GitHub Action to use the cache
format = "detailed"        # Default output format is compact, so show more info
verbose = "error"          # List additional information in output about errors
no_progress = true         # Hide progress bar
include_fragments = true   # Check anchor links
include_verbatim = false   # Don't check links inside code blocks
exclude_all_private = true # Exclude link local, loopback, and private IPs.

# Treat these HTTP response codes as success.
# 100-103, 200â€“299: Successful status codes. Lychee's default accept list.
# 302 Found, 307 Temporary Redirect: Used in auth flows and login-gated docs.
# 403 Forbidden: Often from blocking unauthenticated requests or bots.
# 429 Too Many Requests: Often from rate-limiting bots.
accept = ["100..=103", "200..=299", "302", "307", "403", "429"]

# Set a root dir so Lychee can resolve relative links to URIs, even though we
# exclude relative links in the actual check.
root_dir = './'

exclude = [
    # Exclude root-relative links because Mintlify checks them.
    '^file://.*',

    # Exclude Auth0 sites that require interactive login or authentication.
    '^https://manage\.auth0\.com/',
    '^https://dashboard\.fga\.dev',
    '^https://accounts\.auth0\.com',
    '^https://oktawiki\.atlassian\.net/',

    # Exclude other sites that require interactive login.
    '^https://admin\.microsoft\.com',
    '^https://app\.mailjet\.com',
    '^https://console\.aws\.amazon\.com',

    # Exclude anchors on our dynamically-rendered API docs.
    '^https://auth0\.com/docs(?:/(fr-ca|ja-jp))?/api/authentication.*#',
    '^https://auth0\.com/docs(?:/(fr-ca|ja-jp))?/api/management/v2.*#',

    # Exclude GitHub links specific lines in a file because Lychee can't check
    # the line highlighting anchor.
    '^https://github.com/.*#L[0-9]+',

    # Exclude non-resolving links in components (e.g. TokenVaultConfigBlock)
    # because Lychee doesn't recognize the component to skip the check.
    # TODO: Look into file preprocessing to remove links in components.
    '^https://graph.microsoft.com',
    '^https://auth.snapchat.com',
]
