---
description: Learn how to check if a user has logged in your web app with Multi-factor
  Authentication (MFA) by examining their ID Token.
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': Configure Step-up Authentication for Web Apps
'og:url': https://auth0.com/docs/
permalink: configure-step-up-authentication-for-web-apps
title: Configure Step-up Authentication for Web Apps
'twitter:description': Learn how to check if a user has logged in your web app with
  Multi-factor Authentication (MFA) by examining their ID Token.
'twitter:title': Configure Step-up Authentication for Web Apps
---
With step-up authentication, applications that allow access to different types of resources can require users to authenticate with a stronger mechanism to access sensitive information or perform certain transactions.

For instance, a user may be allowed to access views with sensitive data or reset their password only after confirming their identity using <Tooltip tip="Multi-factor authentication (MFA): User authentication process that uses a factor in addition to username and password such as a code via SMS." cta="View Glossary" href="/docs/glossary?term=multi-factor+authentication">multi-factor authentication</Tooltip> (MFA).

To accomplish step-up authentication for your web app, you will create an Action that challenges the user to authenticate with MFA when the web app asks for it, check the <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+Token">ID Token</Tooltip> claims for MFA if the user tries to access a restricted page, and then challenge the user if MFA is not included in the claim.

## Validate ID tokens for MFA

When a user logs in, you get an [ID token](/docs/secure/tokens/id-tokens/get-id-tokens) that contains information relevant to the user's session in the form of claims. The relevant claim is `amr` (authentication methods reference) which is a JSON array of strings that indicates the authentication method used during login. It must be present in the ID token's payload and must contain the value `mfa`.

Its values may include any of the pre-defined [Authentication Method Reference Values](https://tools.ietf.org/html/rfc8176). Because it can contain claims other than `mfa`, when validating you must both test for its existence and examine its contents for a value of `mfa`.

If a user attempts to access a restricted page and the token shows that the user has not authenticated with MFA, then you can retrigger authentication, which you have configured to trigger MFA using an Action. Once the user provides the second factor, a new ID token that contains the `amr` claim is generated and sent to the app.

1. [Get the ID token](/docs/secure/tokens/id-tokens/get-id-tokens).
2. Verify the token's signature, which is used to verify that the sender of the token is who it says it is and to ensure that the message wasn't changed along the way.
3. Validate the following claims:

    <table class="table"><thead>
    <tr>
    <th>Claim</th>
    <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td><code>exp</code></td>
    <td>Token expiration</td>
    </tr>
    <tr>
    <td><code>iss</code></td>
    <td>Token issuer</td>
    </tr>
    <tr>
    <td><code>aud</code></td>
    <td>Intended recipient of the token</td>
    </tr>
    <tr>
    <td><code>amr</code></td>
    <td>If <code>amr</code> does not exist in the payload or does not contain the value <code>mfa</code>, the user did not log in with MFA. If <code>amr</code> exists in the payload and contains the value <code>mfa</code>, then the user did log in with MFA.</td>
    </tr>
    </tbody>
    </table>

#### AMR claim exceptions

The `amr` claim is required except in the following use cases:

1. In hosted login flows, only after the user successfully passes an MFA challenge, the `amr` claim is injected into the ID token. If the app uses silent authentication or Refresh Tokens for newly issued ID tokens, the `amr` claim will not be present because the user previously completed login with MFA.
2. MFA API issued tokens do not contain the `amr` claim. The `amr` claim flags the authentication methods used when the user receives the ID Token. In the MFA API authentication process, the application controls the authentication flow and can enforce MFA as needed.

In the examples below, you can compare the potential values included in an ID token's payload when a user has authenticated with MFA versus when they have not.

### Example: Values with MFA

{/* codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet */}


```json lines
{
    "iss": "https://{yourDomain}/",
    "sub": "auth0|1a2b3c4d5e6f7g8h9i",
    "aud": "{yourClientId}",
    "iat": 1522838054,
    "exp": 1522874054,
    "acr": "http://schemas.openid.net/pape/policies/2007/06/multi-factor",
    "amr": [
        "mfa"
    ]
}
```






### Example: Values without MFA

```json lines
{
    "iss": "https://{yourDomain}/",
    "sub": "auth0|1a2b3c4d5e6f7g8h9i",
    "aud": "{yourClientId}",
    "iat": 1522838054,
    "exp": 1522874054
}
```






## Scenario: Salary data with push notifications

In the following scenario, a web app authenticates a user with a username and password. Some users want to access a specific screen that displays salary data, so they must authenticate with Guardian push factor.

### Prerequisites

For this scenario, you must configure the following items in the Dashboard:

* [Register a web app](/docs/get-started/auth0-overview/create-applications/regular-web-apps).
* [Create a database connection](https://manage.auth0.com/#/connections/database).
* [Enable MFA](/docs/secure/multi-factor-authentication/enable-mfa) to use push notifications.

### Create an Action

Create an Action that challenges the user to authenticate with MFA when the web app requests it. Go to [Dashboard > Actions > Flows](https://manage.auth0.com/#/actions/flows), and create an Action that contains the following content:

```js lines
exports.onExecutePostLogin = async (event, api) => {
 const CLIENTS_WITH_MFA = ['REPLACE_WITH_YOUR_CLIENT_ID'];
 // run only for the specified clients
 if (CLIENTS_WITH_MFA.includes(event.client.client_id)) {
 // ask for MFA only if the web app said so in the authentication request
 if (event.transaction?.acr_values.includes('http://schemas.openid.net/pape/policies/2007/06/multi-factor')) {
 api.multifactor.enable('any', { allowRememberBrowser: false });
 }
 }
}
```






* The `CLIENTS_WITH_MFA` variable contains the <Tooltip tip="Client ID: Identification value given to your registered resource from Auth0." cta="View Glossary" href="/docs/glossary?term=client+IDs">client IDs</Tooltip> of the applications you want this Action to apply to. You can remove this (and the `if` conditional that follows) if you don't need it.
* The `event.transaction.acr_values` property is an array of strings that contains the authentication context class reference(s) (`acr`). This is an optional property that only exists when the application includes it in the authentication request to the <Tooltip tip="Authorization Server: Centralized server that contributes to defining the boundaries of a userâ€™s access. For example, your authorization server can control the data, tasks, and features available to a user." cta="View Glossary" href="/docs/glossary?term=Authorization+Server">Authorization Server</Tooltip>. In this example, our web app will include it in the authentication request, but only when a user who has not already authenticated with MFA tries to access salary information. When our web app includes it, it will set a value of `http://schemas.openid.net/pape/policies/2007/06/multi-factor`, which indicates that we want the Authorization Server to require MFA, and the `api.multifactor` property value that we set in our code will challenge the user for MFA using any of the available methods that have been configured in the tenant. To learn more about the `api.multifactor.enable()` method, read [Action Triggers: post-login API object](/docs/customize/actions/explore-triggers/password-reset-triggers/post-challenge-trigger/post-challenge-api-object).
* The `http://schemas.openid.net/pape/policies/2007/06/multi-factor` policy defines an authentication mechanism where the end user authenticates to the <Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Provider by providing more than one authentication factor, or MFA. To learn more, read [OpenID Provider Authentication Policy Extension 1.0](https://openid.net/specs/openid-provider-authentication-policy-extension-1_0.html).

### Configure app

Configure the app to check that the user has authenticated using MFA when a user tries to access the restricted salary information page. (When a user has authenticated with MFA, the ID token claims contain the `amr` claim with a value of `mfa`.) If the user has already authenticated with MFA, then the web app will display the restricted page; otherwise, the web app will send a new authentication request that includes the `acr_values` parameter with a value of:
`http://schemas.openid.net/pape/policies/2007/06/multi-factor`which will trigger the Action.

The web app in this scenario uses the [Authorization Code Flow](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow) to authenticate, so the request is as follows:

```http lines
https://{yourDomain}/authorize?
        audience=https://{yourDomain}/userinfo&
        scope=openid&
        response_type=code&
        client_id={yourClientId}&
        redirect_uri={https://yourApp/callback}&
        state={yourOpaqueValue}&
        acr_values=http://schemas.openid.net/pape/policies/2007/06/multi-factor
```






Once the user authenticates with MFA, the web app receives the authorization code, which must be exchanged for the new ID token, which should now contain the `amr` claim with a value of `mfa`. To learn how to exchange the code for an ID token, read [Add Login Using the Authorization Code Flow](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow/add-login-auth-code-flow).

### Validate ID token

In this scenario, perform the validations using the [JSON Web Token Sample Code](https://github.com/auth0/node-jsonwebtoken), which verifies the token's signature (`jwt.verify`), decodes the token, checks whether the payload contains `amr`, and if so, logs the results in the console.

```javascript lines
const AUTH0_CLIENT_SECRET = '{yourClientSecret}';
const jwt = require('jsonwebtoken');

jwt.verify(id_token, AUTH0_CLIENT_SECRET, { algorithms: ['HS256'] }, function(err, decoded) {
  if (err) {
    console.log('invalid token');
    return;
  }

  if (Array.isArray(decoded.amr) && decoded.amr.indexOf('mfa') >= 0) {
    console.log('You used mfa');
    return;
  }

  console.log('you are not using mfa');
});
```






## Learn more

* [ID Tokens](/docs/secure/tokens/id-tokens)
* [Rule Use Cases](/docs/customize/rules/use-cases)
* [JSON Web Tokens](/docs/secure/tokens/json-web-tokens)
* [Configure Step-up Authentication for APIs](/docs/secure/multi-factor-authentication/step-up-authentication/configure-step-up-authentication-for-apis)