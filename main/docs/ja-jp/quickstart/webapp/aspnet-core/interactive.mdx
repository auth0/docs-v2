---
title: "ASP.NET MVCアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、新規または既存のASP.NET MVCアプリケーションにAuth0.AspNetCore.Authentication SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "ASP.NET MVCアプリケーションにログインを追加する"
'og:description': "このガイドは、新規または既存のASP.NET MVCアプリケーションにAuth0.AspNetCore.Authentication SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/asp.png"
'twitter:title': "ASP.NET MVCアプリケーションにログインを追加する"
'twitter:description': "このガイドは、新規または既存のASP.NET MVCアプリケーションにAuth0.AspNetCore.Authentication SDKを使ってAuth0を統合する方法を説明します。"
sidebarTitle: ASP.NET Core MVC
mode: wide
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import AppSettingsJSON from "/snippets/quickstart/webapp/aspnet-core/appsettings.json.mdx";
import AccountController from "/snippets/quickstart/webapp/aspnet-core/AccountController.cs.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "sdkをインストールして構成する", title: "SDKをインストールして構成する" },
  { id: "ログイン", title: "ログイン" },
  { id: "ユーザープロファイルを表示する", title: "ユーザープロファイルを表示する" },
  { id: "ログアウト", title: "ログアウト" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加して、ユーザープロファイル情報にアクセスすることができます。このガイドは、新規または既存のASP.NET
        MVCアプリケーションに**Auth0.AspNetCore.Authentication** SDKを使ってAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      ### Nugetからインストールする

      Auth0をASP.NET Coreと統合するには、`Auth0.AspNetCore.Authentication`[Nugetパッケージ](https://www.nuget.org/packages/Auth0.AspNetCore.Authentication/)をアプリケーションにインストールすることでSDKを使用できます。

      ### ミドルウェアを構成する

      ASP.NET
            Coreアプリケーションで認証を可能にするには、SDKが提供するミドルウェアを使います。`Program.cs`ファイルに移動して`builder.Services.AddAuth0WebAppAuthentication()`を呼び出し、SDKのミドルウェアを登録します。

      `Domain`と`ClientId`は必ず構成してください。SDKがどのAuth0テナントとアプリケーションを使用すべきかを認識するために必要となるフィールドです。

      認証と認可が`Program.cs`ファイルで有効になったことを確認します。
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      ユーザーによるASP.NET MVCアプリケーションへのログインを許可するには、コントローラーに`Login`アクションを追加します。

      `HttpContext.ChallengeAsync()`を呼び出し、`Auth0Constants.AuthenticationScheme`を認証スキームとして渡します。これによりSDKが内部に登録しているOIDC認証ハンドラーが発動されます。関連する`authenticationProperties`も必ず指定してください。構築は`LoginAuthenticationPropertiesBuilder`で行えます。

      `HttpContext.ChallengeAsync()`の呼び出し成功後、ユーザーはAuth0にリダイレクトされます。その後アプリケーションにリダイレクトで戻された際に、OIDCミドルウェアとクッキーミドルウェアの両方にサインインしています。これにより、ユーザーは後続の要求でも認証されるようになります。

      <Note>
      ##### チェックポイント

      Loginの構成が完了したら、アプリケーションを実行して次の点を確認します：

      - `Login`アクションに移動すると、Auth0にリダイレクトされる。
      - 資格情報を入力すると、リダイレクトでアプリケーションに戻る。
      </Note>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      ミドルウェアはAuth0からトークンを取得すると、IDトークンからユーザー情報とクレームを抽出し、コントローラーで`User.Claims`プロパティとして利用できるようにします。

      ユーザーの名前、メールアドレス、プロファイル画像を表示するカスタムユーザープロファイルを作成するには、`User`から関連する情報を取得し、コントローラー内からビューに渡します。

      <Note>
      ##### チェックポイント

      ユーザープロファイルを表示するようアクションをセットアップし終えたら、アプリケーションを実行して次の点を確認します：

      - ログイン成功後に`Profile`アクションに移動すると、ユーザープロファイルが表示される。
      </Note>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      コントローラーのアクション内から`HttpContext.SignOutAsync`を`CookieAuthenticationDefaults.AuthenticationScheme`認証スキームで呼び出すと、ユーザーをアプリケーションからログアウトさせられます。

      さらに、ユーザーをAuth0からもログアウトさせたい場合は（これによりシングルサインオンに依拠している他のアプリケーションからもログアウトさせる可能性があります）、`HttpContext.SignOutAsync`を`Auth0Constants.AuthenticationScheme`認証スキームで呼び出します。また、`LogoutAuthenticationPropertiesBuilder`を使って構築できる適切な`authenticationProperties`も同じ認証スキームで呼び出します。

      <Note>
      ##### チェックポイント

      Logoutの構成が完了したら、アプリケーションを実行して次の点を確認します：

      - `Logout`アクションに移動すると、ユーザーが確実にログアウトする。
      - Auth0からもログアウトすると、Auth0にリダイレクトされ、即座にアプリケーションにリダイレクトで戻される。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-aspnetcore-authentication SDK](https://github.com/auth0/auth0-aspnetcore-authentication) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <AuthCodeGroup>
        <AppSettingsJSON/>
        <AccountController/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <AuthCodeGroup>
        <AccountController/>
        <AppSettingsJSON/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <SignUpForm />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
