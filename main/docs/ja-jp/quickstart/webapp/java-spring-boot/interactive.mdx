---
title: "Spring Webアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドでは、Spring BootアプリケーションにAuth0 Spring Boot SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "Spring Webアプリケーションにログインを追加する"
'og:description': "このガイドでは、Spring BootアプリケーションにAuth0 Spring Boot SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/spring.png"
'twitter:title': "Spring Webアプリケーションにログインを追加する"
'twitter:description': "このガイドでは、Spring BootアプリケーションにAuth0 Spring Boot SDKを使ってAuth0を統合する方法を説明します。"
sidebarTitle: Java Spring Boot
mode: wide
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Application from "/snippets/quickstart/webapp/java-spring-boot/application.yml.mdx";
import Securityconfig from "/snippets/quickstart/webapp/java-spring-boot/SecurityConfig.java.mdx";
import Index from "/snippets/quickstart/webapp/java-spring-boot/index.html.mdx";
import Homecontroller from "/snippets/quickstart/webapp/java-spring-boot/HomeController.java.mdx";
import Securityconfigwithlogout from "/snippets/quickstart/webapp/java-spring-boot/SecurityConfigWithLogout.java.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "sprint-bootアプリケーションを構成する", title: "Sprint Bootアプリケーションを構成する" },
  { id: "spring-securityを構成する", title: "Spring Securityを構成する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "表紙ページを追加する", title: "表紙ページを追加する" },
  { id: "コントローラーを追加する", title: "コントローラーを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" }
]

<Recipe>
  <Content>
    <Info>
    このチュートリアルでは[Spring MVC](https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html)を使用します。[Spring WebFlux](https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#spring-web-reactive)を使用している場合、認証を追加する手順は似ていますが、実装の詳細は一部異なります。[Spring Boot WebFluxサンプルコード](https://github.com/auth0-samples/auth0-spring-boot-login-samples/tree/master/webflux-login)で、Auth0とSpring Boot
                  WebFluxアプリケーションの統合方法を確認してください。
    </Info>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadでセットアップしたアプリケーションが必要です。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      インタラクティブセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0の全てのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションに自動更新を行います。今後、アプリケーションの管理はDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合には、次の値に設定します：

      `http://localhost:3000/login/oauth2/code/okta`
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合には、次の値に設定します：

      `http://localhost:3000`
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      ### Spring依存関係を追加する

      Spring BootアプリケーションをAuth0と統合するには、[Okta Spring Boot Starter](https://github.com/okta/okta-spring-boot/)をアプリケーションの依存関係に含めます。

      <Info>
      このガイドでは、ビューレイヤー用に[Thymeleaf](https://www.thymeleaf.org/)と[Spring Security統合モジュール](https://github.com/thymeleaf/thymeleaf-extras-springsecurity)を使用しています。別の表示技術を使用している場合、Spring
                      Securityの構成とコンポーネントはそのまま同じです。
      </Info>

      Gradleを使用している場合は、以下のようにこれらの依存関係を含めることができます。

      ```text lines
      plugins {
        id 'java'
        id 'org.springframework.boot' version '3.1.4'
        id 'io.spring.dependency-management' version '1.1.3'
      }
      implementation 'com.okta.spring:okta-spring-boot-starter:3.0.5'
      implementation 'org.springframework.boot:spring-boot-starter-web'
      implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
      implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'
      implementation 'nz.net.ultraq.thymeleaf:thymeleaf-layout-dialect'
      ```

      Mavenを使用している場合：

      ```xml lines expandable
      <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>3.1.4</version>
      <relativePath/>
      </parent>
      <dependencies>
      <dependency>
      <groupId>com.okta</groupId>
      <artifactId>okta-spring-boot-starter</artifactId>
      <version>3.0.5</version>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-oauth2-client</artifactId>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-thymeleaf</artifactId>
      </dependency>
      <dependency>
      <groupId>org.thymeleaf.extras</groupId>
      <artifactId>thymeleaf-extras-springsecurity6</artifactId>
      </dependency>
      <dependency>
      <groupId>nz.net.ultraq.thymeleaf</groupId>
      <artifactId>thymeleaf-layout-dialect</artifactId>
      </dependency>
      </dependencies>
      ```
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Okta Spring Boot
            Starterでは、Auth0でアプリケーションを簡単に構成できます。以下のサンプルでは`application.yml`ファイルを使用していますが、プロパティファイルや他の[サポートされる表出化メカニズム](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config)を使用することもできます。

      ```yml lines
      #src/main/resources/application.yml
      okta:
      oauth2:
      issuer: https://dev-gja8kxz4ndtex3rq.us.auth0.com/

      client-id: mz9iNEIo2PHu7oeh8QRt19ndTyyCIgai

      client-secret: yLTW7npKO4g1HHsCENiZbOaHHXLmhVefJxdNnXcyhOBOomZ2tgjJjSC2pMK7Swvr

      #The sample and instructions above for the callback and logout URL configuration use port 3000.
      #If you wish to use a different port, change this and be sure your callback and logout URLs are
      #configured with the correct port.
      server:
      port: 3000
      ```
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Auth0でユーザーログインを有効にするには、[SecurityFilterChain](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/SecurityFilterChain.html)を登録するクラスを作成し、`@Configuration`の注釈を追加します。

      <Info>
      すべてまたは特定のパスで認証を必須にするために、[HttpSecurity](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html)インスタンスを構成することができます。たとえば、ホームページを除くすべてのパスで認証を必須にするには、以下のようにします：
      </Info>

      ```java lines
      http.authorizeHttpRequests(authorize -> authorize
          .requestMatchers(&quot;/&quot;).permitAll()

          .anyRequest().authenticated()

      );
      ```
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Okta Spring Boot
            Starterは以前に定義したクライアント構成を使って、ユーザーがアプリケーションの`/oauth2/authorization/okta`パスにアクセスしたときのログインを処理します。これを使用して、アプリケーションでログインリンクを作成することができます。

      このページは、ユーザー認証時にユーザー属性を返します。テンプレートの`/logout`リンクを使用して、ログアウト機能を実装します。
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      受信要求を処理するようにコントロールを作成します。このコントローラは`index.html`ページをレンダリングします。ユーザー認証時に、アプリケーションはユーザーのプロファイル情報の属性を取得し、ページをレンダリングします。

      <Note>
      ##### チェックポイント

      ログインリンクをクリックすると、アプリケーションによって[Auth0ユニバーサルログイン](https://auth0.com/universal-login)ページにリダイレクトされ、ユーザー名とパスワードまたはソーシャルプロバイダーを使ってログインまたはサインアップできるようになったことを確認します。
      </Note>

      <Info>
      Auth0は、Googleソーシャルプロバイダーを新しいテナントでデフォルトで有効にし、[ソーシャルIDプロバイダー](/docs/ja-jp/connections/identity-providers-social)でログインテストを実施するための開発者キーを提供します。ただし、これらの開発者キーにはいくつかの制限が設けられており、これによってアプリケーションが異なる動作をする場合があります。この動作の様子と修正方法については、「[Auth0開発者キーを使ってソーシャル接続をテストする](/docs/ja-jp/connections/social/devkeys#limitations-of-developer-keys)」ドキュメントを参照してください。
      </Info>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      アプリケーションにログインできるようになったら、[ログアウトする方法](/docs/ja-jp/logout/guides/logout-auth0)が必要です。デフォルトで、ログアウトが有効になると、Spring
            Securityはユーザーをアプリケーションからログアウトし、セッションを消去します。Auth0から正常にログアウトするには、`LogoutHandler`でユーザーを[Auth0ログアウトエンドポイント](https://auth0.com/docs/api/authentication?javascript#logout)（`https://{yourDomain}/v2/logout`）にリダイレクトした直後に、アプリケーションにリダイレクトします。

      `SecurityConfig`クラスで`LogoutHandler`を指定すると、Auth0ログアウトエンドポイントにリダイレクトされ、ログアウトハンドラを追加するように`HttpSecurity`を構成します。

      <Note>
      ##### チェックポイント

      ログアウトリンクをクリックすると、「Settings（設定）」にある［Allowed Logout
                    URLs（許可されているログアウトURL）］のいずれかに指定されたアドレスにリダイレクトされ、アプリケーションにログインされなくなります。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Okta Spring Boot Starter SDK](https://github.com/okta/okta-spring-boot/) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <AuthCodeGroup>
        <Application/>
        <Securityconfig/>
        <Index/>
        <Homecontroller/>
        <Securityconfigwithlogout/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <AuthCodeGroup>
        <Securityconfig/>
        <Application/>
        <Index/>
        <Homecontroller/>
        <Securityconfigwithlogout/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <AuthCodeGroup>
        <Index/>
        <Application/>
        <Securityconfig/>
        <Homecontroller/>
        <Securityconfigwithlogout/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <AuthCodeGroup>
        <Homecontroller/>
        <Application/>
        <Securityconfig/>
        <Index/>
        <Securityconfigwithlogout/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <AuthCodeGroup>
        <Securityconfigwithlogout/>
        <Application/>
        <Securityconfig/>
        <Index/>
        <Homecontroller/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
