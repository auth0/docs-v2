---
title: "Spring Bootアプリケーションに認可を追加する"
permalink: "interactive"
'description': "このガイドは、新規または既存のSpring BootアプリケーションにAuth0を統合する方法を説明します。"
'og:title': "Spring Bootアプリケーションに認可を追加する"
'og:description': "このガイドは、新規または既存のSpring BootアプリケーションにAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/java.png"
'twitter:title': "Spring Bootアプリケーションに認可を追加する"
'twitter:description': "このガイドは、新規または既存のSpring BootアプリケーションにAuth0を統合する方法を説明します。"
sidebarTitle: Spring Boot API
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Application from "/snippets/quickstart/backend/java-spring-security5/application.yml.mdx";
import Securityconfig from "/snippets/quickstart/backend/java-spring-security5/SecurityConfig.java.mdx";
import Apicontroller from "/snippets/quickstart/backend/java-spring-security5/APIController.java.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "アクセス許可を定義する", title: "アクセス許可を定義する" },
  { id: "サンプルプロジェクトを構成する", title: "サンプルプロジェクトを構成する" },
  { id: "依存関係をインストールする", title: "依存関係をインストールする" },
  { id: "リソースサーバーを構成する", title: "リソースサーバーを構成する" },
  { id: "ドメインオブジェクトを作成する", title: "ドメインオブジェクトを作成する" },
  { id: "apiコントローラーを作成する", title: "APIコントローラーを作成する" },
  { id: "アプリケーションを実行する", title: "アプリケーションを実行する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションにすばやく認可を追加することができます。このガイドは、新規または既存のSpring BootアプリケーションにAuth0を統合する方法を説明します。

    Auth0 DashboardでAPIをまだ作成していない場合は、対話型のセレクターを使ってAuth0 APIを新規作成します。そうでない場合は、統合したいプロジェクトを表す既存のAPIを選択します。

    Auth0 Dashboardを使って初めてAPIをセットアップする場合には、[使用の開始ガイド](/docs/ja-jp/get-started/auth0-overview/set-up-apis)を確認してください。

    それぞれのAuth0 APIにはAPI識別子があり、アプリケーションにアクセストークンの検証で使用されます。

    <Info>
    **Auth0を初めてご利用ですか？** [Auth0の仕組み](/docs/ja-jp/overview)と、OAuth 2.0フレームワークを用いた[API認証と認可の実装](/docs/ja-jp/api-auth)について説明します。
    </Info>

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      アクセス許可は、ユーザーの代わりに、提供されたアクセストークンを使ってどのようにしてリソースにアクセスできるのかを定義できるようにします。たとえば、ユーザーがマネージャーアクセスレベルを持つ場合には、`messages`リソースに対して読み出しアクセスを付与し、管理者アクセスレベルを持つ場合には、書き込みアクセスを付与することができます。

      Auth0 Dashboardの[［APIs］](https://manage.auth0.com/dashboard/us/dev-1-2s2aq0/apis)セクションにある**［Permissions（権限）］** ビューで使用可能なアクセス許可を定義することができます。

      <Frame>![［Auth0 Dashboard］>［Applications（アプリケーション）］>［APIs］>［Specific API（特定のAPI］>［Permissions（権限）］タブ](/docs/images/ja-jp/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/acef814282795bef6921535f044f96e9/Quickstarts_API.png)</Frame>

      <Info>
      以下の例では`read:messages`スコープを使用します。
      </Info>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      サンプルプロジェクトは`/src/main/resources/application.yml`ファイルを使用し、これをAPIに対して正しいAuth0**ドメイン** と**API識別子** を使用するように構成します。このページからコードをダウンロードすると、自動的に構成されます。GitHubから例を複製する場合は、ご自身で入力する必要があります。
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Gradleを使用している場合、[Spring Boot Gradleプラグイン](https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/)と[Dependency Managementプラグイン](https://docs.spring.io/dependency-management-plugin/docs/current/reference/html/)を使って必要な依存関係を追加し、依存関係のバージョンを解決することができます：

      ```gradle
      // build.gradle
      plugins {

          id 'java'

          id 'org.springframework.boot'

          version '3.1.5'

          id 'io.spring.dependency-management'

          version '1.1.3'

      }

      dependencies {

          implementation 'org.springframework.boot:spring-boot-starter-web'

          implementation 'com.okta.spring:okta-spring-boot-starter:3.0.5'

      }
      ```

      Mavenを使用している場合は、Springの依存関係を`pom.xml`ファイルに追加します：

      ```xml
      // pom.xml
      <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>3.1.5</version>
      <relativePath/>
      </parent>
      <dependencies>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
      </dependency>
      <dependency>
      <groupId>com.okta.spring</groupId>
      <artifactId>okta-spring-boot-starter</artifactId>
      <version>3.0.5</version>
      </dependency>
      </dependencies>
      ```
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      アプリケーションをリソースサーバーとして構成し、JWTを検証するには、`SecurityFilterChain`のインスタンスを提供するクラスを作成し、`@Configuration`の注釈を追加します。

      ### APIエンドポイントを保護する

      以下に示されたルートは次の要求で使用することができます：

      - `GET /api/public`：認証を必要としない要求に使用できる
      - `GET /api/private`：追加スコープのないアクセストークンを含む認証された要求に使用できる
      - `GET /api/private-scoped`：`read:messages`スコープが付与されたアクセストークンを含む認証された要求に使用できる

      以下の例は、`SecurityConfig`クラスの`filterChain()`メソッドで指定された`HttpSecurity`オブジェクトを使用して、APIメソッドのセキュリティを確保する方法を示します。ルートマッチャーは必要な認可レベルに基づいてアクセスを制限します。

      <Info>
      デフォルトで、Spring SecurityはJWTの`scope`クレームで、クレームごとに`GrantedAuthority`を作成します。このスコープでは、`hasAuthority("SCOPE_read:messages")`メソッドを使用して、`read:messages`スコープを含む有効なJWTへのアクセスを制限することができます。
      </Info>
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      エンドポイントがJSONを返すには、Javaレコードを使用することができます。このオブジェクトのメンバー変数は、JSONのキー値にシリアル化されます。`Message`と呼ばれる新しいレコードを、API呼び出し中に返すサンプルドメインオブジェクトとして作成します。
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      `APIController`という名前の新しいクラスを作成し、エンドポイントへの要求を処理します。`APIController`には、[APIエンドポイントを保護する](/docs/ja-jp/quickstart/backend/java-spring-security5/interactive#configure-the-resource-server)セクションで定義されるように、3つのルートがあります。たとえば、`@CrossOrigin`の注釈からすべてのオリジンを許可します。実際のアプリケーションでは、ユースケースに対して`CORS`を構成する必要があります。
      </Section>

      <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      サンプルプロジェクトを構築し実行するには、`bootRun` Gradleタスクを実行します。

      LinuxまたはmacOS：

      ```sh
      ./gradlew bootRun
      ```

      Windows：

      ```ps
      gradlew.bat bootRun
      ```

      Mavenと[Spring Boot Mavenプラグイン](https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html)で独自のアプリケーションを構成している場合は、`spring-boot:run`ゴールを実行することができます。

      LinuxまたはmacOS：

      ```sh
      mvn spring-boot:run
      ```

      Windows：

      ```ps
      mvn.cmd spring-boot:run
      ```

      <Note>
      ##### チェックポイント
      サンプルアプリケーションはhttp://localhost:3010/で入手できます。「APIの使用」の記事でAPIをテストおよび使用する方法についてお読みください。
      </Note>
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Okta Spring Boot Starter SDK](https://github.com/okta/okta-spring-boot/) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <AuthCodeGroup>
          <Application/>
          <Securityconfig/>
          <Apicontroller/>
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <AuthCodeGroup>
          <Application/>
          <Securityconfig/>
          <Apicontroller/>
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <AuthCodeGroup>
          <Securityconfig/>
          <Application/>
          <Apicontroller/>
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <AuthCodeGroup>
          <Application/>
          <Securityconfig/>
          <Apicontroller/>
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <AuthCodeGroup>
          <Apicontroller/>
          <Securityconfig/>
          <Application/>
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <SignUpForm />
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
