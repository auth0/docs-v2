---
title: "PHPアプリケーションに認可を追加する"
permalink: "interactive"
'description': "このガイドは、Auth0 PHP SDKを使ってAuth0を統合し、トークンベースの認可の追加とアプリケーションルートの保護を行う方法について説明します。"
'og:title': "PHPアプリケーションに認可を追加する"
'og:description': "このガイドは、Auth0 PHP SDKを使ってAuth0を統合し、トークンベースの認可の追加とアプリケーションルートの保護を行う方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/php.png"
'twitter:title': "PHPアプリケーションに認可を追加する"
'twitter:description': "このガイドは、Auth0 PHP SDKを使ってAuth0を統合し、トークンベースの認可の追加とアプリケーションルートの保護を行う方法について説明します。"
sidebarTitle: PHP API
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Index from "/snippets/quickstart/backend/php/index.php.mdx";
import Index2 from "/snippets/quickstart/backend/php/index.php2.mdx";
import Router from "/snippets/quickstart/backend/php/router.php.mdx";
import Router2 from "/snippets/quickstart/backend/php/router.php2.mdx";
import Router3 from "/snippets/quickstart/backend/php/router.php3.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-php-sdkをインストールする", title: "Auth0 PHP SDKをインストールする" },
  { id: "ベアラートークンをリッスンする", title: "ベアラートークンをリッスンする" },
  { id: "ルートを作成-構成する", title: "ルートを作成・構成する" },
  { id: "エンドポイント認可を構成する", title: "エンドポイント認可を構成する" },
  { id: "スコープで認可する", title: "スコープで認可する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽にトークンベースのエンドポイント認可を追加することができます。このガイドは、Auth0 PHP SDKを使ってAuth0を統合し、トークンベースの認可の追加とアプリケーションルートの保護を行う方法について説明します。

    このクイックスタートを使用するには、以下の手順に従います：

    - Auth0の無料アカウントにサインアップするか、Auth0にログインします。
    - Auth0に統合したいPHPプロジェクトを用意します。または、ログインした後に、サンプルアプリケーションを表示してダウンロードすることもできます。

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに登録済みのアプリケーションがある必要があります。Auth0アプリケーションは、プロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0 APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### APIを構成する

      同様に、Auth0 APIを新規作成するか、[Dashboard](https://manage.auth0.com/#/)から統合するプロジェクトを表す既存のAPIを使用する必要があります。APIに一意の識別子を選択して記録します。以下のアプリケーションを構成するには、その識別子が必要です。
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      PHPアプリで、Auth0の認証・認可を手軽に実装できるように、Auth0は[PHP SDK](https://github.com/auth0/auth0-PHP)（Auth0-PHP）を提供しています。

      Auth0 PHP SDKでは、ネットワーク要求を管理するために、[PSR-17](https://www.php-fig.org/psr/psr-17/)と[PSR-18](https://www.php-fig.org/psr/psr-18/)対応HTTPライブラリーをインストールする必要があります。ライブラリーがない場合は、ターミナルで以下のコマンドを実行して、信頼できる選択肢をインストールすることができます：

      ```
      cd <your-project-directory>
      composer require symfony/http-client nyholm/psr7
      ```

      ターミナルで以下のコマンドを実行してAuth0 PHP SDKをインストールします：

      ```
      composer require auth0/auth0-php
      ```

      ### Auth0 SDKを構成する

      SDKが正しく機能するためには、次のプロパティを初期化中にAuth0 SDKで設定しなければなりません：

      - `strategy`：アプリのユースケースでSDKの動作を導くのに役立ちます。この場合は、以下の定数に設定します。

        `Auth0\SDK\Configuration\SdkConfiguration::STRATEGY_API`
      - domain：Auth0テナントのドメインです。通常、Auth0 Dashboardにあるアプリケーションの［Settings（設定）］の［Domain（ドメイン）］フィールドで確認できます。カスタムドメインを使用している場合は、この値をカスタムドメインの値に設定してください。
      - clientId：このクイックスタートで前にセットアップした、Auth0アプリケーションのIDです。Auth0 Dashboardにあるアプリケーションの［Settings（設定）］の［Client ID（クライアントID）］フィールドで確認できます。
      - clientSecret：このクイックスタートで前にセットアップしたAuth0アプリケーションのシークレットです。Auth0 Dashboardにあるアプリケーションの［Settings（設定）］の［Client Secret（クライアントシークレット）］フィールドにあります。
      - audience：上で登録したAuth0 APIの識別子です。配列として指定されている必要があります。

      <Note>
      ##### チェックポイント
      Auth0 SDKが正しく構成されました。アプリケーションを実行して次の点を確認します：
      SDKが正しく初期化している。
      アプリケーションがAuth0に関連したエラーを投入していない。
      </Note>
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      次に、ベアラートークンを取得し処理するためにアプリケーションを拡張します。ベアラートークンはAPIに提供されるアクセストークンで、ユーザーに代わってクライアントから要求されます。アクセストークンは、アプリケーションでルートへのアクセスを承認または拒否します。これは、エンドポイント認可と呼ばれます。

      要求からアクセストークンを取得する最も簡単な方法は、PHP SDKの`getBearerToken()`メソッドを使用するものです。このメソッドは、GETパラメーター、POST本文、要求ヘッダー、および他のソースからトークンを取得します。この場合、PHP SDKは`token`パラメーターのGET要求、またはHTTP `Authorization`ヘッダーから渡されたトークンを処理します。
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      次に、受信する要求をアプリケーションにダイレクトするために、ルーティングライブラリーをインストールします。これは必須手順ではありませんが、本クイックスタートの目的上、アプリケーション構造が簡略化されます。

      ```
      composer require steampixel/simple-php-router
      ```

      アプリケーションで`router.php`と呼ばれる新規ファイルを作成し、ルートを定義します。**router.php** タブにある、右のインタラクティブパネルからコードをコピーします。
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Auth0アプリケーションとAuth0 PHP SDKを構成し、アプリケーションで要求からベアラートークンを取得したら、次の手順はプロジェクトにエンドポイント認可をセットアップすることです。上で実装した`getBearerToken()`メソッドは、要求のアクセスに関する詳細を含む`Token`クラスを返します。

      `getBearerToken()`メソッドは受信要求を自動的に検証・確認するため、アプリケーションはメソッドの応答を評価することで、アクセストークンの詳細を判定します。応答がnullの場合、提供される有効なトークンはありません。そうでない場合は、応答の内容を検査し、要求の詳細を確認してください。

      右のインタラクティブパネルで、応答がnullであるかどうかをチェックし、`/api/private`ルートへのアクセスをフィルターすることができます。
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      アクセストークンで要求されたスコープに基づいて、特定のルートへのアクセスをフィルターしたい場合もあるでしょう。右のインタラクティブパネルに示すように、`getBearerToken()`メソッドの応答から'scope'プロパティのコンテンツを評価し、アクセストークンで付与されたスコープをチェックします。
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Auth0-PHP SDK](https://github.com/auth0/auth0-php) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <AuthCodeGroup>
          <Index />
          <Router />
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <AuthCodeGroup>
          <Index2 />
          <Router />
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <AuthCodeGroup>
          <Router />
          <Index />
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <AuthCodeGroup>
          <Router2 />
          <Index />
        </AuthCodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <AuthCodeGroup>
          <Router3 />
          <Index />
        </AuthCodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
