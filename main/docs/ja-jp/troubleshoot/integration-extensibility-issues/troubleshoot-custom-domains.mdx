---
title: "カスタムドメインのトラブルシューティング"
permalink: "troubleshoot-custom-domains"
"description": "カスタムドメインに関する問題のトラブルシューティングについて説明します。"
"og:title": "カスタムドメインのトラブルシューティング"
"og:description": "カスタムドメインに関する問題のトラブルシューティングについて説明します。"
"og:image": "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
"twitter:title": "カスタムドメインのトラブルシューティング"
"twitter:description": "カスタムドメインに関する問題のトラブルシューティングについて説明します。"
---

カスタムドメインに関する一般的な問題については次のビデオをご覧ください。また、特定のシナリオのトラブルシューティング手順については、以下のセクションを参照してください。

<iframe
  src="https://www.youtube.com/embed/f6fkOkS1RFA"
  title="Custom Domain Issues"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  referrerpolicy="strict-origin-when-cross-origin"
  allowfullscreen
  className="aspect-video object-cover w-full h-full"
></iframe>

## カスタムドメインが検証待ちのままである

DNS が伝播するまでに最大 48 時間かかる場合があります。

- ダッシュボードにこのエラーが引き続き表示される場合は、ドメイン管理サービスで CNAME レコードが正しく設定されていることを確認してください。CNAME レコードの設定は、次の方法で確認できます：
  - [Mxtoolbox](https://mxtoolbox.com/DNSLookup.aspx)または[Google](https://dns.google.com)
  - ターミナルでの`dig`コマンド

- ドメイン名が A レコードにまだ関連付けられていないことを確認します。
- CNAME レコードのドメイン名または値を入力またはコピーするときにエラーが発生していないことを確認します。

上記のことを確認してもカスタムドメインの検証がまだ保留中の場合は、ドメインを再検証する前に 4 時間待ってください。サービスの中断を避けるため、再検証時にカスタムドメインを再作成しないでください。

## Cloudflare での CNAME フラット化

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Auth0 では、絶対に必要な場合を除き、CNAME フラット化をオフにすることを推奨しています。Cloudflare のドキュメント、「[Understand and configure CNAME flattening（CNAME フラット化を理解・構成する）](https://support.cloudflare.com/hc/en-us/articles/200169056-Understand-and-configure-CNAME-Flattening)」に従ってください。Auth0 のマネージド証明書に対する CNAME フラット化は、サポートされない構成であるため、CNAME フラット化が有効になっているとカスタムドメインが予告なく壊れてしまう可能性があります。

</Callout>

CNAME フラット化は、DNS レコードの処理方法により、Auth0 の検証および証明書の更新プロセスに影響します。カスタムドメインを設定した後、Cloudfare で CNAME フラット化を有効にしても、証明書の更新は **not prevent（妨げられません）］** 。

Cloudflare で管理しているすべてのサブドメインに対して CNAME フラット化を有効にし、特定のサブドメインを Auth0 のカスタムドメインとして構成する必要がある場合は、Auth0 用のサブドメインを別の DNS プロバイダーに委任することを検討してください。詳細については、Cloudflare ドキュメントの[「Cloudflare の外部にサブドメインを委任」](https://support.cloudflare.com/hc/en-us/articles/360021357131-Delegating-Subdomains-Outside-of-Cloudflare)を参照してください。外部に委任すると、Auth0 用のサブドメインを除くすべてのサブドメインで CNAME フラット化を使用できるようになります。

## 「このエンドポイントに到達しないでください」

カスタムドメインを構成するときにこのエラーが表示された場合は、セットアップに応じて異なる追加の構成を実行する必要があります。詳しくは、[カスタムドメインを使用するための機能を構成する](/docs/ja-jp/customize/custom-domains/configure-features-to-use-custom-domains)をお読みください。

## 「サービスが見つかりません」

アプリケーションが、`audience=https://login.northwind.com/userinfo`を指定して`/authorize`要求を発行すると、サーバーは`Service not found:https://login.northwind.com/userinfo`エラーを返します。これは、カスタムドメインを設定しても、`/userinfo`エンドポイントの API 識別子が`https://{yourOriginalAuth0Domain}/userinfo`のままになるためです。

同様に、[Auth0 Management API](/docs/ja-jp/api/management/v2)の呼び出しでカスタムドメインを使用すると、同じ理由でエラーが発生します。

これを修正するには、アプリで代わりに`audience=https://{yourOriginalAuth0Domain}/userinfo`を使用する必要があります。アプリケーションの **Advanced Settings（詳細設定）］** の **OAuth2］** タブでアプリケーションが **OIDC-Conformant（OIDC 準拠）］** としてフラグ付けされている場合は、この`audience=[...]/userinfo`パラメータを完全に削除することもできます。

## Internet Explorer に関連するエラー

Internet Explorer を使用している場合は、次のいずれかのエラーメッセージが表示されることがあります：

- 「クライアントから検証が返されませんでした」
- 「Origin ヘッダーが必要です」
- 「クロスオリジン認証に失敗しました」

Auth0 ドメインとアプリドメインの両方が同じ信頼済みゾーンまたはローカルイントラネットゾーンにある場合、Internet Explorer は要求をクロスドメイン要求として扱わず、クロスオリジンヘッダーを送信しません。

これらのエラーのいずれかが表示され、埋め込みログインを使用している場合は、サイトの 1 つを信頼済みゾーンまたはローカルイントラネットゾーンから移動することができます。このためには、次の手順に従います。

1. **Internet Options>Security** へ移動します。
2. **［Local Intranet Zone（ローカル イントラネット ゾーン）］** タブを選択し、Sites>Advanced に移動します。ドメインを追加します。
3. **［Security（セキュリティ）］** タブに戻り、適切なゾーンが選択されていることを確認します。
4. **［Custom Level（レベルのカスタマイズ）］** をクリックし、**Miscellaneous（その他）］** セクションで **Access data sources across domains（ドメイン間のアクセス データ ソース）］** を探します。**Enable（有効化）］** の横にあるラジオボタンをクリックします。

あるいは、[Auth0 ユニバーサルログイン](/docs/ja-jp/authenticate/login/auth0-universal-login)を実装することで、クロスオリジン認証への依存を排除 ​​ することもできます。

## もっと詳しく

- [機能にカスタムドメインの使用を構成する](/docs/ja-jp/customize/custom-domains/configure-features-to-use-custom-domains)
- [Auth0 管理証明書を使ってカスタムドメインを構成する](/docs/ja-jp/customize/custom-domains/auth0-managed-certificates)
- [自己管理証明書を使ってカスタムドメインを構成する](/docs/ja-jp/customize/custom-domains/self-managed-certificates)
- [TLS（SSL）のバージョンと暗号](/docs/ja-jp/customize/custom-domains/self-managed-certificates/tls-ssl)
