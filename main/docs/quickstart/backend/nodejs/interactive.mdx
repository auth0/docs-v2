---
mode: wide
title: Add Authorization to Your Express.js API
description: This tutorial demonstrates how to add authorization to an Express.js API using the express-oauth2-jwt-bearer middleware.
sidebarTitle: Node (Express) API
---

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

<Note>
**Prerequisites:** Before you begin, ensure you have the following:

- An [Auth0 account](https://auth0.com/signup) (sign up for free)
- [Node.js](https://nodejs.org/) v18.12.0 or later installed
- [npm](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) 8+ or [yarn](https://classic.yarnpkg.com/lang/en/docs/install/) 1.22+
- [jq](https://jqlang.org/) - Required for Auth0 CLI setup
- An existing Express.js application, or follow along to create one
</Note>

## Get Started

This quickstart demonstrates how to add authorization to an Express.js API using the [express-oauth2-jwt-bearer](https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer) middleware.

This example demonstrates:

- How to check for a JSON Web Token (JWT) in the `Authorization` header of an incoming HTTP request
- How to check if the token is valid using the [JSON Web Key Set (JWKS)](https://auth0.com/docs/tokens/concepts/jwks) for your Auth0 account
- How to protect API routes based on OAuth 2.0 scopes

<Steps>
  <Step title="Create a new project" stepNumber={1}>
    Create a new directory for your Express.js API:

    ```bash
    mkdir auth0-express-api && cd auth0-express-api
    npm init -y
    ```
  </Step>

  <Step title="Install the SDK" stepNumber={2}>
    Install the Auth0 Express OAuth2 JWT Bearer middleware and other dependencies:

    ```bash
    npm install express express-oauth2-jwt-bearer dotenv cors
    ```
  </Step>

  <Step title="Setup your Auth0 API" stepNumber={3}>
    Next, you need to create a new API on your Auth0 tenant and add the environment variables to your project.

    You can choose to do this automatically by running a CLI command or do it manually via the Dashboard:

    <Tabs>
      <Tab title="CLI">
        Run the following shell command on your project's root directory to create an Auth0 API and generate a `.env` file:

        <AuthCodeGroup>
          ```shellscript Mac
          AUTH0_API_NAME="My API" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apis create --name "${AUTH0_API_NAME}" --identifier "https://api.example.com" --json > auth0-api-details.json && API_ID=$(jq -r '.identifier' auth0-api-details.json) && DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name') && echo "ISSUER_BASE_URL=https://${DOMAIN}/" > .env && echo "AUDIENCE=${API_ID}" >> .env && echo "PORT=3000" >> .env && rm auth0-api-details.json && echo ".env file created with your Auth0 details:" && cat .env
          ```

          ```shellscript Windows
          $ApiName = "My API"; winget install Auth0.CLI; auth0 login --no-input; auth0 apis create --name "$ApiName" --identifier "https://api.example.com" --json | Set-Content -Path auth0-api-details.json; $ApiId = (Get-Content -Raw auth0-api-details.json | ConvertFrom-Json).identifier; $Domain = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; Set-Content -Path .env -Value "ISSUER_BASE_URL=https://$Domain/"; Add-Content -Path .env -Value "AUDIENCE=$ApiId"; Add-Content -Path .env -Value "PORT=3000"; Remove-Item auth0-api-details.json; Write-Output ".env file created with your Auth0 details:"; Get-Content .env
          ```
        </AuthCodeGroup>
      </Tab>

      <Tab title="Dashboard">
        Before you start, create a `.env` file in your project's root directory:

        ```shellscript .env
        ISSUER_BASE_URL=https://YOUR_DOMAIN.auth0.com/
        AUDIENCE=YOUR_API_IDENTIFIER
        PORT=3000
        ```

        1. Head to the [Auth0 Dashboard](https://manage.auth0.com/dashboard/)
        2. Click on **Applications** > **APIs** > **Create API**
        3. Enter a **Name** for your API (e.g., "My API")
        4. Enter an **Identifier** for your API (e.g., `https://api.example.com`). This will be your `AUDIENCE` value.
        5. Leave **Signing Algorithm** as **RS256** and click **Create**
        6. Replace `YOUR_DOMAIN` and `YOUR_API_IDENTIFIER` in the `.env` file with your **Domain** (from tenant settings) and **Identifier** values

        <Info>
          The **Identifier** is the unique identifier for your API, also known as the `audience`. This value is used when requesting access tokens and validating them in your API.
        </Info>
      </Tab>
    </Tabs>
  </Step>

  <Step title="Define permissions" stepNumber={4}>
    Permissions let you define how resources can be accessed on behalf of the user with a given access token.

    1. In the [Auth0 Dashboard](https://manage.auth0.com/), go to **Applications** > **APIs**
    2. Select your API and go to the **Permissions** tab
    3. Add the following permission:
       - **Permission:** `read:messages`
       - **Description:** Read messages

    <Note>
      This example uses the `read:messages` scope. You can define additional permissions based on your API's requirements.
    </Note>
  </Step>

  <Step title="Configure the middleware" stepNumber={5}>
    Create a `server.js` file and configure the `express-oauth2-jwt-bearer` middleware:

    ```javascript server.js lines
    const express = require('express');
    const cors = require('cors');
    const { auth } = require('express-oauth2-jwt-bearer');
    require('dotenv').config();

    // Validate environment variables
    if (!process.env.ISSUER_BASE_URL || !process.env.AUDIENCE) {
      throw new Error('Make sure you have ISSUER_BASE_URL and AUDIENCE in your .env file');
    }

    const app = express();

    // Enable CORS
    app.use(cors());

    // Authorization middleware. When used, the Access Token must
    // exist and be verified against the Auth0 JSON Web Key Set.
    const checkJwt = auth({
      audience: process.env.AUDIENCE,
      issuerBaseURL: process.env.ISSUER_BASE_URL,
    });
    ```

    The `checkJwt` middleware checks if the user's Access Token included in the request is valid. If the token is not valid, the user gets a 401 Authorization error when they try to access the endpoints.
  </Step>

  <Step title="Protect API endpoints" stepNumber={6}>
    Add routes to your `server.js` file. The routes shown below are available for the following requests:

    - `GET /api/public`: available for non-authenticated requests
    - `GET /api/private`: available for authenticated requests containing an access token
    - `GET /api/private-scoped`: available for authenticated requests containing an access token with the `read:messages` scope

    ```javascript server.js lines
    // This route doesn't need authentication
    app.get('/api/public', function(req, res) {
      res.json({
        message: "Hello from a public endpoint! You don't need to be authenticated to see this."
      });
    });

    // This route needs authentication
    app.get('/api/private', checkJwt, function(req, res) {
      res.json({
        message: 'Hello from a private endpoint! You need to be authenticated to see this.'
      });
    });
    ```

    ### Protect routes with scopes

    You can configure individual routes to look for a particular scope. Add the `requiredScopes` middleware to check for specific scopes:

    ```javascript server.js lines
    const { auth, requiredScopes } = require('express-oauth2-jwt-bearer');

    const checkScopes = requiredScopes('read:messages');

    app.get('/api/private-scoped', checkJwt, checkScopes, function(req, res) {
      res.json({
        message: 'Hello from a private endpoint! You need to be authenticated and have a scope of read:messages to see this.'
      });
    });
    ```

    In this configuration, only Access Tokens with the `read:messages` scope can access the endpoint.
  </Step>

  <Step title="Add error handling" stepNumber={7}>
    Add an error handler to return proper responses when authentication fails:

    ```javascript server.js lines
    // Error handler
    app.use(function(err, req, res, next) {
      console.error(err.stack);
      return res.set(err.headers).status(err.status).json({ message: err.message });
    });

    // Start server
    const port = process.env.PORT || 3000;
    app.listen(port, function() {
      console.log(`API server listening on http://localhost:${port}`);
    });
    ```

    <Warning>
      The `error_description` in the `WWW-Authenticate` header will contain useful information about the error, which you may not want to disclose in Production. Consider customizing the error handler for production environments.
    </Warning>
  </Step>

  <Step title="Run and test your API" stepNumber={8}>
    Start your Express server:

    ```bash
    node server.js
    ```

    The API will be served at `http://localhost:3000`.

    **Test the public endpoint** (no authentication required):

    ```bash
    curl http://localhost:3000/api/public
    ```

    **Test the private endpoint** (requires valid Access Token):

    ```bash
    curl http://localhost:3000/api/private \
      --header 'Authorization: Bearer YOUR_ACCESS_TOKEN'
    ```

    <Note>
      To get a test Access Token, go to **Applications** > **APIs** > Your API > **Test** tab in the Auth0 Dashboard, or obtain one through your client application.
    </Note>
  </Step>
</Steps>

---

## Complete Server Example

Here's the complete `server.js` file with all the code from this tutorial:

```javascript server.js lines
const express = require('express');
const cors = require('cors');
const { auth, requiredScopes } = require('express-oauth2-jwt-bearer');
require('dotenv').config();

// Validate environment variables
if (!process.env.ISSUER_BASE_URL || !process.env.AUDIENCE) {
  throw new Error('Make sure you have ISSUER_BASE_URL and AUDIENCE in your .env file');
}

const app = express();

// Enable CORS
app.use(cors());

// Authorization middleware
const checkJwt = auth({
  audience: process.env.AUDIENCE,
  issuerBaseURL: process.env.ISSUER_BASE_URL,
});

// Public route
app.get('/api/public', function(req, res) {
  res.json({
    message: "Hello from a public endpoint! You don't need to be authenticated to see this."
  });
});

// Private route
app.get('/api/private', checkJwt, function(req, res) {
  res.json({
    message: 'Hello from a private endpoint! You need to be authenticated to see this.'
  });
});

// Private route with scope
const checkScopes = requiredScopes('read:messages');

app.get('/api/private-scoped', checkJwt, checkScopes, function(req, res) {
  res.json({
    message: 'Hello from a private endpoint! You need to be authenticated and have a scope of read:messages to see this.'
  });
});

// Error handler
app.use(function(err, req, res, next) {
  console.error(err.stack);
  return res.set(err.headers).status(err.status).json({ message: err.message });
});

// Start server
const port = process.env.PORT || 3000;
app.listen(port, function() {
  console.log(`API server listening on http://localhost:${port}`);
});
```

---

## Access Token Claims

After successful authentication, you can access the decoded JWT claims through `req.auth`:

```javascript
app.get('/api/profile', checkJwt, function(req, res) {
  const payload = req.auth.payload;
  
  res.json({
    sub: payload.sub,           // User ID
    iss: payload.iss,           // Issuer
    aud: payload.aud,           // Audience
    exp: payload.exp,           // Expiration time
    scope: payload.scope,       // Granted scopes
  });
});
```

---

## TypeScript Support

The SDK includes full TypeScript support. Install the required dependencies:

```bash
npm install -D typescript @types/express @types/node
```

Here's an example using TypeScript:

```typescript server.ts lines
import express, { Request, Response, NextFunction } from 'express';
import cors from 'cors';
import { 
  auth, 
  requiredScopes,
  AuthResult,
  InvalidTokenError,
  InsufficientScopeError
} from 'express-oauth2-jwt-bearer';
import 'dotenv/config';

if (!process.env.ISSUER_BASE_URL || !process.env.AUDIENCE) {
  throw new Error('Make sure you have ISSUER_BASE_URL and AUDIENCE in your .env file');
}

const app = express();
app.use(cors());

const checkJwt = auth({
  audience: process.env.AUDIENCE,
  issuerBaseURL: process.env.ISSUER_BASE_URL,
});

// Public route
app.get('/api/public', (req: Request, res: Response) => {
  res.json({ message: 'Public endpoint' });
});

// Private route
app.get('/api/private', checkJwt, (req: Request, res: Response) => {
  const auth: AuthResult | undefined = req.auth;
  res.json({ 
    message: 'Private endpoint',
    sub: auth?.payload.sub 
  });
});

// Error handler
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof InvalidTokenError) {
    return res.status(401).json({ error: 'Invalid token' });
  }
  if (err instanceof InsufficientScopeError) {
    return res.status(403).json({ error: 'Insufficient scope' });
  }
  next(err);
});

const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
```

---

## Additional Configuration Options

The `auth()` middleware accepts additional options for advanced use cases:

```javascript
const checkJwt = auth({
  audience: process.env.AUDIENCE,
  issuerBaseURL: process.env.ISSUER_BASE_URL,
  
  // Optional: Custom token signing algorithm (defaults to RS256)
  tokenSigningAlg: 'RS256',
  
  // Optional: Clock tolerance for exp/iat validation (seconds)
  clockTolerance: 5,
  
  // Optional: Allow unauthenticated requests (default: false)
  authRequired: true,
});
```

---

## Security Best Practices

For production deployments, consider these security recommendations:

### Use Helmet for security headers

```bash
npm install helmet
```

```javascript
const helmet = require('helmet');

app.use(helmet());
app.use(cors());
```

### Hide error details in production

```javascript
app.use(function(err, req, res, next) {
  const isProduction = process.env.NODE_ENV === 'production';
  
  res.status(err.status || 500).json({
    error: err.code || 'server_error',
    message: isProduction ? 'An error occurred' : err.message
  });
});
```

---

## Troubleshooting

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| `401 Unauthorized` on valid token | Incorrect `audience` or `issuerBaseURL` | Verify values match your Auth0 API settings |
| `403 Insufficient Scope` | Token missing required scope | Ensure the token was requested with the correct scopes |
| `ISSUER_BASE_URL required` | Missing environment variable | Create a `.env` file with required values |
| JWKS fetch timeout | Network/firewall issues | Check network access to your Auth0 domain |

### Verify your configuration

```javascript
console.log('Issuer:', process.env.ISSUER_BASE_URL);
console.log('Audience:', process.env.AUDIENCE);
```

### Test with a valid token

1. Go to **Applications** > **APIs** > Your API > **Test** tab in the Auth0 Dashboard
2. Copy the provided Access Token
3. Use it in your API request:

```bash
curl http://localhost:3000/api/private \
  --header 'Authorization: Bearer YOUR_TEST_TOKEN'
```

---

## Next Steps

Congratulations! You have successfully added authorization to your Express.js API using Auth0.

Continue building your application:

- [Validate Access Tokens](https://auth0.com/docs/tokens/guides/validate-access-tokens) - Learn more about Access Token validation
- [Role-Based Access Control](https://auth0.com/docs/authorization/rbac) - Implement fine-grained authorization
- [Custom Claims](https://auth0.com/docs/tokens/jwt-claims#custom-claims) - Add custom data to your tokens
- [API Reference](https://auth0.github.io/node-oauth2-jwt-bearer/) - Explore all SDK options
- [Sample Application](https://github.com/auth0-samples/auth0-express-api-samples) - View complete example projects
