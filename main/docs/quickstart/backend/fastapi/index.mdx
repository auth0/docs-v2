---
mode: wide
description: 'Add Auth0 JWT authentication to an FastAPI with protected endpoints'
sidebarTitle: FastAPI API
title: 'FastAPI API'
---
<Accordion title="Use AI to integrate Auth0" icon="microchip-ai" iconType="solid" defaultOpen>

If you use an AI coding assistant like Claude Code, Cursor, or GitHub Copilot, you can add Auth0 authentication automatically in minutes using [agent skills](https://agentskills.io/home).

**Install:**

```bash
npx skills add auth0/agent-skills
```

**Then ask your AI assistant:**

```text
Add Auth0 JWT authentication to my FastAPI backend API
```

Your AI assistant will automatically create your Auth0 API, fetch credentials, install python-jose and dependencies, create JWT validation middleware, and protect endpoints with dependencies. [Full agent skills documentation →](/quickstart/agent-skills)

</Accordion>


<Note>
This quickstart requires:
- **Python 3.9** or higher
- **pip** package manager
- **jq** - Required for Auth0 CLI setup
- Familiarity with FastAPI

If you haven't already, [sign up for a free Auth0 account](https://auth0.com/signup) to follow along.
</Note>

This guide demonstrates how to integrate Auth0 with a FastAPI API to add authentication and protect your endpoints.

<Steps>

<Step title="Create a new FastAPI project" stepNumber={1}>

Create a new directory for your FastAPI project and set up a virtual environment.

```bash
mkdir my-fastapi-api
cd my-fastapi-api
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

</Step>

<Step title="Install dependencies" stepNumber={2}>

Create a `requirements.txt` file with the following dependencies:

```txt requirements.txt
fastapi>=0.115.0
uvicorn[standard]>=0.34.0
auth0-fastapi-api>=1.0.0b5
python-dotenv>=1.0.0
```

Install the dependencies:

```bash
pip install -r requirements.txt
```

</Step>

<Step title="Setup your Auth0 API" stepNumber={3}>

You'll need to create an Auth0 API to represent your FastAPI application.

<Tabs>
  <Tab title="Dashboard">

1. Navigate to [Applications > APIs](https://manage.auth0.com/#/apis) in the Auth0 Dashboard
2. Click **Create API**
3. Provide a **Name** for your API (e.g., "My FastAPI API")
4. Set the **Identifier** to your API identifier (e.g., `https://my-fastapi-api`)
5. Leave the **Signing Algorithm** as RS256
6. Click **Create**

  </Tab>
  <Tab title="CLI">

If you have the [Auth0 CLI](https://github.com/auth0/auth0-cli) installed, you can create an API and configure your environment from your terminal:

<CodeGroup>

```shellscript Mac
AUTH0_API_NAME="My FastAPI API" && AUTH0_API_IDENTIFIER="https://my-fastapi-api" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apis create --name "${AUTH0_API_NAME}" --identifier "${AUTH0_API_IDENTIFIER}" --signing-alg RS256 --no-input && echo "AUTH0_DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name')\nAUTH0_AUDIENCE=${AUTH0_API_IDENTIFIER}" > .env
```

```powershell Windows
$ApiName = "My FastAPI API"; $ApiIdentifier = "https://my-fastapi-api"; auth0 login --no-input; auth0 apis create -n $ApiName -i $ApiIdentifier --signing-alg RS256 --no-input; $ActiveTenant = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; "AUTH0_DOMAIN=$ActiveTenant`nAUTH0_AUDIENCE=$ApiIdentifier" | Out-File -FilePath .env -Encoding utf8
```

</CodeGroup>

This will create your API and automatically generate a `.env` file with your Auth0 configuration.

  </Tab>
</Tabs>

<Info>
The **Identifier** is a unique identifier for your API. It's recommended to use a URL, but it doesn't have to be a publicly accessible URL—Auth0 won't call it. This value cannot be modified afterwards.
</Info>

Make note of the **Domain** and **Identifier** (Audience) values. You'll need these in the next step.

</Step>

<Step title="Define API permissions" stepNumber={4}>

Permissions (also known as scopes) allow you to define how your API can be accessed. You can create permissions for your API in the Auth0 Dashboard.

1. In the Auth0 Dashboard, navigate to your API's **Permissions** tab
2. Add the following permissions:
   - `read:messages` with description "Read messages"
   - `write:messages` with description "Write messages"

These permissions will be used to control access to specific endpoints in your API.

</Step>

<Step title="Configure the Auth0 client" stepNumber={5}>

Create a `.env` file in your project root to store your Auth0 configuration:

```txt .env
AUTH0_DOMAIN=YOUR_AUTH0_DOMAIN
AUTH0_AUDIENCE=YOUR_API_IDENTIFIER
```

Replace `YOUR_AUTH0_DOMAIN` with your Auth0 domain (e.g., `dev-abc123.us.auth0.com`) and `YOUR_API_IDENTIFIER` with the identifier you set when creating your API.

<Warning>
Never commit your `.env` file to version control. Add it to your `.gitignore` file to keep your credentials secure.
</Warning>

Now create an `app.py` file and initialize your FastAPI application with Auth0:

```python app.py
from fastapi import FastAPI, Depends
from fastapi_plugin.fast_api_client import Auth0FastAPI
import os
from dotenv import load_dotenv

# Load environment variables
load_dotenv()

app = FastAPI()

# Initialize Auth0
auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE")
)
```

</Step>

<Step title="Create protected routes" stepNumber={6}>

Add the following routes to your `app.py` file. These routes demonstrate different levels of access control:

```python app.py
from fastapi import FastAPI, Depends
from fastapi_plugin.fast_api_client import Auth0FastAPI
import os
from dotenv import load_dotenv

load_dotenv()

app = FastAPI()

auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE")
)

# Public route - no authentication required
@app.get("/api/public")
async def public():
    return {
        "message": "Hello from a public endpoint! You don't need to be authenticated to see this."
    }

# Protected route - requires authentication
@app.get("/api/private")
async def private(claims: dict = Depends(auth0.require_auth())):
    return {
        "message": "Hello from a private endpoint! You need to be authenticated to see this.",
        "user_id": claims.get("sub")
    }

# Scoped route - requires specific permission
@app.get("/api/private-scoped")
async def private_scoped(claims: dict = Depends(auth0.require_auth(scopes="read:messages"))):
    return {
        "message": "Hello from a private endpoint! You need to be authenticated and have a scope of read:messages to see this.",
        "user_id": claims.get("sub")
    }
```

The `require_auth()` method validates the access token sent in the Authorization header. When called with a `scopes` parameter, it also verifies that the token contains the specified permission.

</Step>

<Step title="Run your API" stepNumber={7}>

Start your FastAPI application:

```bash
uvicorn app:app --reload
```

Your API is now running on `http://localhost:8000`.

<Check>
Visit `http://localhost:8000/api/public` in your browser. You should see the public message without needing authentication.
</Check>

</Step>

</Steps>

---

## Test your API

To test the protected endpoints, you'll need to obtain an access token from Auth0.

### Get an access token

The easiest way to get an access token for testing is through the Auth0 Dashboard:

1. Navigate to [Applications > APIs](https://manage.auth0.com/#/apis) in the Auth0 Dashboard
2. Select your API
3. Click the **Test** tab
4. Click **Copy Token** in the **Asking Auth0 for tokens from my application** section

### Call your API

Use the access token to call your protected endpoint:

```bash
curl -X GET http://localhost:8000/api/private -H 'authorization: Bearer YOUR_ACCESS_TOKEN'
```

You should receive a response with the private message and your user ID.

To test the scoped endpoint, make sure your token includes the `read:messages` scope:

```bash
curl -X GET http://localhost:8000/api/private-scoped -H 'authorization: Bearer YOUR_ACCESS_TOKEN'
```

If your token doesn't have the required scope, you'll receive a 403 Forbidden response.

---

## Advanced Usage

<Accordion title="Validate custom claims">

You can access custom claims that have been added to the access token through [Auth0 Actions](https://auth0.com/docs/customize/actions).

Access custom claims in your route handler:

```python
@app.get("/api/profile")
async def profile(claims: dict = Depends(auth0.require_auth())):
    return {
        "user_id": claims.get("sub"),
        "email": claims.get("email"),
        "permissions": claims.get("permissions", []),
        "custom_claim": claims.get("https://myapp.example.com/custom_claim")
    }
```

To add custom claims to your access tokens, create an Auth0 Action:

1. Navigate to **Actions > Library** in the Auth0 Dashboard
2. Click **Create Action**
3. Select **Build from scratch**
4. Name your action and select the **Login / Post Login** trigger
5. Add your custom claims:

```javascript
exports.onExecutePostLogin = async (event, api) => {
  const namespace = 'https://myapp.example.com';

  if (event.authorization) {
    // Add custom claim to access token
    api.accessToken.setCustomClaim(`${namespace}/roles`, event.user.app_metadata.roles || []);
  }
};
```

6. Click **Deploy** and add the action to your Login flow

<Info>
Custom claims must use a namespaced format (e.g., `https://myapp.example.com/claim_name`) to avoid conflicts with standard claims.
</Info>

</Accordion>

<Accordion title="Protect endpoints without using claims">

If you need to protect an endpoint but don't need to access the claims, you can use the `dependencies` parameter:

```python
@app.get("/api/protected", dependencies=[Depends(auth0.require_auth())])
async def protected():
    return {"message": "This endpoint is protected"}
```

This validates the access token but doesn't inject the claims into your function.

</Accordion>

<Accordion title="DPoP support">

<Info>
DPoP (Demonstrating Proof-of-Possession) is currently in [Early Access](https://auth0.com/docs/troubleshoot/product-lifecycle/product-release-stages). Contact [Auth0 support](https://support.auth0.com/) to enable it for your tenant.
</Info>

DPoP provides enhanced security by cryptographically binding access tokens to the client that requested them. This prevents token theft and replay attacks.

The SDK enables DPoP support by default. You can configure DPoP behavior:

```python
auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE"),
    dpop_enabled=True,      # Enable DPoP (default: True)
    dpop_required=False     # Require DPoP (default: False)
)
```

**Mixed mode** (default) accepts both Bearer and DPoP tokens:

```python
auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE"),
    dpop_enabled=True,
    dpop_required=False
)
```

**DPoP-only mode** rejects Bearer tokens:

```python
auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE"),
    dpop_required=True
)
```

When using DPoP, clients must include both the `Authorization: DPoP <token>` and `DPoP: <proof>` headers. The SDK automatically validates the DPoP proof and binds it to the access token.

</Accordion>

<Accordion title="Configure for reverse proxy">

<Warning>
Only enable `trust_proxy` when your application is behind a trusted reverse proxy. Never enable this for applications directly exposed to the internet.
</Warning>

If your application runs behind a reverse proxy (nginx, AWS ALB, etc.), you need to enable proxy trust for DPoP validation to work correctly:

```python
from fastapi import FastAPI

app = FastAPI()

# Enable proxy trust
app.state.trust_proxy = True

auth0 = Auth0FastAPI(
    domain=os.environ.get("AUTH0_DOMAIN"),
    audience=os.environ.get("AUTH0_AUDIENCE")
)
```

Configure your reverse proxy to forward the necessary headers:

```nginx
location /api {
    proxy_pass http://localhost:8000;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Prefix /api;
}
```

This is essential for DPoP validation because the SDK needs to match the exact URL the client used. Without proxy trust, your application sees internal URLs while DPoP proofs reference external URLs, causing validation failures.

</Accordion>

<Accordion title="Error handling">

The SDK raises `HTTPException` for authentication errors. FastAPI handles these automatically, returning appropriate HTTP responses to the client.

You can implement custom error handling if needed:

```python
from fastapi import Request
from fastapi.responses import JSONResponse
from fastapi.exceptions import HTTPException

@app.exception_handler(HTTPException)
async def custom_http_exception_handler(request: Request, exc: HTTPException):
    if exc.status_code in [401, 403]:
        return JSONResponse(
            status_code=exc.status_code,
            content={
                "error": "authentication_failed",
                "message": "You must be authenticated to access this resource",
                "details": exc.detail
            }
        )
    return JSONResponse(
        status_code=exc.status_code,
        content={"detail": exc.detail}
    )
```

Authentication errors include:
- **401 Unauthorized**: Missing, invalid, or expired access token
- **403 Forbidden**: Valid token but insufficient permissions (scopes)

</Accordion>

---

## Common Issues

<AccordionGroup>

<Accordion title="401 Unauthorized - Invalid audience">

**Problem**: Token validation fails with "Invalid audience" error.

**Solution**: Verify that the `AUTH0_AUDIENCE` in your `.env` file exactly matches the **Identifier** you configured for your API in the Auth0 Dashboard.

1. Open the Auth0 Dashboard and navigate to **Applications > APIs**
2. Select your API
3. Check the **Identifier** value in the Settings tab
4. Update your `.env` file:
   ```txt
   AUTH0_AUDIENCE=https://your-exact-api-identifier
   ```
5. Restart your application

</Accordion>

<Accordion title="401 Unauthorized - Invalid issuer">

**Problem**: Token validation fails with "Invalid issuer" error.

**Solution**: Verify that your `AUTH0_DOMAIN` is correct and does not include the `https://` protocol.

Your domain should look like `dev-abc123.us.auth0.com`, not `https://dev-abc123.us.auth0.com`.

Update your `.env` file:

```txt
AUTH0_DOMAIN=dev-abc123.us.auth0.com
```

</Accordion>

<Accordion title="403 Forbidden - Insufficient scope">

**Problem**: Protected endpoint returns 403 even with a valid access token.

**Solution**: The access token doesn't include the required scope.

1. Check what scopes your endpoint requires
2. When requesting a token, ensure you include the required scopes
3. Verify the scope exists in your API's Permissions tab in the Auth0 Dashboard
4. Decode your token at [jwt.io](https://jwt.io) to verify it contains the `scope` claim with the required values

</Accordion>

<Accordion title="ModuleNotFoundError: No module named 'fastapi_plugin'">

**Problem**: Python cannot find the Auth0 FastAPI SDK.

**Solution**: Ensure the SDK is installed in your active virtual environment.

```bash
# Activate your virtual environment
source venv/bin/activate  # Windows: venv\Scripts\activate

# Install the SDK
pip install auth0-fastapi-api

# Verify installation
pip show auth0-fastapi-api
```

</Accordion>

<Accordion title="Cannot connect to Auth0 (JWKS fetch failed)">

**Problem**: Application cannot fetch signing keys from Auth0.

**Solution**: Check your network connectivity and domain configuration.

1. Verify your domain is accessible:
   ```bash
   curl https://YOUR_DOMAIN/.well-known/openid-configuration
   ```

2. Check that your firewall allows outbound HTTPS (port 443) connections to `*.auth0.com`

3. If behind a corporate proxy, configure the `HTTP_PROXY` and `HTTPS_PROXY` environment variables

</Accordion>

<Accordion title="DPoP validation fails">

**Problem**: DPoP authentication returns errors about URL or proof validation.

**Solution**:

1. If behind a reverse proxy, enable proxy trust:
   ```python
   app.state.trust_proxy = True
   ```

2. Verify your proxy forwards these headers:
   - `X-Forwarded-Proto`
   - `X-Forwarded-Host`
   - `X-Forwarded-Prefix`

3. Ensure DPoP is enabled for your tenant (contact Auth0 support)

4. Verify the DPoP proof `htu` claim matches your request URL exactly

</Accordion>

</AccordionGroup>

---

## Next Steps

<CardGroup cols={3}>

<Card title="SDK Documentation" icon="github" href="https://github.com/auth0/auth0-fastapi-api">
Explore the Auth0 FastAPI SDK on GitHub for advanced configuration and examples
</Card>

<Card title="Scopes and Permissions" icon="lock" href="https://auth0.com/docs/get-started/apis/scopes">
Learn how to define and use scopes for fine-grained access control
</Card>

<Card title="Auth0 Actions" icon="bolt" href="https://auth0.com/docs/customize/actions">
Customize your authentication flow and add custom claims to tokens
</Card>

<Card title="FastAPI Documentation" icon="book" href="https://fastapi.tiangolo.com/">
Learn more about FastAPI features, async patterns, and best practices
</Card>

<Card title="API Authorization" icon="shield-check" href="https://auth0.com/docs/authorization">
Implement role-based access control (RBAC) for your API
</Card>

<Card title="Deploy to Production" icon="server" href="https://auth0.com/docs/deploy">
Best practices for deploying FastAPI applications with Auth0
</Card>

</CardGroup>