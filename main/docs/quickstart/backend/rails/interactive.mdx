---

mode: wide
description: This tutorial performs access token validation using the jwt Gem
  within a custom Auth0Client class.
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': 'Auth0 Ruby On Rails API SDK Quickstarts: Add Authorization to Your Ruby
  on Rails API'
'og:url': https://auth0.com/docs/
sidebarTitle: Ruby on Rails API
title: Add Authorization to Your Ruby on Rails API
'twitter:description': This tutorial performs access token validation using the jwt
  Gem within a custom Auth0Client class.
'twitter:title': 'Auth0 Ruby On Rails API SDK Quickstarts: Add Authorization to Your
  Ruby on Rails API'
---
import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import ApplicationController from "/snippets/quickstart/backend/rails/application_controller.rb.mdx";
import Auth0Client from "/snippets/quickstart/backend/rails/auth0_client.rb.mdx";
import Secured from "/snippets/quickstart/backend/rails/secured.rb.mdx";
import PublicController from "/snippets/quickstart/backend/rails/public_controller.rb.mdx";
import PrivateController from "/snippets/quickstart/backend/rails/private_controller.rb.mdx";

export const sections = [
  { id: "define-permissions", title: "Define permissions" },
  { id: "install-dependencies", title: "Install dependencies" },
  { id: "create-an-auth0client-class", title: "Create an Auth0Client class" },
  { id: "define-a-secured-concern", title: "Define a Secured concern" },
  { id: "include-the-secure-concern-in-your-applicationcontroller", title: "Include the Secure concern in your ApplicationController" },
  { id: "create-the-public-endpoint", title: "Create the public endpoint" },
  { id: "create-the-private-endpoints", title: "Create the private endpoints" }
]

<Recipe>
  <Content>
    This tutorial performs access token validation using the [jwt](https://github.com/jwt/ruby-jwt) Gem within a custom `Auth0Client` class. A Concern called
        `Secured` is used to authorize endpoints which require authentication through an incoming access token.

    If you have not created an API in your Auth0 dashboard yet, use the interactive selector to create a new Auth0 API
        or select an existing API for your project.

    To set up your first API through the Auth0 dashboard, review [our getting started
          guide](https://auth0.com/docs/get-started/auth0-overview/set-up-apis).

    Each Auth0 API uses the API Identifier, which your application needs to validate the access token.

    <Callout icon="file-lines" iconType="regular">
    **New to Auth0?** Learn [how Auth0 works](https://auth0.com/docs/overview)
                  and read about [implementing API authentication
                    and authorization](https://auth0.com/docs/api-auth) using the OAuth 2.0 framework.
    </Callout>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Permissions let you define how resources can be accessed on behalf of the user with a given access token. For
            example, you might choose to grant read access to the `messages` resource if users have the manager
            access level, and a write access to that resource if they have the administrator access level.

      You can define allowed permissions in the **Permissions** view of the Auth0 Dashboard's [APIs](https://manage.auth0.com/#/apis) section.

      <Frame>
        <img src="/images/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/e61793a2822d095666002c3f65c71ac2/configure-permissions.png" />
      </Frame>

      <Callout icon="file-lines" iconType="regular">
      This example uses the `read:messages` scope.
      </Callout>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      Install the **jwt **Gem.

      ```bash lines
      gem 'jwt'
      bundle install
      ```

    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Create a class called `Auth0Client`. This class decodes and verifies the incoming access token taken
            from the `Authorization` header of the request.

      The `Auth0Client` class retrieves the public key for your Auth0 tenant and then uses it to verify the
            signature of the access token. The `Token` struct defines a `validate_permissions` method to
            look for a particular `scope` in an access token by providing an array of required scopes and check if
            they are present in the payload of the token.
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Create a Concern called `Secured` which looks for the access token in the `Authorization`
            header of an incoming request.

      If the token is present, the `Auth0Client.validate_token` will use the `jwt` Gem to verify
            the token's signature and validate the token's claims.

      In addition to verifying that the access token is valid, the Concern also includes a mechanism for confirming the
            token has the sufficient **scope** to access the requested resources. In this example we define a
            `validate_permissions` method that receives a block and checks the permissions by calling the
            `Token.validate_permissions` method from the `Auth0Client` class.

      For the `/private-scoped` route, the scopes defined will be intersected with the scopes coming in the
            payload, to determine if it contains one or more items from the other array.
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      By adding the `Secure` concern to your application controller, you'll only need to use a
            `before_action` filter in the controller that requires authorization.
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      Create a controller to handle the public endpoint `/api/public`.

      The `/public` endpoint does not require any authorization so no `before_action` is needed.
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      Create a controller to handle the private endpoints: `/api/private` and
            `/api/private-scoped`.

      `/api/private` is available for authenticated requests containing an access token with no additional
            scopes.

      `/api/private-scoped` is available for authenticated requests containing an access token with the
            `read:messages` scope granted

      The protected endpoints need to call the `authorize` method from the `Secured` concern, for
            that you use `before_action :authorize`, this ensure the `Secured.authorize` method is
            called before every action in the `PrivateController`.

      ### Make a Call to Your API

      To make calls to your API, you need an Access Token. You can get an Access Token for testing purposes from the
            **Test** view in your [API
              settings](https://manage.auth0.com/#/apis).

      <Frame>
        <img src="/images/cdy7uua7fh8z/6jeVBuypOGX5qMRXeJn5ow/5e79037f6c852d2043789d622bdb9562/Quickstart_Example_App_-_English.png" />
      </Frame>

      Provide the Access Token as an `Authorization` header in your requests.

      <CodeGroup>
        ```bash cURL lines
        curl --request get \
        --url 'http:///%7ByourDomain%7D/api_path' \
        --header 'authorization: Bearer YOUR_ACCESS_TOKEN_HERE'
        ```

        ```csharp C# lines
        var client = new RestClient("http:///%7ByourDomain%7D/api_path");
        var request = new RestRequest(Method.GET);
        request.AddHeader("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE");
        IRestResponse response = client.Execute(request);
        ```

        ```go Go lines
        package main
        import (
        "fmt"
        "net/http"
        "io/ioutil"
        )
        func main() {
        url := "http:///%7ByourDomain%7D/api_path"
        req, _ := http.NewRequest("get", url, nil)
        req.Header.Add("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE")
        res, _ := http.DefaultClient.Do(req)
        defer res.Body.Close()
        body, _ := ioutil.ReadAll(res.Body)
        fmt.Println(res)
        fmt.Println(string(body))
        }
        ```

        ```java Java lines
        HttpResponse<String> response = Unirest.get("http:///%7ByourDomain%7D/api_path")
        .header("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE")
        .asString();
        ```

        ```javascript Node.JS lines
        var axios = require("axios").default;
        var options = {
        method: 'get',
        url: 'http:///%7ByourDomain%7D/api_path',
        headers: {authorization: 'Bearer YOUR_ACCESS_TOKEN_HERE'}
        };
        axios.request(options).then(function (response) {
        console.log(response.data);
        }).catch(function (error) {
        console.error(error);
        });
        ```

        ```obj-c Obj-C lines
        #import <Foundation/Foundation.h>
        NSDictionary *headers = @{ @"authorization": @"Bearer YOUR_ACCESS_TOKEN_HERE" };
        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http:///%7ByourDomain%7D/api_path"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

        [request setHTTPMethod:@"get"];
        [request setAllHTTPHeaderFields:headers];
        NSURLSession *session = [NSURLSession sharedSession];
        NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                                completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                    if (error) {

                                                        NSLog(@&quot;%@&quot;, error);

                                                    } else {

                                                        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                        NSLog(@&quot;%@&quot;, httpResponse);

                                                    }

                                                }];

        [dataTask resume];
        ```

        ```php PHP lines
        #import <Foundation/Foundation.h>
        NSDictionary *headers = @{ @"authorization": @"Bearer YOUR_ACCESS_TOKEN_HERE" };
        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http:///%7ByourDomain%7D/api_path"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

        [request setHTTPMethod:@"get"];
        [request setAllHTTPHeaderFields:headers];
        NSURLSession *session = [NSURLSession sharedSession];
        NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                                completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                    if (error) {

                                                        NSLog(@&quot;%@&quot;, error);

                                                    } else {

                                                        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                        NSLog(@&quot;%@&quot;, httpResponse);

                                                    }

                                                }];

        [dataTask resume];
        ```

        ```python Python lines
        import http.client
        conn = http.client.HTTPConnection("")
        headers = { 'authorization': "Bearer YOUR_ACCESS_TOKEN_HERE" }
        conn.request("get", "/%7ByourDomain%7D/api_path", headers=headers)
        res = conn.getresponse()
        data = res.read()
        print(data.decode("utf-8"))
        ```

        ```ruby Ruby lines
        require 'uri'
        require 'net/http'
        url = URI("http:///%7ByourDomain%7D/api_path")
        http = Net::HTTP.new(url.host, url.port)
        request = Net::HTTP::Get.new(url)
        request["authorization"] = 'Bearer YOUR_ACCESS_TOKEN_HERE'
        response = http.request(request)
        puts response.read_body
        ```

        ```swift Swift lines
        import Foundation
        let headers = ["authorization": "Bearer YOUR_ACCESS_TOKEN_HERE"]
        let request = NSMutableURLRequest(url: NSURL(string: "http:///%7ByourDomain%7D/api_path")! as URL,
                                            cachePolicy: .useProtocolCachePolicy,

                                        timeoutInterval: 10.0)

        request.httpMethod = "get"
        request.allHTTPHeaderFields = headers
        let session = URLSession.shared
        let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in
        if (error != nil) {
        print(error)

        } else {
        let httpResponse = response as? HTTPURLResponse

        print(httpResponse)

        }
        })
        dataTask.resume()
        ```
        </CodeGroup>

      <Callout icon="file-lines" color="#0EA5E9" iconType="regular">
      ##### Checkpoint

      Now that you have configured your application, run your application to verify that:

      - `GET /api/public`is available for non-authenticated requests.
      - `GET /api/private`is available for authenticated requests.
      - `GET /api/private-scoped`is available for authenticated requests containing an Access
                        Token with the `read:messages`scope.
      </Callout>
    </Section>

    ## Next Steps

    Excellent work! If you made it this far, you should now have login, logout, and user profile information running in your application.

    This concludes our quickstart tutorial, but there is so much more to explore. To learn more about what you can do with Auth0, check out:

    *   [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Learn how to configure and manage your Auth0 tenant and applications
    *   [omniauth-auth0 SDK](https://github.com/auth0/omniauth-auth0) - Explore the SDK used in this tutorial more fully
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Discover integrations you can enable to extend Auth0’s functionality
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <CodeGroup>
        <Secured/>
        <ApplicationController/>
        <Auth0Client/>
        <PublicController/>
        <PrivateController/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <CodeGroup>
        <Secured/>
        <ApplicationController/>
        <Auth0Client/>
        <PublicController/>
        <PrivateController/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <CodeGroup>
        <ApplicationController/>
        <Auth0Client/>
        <Secured/>
        <PublicController/>
        <PrivateController/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <CodeGroup>
        <PublicController/>
        <ApplicationController/>
        <Auth0Client/>
        <Secured/>
        <PrivateController/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <CodeGroup>
        <PrivateController/>
        <ApplicationController/>
        <Auth0Client/>
        <Secured/>
        <PublicController/>
      </CodeGroup>
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
