# Auth0.OidcClient.iOS SDK Deep Analysis

## Executive Summary

**Auth0.OidcClient.iOS** is a C# SDK for implementing OpenID Connect (OIDC) authentication in iOS applications built with Xamarin or .NET for iOS. The SDK wraps the industry-standard Duende IdentityModel.OidcClient library with Auth0-specific functionality and iOS platform integration, providing a streamlined authentication experience using native iOS browser components.

**Key Insights:**
- **Primary Purpose:** Simplifies Auth0 authentication integration for iOS apps using C#
- **Current Version:** 3.6.0 (as of the codebase)
- **Target Frameworks:** Xamarin.iOS 10, .NET 8.0-iOS, .NET 9.0-iOS
- **Minimum iOS Version:** iOS 14.0
- **Core Dependency:** Duende.IdentityModel.OidcClient 6.0.1
- **Authentication Method:** Browser-based OAuth 2.0 / OIDC flow using system browsers
- **Installation:** Available via NuGet as `Auth0.OidcClient.iOS`

---

## 1. Core Purpose & Value Proposition

### Primary Purpose
The Auth0.OidcClient.iOS SDK is designed to implement secure, standards-compliant authentication in iOS applications using the OpenID Connect protocol. It provides a native iOS authentication experience by leveraging Apple's system authentication components.

### Specific Problems It Solves

1. **OAuth/OIDC Complexity**: Abstracts the intricate details of the OAuth 2.0 and OIDC protocols, including:
   - Authorization code flow with PKCE (Proof Key for Code Exchange)
   - State parameter management for security
   - Token validation and verification
   - Nonce handling

2. **iOS Platform Integration**: Handles platform-specific requirements:
   - Custom URL scheme registration and callback handling
   - Integration with iOS system browsers (ASWebAuthenticationSession, SFAuthenticationSession, SFSafariViewController)
   - Automatic browser selection based on iOS version
   - Bundle identifier-based redirect URI generation

3. **Security Best Practices**: Implements industry-standard security measures:
   - RS256 JWT signature validation
   - ID token validation with issuer, audience, and expiration checks
   - Clock skew accommodation (5-minute default leeway)
   - Secure token storage recommendations

4. **Auth0-Specific Features**: Provides seamless integration with Auth0's platform:
   - Organizations support for B2B scenarios
   - Universal Login integration
   - Refresh token management
   - API authorization with audience parameter
   - Telemetry for platform analytics

### Key Value Propositions

1. **Simplified Integration**: Reduces authentication implementation from days to hours with a straightforward API
2. **Production-Ready Security**: Leverages battle-tested OIDC libraries with Auth0-specific validation
3. **Native User Experience**: Uses iOS system browsers for familiar, trusted authentication flows
4. **Cross-Platform Consistency**: Shares the same API surface across all .NET platforms (WPF, UWP, Android, MAUI)
5. **Maintenance & Updates**: Benefits from Auth0's ongoing maintenance and security updates
6. **Enterprise Features**: Built-in support for Organizations, SSO, and federated identity providers

---

## 2. Architecture & Core Components

### Main Modules and Classes

#### **Auth0Client**
- **Location:** `src/Auth0.OidcClient.iOS/Auth0Client.cs`
- **Purpose:** Platform-specific implementation of the Auth0 OIDC client for iOS
- **Key Responsibilities:**
  - Initializes with iOS-specific defaults
  - Automatically generates callback URLs using Bundle Identifier
  - Configures the default browser implementation (AutoSelectBrowser)
  - Sets platform telemetry identifier as "xamarin-ios"

#### **Auth0ClientBase**
- **Location:** `src/Auth0.OidcClient.Core/Auth0ClientBase.cs`
- **Purpose:** Abstract base class providing core authentication functionality
- **Key Methods:**
  - `LoginAsync()`: Initiates browser-based login flow
  - `LogoutAsync()`: Clears Auth0 session and optionally federated IdP sessions
  - `RefreshTokenAsync()`: Exchanges refresh tokens for new access tokens
  - `GetUserInfoAsync()`: Retrieves user profile from userinfo endpoint
  - `PrepareLoginAsync()`: For advanced scenarios requiring manual flow control
  - `ProcessResponseAsync()`: Completes login after manual redirect handling

#### **Auth0ClientOptions**
- **Location:** `src/Auth0.OidcClient.Core/Auth0ClientOptions.cs`
- **Purpose:** Configuration container for SDK initialization
- **Key Properties:**
  - `Domain`: Auth0 tenant domain (e.g., "tenant.auth0.com")
  - `ClientId`: Application client ID from Auth0 dashboard
  - `Scope`: OAuth scopes (default: "openid profile email")
  - `Browser`: Browser implementation (auto-selected if not specified)
  - `RedirectUri`: Callback URL (auto-generated from Bundle ID if not specified)
  - `PostLogoutRedirectUri`: Logout callback URL
  - `Leeway`: Clock skew tolerance (default: 5 minutes)
  - `MaxAge`: Maximum authentication age requirement
  - `LoadProfile`: Whether to call /userinfo endpoint (default: true)
  - `EnableTelemetry`: SDK telemetry (default: true)

#### **Browser Implementations**

The SDK provides multiple browser implementations for different iOS versions:

1. **AutoSelectBrowser** (Default)
   - Location: `src/Auth0.OidcClient.iOS/AutoSelectBrowser.cs`
   - Automatically selects the best browser based on iOS version:
     - iOS 12+: ASWebAuthenticationSession
     - iOS 11: SFAuthenticationSession
     - iOS 10 and earlier: SFSafariViewController

2. **ASWebAuthenticationSessionBrowser** (Recommended for iOS 12+)
   - Location: `src/Auth0.OidcClient.iOS/ASWebAuthenticationSessionBrowser.cs`
   - Uses Apple's modern authentication session API
   - Supports ephemeral sessions (no shared cookies)
   - Configurable via `ASWebAuthenticationSessionOptions`

3. **SFAuthenticationSessionBrowser** (iOS 11)
   - Location: `src/Auth0.OidcClient.iOS/SFAuthenticationSessionBrowser.cs`
   - Legacy browser implementation for iOS 11

4. **SFSafariViewControllerBrowser** (iOS 9-10)
   - Location: `src/Auth0.OidcClient.iOS/SFSafariViewControllerBrowser.cs`
   - In-app Safari view controller for older iOS versions

#### **ActivityMediator**
- **Location:** `src/Auth0.OidcClient.iOS/ActivityMediator.cs`
- **Purpose:** Singleton pattern for handling URL callbacks
- **Key Responsibility:** Routes redirect URLs from `AppDelegate` to the active authentication session

#### **IdTokenValidator**
- **Location:** `src/Auth0.OidcClient.Core/Tokens/IdTokenValidator.cs`
- **Purpose:** Validates ID tokens according to OIDC specification
- **Validations Performed:**
  - Issuer (iss) claim matches Auth0 domain
  - Audience (aud) claim matches client ID
  - Token expiration with clock skew consideration
  - Organization claim validation when specified
  - Nonce validation (handled by underlying OidcClient)

### Component Interaction Flow

```
┌─────────────────────────────────────────────────────────────┐
│                     iOS Application                          │
│  ┌────────────────┐              ┌──────────────────┐       │
│  │ AppDelegate    │              │ViewController    │       │
│  │                │              │                  │       │
│  │ - OpenUrl()    │              │ - LoginButton    │       │
│  │   → Mediator   │              │   Click Handler  │       │
│  └────────────────┘              └──────────────────┘       │
│         ▲                                 │                  │
│         │                                 ▼                  │
│         │                        ┌──────────────────┐       │
│         │                        │   Auth0Client    │       │
│         │                        │                  │       │
│         │                        │ - LoginAsync()   │       │
│         │                        │ - LogoutAsync()  │       │
│         │                        └──────────────────┘       │
│         │                                 │                  │
│         │                                 ▼                  │
│  ┌──────────────────┐          ┌──────────────────┐        │
│  │ ActivityMediator │◄─────────│ AutoSelectBrowser│        │
│  │   (Singleton)    │          │                  │        │
│  └──────────────────┘          │ - ASWebAuth...   │        │
│         │                       │ - SFAuth...      │        │
│         │                       └──────────────────┘        │
└─────────│──────────────────────────────│───────────────────┘
          │                              │
          │                              ▼
          │                    ┌────────────────────┐
          │                    │ System Browser     │
          │                    │ (iOS Component)    │
          │                    └────────────────────┘
          │                              │
          │                              ▼
          │                    ┌────────────────────┐
          │                    │   Auth0 Server     │
          │                    │  (Universal Login)  │
          │                    └────────────────────┘
          │                              │
          └──────────────────────────────┘
              (Callback URL with code)
```

### Typical Developer Workflow

1. **Installation**: Add `Auth0.OidcClient.iOS` NuGet package
2. **Configuration**: Create `Auth0Client` with domain and client ID
3. **URL Scheme Setup**: Register custom URL scheme in Info.plist
4. **AppDelegate Integration**: Implement `OpenUrl` to send callbacks to `ActivityMediator`
5. **Authentication**: Call `LoginAsync()` from UI event handler
6. **Token Handling**: Receive `LoginResult` with tokens and user claims
7. **Protected API Calls**: Use access token for API authorization
8. **Session Management**: Call `LogoutAsync()` to clear session
9. **Token Refresh**: Use `RefreshTokenAsync()` for long-lived sessions

---

## 3. Key Features & Capabilities

### Core Authentication Features

#### **Login/Sign Up**
- Browser-based OAuth 2.0 / OIDC authentication flow
- Universal Login integration with Auth0's hosted pages
- Support for social connections (Google, Facebook, etc.)
- Database connections with username/password
- Enterprise SSO with SAML, WS-Fed, OIDC
- Passwordless authentication support

#### **Logout**
- Clears Auth0 SSO session
- Optional federated logout to clear IdP sessions
- Returns user to application via callback URL

#### **Token Management**
- Returns ID token, access token, and optional refresh token
- Automatic ID token validation
- Refresh token flow for silent authentication
- Token expiration handling with clock skew tolerance

#### **User Information**
- Claims available from ID token
- Optional userinfo endpoint call for extended profile
- Customizable claims via scopes
- Standard OIDC claims (sub, name, email, etc.)

### Advanced Features

#### **Organizations (B2B/SaaS)**
- Organization-based login: `LoginAsync(new { organization = "org_id" })`
- User invitation acceptance
- Organization claim validation in ID tokens
- Multi-tenant application support

#### **API Authorization**
- Access tokens for Auth0 APIs
- Custom audience parameter: `LoginAsync(new { audience = "https://api.example.com" })`
- Scope-based authorization
- Token validation for API resource servers

#### **Refresh Tokens**
- Request with `offline_access` scope
- Silent token renewal without user interaction
- Configurable token expiration policies
- Support for rotating refresh tokens

#### **Custom Scopes**
- Control claims returned in ID token
- Standard scopes: openid, profile, email
- Custom scopes for specific claims
- Profile loading control via `LoadProfile` option

#### **Browser Customization**
- Multiple browser implementations available
- Ephemeral sessions (no shared cookies) via `PrefersEphemeralWebBrowserSession`
- Custom browser implementations via `IBrowser` interface
- Platform-specific browser options

#### **Advanced Authentication Flows**
- Manual flow control with `PrepareLoginAsync()` and `ProcessResponseAsync()`
- Custom state management
- Integration with deep linking scenarios
- Support for custom authentication parameters

### Specialized Capabilities

#### **Telemetry**
- Automatic SDK version and platform reporting
- Helps Auth0 prioritize platform support
- Can be disabled via `EnableTelemetry = false`

#### **Logging**
- Integration with Microsoft.Extensions.Logging
- Configurable via `LoggerFactory` option
- Useful for debugging authentication flows

#### **Custom HTTP Handlers**
- Override `BackchannelHandler` for custom HTTP behavior
- Override `RefreshTokenMessageHandler` for token refresh requests
- Useful for proxy configuration, certificate pinning, etc.

---

## 4. Authentication & Configuration

### How Developers Configure the SDK

#### **Basic Configuration**
```csharp
using Auth0.OidcClient;

var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "YOUR_AUTH0_DOMAIN",
    ClientId = "YOUR_AUTH0_CLIENT_ID"
});
```

#### **Advanced Configuration**
```csharp
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "tenant.auth0.com",
    ClientId = "abc123xyz",
    Scope = "openid profile email offline_access",
    Browser = new ASWebAuthenticationSessionBrowser(
        new ASWebAuthenticationSessionOptions
        {
            PrefersEphemeralWebBrowserSession = true
        }
    ),
    LoadProfile = true,
    Leeway = TimeSpan.FromMinutes(5),
    MaxAge = TimeSpan.FromHours(8)
});
```

### Required Credentials & Setup Steps

#### **Auth0 Dashboard Configuration**

1. **Create Native Application**
   - Navigate to Auth0 Dashboard → Applications → Create Application
   - Select "Native" application type
   - Note the **Domain** and **Client ID**

2. **Configure Application Settings**
   - Set JWT Signature Algorithm to **RS256**
   - Enable **OIDC Conformant** (under Advanced Settings → OAuth)

3. **Set Allowed Callback URLs**
   - Format: `YOUR_BUNDLE_ID://YOUR_DOMAIN/ios/YOUR_BUNDLE_ID/callback`
   - Example: `com.example.myapp://tenant.auth0.com/ios/com.example.myapp/callback`

4. **Set Allowed Logout URLs**
   - Same format as callback URLs
   - Can be the same URL or different

#### **iOS Application Configuration**

1. **Register URL Scheme in Info.plist**
   ```xml
   <key>CFBundleURLTypes</key>
   <array>
       <dict>
           <key>CFBundleTypeRole</key>
           <string>None</string>
           <key>CFBundleURLName</key>
           <string>Auth0</string>
           <key>CFBundleURLSchemes</key>
           <array>
               <string>com.example.myapp</string>
           </array>
       </dict>
   </array>
   ```

2. **Implement AppDelegate Callback Handler**
   ```csharp
   using Auth0.OidcClient;
   using Foundation;
   using UIKit;

   [Register("AppDelegate")]
   public class AppDelegate : UIApplicationDelegate
   {
       public override bool OpenUrl(UIApplication application, NSUrl url,
           string sourceApplication, NSObject annotation)
       {
           ActivityMediator.Instance.Send(url.AbsoluteString);
           return true;
       }
   }
   ```

### Environment-Specific Considerations

#### **iOS Version Requirements**
- **Minimum iOS:** 14.0 (as specified in SupportedOSPlatformVersion)
- **Browser Behavior:**
  - iOS 12+: Best experience with ASWebAuthenticationSession
  - iOS 11: SFAuthenticationSession
  - iOS 10 and earlier: SFSafariViewController

#### **Simulator vs. Device**
- Works in both iOS Simulator and physical devices
- No special configuration differences needed

#### **Development vs. Production**
- Use different Auth0 applications for dev/staging/production
- Bundle identifiers typically differ between environments
- Update allowed callback URLs accordingly

---

## 5. Common Integration Patterns

### How the SDK Integrates into Applications

The SDK follows a standard pattern for mobile authentication:
1. User initiates login from app UI
2. SDK opens system browser with Auth0 login page
3. User authenticates in browser
4. Browser redirects back to app via custom URL scheme
5. SDK processes callback and returns tokens

### Most Common Initialization Pattern

```csharp
using Auth0.OidcClient;
using UIKit;

namespace MyApp.iOS
{
    public partial class MainViewController : UIViewController
    {
        private Auth0Client _auth0Client;

        public override void ViewDidLoad()
        {
            base.ViewDidLoad();

            // Initialize Auth0Client
            _auth0Client = new Auth0Client(new Auth0ClientOptions
            {
                Domain = "tenant.auth0.com",
                ClientId = "YOUR_CLIENT_ID"
            });

            // Wire up button events
            LoginButton.TouchUpInside += LoginButton_Click;
            LogoutButton.TouchUpInside += LogoutButton_Click;
        }

        private async void LoginButton_Click(object sender, EventArgs e)
        {
            var loginResult = await _auth0Client.LoginAsync();

            if (loginResult.IsError)
            {
                // Handle error
                ShowError(loginResult.Error);
                return;
            }

            // Store tokens securely
            SaveToken(loginResult.AccessToken);

            // Update UI
            UpdateUserInterface(loginResult.User);
        }

        private async void LogoutButton_Click(object sender, EventArgs e)
        {
            await _auth0Client.LogoutAsync();
            ClearTokens();
            UpdateUserInterface(null);
        }
    }
}
```

### Framework-Specific Considerations for iOS

#### **Xamarin.iOS Traditional**
- Uses UIKit directly
- Storyboard or programmatic UI
- Standard Xamarin.iOS project structure

#### **.NET for iOS (Modern)**
- Supports .NET 8 and .NET 9
- Same API surface as Xamarin.iOS
- Better performance and tooling

#### **MAUI (Note)**
While this SDK has a separate `Auth0.OidcClient.MAUI` package, the iOS-specific package is for Xamarin.iOS and .NET iOS projects. MAUI developers should use the MAUI-specific package instead.

### URL Scheme Registration Best Practices

#### **Standard Registration**
```xml
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleTypeRole</key>
        <string>None</string>
        <key>CFBundleURLName</key>
        <string>Auth0</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>$(PRODUCT_BUNDLE_IDENTIFIER)</string>
        </array>
    </dict>
</array>
```

#### **Callback Handling in AppDelegate**
```csharp
[Register("AppDelegate")]
public class AppDelegate : UIApplicationDelegate
{
    // For iOS 9+
    public override bool OpenUrl(UIApplication application, NSUrl url,
        string sourceApplication, NSObject annotation)
    {
        ActivityMediator.Instance.Send(url.AbsoluteString);
        return true;
    }

    // For iOS 13+ (Scene-based apps)
    // Note: If using scenes, callback handling moves to SceneDelegate
}
```

### Working Within iOS Applications

#### **Dependency Injection Pattern**
```csharp
// Services/AuthService.cs
public interface IAuthService
{
    Task<LoginResult> LoginAsync();
    Task<BrowserResultType> LogoutAsync();
    Task<RefreshTokenResult> RefreshTokenAsync(string refreshToken);
}

public class Auth0Service : IAuthService
{
    private readonly Auth0Client _client;

    public Auth0Service(IConfiguration config)
    {
        _client = new Auth0Client(new Auth0ClientOptions
        {
            Domain = config["Auth0:Domain"],
            ClientId = config["Auth0:ClientId"]
        });
    }

    public Task<LoginResult> LoginAsync() => _client.LoginAsync();
    public Task<BrowserResultType> LogoutAsync() => _client.LogoutAsync();
    public Task<RefreshTokenResult> RefreshTokenAsync(string refreshToken)
        => _client.RefreshTokenAsync(refreshToken);
}
```

#### **Secure Token Storage**
```csharp
using Security;

// Store tokens securely in iOS Keychain
public class TokenStorage
{
    private const string AccessTokenKey = "access_token";
    private const string RefreshTokenKey = "refresh_token";

    public void SaveAccessToken(string token)
    {
        var record = new SecRecord(SecKind.GenericPassword)
        {
            Service = "MyApp",
            Account = AccessTokenKey,
            ValueData = NSData.FromString(token)
        };
        SecKeyChain.Add(record);
    }

    public string GetAccessToken()
    {
        var record = new SecRecord(SecKind.GenericPassword)
        {
            Service = "MyApp",
            Account = AccessTokenKey
        };

        SecKeyChain.QueryAsData(record, out NSData data);
        return data?.ToString();
    }

    public void ClearTokens()
    {
        var record = new SecRecord(SecKind.GenericPassword)
        {
            Service = "MyApp"
        };
        SecKeyChain.Remove(record);
    }
}
```

#### **API Call Pattern with Access Token**
```csharp
using System.Net.Http.Headers;

public class ApiClient
{
    private readonly HttpClient _httpClient;
    private readonly TokenStorage _tokenStorage;

    public ApiClient(TokenStorage tokenStorage)
    {
        _httpClient = new HttpClient();
        _tokenStorage = tokenStorage;
    }

    public async Task<UserProfile> GetUserProfileAsync()
    {
        var token = _tokenStorage.GetAccessToken();

        _httpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", token);

        var response = await _httpClient.GetAsync("https://api.example.com/user");
        response.EnsureSuccessStatusCode();

        return await response.Content.ReadAsAsync<UserProfile>();
    }
}
```

---

## 6. Error Handling & Best Practices

### Common Error Scenarios

#### **1. User Cancellation**
```csharp
var loginResult = await _auth0Client.LoginAsync();

if (loginResult.IsError)
{
    if (loginResult.Error == "UserCancel")
    {
        // User cancelled the login in the browser
        Console.WriteLine("Login was cancelled by user");
        return;
    }
}
```

#### **2. Network Errors**
```csharp
try
{
    var loginResult = await _auth0Client.LoginAsync();
}
catch (HttpRequestException ex)
{
    // Network connectivity issues
    ShowError("Please check your internet connection");
}
```

#### **3. Invalid Configuration**
```csharp
// Callback URL not in allowed list
var loginResult = await _auth0Client.LoginAsync();

if (loginResult.IsError && loginResult.Error.Contains("redirect_uri"))
{
    // This usually means the callback URL isn't configured in Auth0 dashboard
    ShowError("Configuration error. Please contact support.");
}
```

#### **4. Token Expiration**
```csharp
// Access token expired
var response = await CallApiAsync(accessToken);

if (response.StatusCode == HttpStatusCode.Unauthorized)
{
    if (!string.IsNullOrEmpty(refreshToken))
    {
        var refreshResult = await _auth0Client.RefreshTokenAsync(refreshToken);

        if (!refreshResult.IsError)
        {
            // Retry with new token
            response = await CallApiAsync(refreshResult.AccessToken);
        }
        else
        {
            // Refresh failed, re-login required
            await _auth0Client.LoginAsync();
        }
    }
}
```

#### **5. ID Token Validation Failures**
```csharp
// Organization mismatch or invalid issuer
var loginResult = await _auth0Client.LoginAsync(new { organization = "org_abc123" });

if (loginResult.IsError)
{
    if (loginResult.ErrorDescription.Contains("organization"))
    {
        ShowError("You are not authorized to access this organization");
    }
}
```

### Recommended Best Practices

#### **Security Best Practices**

1. **Never Store Client Secrets**
   - This SDK is for native/public clients - no client secrets
   - Client secrets are NOT secure in mobile apps

2. **Use PKCE (Automatically Enabled)**
   - The SDK automatically uses PKCE for added security
   - Protects against authorization code interception

3. **Secure Token Storage**
   - Store tokens in iOS Keychain, not UserDefaults or files
   - Use appropriate Keychain access controls
   - Clear tokens on logout

4. **Validate ID Tokens (Automatic)**
   - SDK automatically validates issuer, audience, signature
   - Validates organization claims when specified
   - Handles nonce validation

5. **Use HTTPS for APIs**
   - Always use HTTPS for API calls with access tokens
   - Consider certificate pinning for high-security apps

#### **Performance Best Practices**

1. **Reuse Auth0Client Instance**
   ```csharp
   // Good: Single instance
   private readonly Auth0Client _auth0Client;

   public MyViewController()
   {
       _auth0Client = new Auth0Client(options);
   }

   // Bad: Creating new instance each time
   public async Task Login()
   {
       var client = new Auth0Client(options); // Don't do this
       await client.LoginAsync();
   }
   ```

2. **Implement Token Refresh**
   - Request `offline_access` scope for refresh tokens
   - Refresh tokens before expiration
   - Avoid forcing users to re-login unnecessarily

3. **Configure LoadProfile Appropriately**
   ```csharp
   // If you only need claims from ID token
   var options = new Auth0ClientOptions
   {
       LoadProfile = false  // Saves a network request
   };
   ```

4. **Use Ephemeral Sessions When Appropriate**
   ```csharp
   // For shared devices or privacy-focused apps
   var browser = new ASWebAuthenticationSessionBrowser(
       new ASWebAuthenticationSessionOptions
       {
           PrefersEphemeralWebBrowserSession = true
       }
   );
   ```

#### **User Experience Best Practices**

1. **Handle User Cancellation Gracefully**
   - Don't show error messages when user cancels
   - Return to previous screen or home screen

2. **Provide Loading Indicators**
   ```csharp
   ShowLoadingIndicator();
   var result = await _auth0Client.LoginAsync();
   HideLoadingIndicator();
   ```

3. **Implement Remember Me**
   - Use refresh tokens with appropriate expiration
   - Store refresh tokens securely
   - Check token validity on app launch

4. **Clear Error Messages**
   ```csharp
   if (loginResult.IsError)
   {
       var userMessage = loginResult.Error switch
       {
           "UserCancel" => null, // Don't show error
           "access_denied" => "Access was denied. Please check your permissions.",
           _ => "An error occurred during login. Please try again."
       };

       if (userMessage != null)
           ShowError(userMessage);
   }
   ```

#### **Organization/Multi-Tenant Best Practices**

1. **Always Validate Organization Claims**
   - SDK automatically validates when organization parameter is provided
   - Ensure users can only access authorized organizations

2. **Handle Organization Invitations**
   ```csharp
   // Accept user invitation
   var result = await _auth0Client.LoginAsync(new
   {
       organization = "org_abc123",
       invitation = "invitation_code_from_email"
   });
   ```

3. **Store Organization Context**
   - Remember which organization user is accessing
   - Use organization ID for API calls

#### **Debugging Best Practices**

1. **Enable Debug Logging**
   ```csharp
   var options = new Auth0ClientOptions
   {
       LoggerFactory = LoggerFactory.Create(builder =>
       {
           builder.AddConsole();
           builder.SetMinimumLevel(LogLevel.Debug);
       })
   };
   ```

2. **Monitor Callback URLs**
   - SDK logs callback URLs to debug console
   - Verify they match Auth0 dashboard configuration

3. **Test with Different iOS Versions**
   - Browser behavior differs between iOS versions
   - Test on oldest supported iOS version (14.0)

---

## 7. Dependencies & Requirements

### Key Dependencies

#### **Primary Dependencies**

1. **Duende.IdentityModel.OidcClient (v6.0.1)**
   - Core OIDC client implementation
   - Handles OAuth 2.0 / OIDC protocol details
   - Provides browser integration abstraction
   - Industry-standard, well-maintained library

2. **Microsoft.Extensions.Logging (v6.0.0)**
   - Logging abstraction used throughout SDK
   - Required by Auth0.OidcClient.Core

3. **Microsoft.IdentityModel.Protocols.OpenIdConnect (v8.12.1)**
   - OpenID Connect protocol implementation
   - JWT token handling and validation

#### **iOS-Specific Dependencies**

1. **Xamarin.iOS** (for Xamarin.iOS projects)
   - iOS SDK bindings for C#
   - Required for UIKit, Foundation, AuthenticationServices frameworks

2. **.NET iOS** (for .NET 8/9 iOS projects)
   - Modern .NET implementation for iOS
   - Replaces Xamarin.iOS in newer projects

### System Requirements

#### **Development Environment**

**For macOS:**
- **macOS:** 12.0 (Monterey) or later
- **Xcode:** 14.0 or later (for iOS 14+ support)
- **Visual Studio for Mac:** 2022 or later (if using Xamarin)
- **.NET SDK:**
  - .NET 8.0 SDK (for net8.0-ios)
  - .NET 9.0 SDK (for net9.0-ios)
  - Xamarin.iOS SDK (for xamarin.ios10)

**For Windows (Xamarin.iOS with Mac Build Host):**
- **Windows:** 10 or later
- **Visual Studio:** 2022 or later with Xamarin workload
- **Mac Build Host:** macOS machine with Xcode
- **.NET SDK:** As above

#### **Runtime Requirements**

- **iOS Version:** 14.0 or later (as specified in `SupportedOSPlatformVersion`)
- **Devices:** All iOS devices (iPhone, iPad, iPod touch)
- **Simulator:** iOS Simulator 14.0 or later

### Version Compatibility Considerations

#### **Target Framework Compatibility**

The SDK targets three frameworks:
- `xamarin.ios10`: Legacy Xamarin.iOS
- `net8.0-ios`: .NET 8 iOS
- `net9.0-ios`: .NET 9 iOS

Choose based on your project type:
- **Existing Xamarin projects:** Use xamarin.ios10
- **New projects:** Use net8.0-ios or net9.0-ios
- **Future-proofing:** net9.0-ios for latest features

#### **Breaking Changes from Previous Versions**

**v3.x (Current)**
- Dropped support for .NET Standard 1.4
- Minimum .NET Standard 2.0
- Added CancellationToken support to all async methods
- Removed `ClientSecret` property (deprecated)
- Email scope added to defaults

**v2.x to v3.x Migration:**
- Update target framework to .NET Standard 2.0 minimum
- Remove `ClientSecret` if used (insecure for native apps)
- Update `IAuth0Client` interface implementations

### Minimum C# Version

- **C# Language Version:** Default for target framework
  - .NET 8: C# 12.0
  - .NET 9: C# 13.0
  - Xamarin.iOS: C# 7.3 or later

The SDK uses standard C# features compatible with C# 7.3+, ensuring broad compatibility.

---

## 8. Prerequisites & Development Environment

### System-Level Prerequisites

#### **For macOS Development (Recommended)**

1. **macOS Operating System**
   - Version: macOS 12 (Monterey) or later
   - Recommended: macOS 13 (Ventura) or macOS 14 (Sonoma)

2. **Xcode**
   - Version: 14.0 or later
   - Install from Mac App Store or developer.apple.com
   - Required for iOS SDK, simulators, and device deployment
   - Command Line Tools must be installed:
     ```bash
     xcode-select --install
     ```

3. **.NET SDK**
   - **.NET 8.0 SDK** or **.NET 9.0 SDK** for modern projects
   - Download from: https://dotnet.microsoft.com/download
   - Verify installation:
     ```bash
     dotnet --version
     ```

4. **iOS Workload (for .NET iOS)**
   ```bash
   dotnet workload install ios
   ```

5. **Visual Studio for Mac 2022** (Optional but recommended)
   - For integrated development experience
   - Includes iOS designer, simulators, etc.
   - Download from: https://visualstudio.microsoft.com/vs/mac/

#### **For Windows Development (Xamarin.iOS Only)**

1. **Windows Operating System**
   - Windows 10 or later
   - Windows 11 recommended

2. **Visual Studio 2022**
   - Community, Professional, or Enterprise edition
   - Install "Mobile development with .NET" workload
   - Download from: https://visualstudio.microsoft.com/

3. **Mac Build Host**
   - A macOS machine accessible on the network
   - Must have Xcode and Xamarin.iOS installed
   - Used for compilation and iOS Simulator access
   - Connected via Visual Studio's "Pair to Mac" feature

4. **.NET SDK** (if not included with Visual Studio)
   - Same as macOS requirements

### Specific Development Tools Required

#### **Package Manager**
- **NuGet:** Integrated with Visual Studio and .NET CLI
- No separate installation needed
- Package Manager Console (VS) or `dotnet` CLI for package operations

#### **NuGet Package Installation**
```bash
# Using .NET CLI
dotnet add package Auth0.OidcClient.iOS

# Using Package Manager Console (Visual Studio)
Install-Package Auth0.OidcClient.iOS

# Using PackageReference in .csproj
<PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
```

#### **Additional Tools (Optional but Useful)**

1. **iOS Simulators**
   - Included with Xcode
   - Manage via Xcode → Window → Devices and Simulators

2. **Charles Proxy or Proxyman**
   - For debugging network traffic
   - Useful for troubleshooting authentication flows

3. **Keychain Access.app**
   - Built into macOS
   - For inspecting stored tokens during development

### Version Requirements for Critical Dependencies

#### **Minimum Versions**

| Dependency | Minimum Version | Notes |
|------------|----------------|-------|
| .NET SDK | 8.0 or 9.0 | For net8.0-ios or net9.0-ios |
| iOS | 14.0 | Runtime minimum (SupportedOSPlatformVersion) |
| Xcode | 14.0 | For iOS 14+ SDK |
| macOS | 12.0 | For Xcode 14+ |
| Duende.IdentityModel.OidcClient | 6.0.1 | Auto-installed as dependency |
| Microsoft.Extensions.Logging | 6.0.0 | Auto-installed as dependency |

#### **Recommended Versions**

| Tool | Recommended Version |
|------|---------------------|
| .NET SDK | Latest stable (9.0) |
| Xcode | Latest stable |
| iOS Target | Latest stable (17.x) |
| Visual Studio | Latest 2022 version |

### Common Environment Setup Issues

#### **Issue 1: iOS Workload Not Installed**
**Symptom:** Build errors about missing iOS targets
**Solution:**
```bash
dotnet workload install ios
```

#### **Issue 2: Xcode Command Line Tools Not Configured**
**Symptom:** Build fails with "xcrun" errors
**Solution:**
```bash
sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer
sudo xcodebuild -license accept
```

#### **Issue 3: NuGet Package Restore Failures**
**Symptom:** Cannot find Auth0.OidcClient.iOS package
**Solution:**
1. Check internet connectivity
2. Clear NuGet cache:
   ```bash
   dotnet nuget locals all --clear
   ```
3. Restore packages:
   ```bash
   dotnet restore
   ```

#### **Issue 4: Provisioning Profile Errors**
**Symptom:** Cannot deploy to device
**Solution:**
1. Set up Apple Developer account
2. Configure signing in Xcode or Visual Studio
3. Use automatic provisioning for development

#### **Issue 5: Simulator Not Loading**
**Symptom:** iOS Simulator won't start or crashes
**Solution:**
1. Update Xcode to latest version
2. Reset simulators:
   ```bash
   xcrun simctl shutdown all
   xcrun simctl erase all
   ```
3. Restart Xcode and Visual Studio

#### **Issue 6: Mac Build Host Connection (Windows)**
**Symptom:** Cannot connect to Mac from Visual Studio on Windows
**Solution:**
1. Enable Remote Login on Mac (System Settings → Sharing)
2. Ensure both machines are on the same network
3. Use "Pair to Mac" in Visual Studio
4. Check firewall settings on Mac

---

## 9. Language Ecosystem & Type System Considerations

### C# Type System Integration

#### **Strongly-Typed Configuration**
The SDK leverages C#'s type system for compile-time safety:

```csharp
// Auth0ClientOptions is a strongly-typed configuration class
var options = new Auth0ClientOptions
{
    Domain = "tenant.auth0.com",      // string
    ClientId = "abc123",               // string
    Scope = "openid profile",          // string
    LoadProfile = true,                // bool
    Leeway = TimeSpan.FromMinutes(5),  // TimeSpan
    MaxAge = TimeSpan.FromHours(8)     // TimeSpan?
};
```

#### **Result Types**
The SDK uses specific result types from Duende.IdentityModel.OidcClient:

1. **LoginResult**
   - `IsError`: bool - indicates success or failure
   - `Error`: string - error code if failed
   - `ErrorDescription`: string - detailed error message
   - `AccessToken`: string - JWT access token
   - `IdentityToken`: string - JWT ID token
   - `RefreshToken`: string - refresh token (if offline_access requested)
   - `User`: ClaimsPrincipal - user identity with claims

2. **RefreshTokenResult**
   - Similar structure to LoginResult
   - Returns new tokens after refresh

3. **UserInfoResult**
   - `IsError`: bool
   - `Error`: string
   - `Claims`: IEnumerable<Claim>

4. **BrowserResultType** (enum for logout)
   - `Success`
   - `UserCancel`
   - `UnknownError`
   - `Timeout`

#### **Claims-Based Identity**
The SDK integrates with .NET's claims-based identity system:

```csharp
using System.Security.Claims;

// User is a ClaimsPrincipal
ClaimsPrincipal user = loginResult.User;

// Access claims using LINQ
var email = user.FindFirst(c => c.Type == "email")?.Value;
var name = user.FindFirst(c => c.Type == "name")?.Value;
var userId = user.FindFirst(c => c.Type == "sub")?.Value;

// Iterate all claims
foreach (var claim in user.Claims)
{
    Console.WriteLine($"{claim.Type}: {claim.Value}");
}

// Check if claim exists
bool hasEmailClaim = user.HasClaim(c => c.Type == "email");
```

### Language-Specific Patterns & Interfaces

#### **Async/Await Pattern**
All SDK methods follow C#'s async/await pattern:

```csharp
// All authentication operations are asynchronous
public async Task AuthenticateAsync()
{
    try
    {
        var result = await _auth0Client.LoginAsync();

        if (!result.IsError)
        {
            await ProcessUserAsync(result.User);
        }
    }
    catch (Exception ex)
    {
        // Handle exceptions
    }
}
```

#### **CancellationToken Support**
All async methods support cancellation:

```csharp
// Create a cancellation token source with timeout
var cts = new CancellationTokenSource(TimeSpan.FromSeconds(30));

try
{
    var result = await _auth0Client.LoginAsync(
        extraParameters: null,
        cancellationToken: cts.Token
    );
}
catch (OperationCanceledException)
{
    // Login was cancelled or timed out
}
```

#### **IAuth0Client Interface**
For dependency injection and testing:

```csharp
using Auth0.OidcClient;

// Interface for mocking in unit tests
public interface IAuthenticationService
{
    Task<LoginResult> LoginAsync();
    Task<BrowserResultType> LogoutAsync();
}

public class AuthenticationService : IAuthenticationService
{
    private readonly IAuth0Client _auth0Client;

    public AuthenticationService(IAuth0Client auth0Client)
    {
        _auth0Client = auth0Client;
    }

    public Task<LoginResult> LoginAsync() => _auth0Client.LoginAsync();
    public Task<BrowserResultType> LogoutAsync() => _auth0Client.LogoutAsync();
}
```

#### **IBrowser Interface for Custom Implementations**
```csharp
using Duende.IdentityModel.OidcClient.Browser;

// Custom browser implementation
public class CustomBrowser : IBrowser
{
    public Task<BrowserResult> InvokeAsync(
        BrowserOptions options,
        CancellationToken cancellationToken = default)
    {
        var tcs = new TaskCompletionSource<BrowserResult>();

        // Custom browser logic
        // Navigate to options.StartUrl
        // Wait for callback to options.EndUrl
        // Return result with callback URL

        tcs.SetResult(new BrowserResult
        {
            ResultType = BrowserResultType.Success,
            Response = callbackUrl
        });

        return tcs.Task;
    }
}
```

### Required Language-Specific Configuration

#### **Using Directives**
Common namespaces to import:

```csharp
using Auth0.OidcClient;                           // Core SDK namespace
using Duende.IdentityModel.OidcClient;            // OIDC client types
using Duende.IdentityModel.OidcClient.Browser;    // Browser abstractions
using Duende.IdentityModel.OidcClient.Results;    // Result types
using System.Security.Claims;                     // Claims-based identity
using Foundation;                                 // iOS Foundation framework
using UIKit;                                      // iOS UIKit framework
```

#### **Project File Configuration**
For .csproj files:

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net8.0-ios;net9.0-ios</TargetFrameworks>
    <OutputType>Exe</OutputType>
    <SupportedOSPlatformVersion>14.0</SupportedOSPlatformVersion>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
  </ItemGroup>
</Project>
```

#### **Nullable Reference Types**
The SDK supports nullable reference types (C# 8.0+):

```csharp
// Enable nullable reference types
#nullable enable

public class AuthService
{
    private Auth0Client? _client;

    public void Initialize(Auth0ClientOptions options)
    {
        _client = new Auth0Client(options);
    }

    public async Task<string?> GetAccessTokenAsync()
    {
        if (_client == null)
            throw new InvalidOperationException("Client not initialized");

        var result = await _client.LoginAsync();
        return result.IsError ? null : result.AccessToken;
    }
}
```

### Compilation & Runtime Compatibility

#### **Target Framework Monikers (TFMs)**
The SDK supports three TFMs:

1. **xamarin.ios10**: Legacy Xamarin.iOS
   - Uses Xamarin.iOS runtime
   - Compatible with Visual Studio for Mac/Windows
   - Mature, stable platform

2. **net8.0-ios**: Modern .NET iOS
   - Uses .NET 8 runtime
   - Better performance than Xamarin
   - Unified with .NET ecosystem

3. **net9.0-ios**: Latest .NET iOS
   - Uses .NET 9 runtime
   - Latest C# features
   - Best performance and tooling

#### **Runtime Considerations**

**AOT Compilation (Ahead-of-Time):**
- iOS requires AOT compilation (no JIT)
- All code is compiled to native code at build time
- Some dynamic features are restricted

**Linking:**
- Linker removes unused code to reduce app size
- SDK is linker-safe
- May need to preserve custom types if using reflection

**Trimming:**
- .NET 8+ uses assembly trimming
- SDK assemblies are trim-compatible
- Custom code using reflection may need annotations

#### **Platform-Specific Code**
iOS-specific implementation:

```csharp
#if IOS
using UIKit;
using Foundation;

public class PlatformService
{
    public string GetBundleIdentifier()
    {
        return NSBundle.MainBundle.BundleIdentifier;
    }

    public bool IsSimulator()
    {
        return Runtime.Arch == Arch.SIMULATOR;
    }
}
#endif
```

---

## 10. Current vs Deprecated Approaches

### Current Recommended Installation Method

#### **Using .NET CLI (Recommended)**
```bash
# Navigate to your iOS project directory
cd MyApp.iOS

# Add the package
dotnet add package Auth0.OidcClient.iOS

# Restore packages (usually automatic)
dotnet restore
```

#### **Using Visual Studio Package Manager**
```powershell
# In Package Manager Console
Install-Package Auth0.OidcClient.iOS
```

#### **Using PackageReference (Modern)**
Edit your `.csproj` file:
```xml
<ItemGroup>
  <PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
</ItemGroup>
```

### Deprecated or Outdated Approaches to Avoid

#### **❌ DEPRECATED: packages.config (Old Xamarin)**
```xml
<!-- DO NOT USE - Legacy package management -->
<packages>
  <package id="Auth0.OidcClient.iOS" version="3.6.0" />
</packages>
```
**Why to avoid:**
- packages.config is legacy Xamarin approach
- Not supported in .NET 8/9
- Use PackageReference instead

#### **❌ DEPRECATED: Auth0.OidcClient.Android Package**
The README notes:
> As `Auth0.OidcClient.Android` relies on support libraries which have been deprecated by Google since 2019, there is no way for `Auth0.OidcClient.Android` to ever work on .NET 6 and above. If you wish to integrate Auth0 in an Android application, use `Auth0.OidcClient.AndroidX` instead.

For iOS, always use **Auth0.OidcClient.iOS**, not any Android variant.

#### **❌ DEPRECATED: ClientSecret in Auth0ClientOptions**
```csharp
// DO NOT USE - ClientSecret is deprecated
var options = new Auth0ClientOptions
{
    ClientSecret = "secret123"  // ❌ Insecure for native apps
};
```
**Why to avoid:**
- Native apps cannot securely store secrets
- PKCE is the proper alternative (automatically used)
- Will be removed in future SDK versions

#### **❌ DEPRECATED: PlatformWebView Class**
```csharp
// DO NOT USE - Removed in v3.0
var options = new Auth0ClientOptions
{
    Browser = new PlatformWebView()  // ❌ No longer exists
};
```
**Why to avoid:**
- Removed in v3.0
- Use default (omit Browser) or specify explicit browser implementation

### Modern .NET Tooling & Conventions

#### **Current: .NET iOS Project Structure**
```
MyApp.iOS/
├── MyApp.iOS.csproj          # Modern SDK-style project
├── Info.plist                # iOS app configuration
├── Entitlements.plist        # App entitlements
├── AppDelegate.cs            # Application lifecycle
├── ViewControllers/          # UI controllers
│   └── LoginViewController.cs
├── Services/                 # Business logic
│   └── AuthService.cs
└── Resources/                # Images, assets
    └── Assets.xcassets/
```

#### **Current: SDK-Style Project File**
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net8.0-ios</TargetFrameworks>
    <OutputType>Exe</OutputType>
    <RootNamespace>MyApp.iOS</RootNamespace>
    <SupportedOSPlatformVersion>14.0</SupportedOSPlatformVersion>
    <DebugType>portable</DebugType>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
  </ItemGroup>
</Project>
```

#### **Current: Top-Level Statements (C# 9+)**
For simple scenarios:
```csharp
// Program.cs
UIApplication.Main(args, null, typeof(AppDelegate));
```

#### **Current: Global Using Directives (C# 10+)**
Create `GlobalUsings.cs`:
```csharp
global using Auth0.OidcClient;
global using Foundation;
global using UIKit;
global using System.Security.Claims;
```

### iOS-Specific Integration Patterns

#### **✅ CURRENT: ASWebAuthenticationSession (iOS 12+)**
```csharp
// Default - SDK automatically selects this for iOS 12+
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "tenant.auth0.com",
    ClientId = "client_id"
    // Browser is auto-selected (ASWebAuthenticationSession)
});

// Explicit configuration
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "tenant.auth0.com",
    ClientId = "client_id",
    Browser = new ASWebAuthenticationSessionBrowser(
        new ASWebAuthenticationSessionOptions
        {
            PrefersEphemeralWebBrowserSession = true
        }
    )
});
```

#### **✅ CURRENT: ActivityMediator for Callbacks**
```csharp
[Register("AppDelegate")]
public class AppDelegate : UIApplicationDelegate
{
    public override bool OpenUrl(UIApplication application, NSUrl url,
        string sourceApplication, NSObject annotation)
    {
        ActivityMediator.Instance.Send(url.AbsoluteString);
        return true;
    }
}
```

#### **❌ DEPRECATED: SFSafariViewController (iOS 9-10)**
```csharp
// Only use if you must support iOS 10 or earlier
// SDK minimum is iOS 14, so this is rarely needed
var client = new Auth0Client(new Auth0ClientOptions
{
    Browser = new SFSafariViewControllerBrowser()  // Legacy
});
```

### Migration from Xamarin.iOS to .NET iOS

#### **Old Approach (Xamarin.iOS)**
```xml
<!-- Legacy Xamarin.iOS project -->
<Project ToolsVersion="4.0" DefaultTargets="Build">
  <PropertyGroup>
    <TargetFrameworkIdentifier>Xamarin.iOS</TargetFrameworkIdentifier>
    <TargetFrameworkVersion>v1.0</TargetFrameworkVersion>
  </PropertyGroup>

  <ItemGroup>
    <Reference Include="Xamarin.iOS" />
    <PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
  </ItemGroup>
</Project>
```

#### **New Approach (.NET 8/9 iOS)**
```xml
<!-- Modern .NET iOS project -->
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net8.0-ios</TargetFrameworks>
    <SupportedOSPlatformVersion>14.0</SupportedOSPlatformVersion>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Auth0.OidcClient.iOS" Version="3.6.0" />
  </ItemGroup>
</Project>
```

**Migration Benefits:**
- Better performance (Ahead-of-Time compilation improvements)
- Unified .NET experience
- Better tooling support
- Smaller app sizes
- Access to latest C# features

### Version-Specific Recommendations

| Scenario | Recommended Approach |
|----------|---------------------|
| New iOS app | Use .NET 8 or .NET 9 with net8.0-ios/net9.0-ios |
| Existing Xamarin.iOS app | Migrate to .NET 8/9 when possible |
| Legacy codebase | Continue with Xamarin.iOS (xamarin.ios10 target) |
| Cross-platform (MAUI) | Use Auth0.OidcClient.MAUI package instead |
| iOS-only app | Use Auth0.OidcClient.iOS with .NET 8/9 |

---

## 11. External Service & Configuration Requirements

### Auth0 Service Setup

#### **Creating an Auth0 Account**

1. **Sign Up**
   - Visit https://auth0.com/signup
   - Create a free account
   - Verify email address

2. **Create a Tenant**
   - Choose a tenant domain (e.g., `my-company.auth0.com`)
   - Select region (US, EU, AU, etc.)
   - Tenant domain cannot be changed later

#### **Creating a Native Application**

1. **Navigate to Applications**
   - Dashboard → Applications → Applications
   - Click "Create Application"

2. **Configure Application**
   - **Name:** Give it a descriptive name (e.g., "iOS App")
   - **Type:** Select "Native"
   - Click "Create"

3. **Important Settings to Note**
   - **Domain:** Your tenant domain (e.g., `tenant.auth0.com`)
   - **Client ID:** Auto-generated unique identifier
   - **DO NOT use Client Secret** in mobile apps (insecure)

### Required Configuration Values

#### **Values to Obtain from Auth0 Dashboard**

| Configuration Value | Location in Dashboard | Example Format | Required |
|---------------------|----------------------|----------------|----------|
| Domain | Application Settings → Basic Information | `tenant.auth0.com` | ✅ Yes |
| Client ID | Application Settings → Basic Information | `abc123xyz789` | ✅ Yes |
| Allowed Callback URLs | Application Settings → Application URIs | `com.example.app://tenant.auth0.com/ios/com.example.app/callback` | ✅ Yes |
| Allowed Logout URLs | Application Settings → Application URIs | `com.example.app://tenant.auth0.com/ios/com.example.app/callback` | ✅ Yes |
| Allowed Web Origins | Application Settings → Application URIs | Not typically needed for iOS | ❌ No |

#### **Obtaining Configuration Values**

```csharp
// These values come from Auth0 Dashboard
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "YOUR_TENANT.auth0.com",      // From: Basic Information
    ClientId = "YOUR_CLIENT_ID"            // From: Basic Information
});
```

### Configuration Value Formats & Examples

#### **1. Domain**
**Format:** `tenant-name.region.auth0.com` or custom domain

**Examples:**
```
tenant.auth0.com           // US tenant
tenant.eu.auth0.com        // EU tenant
tenant.au.auth0.com        // Australia tenant
auth.example.com           // Custom domain
```

**Common Errors:**
```csharp
// ❌ WRONG - Including https://
Domain = "https://tenant.auth0.com"

// ❌ WRONG - Including trailing slash
Domain = "tenant.auth0.com/"

// ✅ CORRECT
Domain = "tenant.auth0.com"
```

#### **2. Client ID**
**Format:** Alphanumeric string, typically 32 characters

**Examples:**
```
qmss9A66stPWTOXjR6X1OeA0DLadoNP2
```

**Common Errors:**
```csharp
// ❌ WRONG - Using Client Secret instead
ClientId = "abc123-secret-xyz789"

// ✅ CORRECT - Using Client ID
ClientId = "qmss9A66stPWTOXjR6X1OeA0DLadoNP2"
```

#### **3. Callback URLs (Allowed Callback URLs)**
**Format:** `BUNDLE_ID://DOMAIN/ios/BUNDLE_ID/callback`

**Formula:**
```
{Bundle Identifier}://{Auth0 Domain}/ios/{Bundle Identifier}/callback
```

**Examples:**
```
// Example 1: Standard app
com.example.myapp://tenant.auth0.com/ios/com.example.myapp/callback

// Example 2: Company app
com.acme.mobile://acme.auth0.com/ios/com.acme.mobile/callback

// Example 3: App with subdomain
com.company.app.ios://company.eu.auth0.com/ios/com.company.app.ios/callback
```

**Where to Add in Dashboard:**
- Navigate to Application Settings
- Scroll to "Application URIs" section
- Add to "Allowed Callback URLs" field
- Can add multiple URLs (comma or newline separated)

**Common Errors:**
```
// ❌ WRONG - Using https://
https://com.example.myapp://tenant.auth0.com/...

// ❌ WRONG - Missing /ios/ part
com.example.myapp://tenant.auth0.com/com.example.myapp/callback

// ❌ WRONG - Incorrect bundle identifier casing
Com.Example.MyApp://tenant.auth0.com/ios/com.example.myapp/callback

// ✅ CORRECT
com.example.myapp://tenant.auth0.com/ios/com.example.myapp/callback
```

#### **4. Logout URLs (Allowed Logout URLs)**
**Format:** Same as Callback URLs

**Examples:**
```
com.example.myapp://tenant.auth0.com/ios/com.example.myapp/callback
```

**Note:** Can be the same as callback URL or different. Must be configured in dashboard.

### Complete Configuration Example

#### **Auth0 Dashboard Configuration**
```
Application Name: My iOS App
Type: Native

Basic Information:
  Domain: mycompany.auth0.com
  Client ID: qmss9A66stPWTOXjR6X1OeA0DLadoNP2
  Client Secret: [NOT USED IN MOBILE APPS]

Application URIs:
  Allowed Callback URLs:
    com.mycompany.app://mycompany.auth0.com/ios/com.mycompany.app/callback

  Allowed Logout URLs:
    com.mycompany.app://mycompany.auth0.com/ios/com.mycompany.app/callback

Advanced Settings → OAuth:
  JsonWebToken Signature Algorithm: RS256
  OIDC Conformant: Enabled
```

#### **iOS Application Configuration**

**Info.plist:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>CFBundleIdentifier</key>
    <string>com.mycompany.app</string>

    <key>CFBundleURLTypes</key>
    <array>
        <dict>
            <key>CFBundleTypeRole</key>
            <string>None</string>
            <key>CFBundleURLName</key>
            <string>Auth0</string>
            <key>CFBundleURLSchemes</key>
            <array>
                <string>com.mycompany.app</string>
            </array>
        </dict>
    </array>
</dict>
</plist>
```

**SDK Configuration:**
```csharp
using Auth0.OidcClient;

var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "mycompany.auth0.com",
    ClientId = "qmss9A66stPWTOXjR6X1OeA0DLadoNP2",
    // RedirectUri is auto-generated from Bundle ID:
    // "com.mycompany.app://mycompany.auth0.com/ios/com.mycompany.app/callback"
});
```

### Common Configuration Errors & Prevention

#### **Error 1: Callback URL Mismatch**

**Symptom:**
```
Error: redirect_uri_mismatch
Description: The redirect URI is wrong. You sent com.example.app://...,
and we expected com.example.app://...
```

**Causes:**
1. Callback URL not added to Allowed Callback URLs in dashboard
2. Typo in bundle identifier
3. Case mismatch in bundle identifier

**Prevention:**
```csharp
// Let SDK auto-generate callback URL
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "tenant.auth0.com",
    ClientId = "abc123"
    // DO NOT set RedirectUri unless you have a specific reason
});

// SDK logs the generated callback URL:
// "Using Callback URL 'com.example.app://tenant.auth0.com/ios/com.example.app/callback'"
// Copy this EXACT URL to Auth0 dashboard
```

#### **Error 2: Invalid Domain**

**Symptom:**
```
Error: Failed to load discovery document
HttpRequestException: Name or service not known
```

**Causes:**
1. Domain includes "https://"
2. Typo in domain name
3. Network connectivity issues

**Prevention:**
```csharp
// ❌ WRONG
Domain = "https://tenant.auth0.com"

// ❌ WRONG
Domain = "tenant.auth0.com/"

// ✅ CORRECT
Domain = "tenant.auth0.com"
```

#### **Error 3: Client ID Not Found**

**Symptom:**
```
Error: unauthorized_client
Description: Grant type 'authorization_code' not allowed for the client
```

**Causes:**
1. Wrong Client ID
2. Using Client Secret instead of Client ID
3. Application type is not "Native"

**Prevention:**
1. Copy Client ID from "Basic Information" section (not Client Secret)
2. Verify application type is "Native" in Auth0 dashboard
3. Double-check for typos

#### **Error 4: RS256 Not Configured**

**Symptom:**
```
Error: ID token validation failed
```

**Causes:**
1. JWT Signature Algorithm not set to RS256
2. OIDC Conformant not enabled

**Prevention:**
1. Navigate to Application Settings → Advanced Settings → OAuth
2. Set "JsonWebToken Signature Algorithm" to **RS256**
3. Enable **OIDC Conformant**

### Environment-Specific Configuration

#### **Development Environment**
```csharp
#if DEBUG
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "dev-tenant.auth0.com",
    ClientId = "dev_client_id"
});
#else
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "prod-tenant.auth0.com",
    ClientId = "prod_client_id"
});
#endif
```

#### **Configuration File Approach**
```csharp
// appsettings.json or configuration file
{
  "Auth0": {
    "Domain": "tenant.auth0.com",
    "ClientId": "abc123"
  }
}

// Load in code
var config = Configuration.GetSection("Auth0");
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = config["Domain"],
    ClientId = config["ClientId"]
});
```

#### **Environment Variables (CI/CD)**
```bash
# Set in build pipeline or environment
export AUTH0_DOMAIN="tenant.auth0.com"
export AUTH0_CLIENT_ID="abc123"
```

```csharp
// Read in code
var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = Environment.GetEnvironmentVariable("AUTH0_DOMAIN"),
    ClientId = Environment.GetEnvironmentVariable("AUTH0_CLIENT_ID")
});
```

---

## Appendix: Additional Resources

### Official Documentation
- **SDK Documentation:** https://auth0.github.io/auth0-oidc-client-net/
- **Auth0 Docs:** https://auth0.com/docs
- **GitHub Repository:** https://github.com/auth0/auth0-oidc-client-net

### Sample Applications
- **iOS Sample:** Included in repository at `test/iOS/`
- **Xamarin Samples:** https://github.com/auth0-samples/auth0-xamarin-oidc-samples

### Related Technologies
- **Duende IdentityModel:** https://github.com/DuendeSoftware/IdentityModel.OidcClient
- **OIDC Specification:** https://openid.net/specs/openid-connect-core-1_0.html
- **OAuth 2.0 Specification:** https://tools.ietf.org/html/rfc6749

### Support & Community
- **GitHub Issues:** https://github.com/auth0/auth0-oidc-client-net/issues
- **Auth0 Community:** https://community.auth0.com/
- **Security Issues:** https://auth0.com/responsible-disclosure-policy

---

## Conclusion

The Auth0.OidcClient.iOS SDK provides a robust, secure, and developer-friendly way to implement authentication in iOS applications using C#. By abstracting the complexities of OAuth 2.0 and OIDC protocols while providing iOS-specific integrations, the SDK enables developers to add enterprise-grade authentication in hours rather than days.

Key takeaways for quickstart documentation:
- **Minimal setup required:** Just Domain and Client ID
- **Auto-configuration:** Callback URLs generated from Bundle ID
- **Platform integration:** Native iOS browser components
- **Security built-in:** PKCE, token validation, secure flows
- **Enterprise features:** Organizations, SSO, MFA support
- **Modern .NET:** Full support for .NET 8/9 iOS

This analysis provides the foundation for creating comprehensive, accurate quickstart documentation that will help developers successfully integrate Auth0 authentication into their iOS applications.
