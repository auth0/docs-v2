---
title: "Auth0 Ruby On Rails SDK Quickstarts: Troubleshooting"
permalink: "02-troubleshooting"
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

##### By David Patrick

Troubleshooting tips for using Rails with Auth0.We recommend that you log in to follow this quickstart with examples configured for your account.

{/* <Card title="View on Github" href="https://github.com/auth0-samples/auth0-rubyonrails-sample/tree/master/sample" icon="github">
System requirements: Ruby 2.5.0+ | Rails 6.0+ or Rails 5.0+ or Rails 4.2+
</Card> */}
# Troubleshooting

The following are troubleshooting topics that you might run into when using the Rails quickstart.

## Using a reverse proxy

The `redirect_uri` parameter that OmniAuth generates when redirecting to login is based on the `Host` header that is passed to Rails. This can cause incorrect callback URLs to be passed when using this strategy (and OmniAuth in general) with a reverse proxy. You can adjust the host used by OmniAuth with the following snippet:

<AuthCodeBlock icon="file-code">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






[See this StackOverflow thread for more information](https://stackoverflow.com/a/7135029/728480).

## ActionController::InvalidAuthenticityToken

This is likely caused by a missing CSRF token needed to POST the login request. If you inspect the login button in your browser, you should see something like this:

<AuthCodeBlock icon="file-code" language="erb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






... and in the `<head>` element for the page, you should have CSRF meta tags like these:

<AuthCodeBlock icon="file-code" language="erb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






With those elements in place, Rails will convert the login link to POST the CSRF token to the backend to verify it before redirecting to login.

## ActionDispatch::Cookies::CookieOverflow

This error means that a cookie session is being used and because the whole profile is being stored, it overflows the max-size of 4 kb. If you are unable to access the user profile, or you get an error similar to `NoMethodError`, `undefined method '[]' for nil:NilClass`, try using In-Memory store for development.

Go to `/config/initializers/session_store.rb` (or create it if it does not exist) and add the following:

<AuthCodeBlock icon="file-code">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






Go to `/config/environments/development.rb` and add the following:

<AuthCodeBlock icon="file-code">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






Restart your Rails server for these changes to take effect.

It is recommended that a memory store, such as MemCached, is being used for production applications.

## SSL Issues

Under some configurations, Ruby may not be able to find certification authority certificates (CA certs).

Download the CA certs bundle to the project directory:

<AuthCodeBlock icon="file-code" language="bash" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






Add this initializer to `config/initializers/fix_ssl.rb`:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






## "failure message=invalid_credentials"

This issue doesn't occur when working locally but may happen in a staging or production environment. The error message may be displayed as:

<AuthCodeBlock icon="file-code">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






To solve this, add the following to `config/environments/staging.rb` or `production.rb`:

<AuthCodeBlock icon="file-code">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






Substitute `http://www.example.com` with the actual URL you'll be using in your application.







[Edit on GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/webapp/rails/02-troubleshooting.md)