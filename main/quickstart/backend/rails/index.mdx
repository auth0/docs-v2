---
title: "Ruby On Rails API: Authorization"
permalink: "01-authorization"
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

##### By Josh Cunningham

This tutorial demonstrates how to add authorization to a Ruby on Rails API.We recommend that you log in to follow this quickstart with examples configured for your account.

{/* <Card title="View on Github" href="https://github.com/auth0-samples/auth0-rubyonrails-api-samples/tree/master/01-Authentication-RS256" icon="github">
System requirements: Ruby 2.1.8 | Rails 4.2.5
</Card> */}

<Info>
**New to Auth0?** Learn [how Auth0 works](/get-started/auth0-overview) and read about [implementing API authentication and authorization](/get-started/authentication-and-authorization-flow) using the OAuth 2.0 framework.
</Info>

## Configure Auth0 APIs

### Create an API

In the [APIs](https://manage.auth0.com/#/apis) section of the Auth0 dashboard, click **Create API**. Provide a name and an identifier for your API, for example, `https://quickstarts/api`. You will use the identifier as an `audience` later, when you are configuring the Access Token verification. Leave the **Signing Algorithm** as **RS256**.

<Frame>![Create API](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/create-api.png)</Frame>

By default, your API uses RS256 as the algorithm for signing tokens. Since RS256 uses a private/public keypair, it verifies the tokens against the public key for your Auth0 account. The public key is in the [JSON Web Key Set (JWKS)](/secure/tokens/json-web-tokens/json-web-key-sets) format, and can be accessed [here](https://{yourDomain}/.well-known/jwks.json).

<Info>
We recommend using the default RS256 [signing algorithm](/get-started/applications/signing-algorithms) for your API. If you need to use the HS256 algorithm, see the [HS256 integration sample](https://github.com/auth0-samples/auth0-rubyonrails-api-samples/tree/OIDC/02-Authentication-HS256).
</Info>

### Define permissions

Permissions let you define how resources can be accessed on behalf of the user with a given access token. For example, you might choose to grant read access to the `messages` resource if users have the manager access level, and a write access to that resource if they have the administrator access level.

You can define allowed permissions in the **Permissions** view of the Auth0 Dashboard's [APIs](https://manage.auth0.com/#/apis) section.

<Frame>![Configure Permissions](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/configure-permissions.png)</Frame>

<Info>
This example uses the `read:messages` scope.
</Info>

This example demonstrates:

* How to check for a JSON Web Token (JWT) in the `Authorization` header of an incoming HTTP request.
* How to check if the token is valid, using the [JSON Web Key Set (JWKS)](/secure/tokens/json-web-tokens/json-web-key-sets) for your Auth0 account. To learn more about validating Access Tokens, see [Validate Access Tokens](/secure/tokens/access-tokens/validate-access-tokens).

## Validate Access Tokens

### Install dependencies

This tutorial performs access token validation using the [**jwt**](https://github.com/jwt/ruby-jwt) Gem within a custom `Auth0Client` class. A Concern called `Secured` is used to authorize endpoints which require authentication through an incoming access token.

Install the **jwt** Gem.

<AuthCodeBlock icon="file-code" language="bash" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






### Create an Auth0Client class

Create a class called `Auth0Client` which decodes and verifies the incoming access token taken from the `Authorization` header of the request. The public key for your Auth0 tenant can be fetched to verify the token.

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






### Define a Secured concern

Create a Concern called `Secured` which looks for the access token in the `Authorization` header of an incoming request. If the token is present, it should be passed to `Auth0Client.validate_token`.

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






### Validate scopes

The `Auth0Client.validate_token` method above verifies that the access token included in the request is valid; however, it doesn't yet include any mechanism for checking that the token has the sufficient **scope** to access the requested resources.

To look for a particular `scope` in an access token, create a new struct in your `Auth0Client` class called `Token` and define a new method inside, `validate_permissions`, that given an array of required scopes it will check if they are present in the payload of the token.

Go to the `Auth0Client` class. Add the new `Token` struct and update the return value of the `validate_token` method as follows:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






Next, in the `Secured` concern, define a new error constant `INSUFFICIENT_PERMISSIONS` to return a proper error message in case there was a attempt to request a resource without the right permissions. Next, update the return value of the `Auth0Client.validate_token` call and finally create a new method `validate_permissions` where to check if the token has the right permissions, or return a `403 FORBIDDEN` status code with the `INSUFFICIENT_PERMISSIONS` error message otherwise.

Apply these changes in your `Secured` concern by adding the following code:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>

## Protect API Endpoints

The routes shown below are available for the following requests:

* `GET /api/public`: available for non-authenticated requests
* `GET /api/private`: available for authenticated requests containing an access token with no additional scopes
* `GET /api/private-scoped`: available for authenticated requests containing an access token with the `read:messages` scope granted

Add the `Secured` concern to the `ApplicationController`:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






You only ned to protect the `PrivateController` as follows:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>






In order to check that your access token has the right permissions, call the `validate_permissions` method as follows in the `private-scoped` action:

<AuthCodeBlock icon="file-code" language="rb" lines="true">
AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://{USER_DOMAIN}'
AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
</AuthCodeBlock>

<Info>
##### What can you do next?
<table>
  <tr>
    <td><a href="/authenticate/identity-providers">Configure other identity providers</a></td>
    <td><a href="/secure/multi-factor-authentication">Enable multifactor authentication</a></td>
  </tr>
  <tr>
    <td><a href="/secure/attack-protection">Learn about attack protection</a></td>
    <td><a href="/customize/rules">Learn about rules</a></td>
  </tr>
</table>
[Edit on GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>
---

