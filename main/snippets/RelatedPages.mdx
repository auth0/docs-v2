export const AppendRelatedPages = ({ items, title = "Related pages" }) => {
  const [isClient, setIsClient] = useState(false);

  useEffect(() => setIsClient(true), []);

  useEffect(() => {
    if (!isClient || !items?.length) return;

    const container = document.getElementById("content-side-layout");
    if (!container) return;

    let wrapper = container.querySelector("[data-related-pages]");
    if (!wrapper) {
      const separator = document.createElement("div");
      separator.className = "px-1 py-3 pl-10 mb-3";
      const separatorInner = document.createElement("div");
      separatorInner.className = "h-px w-full max-w-[28rem] bg-gray-100 dark:bg-white/10";
      separator.appendChild(separatorInner);
      container.appendChild(separator);

      wrapper = document.createElement("div");
      wrapper.setAttribute("data-related-pages", "true");
      wrapper.className =
        "z-10 hidden xl:flex pl-10 box-border w-[19rem] max-h-full";

      const inner = document.createElement("div");
      inner.className =
        "text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 pb-4 -mt-10 pt-10";

      const header = document.createElement("div");
      header.className =
        "text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2";

      const icon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      icon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
      icon.setAttribute("width", "11");
      icon.setAttribute("height", "12");
      icon.setAttribute("viewBox", "0 0 11 12");
      icon.setAttribute("fill", "none");
      icon.setAttribute("class", "h-3 w-3");

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute(
        "d",
        "M0.986328 9.79145V2.20812C0.986328 1.41006 1.63272 0.763672 2.43077 0.763672H6.46511C6.6565 0.763672 6.84066 0.839505 6.97572 0.975283L9.8025 3.80206C9.93827 3.93784 10.0141 4.12128 10.0141 4.31267V9.79145C10.0141 10.5895 9.36772 11.2359 8.56966 11.2359H2.43077C1.63272 11.2359 0.986328 10.5895 0.986328 9.79145Z"
      );
      path.setAttribute("stroke", "currentColor");
      path.setAttribute("stroke-width", "1.5");
      path.setAttribute("stroke-linecap", "round");
      path.setAttribute("stroke-linejoin", "round");
      icon.appendChild(path);

      const label = document.createElement("span");
      label.textContent = title;

      header.appendChild(icon);
      header.appendChild(label);

      const list = document.createElement("ul");
      list.className = "toc";
      list.setAttribute("data-related-pages-list", "true");

      inner.appendChild(header);
      inner.appendChild(list);
      wrapper.appendChild(inner);

      container.appendChild(wrapper);
    }

    const list = wrapper.querySelector("[data-related-pages-list]");
    if (!list) return;
    list.innerHTML = "";

    items.forEach(({ href, text }) => {
      const li = document.createElement("li");
      li.className = "toc-item relative";
      li.setAttribute("data-depth", "0");

      const a = document.createElement("a");
      a.href = href;
      a.textContent = text;
      a.className =
        "py-1 block border-l pl-4 border-gray-950/5 dark:border-white/10 " +
        "hover:border-gray-950/20 dark:hover:border-white/20 " +
        "hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300";

      li.appendChild(a);
      list.appendChild(li);
    });
  }, [items, isClient, title]);

  return null;
};
