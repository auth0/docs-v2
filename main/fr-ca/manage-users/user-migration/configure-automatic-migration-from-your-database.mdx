---
title: "Configurer la migration automatique à partir de votre base de données"
permalink: "configure-automatic-migration-from-your-database"
'description': "Apprenez à activer la migration automatique des utilisateurs avec votre base de données personnalisée."
'og:title': "Configurer la migration automatique à partir de votre base de données"
'og:description': "Apprenez à activer la migration automatique des utilisateurs avec votre base de données personnalisée."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Configurer la migration automatique à partir de votre base de données"
'twitter:description': "Apprenez à activer la migration automatique des utilisateurs avec votre base de données personnalisée."
---

Configurez votre connexion à la base de données pour migrer automatiquement vos utilisateurs d’un magasin d’utilisateurs externe vers Auth0 à l’aide de [scripts d’action de base de données personnalisés](/docs/fr-ca/authenticate/database-connections/custom-db/templates).

<Warning>

Si vous essayez d’utiliser plusieurs méthodes de migration (par ex., la migration automatique puis l’importation en bloc d’utilisateurs), vous risquez de rencontrer une erreur `DUPLICATED_USER`. Cette erreur indique que l’utilisateur existe dans le magasin d’utilisateurs interne d’Auth0 mais pas dans votre locataire. Pour corriger cette erreur, supprimez l’utilisateur avec le point de terminaison [Supprimer un utilisateur de connexion](https://auth0.com/docs/api/management/v2#!/Connections/delete_users_by_email) de l’Auth0 Management API, puis réessayez l’importation.

</Warning>

## Configurez la connexion à la base de données en tant que personnalisée.

Créez une connexion à la base de données, puis définissez-la comme personnalisée.

1. Allez dans [Auth0 Dashboard > Authentification > Base de données](https://manage.auth0.com/#/connections/database) et sélectionnez la base de données à afficher.
2. Sélectionnez l’aperçu **Base de données personnalisée** , puis activez **Utiliser ma propre base de données**.

   <Frame>![Auth0 Dashboard - Authentication (Authentification) Database Connection (Connexion à la base de données) Custom Database Settings (Paramètres de base de données personnalisée) Use Own Database (Utiliser sa propre base de données) Enabled (Activé)](/images/fr-ca/cdy7uua7fh8z/11HPAdVwJMmnWbzMVjHCJ8/a6f14297fa01b33c9d532dd4712aa430/2025-02-27_17-27-18.png)</Frame>

3. Sélectionnez l’aperçu **Paramètres**, puis activez **Importer les utilisateurs vers Auth0**, ensuite cliquez sur **Enregistrer**.

## Configurez les scripts d’action de base de données.

Sélectionnez l’aperçu **Base de données personnalisée**, puis localisez **Scripts d’action de base de données**.

<Frame>![Dashboard Authentication Database Connection Custom Database tab Database Action Scripts](/images/fr-ca/cdy7uua7fh8z/4LBIvvjaABo51It4eVCmX3/4ef14765c79cc5b7ecfa3f3155caa9eb/Screen_Shot_2021-05-18_at_8.54.55_PM.png)</Frame>

### Connexion

Le script [Connexion](/docs/fr-ca/authenticate/database-connections/custom-db/templates/login) s’exécute chaque fois qu’un utilisateur non trouvé dans Auth0 tente de se connecter. Il vérifie que l’utilisateur existe dans le magasin d’utilisateurs externe sans redemander le mot de passe à ce dernier.

### Obtenir un utilisateur

Le script [Obtenir l’utilisateur](/docs/fr-ca/authenticate/database-connections/custom-db/templates/get-user) s’exécute après l’un des scénarios suivants :

* Un utilisateur initie une tentative d’inscription.
* Un utilisateur initie un processus de changement de mot de passe.
* Un utilisateur saisit son identifiant de connexion lorsqu’il utilise Identifier First + Données biométriques.
* Il est fait appel au point de terminaison de <Tooltip href="/docs/fr-ca/glossary?term=management-api" tip="Management API
Un produit permettant aux clients d’effectuer des tâches administratives." cta="Voir le glossaire">Management API</Tooltip> [mettre à jour le courriel ou le nom d’utilisateur](/docs/fr-ca/api/v2#!/Users/patch_users_by_id) ou [créer un utilisateur](/docs/fr-ca/api/management/v2#!/Users/post_users) .

Si un utilisateur qui n’a pas été migré confirme un changement de mot de passe et se connecte avec succès, son profil utilisateur sera créé dans Auth0 avec le nouveau mot de passe. Ce profil utilisateur contient toutes les données renvoyées dans le script Obtenir l’utilisateur. Toutes les connexions ultérieures pour cet utilisateur seront effectuées directement dans Auth0.

## Vérifiez que la migration des utilisateurs est complète.

Vérifiez que tous les utilisateurs ont été migrés vers le magasin d’utilisateurs Auth0 en utilisant le tableau de bord Auth0 ou Management API Auth0.

1. Allez à [Auth0 Dashboard > Gestion des utilisateurs > Utilisateurs](https://manage.auth0.com/#/users), et examinez la liste des utilisateurs.
2. Utilisez le point de terminaison [List or Search Users (Lister ou Rechercher des utilisateurs)](/docs/fr-ca/api/v2#!/Users/get_users) de Management API.

## Déconnectez le magasin d’utilisateurs externe.

Reconfigurer les scripts d’action de base de données car aucune opération ne fonctionne. Cela empêchera Auth0 d’accéder à votre magasin d’utilisateurs externe pour authentifier les utilisateurs.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Veillez à laisser l’option **Importer les utilisateurs vers Auth0** activée. Si vous désactivez cette option, Auth0 utilisera uniquement les scripts pour l’authentification et d’autres actions utilisateur au lieu d’utiliser les utilisateurs qui ont été importés localement.

</Callout>

1. Allez à [Auth0 Dashboard > Authentification > Base de données](https://manage.auth0.com/#/connections/database), ensuite sélectionnez votre connexion à la base de données.
2. Passez à l’aperçu **Base de données personnalisée**, puis localisez **Scripts d’action de base de données**.
3. Mettre à jour le script de **Connexion** .

   ```javascript lines
   function login (email, password, callback) {
     return callback(null, null);
   }
   ```

   

   
4. Mettre à jour le script **Obtenir l’utilisateur** .

   ```javascript lines
   function getByEmail (email, callback) {
     return callback(null, null);
   }
   ```

   

   

## Résoudre les problèmes de migration des utilisateurs.

Si vous rencontrez des problèmes avec la migration automatique, lisez premièrement [Les meilleures pratiques pour la connexion à la base de données personnalisée et les scripts d’action.](/docs/fr-ca/authenticate/database-connections/custom-db/custom-database-connections-scripts).

### L’utilisateur existe déjà.

Les scénarios les plus courants relatifs à quand vous pourriez rencontrer ce problème :

* Vous supprimez un utilisateur de votre connexion à la base de données, puis vous essayez de le recréer.
* Vous essayez de créer un nouvel utilisateur sur votre connexion à la base de données alors que ledit utilisateur existe déjà dans votre magasin d’utilisateurs externe.
* Un processus de migration d’un utilisateur a été interrompu.

Au cours du processus de migration de l’utilisateur, Auth0 crée premièrement un profil utilisateur partiel dans un magasin d’utilisateurs interne, puis crée un profil utilisateur complet dans votre connexion à la base de données. Si un problème survient qui empêche la création de ce profil utilisateur complet, vous pourriez faire face à l’erreur `The user already exists` .

Vous pouvez généralement résoudre ce problème en supprimant l’utilisateur de la connexion à la base de données, en supprimant l’utilisateur du magasin d’utilisateurs interne, puis en réessayant le processus de migration.

1. Vérifiez les instructions `console.log()` avec l’[extension Journaux Webtask en temps réel](/docs/fr-ca/customize/extensions/real-time-webtask-logs).
2. Supprimez l’utilisateur avec le point de terminaison [Delete a User (Supprimer un utilisateur)](https://auth0.com/docs/api/management/v2#!/Users/delete_users_by_id) de Management API.
3. Supprimez l’utilisateur avec le point de terminaison [Delete a Connection User (Supprimer un utilisateur de connexion)](/docs/fr-ca/api/management/v2#!/Connections/delete_users_by_email) de Management API.
4. Demandez à l’utilisateur de se connecter ou de changer son mot de passe pour réessayer la migration.

### Métadonnées manquantes.

Si un utilisateur est interrompu pendant le processus de connexion ou de changement de mot de passe qui initie la migration, Auth0 peut ne pas être en mesure de transférer ses métadonnées (`user_metadata` ou `app_metadata`) avec ses autres données de profil.

Vous pouvez atténuer ce scénario en créant une [Action](/docs/fr-ca/customize/actions) qui vérifie si le profil de l’utilisateur manque de métadonnées, les récupère depuis le magasin d’utilisateurs externe, puis les stocke dans Auth0.

## En savoir plus

* [Importation d’utilisateurs par lot](/docs/fr-ca/manage-users/user-migration/bulk-user-imports)
* [L’extension User Import/Export (Importation/Exportation des utilisateurs).](/docs/fr-ca/manage-users/user-migration/user-import-export-extension)