---
title: "Créer des connexions de base de données personnalisée"
permalink: "create-db-connection"
'description': "Apprenez à créer une connexion de base de données."
'og:title': "Créer des connexions de base de données personnalisée"
'og:description': "Apprenez à créer une connexion de base de données."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Créer des connexions de base de données personnalisée"
'twitter:description': "Apprenez à créer une connexion de base de données."
---

<Card title="La disponibilité varie selon le plan Auth0">

Votre plan Auth0 ou votre accord personnalisé ont un impact sur la disponibilité de cette fonctionnalité. Pour en savoir plus, lisez [Tarification](https://auth0.com/pricing).

</Card>

Si vous disposez de votre propre base de données d’utilisateurs, vous pouvez l’utiliser comme fournisseur d’identité dans Auth0 pour authentifier des utilisateurs. Dans ce processus, vous allez créer la connexion de base de données personnalisée, créer des scripts d’action de base de données et ajouter des paramètres de configuration.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Assurez-vous que votre base de données possède les champs appropriés pour stocker les attributs des profils utilisateurs, tels que `id`, `nickname`, `email`, and `password`. Pour en savoir plus sur le schéma de profil utilisateur d’Auth0, consultez [Profils utilisateurs normalisés](/docs/fr-ca/manage-users/user-accounts/user-profiles/normalized-user-profiles). Pour en savoir plus sur la mise à jour des profils utilisateurs, consultez [Mise à jour des profils utilisateurs à l’aide de votre base de données](/docs/fr-ca/manage-users/user-accounts/user-profiles/update-user-profiles-using-your-database).

</Callout>

Auth0 vous permet de créer des connexions et des scripts pour la plupart des bases de données couramment utilisées, notamment :

* Fournisseur d’adhésion ASP.NET
* MongoDB
* MySQL
* PostgreSQL
* SQLServer
* Base de données SQL de Windows Azure
* Services Web accessibles via Auth de base

Vous pouvez vous connecter à n’importe quel type de base de données ou de service Web avec un script personnalisé correctement configuré. Notez que la désinfection des entrées relève de la responsabilité du client; Auth0 ne désinfecte ni ne valide aucune combinaison de nom d’utilisateur/mot de passe transmise par une base de données personnalisée. Les scripts de base de données personnalisée sont soumis à [Politique de limites anti-attaques](/docs/fr-ca/troubleshoot/customer-support/operational-policies/rate-limit-policy) d’Auth0.

<Card title="Pare-feu réseau">

Si vous êtes derrière un pare-feu, cette fonctionnalité pourrait exiger que vous ajoutiez les adresses IP Auth0 appropriées à votre Liste blanche pour que cela fonctionne correctement.

</Card>

## Créer la connexion dans Auth0 Dashboard

1. Allez à [Auth0 Dashboard > Authentication > Database (Tableau de bord Auth0 > Authentification > Base de données)](https://manage.auth0.com/#/connections/database) et sélectionnez **Create DB Connection (Créer une connexion DB)**.
2. Configurez les paramètres de la connexion et cliquez sur **Create (Créer)**:

<table class="table"><thead>
<tr>
<th><strong>Paramètre</strong></th>
<th><strong>Définition</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Nom</strong></td>
<td>Le nom de la connexion. Le nom doit commencer et se terminer par un caractère alphanumérique, contenir uniquement des caractères alphanumériques et des tirets et ne pas dépasser 35 caractères.</td>
</tr>
<tr>
<td><strong>Nom d’utilisateur obligatoire</strong></td>
<td>Oblige les utilisateurs à fournir un nom d’utilisateur <em>et</em> une adresse courriel lors de l’inscription.</td>
</tr>
<tr>
<td><strong>Longueur du nom d’utilisateur</strong></td>
<td>Définit une longueur minimale et maximale pour les noms d’utilisateur.</td>
</tr>
<tr>
<td><strong>Désactiver les inscriptions</strong></td>
<td>Empêche les inscriptions pour votre application. Vous pourrez toujours créer des utilisateurs avec vos identifiants API ou via le Auth0 Dashboard.</td>
</tr>
</tbody>
</table>

   Une fois que Auth0 a créé votre connexion, vous disposerez des affichages suivants (en plus de l’affichage des **settings [paramètres]**) :
   * Attributs
   * Méthodes d’authentification
   * Base de données personnalisée
   * Applications
3. Sélectionnez l’aperçu **Custom Database (Base de données personnalisée)**, puis faites glisser le bouton **Use my own database (Utiliser ma propre base de données)**.

   <Frame>![Activer l’option Base de données personnalisée Utiliser ma propre base de données](/images/fr-ca/cdy7uua7fh8z/3kgHDpBFdVWNq9XOfhsTXI/a27aa55ef8e71938040d3046f8416540/2025-02-25_10-19-18.png)</Frame>

## Créer les scripts d’action de la base de données.

L’activation du bouton bascule **Use my own database (Utiliser ma propre base de données)** active les **scripts d’action de la base de données** dans laquelle vous allez créer des scripts afin de configurer le mode d’authentification lors de l’utilisation de votre base de données. Vous pouvez écrire vos scripts d’action de base de données, ou vous pouvez sélectionner un modèle dans la liste déroulante des **Templates (Modèles)** et le modifier, si nécessaire.

Vous  **must (devez)** configurer un script de `login`. Les scripts additionnels pour les fonctionnalités utilisateur sont facultatifs.

Les scripts d’action de base de données incluent :

<table class="table"><thead>
<tr>
<th><strong>Nom</strong></th>
<th><strong>Description</strong></th>
<th><strong>Paramètres</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Connexion</strong> <br/><span class="label label-danger">Requis</span></td>
<td>S’exécute chaque fois qu’un utilisateur tente de se connecter.</td>
<td>`email`, `password`</td>
</tr>
<tr>
<td><strong>Créer</strong></td>
<td>S’exécute lorsqu’un utilisateur s’inscrit.</td>
<td>`user`</td>
</tr>
<tr>
<td><strong>Vérifier</strong></td>
<td>S’exécute lorsqu’un utilisateur a suivi le lien de vérification.</td>
<td>`email`</td>
</tr>
<tr>
<td><strong>Changer le mot de passe</strong></td>
<td>S’exécute lorsqu’un utilisateur clique sur le lien de confirmation après une demande de réinitialisation du mot de passe.</td>
<td>`email`, `newPassword`</td>
</tr>
<tr>
<td><strong>Obtenir l’utilisateur</strong></td>
<td>Récupère un profil utilisateur de votre base de données sans authentifier l’utilisateur.</td>
<td>`email`</td>
</tr>
<tr>
<td><strong>Supprimer</strong></td>
<td>S’exécute lorsqu’un utilisateur est supprimé à l’aide de l’API ou de Auth0 Dashboard.</td>
<td>`id`</td>
</tr>
</tbody>
</table>

Pour en savoir plus sur les scripts, consultez [Modèles de script d’action de base de données personnalisée](/docs/fr-ca/authenticate/database-connections/custom-db/templates) et [Meilleures pratiques d’exécution de script d’action de base de données personnalisée](/docs/fr-ca/authenticate/database-connections/custom-db/custom-database-connections-scripts/execution).

### Créer un script de connexion

<Card title="Éviter les collisions d’ID utilisateur avec de multiples bases de données">

La propriété `id` (ou `user_id`) dans le profil utilisateur retourné sera utilisée par Auth0 pour identifier l’utilisateur.

Si vous utilisez plusieurs connexions de base de données personnalisées, la valeur `id` doit être unique dans toutes les connexions de bases de données personnalisées pour éviter les collisions d’ID utilisateurs. Notre recommandation est d’ajouter le nom de la connexion (sans espace) en préfixe à la valeur de `id`. Pour en savoir plus à propos des ID utilisateurs, lisez [Identifier les utilisateurs](/docs/fr-ca/manage-users/user-accounts/identify-users).

</Card>

Les étapes suivantes utilisent un exemple de script pour se connecter à la base de données MySQL.

1. Après avoir fait glisser le bouton bascule **Use my own database (Utiliser ma propre base de données)**, la zone **Database Action Scripts (Scripts d’action de base de données)** s’active. Assurez-vous que vous êtes sur l’onglet **Login (Connexion)**.
2. Utilisez le menu déroulant de **Modèles** pour sélectionner le modèle de script de base de données MySQL.

   ```javascript lines
   function login(email, password, callback) {
     var bcrypt = require('bcrypt');
     var mysql = require('mysql');
     var connection = mysql.createConnection({
       host: 'localhost',
       user: 'me',
       password: 'secret',
       database: 'mydb'
     });
     connection.connect();
     var query = "SELECT id, nickname, email, password " +
       "FROM users WHERE email = ?";
     connection.query(query, [email], function (err, results) {
       if (err) return callback(err);
       if (results.length === 0) return callback(new WrongUsernameOrPasswordError(email));
       var user = results[0];
       bcrypt.compare(password, user.password, function (err, isValid) {
         if (err) {
           callback(err);
         } else if (!isValid) {
           callback(new WrongUsernameOrPasswordError(email));
         } else {
           callback(null, {
             // This prefix (replace with your own custom DB name)
             // ensure uniqueness across different custom DBs if there's the
             // possibility of collisions (e.g. if the user ID is an email address or an integer)
             id: 'MyConnection1|' + user.id.toString(),
             nickname: user.nickname,
             email: user.email
           });
         }
       });
     });
   }
   ```

   

   

   Le script ci-dessus se connecte à une base de donnéesºMySQL et exécute une requête pour récupérer le premier utilisateur avec `email == user.email`.
   Avec la méthode `bcrypt.compareSync`, il vérifie ensuite si les mots de passe correspondent, puis, si c’est le cas, il renvoie un objet contenant les informations du profil utilisateur, y compris l’`id`, le `nickname` et l’`email`.
   Ce script suppose que vous avez une tableau `users` contenant ces colonnes. L’`id` retourné par le script de connexion est utilisé pour construire l’attribut identifiant utilisateur du profil utilisateur.
3. Cliquez sur **Save and Try (Enregistrer et essayer)**.
4. Dans la fenêtre modale, saisissez votre adresse courriel et votre mot de passe, puis cliquez sur **Try (Essayer)**. Cette fonctionnalité propose un menu déroulant pour choisir parmi une liste de temps d’exécution possibles, avec votre temps d’exécution actuel en tête de liste.

   <Frame>![Modal to try the login script.](/images/fr-ca/cdy7uua7fh8z/8uBGZhHYZwOcO19ljJNNp/38bf4fa49cfe3b98c21a78ade1871245/Try_the_Login_Script_-_French.png)</Frame>

Les modèles de script ne sont pas utilisés par Auth0 tant que vous n’avez pas cliqué sur **Save (Enregistrer)** ou **Try (Essayer)**. Ceci est vrai même si vous n’avez modifié qu’un seul script, sans toucher aux autres. Vous devez cliquer sur **Save (Enregistrer)** au moins une fois pour que tous les scripts soient en place.

## Soutien aux organizations en matière de bases de données personnalisées

Si vous utilisez des connexions par base de données personnalisée en conjonction avec Organizations, vous pouvez utiliser le paramètre `context` dans la signature du script pour rendre les détails de l’organization tels que l’`id`, `name` et `metadata` disponibles pour vos scripts d’action de base de données personnalisée. Les données de l’organization sont envoyées dans l’objet contexte lorsque l’action correspondante se produit dans le contexte de l’organization. Par exemple, lorsqu’un utilisateur s’authentifie à l’invite de connexion d’une organization, le script d’action de connexion est transmis. Pour en savoir plus, consultez [Connexions à la base de données](/docs/fr-ca/authenticate/database-connections).

### Activer l’objet contexte

1. Rendez-vous à [Auth0 Dashboard > Authentification > Base de données](https://manage.auth0.com/dashboard/us/#/connections/database/).
2. Sélectionnez votre connexion de base de données.
3. Sous l’onglet **Custom Database (Base de données personnalisée)**, recherchez les **Context objects in database scripts (Objet de contexte dans les scripts de base de données)** et sélectionnez **Enable (Activer)**.

   <Warning>

   Cette fonctionnalité ne peut pas être désactivée une fois qu’elle a été activée.

   </Warning>

### Utiliser le contexte d’Organization

Une fois que vous avez activé l’objet de contexte sur le Dashboard, vous pouvez ajouter un objet `context` à vos scripts d’action de base de données personnalisée, qui seront insérés juste avant le paramètre de rappel. Lorsque des événements sont déclenchés avec le contexte d’Organization, les données correspondantes sont fournies à vos scripts d’action de base de données personnalisée dans le format suivant :

<Tabs>
<Tab title="Connexion">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```

</Tab>
<Tab title="Créer">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```

</Tab>
<Tab title="Vérifier">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```

</Tab>
<Tab title="Modifier le mot de passe">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```

</Tab>
<Tab title="Obtenir l’utilisateur">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```

</Tab>
<Tab title="Supprimer">
&nbsp;
</Tab>
</Tabs>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Un contexte vide sera toujours transmis au script de `delete`.

</Callout>

## Ajouter des paramètres de configuration

Vous pouvez stocker des paramètres, tels que les identifiants client requis pour se connecter à votre base de données, dans la section **Settings (Paramètres)** sous l’éditeur de script. Ces paramètres seront accessibles pour tous vos scripts et vous pourrez y accéder en utilisant l’objet `configuration` dans les scripts d’action de votre base de données (p. ex., `configuration.MYSQL_PASSWORD`).

Utilisez les paramètres ajoutés dans vos scripts pour configurer la connexion. Vous pouvez par exemple ajouter ce qui suit au script de connexion MySQL :

```javascript lines
function login (username, password, callback) {
  var mysql = require('mysql');
  var connection = mysql.createConnection({
    host     : configuration.MYSQL_HOST,
    user     : 'me',
    password : configuration.MYSQL_PASSWORD,
    database : 'mydb'
  });
}
```

## En savoir plus

* [Meilleures pratiques en matière de connexions personnalisées aux bases de données et aux scripts d’action](/docs/fr-ca/authenticate/database-connections/custom-db/custom-database-connections-scripts)
* [Dépanner les bases de données sur mesure](/docs/fr-ca/authenticate/database-connections/custom-db/error-handling)
* [Importer et exporter des utilisateurs](/docs/fr-ca/manage-users/user-migration)