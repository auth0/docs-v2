---
title: "Configurer Cloudflare en tant que proxy inverse"
permalink: "configure-cloudflare-for-use-as-reverse-proxy"
'description': "Apprenez à configurer Cloudflare pour l’utiliser comme proxy de domaine personnalisé pour Auth0."
'og:title': "Configurer Cloudflare en tant que proxy inverse"
'og:description': "Apprenez à configurer Cloudflare pour l’utiliser comme proxy de domaine personnalisé pour Auth0."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Configurer Cloudflare en tant que proxy inverse"
'twitter:description': "Apprenez à configurer Cloudflare pour l’utiliser comme proxy de domaine personnalisé pour Auth0."
---

<Card title="La disponibilité varie selon le plan Auth0">

La disponibilité de cette fonctionnalité dépend de votre plan Auth0 ou de votre accord personnalisé. Pour en savoir plus, lisez [Page de tarification d’Auth0](https://auth0.com/pricing).

</Card>

Pour configurer Cloudflare en tant que proxy inverse en utilisant l’approche conseillée, un plan Cloudflare Entreprise Plan avec les fonctionnalités suivantes est requis :

<table class="table"><thead>
<tr>
<th><strong>Caractéristique</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Réécrire les en-têtes d’hôte à l’aide de règles différentes de Cloudflare. Pour en savoir plus, consultez <a href="https://support.cloudflare.com/hc/en-us/articles/206652947-Using-Page-Rules-to-Re-Write-Host-Headers">Réécrire les en-têtes d’hôte sur Cloudflare</a>.</td>
<td></td>
</tr>
<tr>
<td>En-tête True-Client-IP</td>
<td>Activer l’en-tête True-Client-IP ajoute l’en-tête True-Client-IP à toutes les requêtes vers votre serveur d’origine, qui inclut l’adresse IP de l’utilisateur final. Pour en savoir plus, consultez <a href="https://support.cloudflare.com/hc/en-us/articles/206776727-What-is-True-Client-IP-">Comprendre l’en-tête True-Client-IP sur Cloudflare</a>.</td>
</tr>
</tbody>
</table>

## Configurer Cloudflare

<Warning>

En tant qu’information requise, le domaine principal de votre domaine personnalisé choisi doit être [ajouté et activé dans le tableau de bord Cloudflare](https://developers.cloudflare.com/learning-paths/get-started/add-domain-to-cf/minimize-downtime/#activate-your-domain). En outre, confirmez que le domaine personnalisé souhaité n’existe pas encore dans votre zone Cloudflare. Si le domaine existe déjà, la vérification de Cloudflare échouera.

</Warning>

Pour configurer Cloudflare en tant que proxy inverse, vous devrez créer un enregistrement CNAME, une règle Page et une règle Transform dans Cloudflare.

1. [Configurez et vérifiez un domaine personnalisé.avec des certificats autogérés](https://auth0.com/docs/customize/custom-domains/self-managed-certificates) si ce n’est déjà fait. Prenez note des valeurs **Nom du domaine d’origine** et **cname-api-key** car vous en aurez besoin plus tard.
2. Dans le tableau de bord de Cloudflare de la zone cible, [créez un enregistrement CNAME](https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/#create-dns-records) avec les paramètres suivants :

   <table class="table"><thead>
   <tr>
   <th><strong>Paramètre</strong></th>
   <th><strong>Valeur</strong></th>
   </tr>
   </thead>
   <tbody>
   <tr>
   <td>Nom</td>
   <td>Le nom de domaine personnalisé.</td>
   </tr>
   <tr>
   <td>Cible</td>
   <td>La valeur <strong>Origin Domain Name</strong> enregistrée plus tôt.</td>
   </tr>
   <tr>
   <td>État de proxy</td>
   <td>`Proxied`</td>
   </tr>
   </tbody>
   </table>
3. [Créez une règle de page](https://support.cloudflare.com/hc/en-us/articles/200172336-Creating-Page-Rules) pour toutes les URL sous le domaine personnalisé choisi, avec les paramètres suivants :

   <table class="table"><thead>
   <tr>
   <th><strong>Paramètre</strong></th>
   <th><strong>Valeur</strong></th>
   </tr>
   </thead>
   <tbody>
   <tr>
   <td>Remplacement d’en-tête de l’hôte</td>
   <td>La valeur <strong>Origin Domain Name</strong> enregistrée plus tôt.</td>
   </tr>
   <tr>
   <td>True-Client-IP</td>
   <td>`Enable`</td>
   </tr>
   </tbody>
   </table>
4. [Créer une règle Transform](https://developers.cloudflare.com/rules/transform/request-header-modification/create-dashboard/) :

   1. Passez à la vue **Modifier l’en-tête de demande**.
   2. Sélectionnez **Créer la règle** et choisissez un nom pour celle-ci.
   3. Sous **Lorsque les demandes entrantes correspondent**, sélectionnez **Expression de filtre personnalisée** et choisissez une expression qui autorise la règle à accepter les demandes associées au domaine personnalisé choisi. Par exemple, utilisez une correspondance exacte dans le champ **Nom d’hôte**.
   4. Sous Modifier l’en-tête de demande, sélectionnez **Définir comme statique**, puis définissez les champs suivants :

      <table class="table"><thead>
      <tr>
      <th><strong>Champ</strong></th>
      <th><strong>Valeur</strong></th>
      </tr>
      </thead>
      <tbody>
      <tr>
      <td>Nom de l’en-tête</td>
      <td>`cname-api-key`</td>
      </tr>
      <tr>
      <td>Valeur</td>
      <td>La valeur <strong>cname-api-key</strong> enregistrée plus tôt.</td>
      </tr>
      </tbody>
      </table>
5. Vérifiez que [Toujours utiliser HTTPS](https://developers.cloudflare.com/ssl/edge-certificates/additional-options/always-use-https/) est activé et que le [mode de chiffrement](https://developers.cloudflare.com/ssl/origin-configuration/ssl-modes/) est défini, au moins sur **Complet** pour le domaine personnalisé de votre choix.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Bien qu’il soit possible d’utiliser Cloudflare Workers au lieu des règles Page and Transform pour configurer un proxy inverse répondant aux exigences d’un domaine personnalisé avec certificat autogéré, nous recommandons d’utiliser l’approche basée sur les règles car elle élimine le besoin d’un code personnalisé.

</Callout>

## Configurer Auth0

Appelez le point de terminaison [Mettre à jour la configuration du domaine personnalisé](https://auth0.com/docs/api/management/v2#!/Custom_Domains/patch_custom_domains_by_id) d’Auth0 <Tooltip href="/docs/fr-ca/glossary?term=management-api" tip="Management API
Un produit permettant aux clients d’effectuer des tâches administratives." cta="Voir le glossaire">Management API</Tooltip> avec la charge utile suivante dans le corps de la requête :

```javascript lines
{
  "custom_client_ip_header": "true-client-ip"
}
```

## En savoir plus

* [Configurer des fonctionnalités pour utiliser des Domaines personnalisés](/docs/fr-ca/customize/custom-domains/configure-features-to-use-custom-domains)
* [Dépanner les domaines personnalisés](/docs/fr-ca/troubleshoot/integration-extensibility-issues/troubleshoot-custom-domains)
* [Versions et suites cryptographiques TLS (SSL)](/docs/fr-ca/customize/custom-domains/self-managed-certificates/tls-ssl)