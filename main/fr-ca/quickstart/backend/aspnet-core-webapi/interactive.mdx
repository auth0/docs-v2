---
title: "Ajouter une autorisation à votre application API ASP.NET Core Web"
permalink: "interactive"
'description': "Ce tutoriel explique comment ajouter une autorisation à une application API ASP.NET Core Web en utilisant le logiciel médiateur JWT standard."
'og:title': "Ajouter une autorisation à votre application API ASP.NET Core Web"
'og:description': "Ce tutoriel explique comment ajouter une autorisation à une application API ASP.NET Core Web en utilisant le logiciel médiateur JWT standard."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/asp.png"
'twitter:title': "Ajouter une autorisation à votre application API ASP.NET Core Web"
'twitter:description': "Ce tutoriel explique comment ajouter une autorisation à une application API ASP.NET Core Web en utilisant le logiciel médiateur JWT standard."
sidebarTitle: ASP.NET Core Web API
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Appsettings from "/snippets/quickstart/backend/aspnet-core-webapi/appsettings.json.mdx";
import Program from "/snippets/quickstart/backend/aspnet-core-webapi/Program.cs.mdx";
import Hasscopehandler from "/snippets/quickstart/backend/aspnet-core-webapi/HasScopeHandler.cs.mdx";
import Hasscoperequirement from "/snippets/quickstart/backend/aspnet-core-webapi/HasScopeRequirement.cs.mdx";
import Apicontroller from "/snippets/quickstart/backend/aspnet-core-webapi/ApiController.cs.mdx";

export const sections = [
  { id: "définir-les-autorisations", title: "Définir les autorisations" },
  { id: "installer-les-dépendances", title: "Installer les dépendances" },
  { id: "configurer-le-logiciel-médiateur", title: "Configurer le logiciel médiateur" },
  { id: "valider-les-permissions", title: "Valider les permissions" },
  { id: "protéger-les-points-de-terminaison-des-api", title: "Protéger les points de terminaison des API" },
  { id: "appeler-votre-api", title: "Appeler votre API" }
]

<Recipe>
  <Content>
    Auth0 vous permet d’ajouter rapidement l’authentification et d’accéder aux informations relatives au profil de l’utilisateur dans presque tous les types d’applications. Ce guide explique comment intégrer Auth0 à n’importe quelle application API ASP.NET Web, nouvelle ou existante, à l’aide du package `Microsoft.AspNetCore.Authentication.JwtBearer` .

    Si vous n’avez pas encore créé d’API dans votre Auth0 Dashboard, vous pouvez utiliser le sélecteur interactif pour créer une nouvelle API Auth0 ou sélectionner une API existante qui représente le projet avec lequel vous souhaitez effectuer l’intégration.

    Vous pouvez également consulter notre guide de démarrage, qui vous aidera à configurer votre première API via Auth0 Dashboard.

    Notez que chaque API dans Auth0 est configurée à l’aide d’un identifiant d’API; votre code d’application utilisera l’identifiant d’API comme Public pour valider le jeton d’accès.

    <Info>
    **Vous ne connaissez pas Auth0 ?** Découvrez Auth0 et l’implémentation de l’authentification et de l’autorisation d’API en utilisant le cadre d’applications OAuth 2.0.
    </Info>

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Les autorisations vous permettent de définir comment les ressources peuvent être accessibles au nom de l’utilisateur avec un jeton d’accès donné. Par exemple, vous pouvez choisir d’accorder un accès en lecture à la ressource `messages` si les utilisateurs ont le niveau d’accès gestionnaire et accorder un accès en écriture à cette ressource s’ils ont le niveau d’accès administrateur.

      Vous pouvez définir les autorisations autorisées dans la vue **Permissions (Autorisations)** de la section [API](https://manage.auth0.com/#/apis) d’Auth0 Dashboard. L’exemple suivant utilise la permission `read:messages`.

      ![Auth0 Dashboard> Applications > APIs (API) > [Specific API (API précise)] > Onglet Permissions (Autorisations)](/images/fr-ca/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/677a3405b2853f5fdf9e42f6e83ceba7/Quickstarts_API_-_French.png)
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      Pour permettre à votre application de valider les jetons d’accès, ajoutez une référence au package NuGet `Microsoft.AspNetCore.Authentication.JwtBearer` :

      ```
      Install-Package Microsoft.AspNetCore.Authentication.JwtBearer
      ```
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Configurez le logiciel médiateur d’authentification dans le fichier `Program.cs` de votre application :

      1. Enregistrez les services d’authentification en appelant la méthode `AddAuthentication`. Configurez `JwtBearerDefaults.AuthenticationScheme` comme schéma par défaut.
      2. Enregistrez le schéma d’authentification du porteur JWT en faisant un appel à la méthode `AddJwtBearer`. Configurez votre domaine Auth0 comme autorité et votre identifiant API Auth0 comme public, et assurez-vous que votre domaine Auth0 et votre identifiant API sont définis dans le fichier **appsettings.json** de votre application.

         OPEN|INFO
         Dans certains cas, le jeton d’accès n’aura pas de `sub` demande; dans ce cas, le nom `User.Identity.Name` sera `null`. Si vous souhaitez mapper une demande différente à `User.Identity.Name`, ajoutez-la aux `options.TokenValidationParameters` dans l’appel `AddJwtBearer()`.
         CLOSE|INFO

         .
      3. Ajoutez l’authentification et l’autorisation de le logiciel médiateur au pipeline du logiciel médiateur en ajoutant des appels aux méthodes `UseAuthentication`  et `UseAuthorization`  sous la méthode `var app = builder.Build();` .
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Pour s’assurer qu’un jeton d’accès contient les permissions adéquates, utilisez [Policy-Based Authorization (Autorisation basée sur une politique)](https://docs.microsoft.com/en-us/aspnet/core/security/authorization/policies) dans ASP.NET Core :

      1. Créez une nouvelle exigence d’autorisation appelée `HasScopeRequirement`, qui vérifiera si la demande de `scope` émise par votre locataire Auth0 est présente et, le cas échéant, vérifiera que la demande contient la permission demandée.
      2. Dans la méthode `var builder = WebApplication.CreateBuilder(args);`  du fichier `Program.cs`, ajoutez un appel à la méthode `app.AddAuthorization`.
      3. Ajoutez des politiques pour les permissions en appelant `AddPolicy`  pour chaque permission.
      4. Enregistrez un singleton pour la classe `HasScopeHandler`.
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Le logiciel médiateur JWT s’intègre aux mécanismes d’[authentification](https://docs.microsoft.com/en-us/aspnet/core/security/authentication/) et d’[autorisation](https://docs.microsoft.com/en-us/aspnet/core/security/authorization/) standard de ASP.NET Core.

      Pour sécuriser un point de terminaison, ajoutez l’attribut `[Authorize]` à votre action de contrôleur (ou à tout le contrôleur si vous souhaitez protéger toutes ses actions).

      Lors de la sécurisation des points de terminaison qui nécessitent des permissions particulières, assurez-vous que la bonne permission est présente dans `access_token`. Pour ce faire, ajoutez l’attribut `Authorize` à l’action `Scoped` et passez `read:messages` comme paramètre de la `policy`.
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      La façon dont vous appelez votre API dépend du type d’application que vous développez et du cadre que vous utilisez. Pour en savoir plus, lire le Guide rapide de l’application concernée :

      - [Applications à page unique](/docs/quickstart/spa)
      - [Application mobile/native](/docs/quickstart/native)

      ### Obtenir un jeton d’accès

      Quel que soit le type d’application que vous développez ou le cadre que vous utilisez, vous aurez besoin d’un jeton d’accès pour appeler votre API.

      Si vous appelez votre API à partir d’une application à page unique (SPA) ou native, vous recevrez un jeton d’accès une fois l’autorisation obtenue.

      Si vous appelez l’API à partir d’un outil de ligne de commande ou d’un autre service sans identifiants utilisateur, utilisez le [Flux des identifiants client d’OAuth](https://auth0.com/docs/api/authentication#client-credentials). Pour ce faire, enregistrez une [Application de communication entre machines](https://manage.auth0.com/#/applications) et incluez les valeurs suivantes à votre requête :

      - **ID client** comme paramètre `client_id`.
      - **Secret client** comme paramètre `client_secret`.
      - **Identifiant API** (la même valeur utilisée pour configurer l’intergiciel plus tôt dans ce guide rapide) comme paramètre `audience`.

      <Info>
      Pour en savoir plus sur l’obtention de l’identificateur client et du secret client pour votre application de communication entre machines, lisez la section Paramètres de l’application.
      </Info>

      **Exemple de demande**

      - [cURL](#875b90eb2e6d4269b79931b5f099132b_shell)
      - [C#](#875b90eb2e6d4269b79931b5f099132b_csharp)
      - [Go](#875b90eb2e6d4269b79931b5f099132b_go)
      - [Java](#875b90eb2e6d4269b79931b5f099132b_java)
      - [Node.JS](#875b90eb2e6d4269b79931b5f099132b_node)
      - [Obj-C](#875b90eb2e6d4269b79931b5f099132b_objc)
      - [...](#)
        - [PHP](#875b90eb2e6d4269b79931b5f099132b_php)
        - [Python](#875b90eb2e6d4269b79931b5f099132b_python)
        - [Ruby](#875b90eb2e6d4269b79931b5f099132b_ruby)
        - [Swift](#875b90eb2e6d4269b79931b5f099132b_swift)

      ```
      curl --request post \
      --url 'https://{yourDomain}/oauth/token' \
      --header 'content-type: application/x-www-form-urlencoded'
      ```

      ```js
      var client = new RestClient("https://{yourDomain}/oauth/token");
      var request = new RestRequest(Method.POST);
      request.AddHeader("content-type", "application/x-www-form-urlencoded");
      IRestResponse response = client.Execute(request);
      ```

      ```
      package main
      import (
      "fmt"
      "net/http"
      "io/ioutil"
      )
      func main() {
      url := "https://{yourDomain}/oauth/token"
      req, _ := http.NewRequest("post", url, nil)
      req.Header.Add("content-type", "application/x-www-form-urlencoded")
      res, _ := http.DefaultClient.Do(req)
      defer res.Body.Close()
      body, _ := ioutil.ReadAll(res.Body)
      fmt.Println(res)
      fmt.Println(string(body))
      }
      ```

      ```
      HttpResponse<String> response = Unirest.post("https://{yourDomain}/oauth/token")
      .header("content-type", "application/x-www-form-urlencoded")
      .asString();
      ```

      ```js
      var axios = require("axios").default;
      var options = {
      method: 'post',
      url: 'https://{yourDomain}/oauth/token',
      headers: {'content-type': 'application/x-www-form-urlencoded'}
      };
      axios.request(options).then(function (response) {
      console.log(response.data);
      }).catch(function (error) {
      console.error(error);
      });
      ```

      ```
      #import <Foundation/Foundation.h>
      NSDictionary *headers = @{ @"content-type": @"application/x-www-form-urlencoded" };
      NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"https://{yourDomain}/oauth/token"]
                                                         cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                     timeoutInterval:10.0];

      [request setHTTPMethod:@"post"];
      [request setAllHTTPHeaderFields:headers];
      NSURLSession *session = [NSURLSession sharedSession];
      NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                              completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                  if (error) {

                                                      NSLog(@"%@", error);

                                                  } else {

                                                      NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                      NSLog(@"%@", httpResponse);

                                                  }

                                              }];

      [dataTask resume];
      ```

      ```bash
      $curl = curl_init();
      curl_setopt_array($curl, [
      CURLOPT_URL => "https://{yourDomain}/oauth/token",
      CURLOPT_RETURNTRANSFER => true,
      CURLOPT_ENCODING => "",
      CURLOPT_MAXREDIRS => 10,
      CURLOPT_TIMEOUT => 30,
      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
      CURLOPT_CUSTOMREQUEST => "post",
      CURLOPT_HTTPHEADER => [
      "content-type: application/x-www-form-urlencoded"

      ],
      ]);
      $response = curl_exec($curl);
      $err = curl_error($curl);
      curl_close($curl);
      if ($err) {
      echo "cURL Error #:" . $err;
      } else {
      echo $response;
      }
      ```

      ```js
      import http.client
      conn = http.client.HTTPSConnection("")
      headers = { 'content-type': "application/x-www-form-urlencoded" }
      conn.request("post", "/{yourDomain}/oauth/token", headers=headers)
      res = conn.getresponse()
      data = res.read()
      print(data.decode("utf-8"))
      ```

      ```js
      require 'uri'
      require 'net/http'
      require 'openssl'
      url = URI("https://{yourDomain}/oauth/token")
      http = Net::HTTP.new(url.host, url.port)
      http.use_ssl = true
      http.verify_mode = OpenSSL::SSL::VERIFY_NONE
      request = Net::HTTP::Post.new(url)
      request["content-type"] = 'application/x-www-form-urlencoded'
      response = http.request(request)
      puts response.read_body
      ```

      ```js
      import Foundation
      let headers = ["content-type": "application/x-www-form-urlencoded"]
      let request = NSMutableURLRequest(url: NSURL(string: "https://{yourDomain}/oauth/token")! as URL,
                                          cachePolicy: .useProtocolCachePolicy,

                                      timeoutInterval: 10.0)

      request.httpMethod = "post"
      request.allHTTPHeaderFields = headers
      let session = URLSession.shared
      let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in
      if (error != nil) {
      print(error)

      } else {
      let httpResponse = response as? HTTPURLResponse

      print(httpResponse)

      }
      })
      dataTask.resume()
      ```

      ### Appeler un point de terminaison sécurisé

      Maintenant que vous avez un jeton d’accès, vous pouvez l’utiliser pour appeler des points de terminaison API sécurisés. Lorsque vous appelez un point de terminaison sécurisé, vous devez inclure le jeton d’accès en tant que jeton de porteur dans l’en-tête **Authorization** de la requête. Par exemple, vous pouvez faire une requête au point de terminaison `/api/private` :

<CodeGroup>
      ```sh cURL lines
      curl --request get \
      --url http://localhost:3010/api/private \
      --header 'authorization: Bearer YOUR_ACCESS_TOKEN'
      ```

      ```cs C# lines
      var client = new RestClient("http://localhost:3010/api/private");
      var request = new RestRequest(Method.GET);
      request.AddHeader("authorization", "Bearer YOUR_ACCESS_TOKEN");
      IRestResponse response = client.Execute(request);
      ```

      ```go Go lines
      package main
      import (
      "fmt"
      "net/http"
      "io/ioutil"
      )
      func main() {
      url := "http://localhost:3010/api/private"
      req, _ := http.NewRequest("get", url, nil)
      req.Header.Add("authorization", "Bearer YOUR_ACCESS_TOKEN")
      res, _ := http.DefaultClient.Do(req)
      defer res.Body.Close()
      body, _ := ioutil.ReadAll(res.Body)
      fmt.Println(res)
      fmt.Println(string(body))
      }
      ```

      ```java Java lines
      HttpResponse<String> response = Unirest.get("http://localhost:3010/api/private")
      .header("authorization", "Bearer YOUR_ACCESS_TOKEN")
      .asString();
      ```

      ```js Node.JS lines
      var axios = require("axios").default;
      var options = {
      method: 'get',
      url: 'http://localhost:3010/api/private',
      headers: {authorization: 'Bearer YOUR_ACCESS_TOKEN'}
      };
      axios.request(options).then(function (response) {
      console.log(response.data);
      }).catch(function (error) {
      console.error(error);
      });
      ```

      ```obj-c Obj-C lines
      #import <Foundation/Foundation.h>
      NSDictionary *headers = @{ @"authorization": @"Bearer YOUR_ACCESS_TOKEN" };
      NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://localhost:3010/api/private"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

      [request setHTTPMethod:@"get"];
      [request setAllHTTPHeaderFields:headers];
      NSURLSession *session = [NSURLSession sharedSession];
      NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                              completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                  if (error) {

                                                      NSLog(@&quot;%@&quot;, error);

                                                  } else {

                                                      NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                      NSLog(@&quot;%@&quot;, httpResponse);

                                                  }

                                              }];

      [dataTask resume];
      ```

      ```php PHP lines
      $curl = curl_init();
      curl_setopt_array($curl, [
      CURLOPT_PORT => "3010",
      CURLOPT_URL => "http://localhost:3010/api/private",
      CURLOPT_RETURNTRANSFER => true,
      CURLOPT_ENCODING => "",
      CURLOPT_MAXREDIRS => 10,
      CURLOPT_TIMEOUT => 30,
      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
      CURLOPT_CUSTOMREQUEST => "get",
      CURLOPT_HTTPHEADER => [
      &quot;authorization: Bearer YOUR_ACCESS_TOKEN&quot;

      ],
      ]);
      $response = curl_exec($curl);
      $err = curl_error($curl);
      curl_close($curl);
      if ($err) {
      echo "cURL Error #:" . $err;
      } else {
      echo $response;
      }
      ```

      ```python Python lines
      import http.client
      conn = http.client.HTTPConnection("localhost:3010")
      headers = { 'authorization': "Bearer YOUR_ACCESS_TOKEN" }
      conn.request("get", "/api/private", headers=headers)
      res = conn.getresponse()
      data = res.read()
      print(data.decode("utf-8"))
      ```

      ```rb Ruby lines
      require 'uri'
      require 'net/http'
      url = URI("http://localhost:3010/api/private")
      http = Net::HTTP.new(url.host, url.port)
      request = Net::HTTP::Get.new(url)
      request["authorization"] = 'Bearer YOUR_ACCESS_TOKEN'
      response = http.request(request)
      puts response.read_body
      ```

      ```swift Swift lines
      import Foundation
      let headers = ["authorization": "Bearer YOUR_ACCESS_TOKEN"]
      let request = NSMutableURLRequest(url: NSURL(string: "http://localhost:3010/api/private")! as URL,
                                          cachePolicy: .useProtocolCachePolicy,

                                      timeoutInterval: 10.0)

      request.httpMethod = "get"
      request.allHTTPHeaderFields = headers
      let session = URLSession.shared
      let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in
      if (error != nil) {
      print(error)

      } else {
      let httpResponse = response as? HTTPURLResponse

      print(httpResponse)

      }
      })
      dataTask.resume()
      ```

      </CodeGroup>
      


      Appelez le point de terminaison `/api/private-scoped` de manière similaire, mais assurez-vous que les autorisations API sont configurées correctement et que le jeton d’accès inclut la permission `read:messages`.

      <Note>
      ##### Point de contrôle
      Vous devriez maintenant pouvoir appeler les points de terminaison `/api/private` et `/api/private-scoped`.
      Exécutez votre application et vérifiez que :
      `GET /api/private` est disponible pour les demandes authentifiées.
      `GET /api/private-scoped` est disponible pour les demandes authentifiées contenant un jeton d’accès avec la permission `read:messages`.
      </Note>
      </Section>

    ## Étapes suivantes

    Beau travail! Si vous en êtes arrivé là, vous devriez avoir la connexion, la déconnexion et les informations de profil utilisateur actives dans votre application.

    Cela conclut notre tutoriel de démarrage rapide, mais il y a tellement plus à explorer. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    *   [Auth0 Dashboard](https://manage.auth0.com/#) : apprenez à configurer et gérer votre locataire et vos applications Auth0
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) : découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
      <CodeGroup>
        <Program />
        <Appsettings/>
        <Hasscopehandler/>
        <Hasscoperequirement/>
        <Apicontroller/>
      </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Hasscopehandler/>
          <Program />
          <Appsettings/>
          <Hasscoperequirement/>
          <Apicontroller/>
      </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Apicontroller/>
          <Hasscopehandler/>
          <Program />
          <Appsettings/>
          <Hasscoperequirement/>
      </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
