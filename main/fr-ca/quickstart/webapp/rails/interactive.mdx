---
title: "Ajouter une connexion à votre application Ruby on Rails"
permalink: "interactive"
'description': "Ce tutoriel explique comment ajouter la connexion utilisateur à une application Ruby on Rails."
'og:title': "Ajouter une connexion à votre application Ruby on Rails"
'og:description': "Ce tutoriel explique comment ajouter la connexion utilisateur à une application Ruby on Rails."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/rails.png"
'twitter:title': "Ajouter une connexion à votre application Ruby on Rails"
'twitter:description': "Ce tutoriel explique comment ajouter la connexion utilisateur à une application Ruby on Rails."
sidebarTitle: Ruby on Rails
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Auth0Yml from "/snippets/quickstart/webapp/rails/auth0.yml.mdx";
import Auth0 from "/snippets/quickstart/webapp/rails/auth0.rb.mdx";
import Auth0Controller from "/snippets/quickstart/webapp/rails/auth0_controller.rb.mdx";
import Routes from "/snippets/quickstart/webapp/rails/routes.rb.mdx";
import Secured from "/snippets/quickstart/webapp/rails/secured.rb.mdx";

export const sections = [
  { id: "configuration-d-auth0", title: "Configuration d’Auth0" },
  { id: "ajouter-des-dépendances", title: "Ajouter des dépendances" },
  { id: "configuration-de-la-trousse-sdk", title: "Configuration de la trousse SDK" },
  { id: "configurer-l-intergiciel-omniauth", title: "Configurer l’intergiciel OmniAuth" },
  { id: "ajouter-un-contrôleur-auth0", title: "Ajouter un contrôleur Auth0" },
  { id: "configurer-les-routes", title: "Configurer les routes" },
  { id: "ajouter-une-fonctionnalité-de-connexion-à-votre-application", title: "Ajouter une fonctionnalité de connexion à votre application" },
  { id: "ajoutez-une-fonctionnalité-de-déconnexion-à-votre-application", title: "Ajoutez une fonctionnalité de déconnexion à votre application" },
  { id: "afficher-les-informations-du-profil-utilisateur", title: "Afficher les informations du profil utilisateur" }
]

<Recipe>
  <Content>
      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Pour utiliser les services Auth0, vous devez avoir une application installée dans Auth0 Dashboard. L’application Auth0 est l’endroit où vous allez configurer le fonctionnement de l’authentification pour le projet que vous développez.

      ### Configurer une application

      Utilisez le sélecteur interactif pour créer une nouvelle application Auth0 ou sélectionner une application existante qui représente le projet avec lequel vous souhaitez effectuer l’intégration. Dans Auth0, il est attribué à chaque application un identifiant client unique alphanumérique que votre code d’application utilisera pour appeler les API Auth0 via la trousse SDK.

      Tous les paramètres que vous configurez à l’aide de ce guide rapide seront automatiquement mis à jour pour votre application dans le [Dashboard](https://manage.auth0.com/#/), qui est l’endroit où vous pourrez gérer vos applications à l’avenir.

      Si vous préférez explorer une configuration complète, consultez plutôt un exemple d’application.

      ### Configurer les URL de rappel

      Une URL de rappel est une URL intégrée dans votre application vers laquelle vous souhaitez qu’Auth0 redirige les utilisateurs après leur authentification. Si elle n’est pas définie, les utilisateurs ne seront pas redirigés vers votre application après s’être connectés.

      <Info>
      Si vous suivez notre exemple de projet, définissez cette URL comme suit : `http://localhost:3000/auth/auth0/callback`.
      </Info>

      ### Configuration des URL de déconnexion

      Une URL de déconnexion est une URL intégrée dans votre application vers laquelle vous souhaitez qu’Auth0 redirige les utilisateurs après leur déconnexion. Si elle n’est pas définie, les utilisateurs ne pourront pas se déconnecter de votre application et recevront un message d’erreur.

      <Info>
      Si vous suivez notre exemple de projet, définissez cette URL comme suit : `http://localhost:3000`.
      </Info>

      ### Configurer les origines Web autorisées

      Une origine Web autorisée est une URL que vous souhaitez autoriser à accéder à votre flux d’authentification. Elle doit contenir l’URL de votre projet. Si elle n’est pas configurée adéquatement, votre projet ne pourra pas actualiser silencieusement les jetons d’authentification, ce qui entraînera la déconnexion de vos utilisateurs lorsque prochainement ils visiteront votre application ou lors de l’actualisation d’une page.

      <Info>
      Si vous suivez notre exemple de projet, définissez cette URL comme suit : `http://localhost:3000`.
      </Info>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      Utilisez `omniauth-auth0`, une [stratégie OmniAuth](https://github.com/intridea/omniauth#omniauth-standardized-multi-provider-authentication) personnalisée, pour gérer le flux d’authentification.

      Ajoutez les dépendances suivantes à votre `Gemfile` :

      ```
      gem 'omniauth-auth0', '~> 3.0'
      gem 'omniauth-rails_csrf_protection', '~> 1.0' # prevents forged authentication requests
      ```

      Une fois vos gems ajoutés, installez-les avec la commande `bundle install`.
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Créez un fichier de configuration `./config/auth0.yml` pour préciser votre domaine Auth0, votre identifiant client et vos valeurs de secret client situées dans votre Auth0 Dashboard sous les **paramètres** de l’application.
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Créez le fichier d’initialisation suivant `./config/initializers/auth0.rb` et [configurez](https://github.com/auth0/omniauth-auth0/blob/master/EXAMPLES.md#send-additional-authentication-parameters) l’intergiciel **OmniAuth** avec le fichier de configuration que vous avez créé à l’étape précédente.

      Assurez-vous que `callback_path` correspond à la valeur donnée dans le paramètre des URL de rappel autorisées de votre application Auth0.
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Créez un contrôleur Auth0 pour gérer le rappel d’authentification, l’action `logout` et les méthodes pour créer l’URL de déconnexion.

      Exécutez la commande `rails generate controller auth0 callback failure logout --skip-assets --skip-helper --skip-routes --skip-template-engine`.

      Dans la méthode de rappel, assignez le hachage des informations utilisateur, renvoyé en tant que `request.env[’omniauth.auth’]` à la session active.

      Pour configurer la déconnexion, effacez tous les objets stockés dans la session en appelant la méthode `reset_session` dans l’action `logout`. Ensuite, redirigez vers le point de terminaison de déconnexion Auth0. Pour en savoir plus sur `reset_session`, consultez [Documentation relative au ActionController Ruby on Rails](http://api.rubyonrails.org/classes/ActionController/Base.html#M000668).
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      Ajoutez ces routes à votre fichier `./config/routes.rb`.

      Les routes doivent être en place afin que Rails sache comment diriger les différentes URL de rappel Auth0 vers le contrôleur Auth0 que vous avez créé à l’étape précédente.

      <Note>
      ##### Point de contrôle
      Exécutez votre application pour vérifier qu’elle fonctionne toujours comme prévu et que vous ne recevez aucun message d’erreur lié à Auth0.
      </Note>
      </Section>

      <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      Un utilisateur peut maintenant se connecter à votre application en visitant le point de terminaison `/auth/auth0`.

      <Warning>
      Pour [prévenir les requêtes d’authentification falsifiées](https://github.com/cookpad/omniauth-rails\_csrf\_protection), utilisez les méthodes d’assistance `link\_to` ou `button\_to` avec la méthode `:post`.
      </Warning>

      ```html
      <!-- Place a login button anywhere on your application -->
      <%= button_to 'Login', '/auth/auth0', method: :post %>
      ```

      <Note>
      ##### Point de contrôle
      Ajoutez un bouton à votre application qui redirige l’utilisateur vers le point de terminaison `/auth/auth0` lorsqu’il est sélectionné. Observez si vous êtes redirigé vers Auth0 pour vous connecter, puis renvoyé vers votre application après une authentification réussie.
      </Note>
      </Section>

      <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
      Maintenant que vous pouvez vous connecter à votre application Rails, vous avez besoin d’un moyen de vous déconnecter. Déconnectez un utilisateur en le redirigeant vers l’action `auth/logout` qui le redirige vers le point de terminaison de déconnexion d’Auth0.

      <Info>
      Pour tester cela après l’étape précédente, vous devez peut-être effacer votre session, puis rediriger l’utilisateur vers le point de terminaison de déconnexion d’Auth0.
      </Info>

      ```html
      <!-- Place a logout button anywhere on your application -->
      <%= button_to 'Logout', 'auth/logout', method: :get %>
      ```

      <Note>
      ##### Point de contrôle
      Ajoutez un bouton à votre application qui redirige l’utilisateur vers le point de terminaison `/auth/logout` lorsqu’il est sélectionné. Vérifiez que vous êtes redirigé vers Auth0, puis renvoyé rapidement vers votre application, et que vous n’êtes plus connecté.
      </Note>
      </Section>

      <Section id={sections[8].id} title={sections[8].title} stepNumber="9">
      Pour afficher le profil utilisateur, votre application doit fournir une route protégée. Vous pouvez utiliser une [préoccupation](https://guides.rubyonrails.org/getting_started.html#using-concerns) pour contrôler l’accès aux routes qui peuvent être partagées entre plusieurs contrôleurs. La préoccupation devrait rediriger automatiquement vers Auth0 lorsque l’utilisateur n’est pas authentifié. Au cas contraire, la préoccupation devrait renvoyer le profil utilisateur actuel.

      Une fois que vous avez une préoccupation, incluez-la dans tout contrôleur qui nécessite un utilisateur connecté. Vous pouvez ensuite accéder à l’utilisateur à partir de la session `session[:userinfo]` comme dans l’exemple suivant :

      ```
      class DashboardController < ApplicationController
      include Secured
      def show
      @user = session[:userinfo]

      end
      end
      ```

      Une fois que l’utilisateur a chargé la session, utilisez-la pour afficher des informations dans votre système frontal :

      ```html
      <div>
      <p>Normalized User Profile:<%= JSON.pretty_generate(@user[:info])%></p>
      <p>Full User Profile:<%= JSON.pretty_generate(@user[:extra][:raw_info])%></p>
      </div>
      ```

      <Note>
      ##### Point de contrôle
      Ajoutez le concern `Secured` à votre application, puis incluez-le dans le contrôleur qui nécessite un utilisateur authentifié pour y accéder. Vérifiez qu’un utilisateur authentifié a accès aux actions de ce contrôleur et que les utilisateurs non authentifiés sont redirigés vers Auth0 pour l’authentification.
      </Note>
      </Section>

    ## Étapes suivantes

    Beau travail! Si vous en êtes arrivé là, vous devriez avoir la connexion, la déconnexion et les informations de profil utilisateur actives dans votre application.

    Cela conclut notre tutoriel de démarrage rapide, mais il y a tellement plus à explorer. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    *   [Auth0 Dashboard](https://manage.auth0.com/#) : apprenez à configurer et gérer votre locataire et vos applications Auth0
    *   [Trousse SDK omniauth-auth0](https://github.com/auth0/omniauth-auth0) : explorez en détail la trousse SDK utilisée dans ce tutoriel
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) : découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <CodeGroup>
          <Auth0Yml/>
          <Auth0/>
          <Auth0Controller/>
          <Routes/>
          <Secured/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Auth0/>
          <Auth0Yml/>
          <Auth0Controller/>
          <Routes/>
          <Secured/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Auth0Controller/>
          <Auth0Yml/>
          <Auth0/>
          <Routes/>
          <Secured/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <CodeGroup>
          <Routes/>
          <Auth0Yml/>
          <Auth0/>
          <Auth0Controller/>
          <Secured/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[7].id}>
        <SignUpForm lang="fr"/>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[8].id}>
        <CodeGroup>
          <Secured/>
          <Auth0Yml/>
          <Auth0/>
          <Auth0Controller/>
          <Routes/>
        </CodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
