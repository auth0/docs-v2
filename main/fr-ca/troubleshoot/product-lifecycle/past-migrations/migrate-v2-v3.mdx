---
title: "Migrer de Recherche v2 vers v3"
permalink: "migrate-v2-v3"
'description': "Apprenez à migrer depuis Auth0 Recherche v2 vers v3."
'og:title': "Migrer de Recherche v2 vers v3"
'og:description': "Apprenez à migrer depuis Auth0 Recherche v2 vers v3."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Migrer de Recherche v2 vers v3"
'twitter:description': "Apprenez à migrer depuis Auth0 Recherche v2 vers v3."
---

La fonctionnalité de recherche d’utilisateurs v2 a atteint sa fin de vie au **30 juin 2019**. Nous vous recommandons vivement de migrer la fonctionnalité de recherche d’utilisateurs vers [search engine v3](/docs/fr-ca/manage-users/user-search) (`search_engine=v3`) dès que possible.

## Considérations sur la migration

Avant de commencer la migration, vous devez savoir un certain nombre de choses

* Pour vous assurer que vos requêtes utilisent le moteur de recherche v3 avant que v2 ne devienne indisponible, vous devez mettre à jour tous vos appels au point de terminaison  `GET /api/v2/users` pour inclure le paramètre `search_engine=v3`. Cela vous permettra de déterminer si des requêtes doivent être mises à jour, de manière à ne pas subir de temps d’arrêt lorsque la v2 deviendra indisponible.
* Si vous effectuez des opérations de recherche d’utilisateur via l’un des [trousses SDK impactées](#impacted-sdks), vous devez également passer le paramètre `search_engine=v30` comme indiqué ci-dessus.
* Les valeurs de recherche pour les champs utilisateur normalisés (`courriel`, `nom`, `prénom`, `nom de famille`, et `surnom`) ne sont pas sensibles à la casse. Tous les autres champs (y compris tous les champs `app_metadata`/ `user_metadata`)  sont sensibles à la casse.
* La v3 limite à 1000 le nombre d’utilisateurs que vous pouvez récupérer. Si vous atteignez cette limite, nous vous recommandons de redéfinir votre requête de recherche afin d’obtenir des résultats plus granulaires. Si vous avez besoin d’une liste de plus de 1000 utilisateurs à un moment donné, nous vous recommandons d’utiliser le point de terminaison de l’API  [Export Job (Exporter la tâche)](/docs/fr-ca/api/management/v2#!/Jobs/post_users_exports) ou [l’extension User Import/Export (Importation/Exportation des utilisateurs).](/docs/fr-ca/manage-users/user-migration/user-import-export-extension)
* Les recherches par plage et par caractères génériques ne sont pas disponibles pour les champs `app_metadata`/`user_metadata`.
* Les champs utilisateur ne sont pas tokenisés comme dans v2, donc `user_id:auth0` ne correspondra pas à `user_id` avec la valeur `auth0|12345`, à la place, utilisez `user_id:auth0*`.
* Les caractères génériques peuvent être utilisés pour la correspondance de préfixe, par exemple  `name:j*`. Pour les autres utilisations des caractères génériques (par ex., la correspondance de suffixes), les littéraux doivent comporter 3 caractères ou plus. Par exemple, `name:*usa` est autorisé, mais `name:*sa` ne l’est pas
* L’extension de champ `.raw` n’est plus prise en charge et doit être supprimée. Dans v3, les champs correspondent à l’intégralité de la valeur fournie et ne comportent pas de jetons, comme c’était le cas dans V2 sans le suffixe `.raw`.
* Le champ  `connexion` n’est pas pris en charge dans v3. Vous devriez utiliser plutôt son alias `identities.connection`.

## Requêtes pour migrer

<table class="table"><thead>
<tr>
<th>Cas d’utilisation</th>
<th>v2</th>
<th>v3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Rechercher par date</td>
<td>`updated_at:&gt;=2018-01-15`</td>
<td>`updated_at:[2018-01-15 TO *]`</td>
</tr>
<tr>
<td>Rechercher par date</td>
<td>`updated_at:&gt;2018-01-15`</td>
<td>`updated_at:{2018-01-15 TO *]`</td>
</tr>
<tr>
<td>Rechercher par date</td>
<td>`updated_at:&lt;=2018-01-15`</td>
<td>`updated_at:[* TO 2018-01-15]`</td>
</tr>
<tr>
<td>Rechercher par date</td>
<td>`updated_at:&lt;2018-01-15`</td>
<td>`updated_at:[* TO 2018-01-15}`</td>
</tr>
<tr>
<td>Rechercher par date</td>
<td>`last_login:&lt;=2017-12`</td>
<td>`last_login:[* TO 2017-12]`</td>
</tr>
<tr>
<td>Correspondance exacte de chaîne</td>
<td>`name.raw:"pierre richard untel"`</td>
<td>`name:"pierre richard untel"`</td>
</tr>
<tr>
<td>La phrase contient un mot</td>
<td>`name:"richard"`, `name:richard`</td>
<td>`name:*richard*`</td>
</tr>
<tr>
<td>La phrase contient un mot (ayant moins de 3 caractères)</td>
<td>`name:*ri`,`name:*a`, `name:*ab*`</td>
<td><em>(not supported)</em></td>
</tr>
</tbody>
</table>

## Trousses SDK concernées

Les trousses SDK suivantes utilisent le moteur de recherche d’utilisateurs. Si vous les utilisez, assurez-vous que vous utilisez les versions énumérées ci-dessous (ou une version plus récente), et passez le paramètre `search_engine=v3`, lorsque vous effectuez des opérations de recherche d’utilisateurs.

<table class="table"><thead>
<tr>
<th>Trousse SDK</th>
<th>Version avec prise en charge de v3</th>
<th>Méthodes impactées</th>
<th>Considérations</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/auth0/auth0-java">Auth0 Java</a></td>
<td>1.8.0</td>
<td>com.auth0.client.mgmt.UsersEntity.list</td>
<td>Fournit un `UserFilter` avec `withSearchEngine("v3")`</td>
</tr>
<tr>
<td><a href="https://github.com/auth0/auth0-python">Auth0 Python</a></td>
<td>3.0.0</td>
<td>management.Users.list</td>
<td>Fournir le paramètre `search_engine='v3'`</td>
</tr>
<tr>
<td>[Auth0 Node] (https://github.com/auth0/node-auth0)</td>
<td>2.0.0</td>
<td>UsersManager.getAll, ManagementClient.getUsers</td>
<td>Fournir le paramètre `search_engine:'v3'`</td>
</tr>
<tr>
<td>[Auth0 .NET] (https://github.com/auth0/auth0.net)</td>
<td>3.0.0 ou 4.0.0</td>
<td>Auth0.ManagementApi.IUsersClient.GetAllAsync</td>
<td>Fournir un objet `GetUsersRequest` avec `SearchEngine` = `"v3"`</td>
</tr>
<tr>
<td>[Auth0 PHP] (https://github.com/auth0/auth0-php)</td>
<td>5.2.0</td>
<td>Auth0.SDK.API.Management.Users.getAll</td>
<td>Fournir le paramètre `'search_engine' =&gt; 'v3'`</td>
</tr>
<tr>
<td>[Auth0 Ruby] (https://github.com/auth0/ruby-auth0)</td>
<td>4.5.0</td>
<td>Auth0.Api.V2.Users.users</td>
<td>Fournir le paramètre `search_engine: 'v3'`</td>
</tr>
</tbody>
</table>

## Extensions affectées

Les extensions suivantes utilisent le moteur de recherche d’utilisateurs. Si vous les avez installées, assurez-vous que vous utilisez les versions listées ci-dessous (ou une version plus récente).

<table class="table"><thead>
<tr>
<th>Extension</th>
<th>Support de version pour v3</th>
<th>Considérations</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/docs/fr-ca/extensions/authorization-extension/v2">Authorization Extension</a></td>
<td>2.5.0+</td>
<td>Si vous utilisez une version antérieure, vous devez mettre à jour manuellement l’extension depuis la page <a href="https://manage.auth0.com/#/extensions">Extensions</a>.</td>
</tr>
<tr>
<td><a href="/docs/fr-ca/extensions/delegated-admin/v3">Administration déléguée</a></td>
<td>3.1+</td>
<td>Si vous utilisez une version antérieure, vous devez mettre à jour manuellement l’extension à partir de la page <a href="https://manage.auth0.com/#/extensions">Extensions</a>. Le paramètre de configuration `SEARCH_ENGINE` n’existe plus dans la version 3.1 car seule la recherche utilisateur v3 est disponible.</td>
</tr>
</tbody>
</table>

## Exploitez les journaux de votre locataire pour connaître les usages de la Recherche d’utilisateurs v2.

Vous pouvez tirer parti des [logs (journaux)](/docs/fr-ca/deploy-monitor/logs) dans le [Dashboard (Tableau de bord)](https://manage.auth0.com/#/logs) pour trouver les appels vers le point de terminaison  `/api/v2/users` qui utilise le moteur de recherche v2, y compris les appels effectués par les trousses SDK. Ces journaux vous aideront à identifier les modifications à apporter au code de vos applications.

Utilisez la requête suivante pour récupérer tous les journaux relatifs à la recherche d’utilisateurs v2 :  `type:w AND description:*search_engine*`. Les journaux fourniront des informations supplémentaires dans le champ de description dans les cas suivants :

* Requêtes susceptibles de produire des résultats différents dans la v3
* Requêtes dont la syntaxe est incompatible avec la v3
* Requêtes qui ne répondent pas aux exigences de la v3 en matière de pagination

Si aucun détail supplémentaire n’est spécifié dans les entrées du journal, il est probable que vos requêtes soient compatibles avec la v3. Nous vous recommandons toutefois de tester les requêtes avant de déployer vos modifications en production.

Notez qu’un seul journal du même type sera généré en l’espace de 60 minutes. Cela signifie que même si vous effectuez plusieurs appels au point de terminaison Recherche d’utilisateurs, un seul journal de chaque type sera généré par heure.