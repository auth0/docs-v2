---
title: "Lock.Android : Authentification native via réseau social"
permalink: "lock-android-native-social-authentication"
'description': "Lock.Android – Authentification native via réseau social"
'og:title': "Lock.Android : Authentification native via réseau social"
'og:description': "Lock.Android – Authentification native via réseau social"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Lock.Android : Authentification native via réseau social"
'twitter:description': "Lock.Android – Authentification native via réseau social"
---

## Fournisseur natif – Google

Vous pouvez utiliser Google AuthProvider pour vous connecter avec ou sans **Lock**. Veuillez suivre les instructions de la section [Configuration](#setup).

[Lock-Google.Android](https://github.com/auth0/Lock-Google.Android)
nécessite l’API Android 15 ou ultérieure et Google Play Services 10.+

### Version la plus récente de Lock-Google

Lock-Google est accessible sur [Maven Central](http://search.maven.org) et [JCenter](https://bintray.com/bintray/jcenter). Pour l’installer, il suffit d’ajouter la ligne suivante à votre `build.gradle` :

`compile ’com.auth0.android:lock-google:1.+’`

Vous pouvez vérifier la version la plus récente dans [Readme](https://github.com/auth0/Lock-Google.Android#install) du répertoire, [Maven](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22lock-google%22%20g%3A%22com.auth0.android%22), ou [JCenter](https://bintray.com/auth0/android/lock-google).

### Configuration de Lock-Google

#### Google Developers Console

1. Rendez-vous dans la [Google Developers Console](https://console.developers.google.com/) et créez un nouveau projet.
2. Renseignez l’[écran de consentement OAuth](https://console.developers.google.com/apis/credentials/consent) en fournissant au moins une adresse courriel et un nom valides.
3. Cliquez sur [Identifiants](https://console.developers.google.com/apis/credentials) dans le tiroir de navigation à gauche.
4. Créez un nouvel identifiant en cliquant sur le bouton [Créer un identifiant](https://console.developers.google.com/apis/credentials/oauthclient) et en choisissant **OAuth client ID (ID client OAuth)**. Ensuite, choisissez **Web Application (Application Web)** et donnez-lui un nom comme « Serveur Auth0 Google-OAuth ». Complétez les **Authorized redirect URIs (URI de redirection autorisés)** en remplissant le champ avec votre URL de rappel, qui devrait ressembler à `https://{yourDomain}/login/callback.` Appuyez sur la touche ENTRÉE avant de quitter le champ, puis cliquez sur le bouton Créer. Notez les valeurs `CLIENT ID` et `CLIENT SECRET` car nous les utiliserons plus tard.
5. Créez un nouvel identifiant en cliquant sur le bouton [Créer un identifiant](https://console.developers.google.com/apis/credentials/oauthclient) et en choisissant **OAuth client ID (ID client OAuth)**. Sélectionnez ensuite **Android** et donnez-lui un nom comme « Auth0 Android Google-OAuth ». Récupérez le **SHA-1** du certificat que vous utilisez pour signer votre application et remplissez le premier champ avec ce SHA-1. Si vous avez besoin d’aide pour récupérer le SHA-1, consultez [cette](#certificate-fingerprints) section. Enfin, remplissez le dernier champ avec le **Package Name (nom de package)** de votre application Android, puis cliquez sur le bouton Créer. Notez la valeur de `CLIENT ID` car nous l’utiliserons plus tard.

#### Auth0 Dashboard

1. Rendez-vous dans Auth0 Dashboard et cliquez sur [Connexions via réseau social](https://manage.auth0.com/#/connections/social).
2. Cliquez sur **Google** et une boîte de dialogue s’ouvrira.
3. Remplissez le champ « ID client » avec la valeur `CLIENT ID` obtenue à l’étape 4 de la section **Google Developers Console** ci-dessus.
4. Complétez le champ « Secret client » avec la valeur `CLIENT SECRET` obtenue à l’étape 4 de la section **Google Developers Console** ci-dessus.
5. Remplissez le champ « ID clients mobiles autorisés » avec la valeur `CLIENT ID` obtenu à l’étape 5 de la section **Google Developers Console** ci-dessus.
6. Cliquez sur le bouton Enregistrer.
7. Rendez-vous dans le Auth0 Dashboard et cliquez sur [Applications](https://manage.auth0.com/#/applications). Si ce n’est pas déjà fait, vous devez d’abord créer une application, puis vous rendre sur la page de configuration de l’application.
8. En bas de la page, cliquez sur le lien « Afficher les paramètres avancés » et accédez à l’onglet « Paramètres de l’appareil ».
9. Dans la section Android, remplissez le champ **Nom de package** avec le nom de package de votre application. Enfin, remplissez le champ **Clés de hachage** avec le SHA-256 du certificat que vous utilisez pour signer votre application. Si vous avez besoin d’aide pour récupérer le SHA-256, consultez [cette](#certificate-fingerprints) section. Cliquez sur le bouton Enregistrer les modifications.

#### Application Android

1. Dans votre application Android, créez une nouvelle ressource de type chaîne dans le fichier `res/strings.xml`. Nommez-le `google_server_client_id` et donnez-lui comme valeur le `CLIENT_ID` obtenu à l’étape 5 de la configuration de la section de configuration de **Google Developers Console** ci-dessus.
2. Ajoutez les métadonnées de la version de Google Play Services au fichier `AndroidManifest.xml`, à l’intérieur de la balise Application.

   ``` lines
   <meta-data
       android:name="com.google.android.gms.version"
       android:value="@integer/google_play_services_version" />
   ```

   

   
3. Ajoutez l’autorisation Internet Android à votre fichier `AndroidManifest.xml`.

   ```xml lines
   <uses-permission android:name="android.permission.INTERNET" />
   ```

   

   
4. En créant une nouvelle instance de `GoogleAuthProvider`, transmettez la valeur `google_server_client_id` obtenue précédemment comme premier paramètre :

   ``` lines
   public class MainActivity extends AppCompatActivity {
     private GoogleAuthProvider provider;
     // ...

     @Override
     protected void onCreate(Bundle savedInstanceState) {
       Auth0 auth0 = new Auth0(getString(R.string.com_auth0_client_id), getString(R.string.com_auth0_domain));
       auth0.setOIDCConformant(true);
       AuthenticationAPIClient client = new AuthenticationAPIClient(auth0);
       provider = new GoogleAuthProvider(getString(R.string.google_server_client_id), client);
     }

     // ...
   }
   ```

   

   

Si vous avez besoin d’aide supplémentaire pour l’installation de la trousse SDK de Google, veuillez consulter le [Guide de connexion pour Android](https://developers.google.com/identity/sign-in/android) de Google.

### Utilisation sans Lock

Si vous prévoyez d’utiliser ce fournisseur sans **Lock**, assurez-vous de passer outre la méthode `onActivityResult()` et de rediriger l’appel vers l’instance du fournisseur. Pour finir, appelez « start » pour lancer le processus d’authentification.

```java lines
// Define your own request codes
private static final int RC_PERMISSIONS = 101;
private static final int RC_AUTHENTICATION = 102;

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (provider.authorize(requestCode, resultCode, data)) {
        return;
    }
    super.onActivityResult(requestCode, resultCode, data);
}

private void beginAuthentication(){
  provider.start(this, callback, RC_PERMISSIONS, RC_AUTHENTICATION);
}
```

Voilà, vous êtes prêt à exécuter l’application et à vous connecter à l’aide du fournisseur natif de Google!

### Options supplémentaires

#### Utiliser un nom de connexion personnalisé

Pour utiliser un nom de connexion via réseau social personnalisé afin d’autoriser Auth0, créez l’instance de GoogleAuthProvider à l’aide du deuxième constructeur :

```java lines
GoogleAuthProvider provider = new GoogleAuthProvider("my-connection", "google-server-client-id", client);
```

#### Envoyer des paramètres d’authentification supplémentaires

Pour envoyer des paramètres supplémentaires lors de l’authentification, appelez `setParameters`.

```java lines
Map<String, Object> parameters = new HashMap<>();
//Add entries
provider.setParameters(parameters);
```

#### Demande d’une permission Google personnalisée

Par défaut, la permission `Scopes.PLUS_LOGIN` est demandée. Vous pouvez personnaliser les permissions en appelant `setScopes` avec la liste des permissions. Chaque API de Google (Auth, Drive, Plus,  etc.) précise sa propre liste de permissions Google.

```java lines
provider.setScopes(Arrays.asList(new Scope(Scopes.PLUS_ME), new Scope(Scopes.PLUS_LOGIN)));
```

#### Demander des autorisations d’exécution personnalisées pour Android

Ce fournisseur n’a pas besoin d’autorisations spéciales dans le manifeste d’Android pour authentifier l’utilisateur. Cependant, si votre cas d’utilisation l’exige, vous pouvez laisser l’AuthProvider s’en charger pour vous. Utilisez la méthode `setRequiredPermissions`.

```java lines
provider.setRequiredPermissions(new String[]{"android.permission.GET_ACCOUNTS"});
```

Si vous n’utilisez pas Lock, vous devrez gérer vous-même le résultat de la demande d’autorisation. Pour ce faire, votre activité doit mettre en œuvre l’interface `ActivityCompat.OnRequestPermissionsResultCallback`. Lorsque la méthode `onRequestPermissionsResult` est appelée, transmettez le résultat au fournisseur en appelant `provider.onRequestPermissionsResult`.

#### Se déconnecter ou supprimer le compte.

On doit appeler `clearSession` pour déconnecter l’utilisateur de sorte qu’il doive entrer ses données d’identification la prochaine fois. Après cela, l’état du fournisseur n’est plus valide et vous devez appeler à nouveau `start` avant d’essayer d’autoriser un résultat avec `authorize`. Appeler `stop` aboutit au même résultat.

`provider.clearSession();`

#### Se rappeler de la dernière connexion

Par défaut, ce fournisseur se souviendra du dernier compte utilisé pour la connexion. Si vous souhaitez modifier ce comportement, utilisez la méthode suivante.

`provider.rememberLastLogin(false);`

#### Empreintes de certificats

En créant un nouvel identifiant <Tooltip href="/docs/fr-ca/glossary?term=oath2" tip="OAuth 2.0
Cadre d’applications d’autorisation qui définit les protocoles d’autorisation et les flux de production." cta="Voir le glossaire">OAuth</Tooltip> dans Google Developers Console, vous devrez fournir le SHA-1 du certificat que vous utilisez pour signer votre application. En complétant la configuration de votre application dans Auth0 Dashboard, vous devrez également fournir la valeur SHA-256. Voici un exemple de commande de terminal permettant d’obtenir la valeur, ainsi qu’un exemple de résultat.

Commande :

`keytool -exportcert -alias androiddebugkey -keystore <PATH_TO_YOUR_KEYSTORE> -storepass android | openssl sha1 -binary | openssl base64`

Exemple de sortie :

`no71633JAC3qgzQYCbskprUr55k=`

Si vous avez besoin d’aide, vous pouvez suivre ce [Guide des magasins de clés](/docs/fr-ca/android-development-keystores-hashes) pour acquérir ces valeurs.

## Fournisseur natif – Facebook

Vous pouvez utiliser Facebook AuthProvider pour vous connecter avec ou sans **Lock**. Veillez à suivre les instructions de la section [Configuration](#setup).

[Lock-Facebook](https://github.com/auth0/Lock-Facebook.Android) nécessite l’API Android 15 ou ultérieure et trousse SDK Facebook pour Android 4.+

## Version la plus récente

Lock-Facebook est accessible sur [Maven Central](http://search.maven.org) et [JCenter](https://bintray.com/bintray/jcenter). Pour l’installer, il suffit d’ajouter la ligne suivante à votre `build.gradle` :

`compile ’com.auth0.android:lock-facebook:3.+’`

Vous pouvez vérifier la version la plus récente dans [Readme](https://github.com/auth0/Lock-Facebook.Android#install) du répertoire, [Maven](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22lock-facebook%22%20g%3A%22com.auth0.android%22), ou [JCenter](https://bintray.com/auth0/android/lock-facebook).

### Configuration Lock-Facebook

#### Facebook Developers Console

1. Rendez-vous dans [Facebook Developers Console](https://developers.facebook.com/) et créez une nouvelle application : Choisissez « Android » et donnez-lui un nom valide. Cliquez sur Créer un nouvel identifiant d’application Facebook.
2. Ajoutez le **Nom de package** de votre application et le nom de **Classe d’activité** dans laquelle vous utilisez le fournisseur et cliquez sur le bouton Suivant.
3. Ajoutez les clés de hachage **SHA-1** encodées en Base64 des certificats que vous utilisez pour signer votre application et cliquez sur le bouton Suivant. Si vous avez besoin d’aide pour récupérer le SHA-1, consultez [cette](#certificate-fingerprints) section.
4. Enfin, faites défiler la page jusqu’en haut et cliquez sur le bouton Sauter le démarrage rapide pour accéder à la page de votre application Facebook.
5. En haut de la page, vous trouverez les valeurs `APP ID` et `APP SECRET`. Prenez-les en note car vous en aurez besoin plus tard.
6. Le tiroir de navigation se trouve sur le côté gauche. Cliquez sur Paramètres, puis sur Base. Activez le commutateur **Authentification unique** et cliquez sur le bouton Enregistrer.
7. Cliquez sur Paramètres, puis sur Avancés. Activez le commutateur **Application native ou de bureau?**

#### Auth0 Dashboard

1. Rendez-vous dans Auth0 Dashboard et cliquez sur [Connexions via réseau social](https://manage.auth0.com/#/connections/social).
2. Cliquez sur **Facebook** et une boîte de dialogue s’ouvrira.
3. Remplissez le champ « ID de l’application » avec la valeur `APP ID` obtenue à l’étape 5 de la section **Facebook Developers Console** ci-dessus.
4. Remplissez le champ « Secret de l’application » avec la valeur `APP SECRET` obtenue à l’étape 5 de la section **Facebook Developers Console** ci-dessus.
5. Cliquez sur le bouton Enregistrer.
6. Rendez-vous dans le Auth0 Dashboard et cliquez sur [Applications](https://manage.auth0.com/#/applications). Si ce n’est pas déjà fait, vous devez d’abord créer une application, puis vous rendre sur la page de configuration de l’application.
7. En bas de la page, cliquez sur le lien « Afficher les paramètres avancés » et accédez à l’onglet « Paramètres de l’appareil ».
8. Dans la section Android, remplissez le champ **Nom de package** avec le nom de package de votre application. Enfin, remplissez le champ **Clés de hachage** avec le SHA-256 du certificat que vous utilisez pour signer votre application. Si vous avez besoin d’aide pour récupérer le SHA-256, consultez [cette](#certificate-fingerprints) section. Cliquez sur le bouton Enregistrer les modifications.

#### Application Android

1. Dans votre application Android, créez une nouvelle ressource de type chaîne dans le fichier `res/strings.xml`. Nommez-le `facebook_app_id` et donnez-lui comme valeur le `APP ID` obtenu à l’étape 5 de la section de configuration de la **Facebook Developers Console** ci-dessus.
2. Ajoutez les métadonnées `FacebookActivity` et `facebook_app_id` au fichier `AndroidManifest.xml`, à l’intérieur de la balise Application.

   ``` lines
   <activity
       android:name="com.facebook.FacebookActivity"
       android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
       android:label="@string/app_name"/>
   <meta-data
       android:name="com.facebook.sdk.ApplicationId"
       android:value="@string/facebook_app_id" />
   ```

   

   
3. Ajoutez l’autorisation Internet Android à votre fichier `AndroidManifest.xml`.

   ```xml lines
   <uses-permission android:name="android.permission.INTERNET" />
   ```

   

   
4. Créez une nouvelle instance de `FacebookAuthProvider`.

   ``` lines
   public class MainActivity extends AppCompatActivity {
     private FacebookAuthProvider provider;
     // ...

     @Override
     protected void onCreate(Bundle savedInstanceState) {
       super.onCreate(savedInstanceState);
       Auth0 auth0 = new Auth0(getString(R.string.com_auth0_client_id), getString(R.string.com_auth0_domain));
       auth0.setOIDCConformant(true);
       AuthenticationAPIClient client = new AuthenticationAPIClient(auth0);
       provider = new FacebookAuthProvider(client);
     }

     // ...
   }
   ```

   

   

Si vous avez besoin d’aide supplémentaire pour l’installation de la trousse SDK de Facebook, consultez le [Guide de démarrage](https://developers.facebook.com/docs/android/getting-started) de Facebook.

### Utilisation sans Lock

Si vous prévoyez d’utiliser ce fournisseur sans **Lock**, assurez-vous de passer outre la méthode `onActivityResult()` de votre activité et de rediriger l’appel vers l’instance du fournisseur. Pour finir, appelez ,,« start » pour lancer le processus d’authentification.

```java lines
// Define your own request codes
private static final int RC_PERMISSIONS = 101;
private static final int RC_AUTHENTICATION = 102;

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (provider.authorize(requestCode, resultCode, data)) {
        return;
    }
    super.onActivityResult(requestCode, resultCode, data);
}

private void beginAuthentication(){
  provider.start(this, callback, RC_PERMISSIONS, RC_AUTHENTICATION);
}
```

Voilà, vous êtes prêt à exécuter l’application et à vous connecter à l’aide du fournisseur natif de Facebook!

### Options supplémentaires

#### Utiliser un nom de connexion personnalisé

Pour utiliser un nom de connexion via réseau social personnalisé afin d’autoriser Auth0, appelez `setConnection` avec votre nouveau nom de connexion.

```java lines
FacebookAuthProvider provider = new FacebookAuthProvider("my_connection_name", client);
```

#### Envoyer des paramètres d’authentification supplémentaires

Pour envoyer des paramètres supplémentaires lors de l’authentification, appelez `setParameters`.

```java lines
Map<String, Object> parameters = new HashMap<>();
//Add entries
provider.setParameters(parameters);
```

#### Demander des autorisations personnalisées pour Facebook.

Par défaut, la permission `public_profile` est demandée. Vous pouvez les personnaliser en appelant `setPermissions` avec la liste des autorisations Facebook.

```java lines
provider.setPermissions(Arrays.asList("public_profile", "user_photos"));
```

#### Demander des autorisations d’exécution personnalisées pour Android

Ce fournisseur n’a pas besoin d’autorisations spéciales dans le manifeste d’Android pour authentifier l’utilisateur. Cependant, si votre cas d’utilisation l’exige, vous pouvez laisser l’AuthProvider s’en charger pour vous. Utilisez la méthode `setRequiredPermissions` pour les préciser.

```java lines
provider.setRequiredPermissions(new String[]{"android.permission.GET_ACCOUNTS"});
```

Si vous n’utilisez pas Lock, vous devrez gérer vous-même le résultat de la demande d’autorisation. Pour ce faire, votre activité doit mettre en œuvre l’interface `ActivityCompat.OnRequestPermissionsResultCallback`. Lorsque la méthode `onRequestPermissionsResult` est appelée, transmettez le résultat au fournisseur en appelant `provider.onRequestPermissionsResult`.

#### Se déconnecter ou supprimer le compte.

On doit appeler `clearSession` pour déconnecter l’utilisateur de sorte qu’il doive entrer ses données d’identification la prochaine fois. Après cela, l’état du fournisseur n’est plus valide et vous devez appeler à nouveau `start` avant d’essayer d’autoriser un résultat avec `authorize`. Appeler `stop` aboutit au même résultat.

`provider.clearSession();`

#### Se rappeler de la dernière connexion

Par défaut, ce fournisseur se souviendra du dernier compte utilisé pour la connexion. Si vous souhaitez modifier ce comportement, utilisez la méthode suivante.

`provider.rememberLastLogin(false);`

### Empreintes de certificats

En créant un nouvel identifiant OAuth dans la Facebook Developers Console, vous devrez fournir le SHA-1 du certificat que vous utilisez pour signer votre application. En complétant la configuration de votre application dans le Auth0 Dashboard, vous devrez également fournir la valeur SHA-256. Voici un exemple de commande de terminal permettant d’obtenir la valeur, ainsi qu’un exemple de résultat.

Commande :

`keytool -exportcert -alias androiddebugkey -keystore <PATH_TO_YOUR_KEYSTORE> -storepass android | openssl sha1 -binary | openssl base64`

Exemple de sortie :

SHA1 : BB:0D:AC:74:D3:21:E1:43:07:71:9B:62:90:AF:A1:66:6E:44:5D:75
SHA256: 15:B9:F9:33:9F:E4:E3:68:C2:10:49:17:5D:A8:77:12:7C:8E:57:E9:FF:B7:23:EA:CC:DD:56:08:06:C9:5E:33

Si vous avez besoin d’aide, vous pouvez suivre ce [Guide des magasins de clés](/docs/fr-ca/android-development-keystores-hashes) pour acquérir ces valeurs.