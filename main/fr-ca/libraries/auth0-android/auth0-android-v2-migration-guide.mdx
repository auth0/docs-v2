---
title: "Auth0 Android v2 – Guide de migration"
permalink: "auth0-android-v2-migration-guide"
'description': "Comment migrer vos applications Auth0 Android v1 vers la version 2 de la trousse SDK"
'og:title': "Auth0 Android v2 – Guide de migration"
'og:description': "Comment migrer vos applications Auth0 Android v1 vers la version 2 de la trousse SDK"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Auth0 Android v2 – Guide de migration"
'twitter:description': "Comment migrer vos applications Auth0 Android v1 vers la version 2 de la trousse SDK"
---

La version 2 de la trousse SDK d’Auth0 Android comprend de nombreuses améliorations dans le cadre de l’intégration d’Auth0 dans vos applications Android. **Cette mise à niveau contient des modifications importantes.** Veuillez lire ce guide pour comprendre les changements à apporter avant d’effectuer la migration vers la version 2.

## Modifications apportées aux exigences

La version 2 nécessite la version 21 (ou ultérieure) de l’API et Java8+.

Voici le nécessaire dans `build.gradle` pour cibler le code à 8 octets Java pour les plugiciels Android et Kotlin respectivement :

``` lines
android {
  compileOptions {
      sourceCompatibility JavaVersion.VERSION_1_8
      targetCompatibility JavaVersion.VERSION_1_8
  }

  kotlinOptions {
      jvmTarget = '1.8'
  }
}
```

## Open ID Connect uniquement

La version 2 ne prend en charge que les applications conformes à OIDC. Lorsque vous utilisez cette trousse SDK pour authentifier des utilisateurs, seuls le pipeline d’authentification et les points de terminaison Auth0 sont utilisés. Nous avons retiré la méthode `setOIDCConformant(boolean value)` de la classe `Auth0`.

En savoir plus sur le [Protocole OpenID Connect](https://auth0.com/docs/protocols/openid-connect-protocol).

## Code d’autorisation avec PKCE

La version 2 ne prend en charge que le flux [Code d’autorisation avec Proof Key for Code Exchange (PKCE)](https://auth0.com/docs/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce). Nous avons retiré la méthode `withResponseType(@ResponseType int type)` sur `WebAuthProvider.Builder`.

## Retrait de la prise en charge WebView

Nous avons retiré la capacité obsolète d’authentification utilisant un composant `WebView`. Les applications de navigateur externes seront toujours utilisées à la place, pour plus de sécurité et de confiance pour les utilisateurs.

## Retrait de la prise en charge des anciennes Authentication API

Nous avons retiré les méthodes et classes dédiées à l’appel des [Authentication API](https://auth0.com/docs/api/authentication) classées comme obsolètes. Voir la liste complète dans la section **Classes et interfaces retirées** ci-après.

## Changements apportés aux interfaces de requêtes

Le package `com.auth0.android.request` définit les interfaces de haut niveau pour la création et l’exécution des  requêtesHTTP. Dans le passé, un problème récurrent était l’impossibilité d’ajouter des en-têtes et des paramètres de requête personnalisés à toutes les requêtes. Nous avons remanié les interfaces de requêtes pour permettre à n’importe quelle requête d’être personnalisée avec des en-têtes et des paramètres de requête supplémentaires. Notez que ces paramètres doivent désormais être de type `String`.

L’interface de niveau supérieur `Request` appelle désormais ces méthodes :

* `public fun addParameters(parameters: Map<String, String>): Request<T, U>`
* `public fun addParameter(name: String, value: String): Request<T, U>`
* `public fun addHeader(name: String, value: String): Request<T, U>`

Nous avons retiré les interfaces suivantes :

* `ParameterizableRequest`
* `AuthRequest`

`AuthenticationAPIClient` contient en conséquence de nombreux changements du type de retour. Voici quelques exemples :

* Toutes les méthodes qui renvoyaient `ParameterizableRequest`, `TokenRequest`, ou `DatabaseConnectionRequest`, renvoient désormais une `Request`

* Toutes les méthodes qui renvoyaient `AuthRequest` renvoient désormais une `AuthenticationRequest`

Si vous utilisez directement un type de renvoi d’une des ces méthodes, vous devrez modifier votre code pour obtenir le type expliqué ci-dessus. Si vous enchaînez un appel à `start` ou `execute` pour effectuer la requête, aucune modification n’est nécessaire.

L’interface `AuthenticationRequest` n’a plus de méthode `setAccessToken("{ACCESS-TOKEN}")`. Cette méthode servait à définir le jeton de la requête faite au point de terminaison [/oauth/access_token](https://auth0.com/docs/api/authentication#social-with-provider-s-access-token) obsolète de l’Authentication API, désactivé en juin 2017. Si vous avez besoin d’envoyer un paramètre sous ce nom, veuillez utiliser `addParameter("access_token", "{ACCESS-TOKEN}")`.

Toutes les classes qui implémentaient `ParameterizableRequest` ou `AuthRequest` ont été mises à jour pour tenir compte de ces changements.

Voir la liste complète dans la section **Classes et interfaces retirées** ci-après.

## Personnalisation des clients de réseau

La version 2 améliore la capacité à personnaliser la façon dont cette bibliothèque émet des requêtes HTTP. Une nouvelle interface, `NetworkingClient`, définit le contrat pour exécuter les requêtes HTTP. Vous pouvez configurer la classe `Auth0` avec une instance de `NetworkingClient`. Cela vous permet de proposer votre propre implémentation pour contrôler entièrement le client de réseau. De plus, le client de réseau fourni par cette bibliothèque prend en charge plusieurs exemples de points de personnalisation afin de faciliter la configuration de points de personnalisation communs.

### Configuration du délai d’expiration

```kotlin lines
// Before
val account = Auth0("{YOUR_CLIENT_ID}", "{YOUR_DOMAIN}")

account.connectTimeoutInSeconds = 30
account.readTimeoutInSeconds = 30

val authAPI = AuthenticationAPIClient(account)

// After
val netClient = DefaultClient(
    connectTimeout = 30,
    readTimeout = 30
)

val account = Auth0("{YOUR_CLIENT_ID}", "{YOUR_DOMAIN}")
account.networkingClient = netClient
```

### Configuration de la journalisation

```kotlin lines
// Before
val account = Auth0("{YOUR_CLIENT_ID}", "{YOUR_DOMAIN}")
account.isLoggingEnabled = true

val authAPI = AuthenticationAPIClent(account)

// After
val netClient = DefaultClient(
    enableLogging = true
)

val account = Auth0("{YOUR_CLIENT_ID}", "{YOUR_DOMAIN}")
account.networkingClient = netClient
```

## Liste détaillée des modifications

### Fichiers qui ont modifié leur package

* Nous avons déplacé la classe `com.auth0.android.authentication.request.ProfileRequest` vers `com.auth0.android.request.ProfileRequest`.
* Nous avons déplacé la classe `com.auth0.android.authentication.request.SignUpRequest` vers `com.auth0.android.request.SignUpRequest`.

### Package interne

La version précédente de cette bibliothèque exposait quelques classes dans le package `com.auth0.android.request.internal`. Celles-ci n’ont jamais été destinées à faire partie de l’API publique de la bibliothèque; la documentation Java décourageait leur utilisation directe. Depuis que la base de code a migré vers Kotlin, nous profitons désormais du modificateur `internal` et l’utilisons lorsque c’est nécessaire. Ces classes peuvent être affichées tant que classes `public` pour les projets Java, mais sans être utilisées. Elles ne font pas encore partie de l’API publique de cette bibliothèque.

Nous ne fournirons aucune assistance pour ces classes. Nous les modifierons selon les besoins, sans préavis.

### Classes et interfaces retirées

* La classe `com.auth0.android.util.Base64` a été retirée. Utilisez plutôt `android.util.Base64`.
* L’interface `com.auth0.android.request.ParameterizableRequest` a été retirée. Nous avons déplacé la capacité à ajouter des en-têtes et paramètres de requête vers l’interface `com.auth0.android.request.Request`.
* L’interface `com.auth0.android.request.AuthRequest` a été retirée. Utilisez plutôt l’interface `com.auth0.android.request.AuthenticationRequest`.
* La classe `com.auth0.android.provider.WebAuthActivity` a été retirée. Les applications de navigateur externes seront toujours utilisées pour l’authentification.
* La classe `com.auth0.android.result.Delegation` a été retirée. Elle était utilisée comme résultat de la requête faite au point de terminaison obsolète de l’Authentication API, désactivé en juin 2017.
* La classe `com.auth0.android.authentication.request.DelegationRequest` a été retirée. Elle était utilisée pour représenter la requête faite au point de terminaison obsolète de l’Authentication API, désactivé en juin 2017.
* La classe `com.auth0.android.util.Telemetry` a été renommée en `com.auth0.android.util.Auth0UserAgent`.
* La classe `com.auth0.android.request.AuthorizableRequest` a été retirée. Vous pouvez obtenir le même résultat en utilisant `addHeader("Authorization", "Bearer {TOKEN_VALUE}")`.
* La classe `com.auth0.android.authentication.request.TokenRequest` a été retirée. Nous avons déplacé la capacité à définir un vérificateur de code et tous les en-têtes et paramètres de requête vers l’interface `com.auth0.android.request.Request`.
* La classe `com.auth0.android.authentication.request.DatabaseConnectionRequest` a été retirée. Nous avons déplacé la capacité à définir des en-têtes et paramètres de requête vers l’interface `com.auth0.android.request.Request`.
* La classe `com.auth0.android.provider.VoidCallback` a été retirée. Nous avons remplacé la capacité à utiliser un callback qui ne prenne pas d’argument avec `Callback<Void, AuthenticationException>`.
* L’interface `com.auth0.android.request.ErrorBuilder` a été retirée.
* La classe `com.auth0.android.RequestBodyBuildException` a été retirée.
* La classe `com.auth0.android.util.CheckHelper` a été retirée.
* L’interface `com.auth0.android.util.JsonRequired` a été retirée.
* La classe `com.auth0.android.util.JsonRequiredTypeAdapterFactory` a été retirée.

### Constantes retirées

* `ParameterBuilder.GRANT_TYPE_JWT` a été retirée.
* `ParameterBuilder.ID_TOKEN_KEY` a été retirée.
* `ParameterBuilder.DEVICE_KEY` a été retirée.
* `ParameterBuilder.ACCESS_TOKEN_KEY` a été retirée.
* `ResponseType.CODE`, `ResponseType.ID_TOKEN`, et `ResponseType.ACCESS_TOKEN` ont été retirées.

### Classes et interfaces modifiées

* `SignupRequest` implémente désormais `AuthenticationRequest` au lieu de `AuthRequest`, qui a été retirée
* `AuthorizableRequest` étend désormais `Request` au lieu de `ParameterizableRequest`, qui a été retirée
* `BaseCallback` est déconseillée, utilisez plutôt `Callback`.

### Constructeurs modifiés

* Vous ne pouvez plus construire `AuthenticationAPIClient` à partir d’un `Context`. Utilisez plutôt `AuthenticationAPIClient(auth0: Auth0)`. Vous pouvez créer une instance d’`Auth0` en utilisant un `Context`.
* Vous ne pouvez plus construire de `UsersAPIClient` à partir d’un `Context`. Utilisez plutôt`UsersAPIClient(auth0: Auth0, token: String)`. Vous pouvez créer une instance d’`Auth0` en utilisant un `Context`.
* `SignupRequest` nécessite désormais `AuthenticationRequest` comme deuxième paramètre.
* `ProfileRequest` nécessite désormais un `AuthenticationRequest` et un `Request<UserProfile, AuthenticationException>`.
* Vous ne pouvez plus construire de `Credentials` avec une valeur « expire dans ». Précisez plutôt la date d’expiration ou « expire à ». En général, vous ne construirez pas de `Credentials` tout seul.

### Méthodes retirées ou modifiées

#### Méthodes Auth0 retirées

* `setOIDCConformant(boolean enabled)` et `isOIDCConformant()` ont été retirées. La trousse SDK ne prend désormais en charge que les applications conformes à OIDC.
* `doNotSendTelemetry()` a été retirée. Il n’y a pas de méthode de remplacement.
* `setWriteTimeoutInSeconds(seconds)` et `getWriteTimeoutInSeconds(seconds)` ont été retirées. Il n’y a pas de méthode de remplacement.
* `setReadTimeoutInSeconds(seconds)` et `getReadTimeoutInSeconds(seconds)` ont été retirées. Vous pouvez personnaliser le délai directement dans la classe `DefaultClient`. Utilisez `DefaultClient(readTimeout = 123)`.
* `setConnectTimeoutInSeconds(seconds)` et `getConnectTimeoutInSeconds(seconds)`ont été retirées. Vous pouvez personnaliser le délai de connexion directement dans la classe `DefaultClient`. Utilisez `DefaultClient(connectTimeout = 123)`.
* `setLoggingEnabled(boolean enabled)` et `isLoggingEnabled()` ont été retirées. Vous pouvez activer l’enregistreur de trafic réseau directement dans la classe `DefaultClient`. Utilisez `DefaultClient(enableLogging = true)`. Utilisez-la à des fins de débogage mais ne l’activez jamais dans les environnements de production.
* `setTLS12Enforced()` et `isTLS12Enforced()` ont été retirées. La trousse SDK prend désormais en charge le TLS moderne par défaut.

#### MéthodesAuthenticationAPIClient retirées ou modifiées

* `setUserAgent(String)` a été retirée. Vous pouvez définir que les en-têtes soient envoyés directement à chaque instance de requête en utilisant la méthode `addHeader("{NAME}", "{VALUE}")`, ou de manière globale à l’instance du client réseau via le paramètre de constructeur `DefaultClient(defaultHeaders = mapOf())`.

Nous avons retiré de la v2 les méthodes et classes appelant une des [Authentication API](https://auth0.com/docs/api/authentication) classées obsolètes. Nous avons retiré les méthodes suivantes :

* `delegation()`, `delegationWithIdToken("{ID-TOKEN}")`, `delegationWithRefreshToken("{REFRESH-TOKEN}")`, et `delegationWithIdToken("{ID-TOKEN}", "{API-TYPE}}")`. La prise en charge des points de terminaison Authentication API obsolètes a été retirée.
* `loginWithOAuthAccessToken("{TOKEN}", {CONNECTION})`. Pour certains fournisseurs sociaux, vous pouvez plutôt utiliser `loginWithNativeSocialToken("{TOKEN}", "{TOKEN-TYPE}")`.
* `tokenInfo("{ID-TOKEN}")`. Utilisez plutôt `userInfo("{ACCESS-TOKEN}")`.

Les méthodes qui renvoyaient une `ParameterizableRequest` renvoient désormais une `Request` :

* `userInfo("{ACCESS-TOKEN}")`
* `revokeToken("{REFRESH-TOKEN}")`
* `renewAuth("{REFRESH-TOKEN}")`
* `passwordlessWithEmail("{EMAIL}", PasswordlessType, "{CONNECTION}")`
* `passwordlessWithSMS("{PHONE-NUNBER}", PasswordlessType, "{CONNECTION}")`
* `fetchJsonWebKeys()`

Les méthodes qui renvoyaient une `AuthRequest` renvoient désormais une `AuthenticationRequest` :

* `login("{USERNAME-OR-EMAIL}", "{PASSWORD}", "{REALM-OR-CONNECTION}")`
* `login("{USERNAME-OR-EMAIL}", "{PASSWORD}")`
* `loginWithOTP("{MFA-TOKEN}", "{OTP}")`
* `loginWithNativeSocialToken("{TOKEN}", "{TOKEN-TYPE}")`
* `loginWithPhoneNumber("{PHONE-NUMBER}", "{VERIFICATION-CODE}", "{REALM-OR-CONNECTION}")`
* `loginWithEmail("{EMAIL}", "{VERIFICATION-CODE}", "{REALM-OR-CONNECTION}")`

Les méthodes qui renvoyaient une `DatabaseConnectionRequest` renvoient désormais une `Request` :

* `createUser("{EMAIL}", "{PASSWORD}", "{USERNAME}", "{CONNECTION}")`
* `resetPassword("{EMAIL}","{CONNECTION}")`

Les méthodes qui renvoyaient une `TokenRequest` renvoient désormais une `Request` :

* `token("{AUTHORIZATION-CODE}", "{CODE-VERIFIER}", "{REDIRECT-URI}")`

#### Méthodes AuthenticationRequest retirées

* `addAuthenticationParameters(parameters)` a été retirée. Utilisez plutôt `addParameters(parameters)`.
* `setDevice("{DEVICE}").` Utilisez plutôt `addParameter("device", "{VALUE}")`.

#### Méthodes WebAuthProvider.Builder retirées

* `useCodeGrant(boolean useCodeGrant)`. Il n’y a pas de remplacement; seul le flux Code + PKCE est pris en charge par la v2.
* `useBrowser(boolean useBrowser)`. Il n’y a pas de remplacement; cette bibliothèque ne prend plus en charge l’authentification WebView.
* `useFullscreen(boolean useFullscreen)`. Il n’y a pas de remplacement; cette bibliothèque ne prend plus en charge l’authentification WebView.
* `withResponseType(@ResponseType int type)`. Il n’y a pas de remplacement; seul le flux Code + PKCE est pris en charge par la v2.
* `start(activity: Activity, callback: AuthCallback, requestCode: Int)` a été retirée. Utilisez plutôt `start(activity: Activity, callback: Callback<Credentials, AuthenticationException>)`.

#### Méthodes WebAuthProvider.LogoutBuilder retirées

* `start(context: Context, callback: VoidCallback)`. Utilisez plutôt `start(context: Context, callback: Callback<Void, AuthenticationException>)`.

#### Méthodes WebAuthProvider retirées

* `init(account: Auth0)` a été retirée. Utilisez plutôt `login(account: Auth0)`.
* `init(context: Context)` a été retirée. Utilisez plutôt `login(account: Auth0)`.
* `resume(requestCode: Int, resultCode: Int, intent: Intent)` a été retirée. Utilisez plutôt `resume(intent: Intent)`.
* `init(account: Auth0)` a été retirée. Utilisez plutôt `login(account: Auth0)`.

#### Méthodes ParameterBuilder retirées

* `setDevice("{DEVICE}")` a été retirée. Utilisez plutôt `set("device", "{VALUE}")`.

#### Les méthodes UsersAPIClient ont été modifiées

* `setUserAgent(String)` a été retirée. Vous pouvez définir que les en-têtes soient envoyés directement à chaque instance de requête en utilisant la méthode `addHeader("{NAME}", "{VALUE}")`, ou de manière globale à l’instance du client réseau via le paramètre de constructeur `DefaultClient(defaultHeaders = mapOf())`.

Les méthodes qui renvoyaient une `ParameterizableRequest` renvoient désormais une `Request` :

* `link("{PRIMARY-USER-ID}", "{SECONDARY-TOKEN}")`
* `unlink("{PRIMARY-USER-ID}", "{SECONDARY-USER-ID}", "{SECONDARY-PROVIDER}")`
* `updateMetadata("{USER-ID}", userMetadata)`
* `getProfile("{USER-ID}")`

#### Les méthodes RequestFactory ont été retirées ou modifiées

La classe `RequestFactory` contient des méthodes pour faciliter les requêtes HTTP, notamment par la sérialisation et désérialisation du corps et de la réponse de la requête JSON. Cette classe du package `com.auth0.android.request.internal` n’est pas conçue pour une utilisation publique. Toutefois, en tant que type public, vous trouverez un aperçu des modifications ci-dessous.

* Toutes les méthodes de requête ont été remaniées pour ne pas dépendre d’une bibliothèque de requêtes HTTP particulière (p. ex.,`OkHttp`)
* Toutes les méthodes de requête renvoient désormais une `Request`.
* Toutes les méthodes de requête sont désormais en lettres minuscules (p. ex., `POST()` –> `post()`).
* La méthode `authenticationPOST` a été retirée sans être remplacée, car toutes les instances `Request` peuvent être paramétrées avec n’importe quel en-tête selon les besoins.

#### Les méthodes ProfileRequest ont été modifiées

* La méthode `addParameters` a désormais besoin d’une valeur « Map of String to String », plutôt que « String to Object » (`addParameters(mapOf("key" to "val"))`)

#### Les méthodes SignUpRequest ont été modifiées

Les méthodes qui définissaient des paramètres nécessitent désormais une valeur « Map of String to String », au lieu de « String to Object » :

* `addAuthenticationParameters(mapOf("key" to "val"))`
* `addSignupParameters(mapOf("key" to "val"))`
* `addParameters(mapOf("key" to "val"))`

De plus, `setDevice("device")` a été retirée. Utilisez plutôt `addParameter("device", "{VALUE}")`.