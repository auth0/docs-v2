---
title: "Importer les inscriptions des utilisateurs à l’authentifiant MFA"
permalink: "import-user-mfa-authenticator-enrollments"
'description': "Cette section décrit comment importer les inscriptions à la MFA de vos utilisateurs existants."
'og:title': "Importer les inscriptions des utilisateurs à l’authentifiant MFA"
'og:description': "Cette section décrit comment importer les inscriptions à la MFA de vos utilisateurs existants."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Importer les inscriptions des utilisateurs à l’authentifiant MFA"
'twitter:description': "Cette section décrit comment importer les inscriptions à la MFA de vos utilisateurs existants."
---

Vous pouvez importer les inscriptions à la <Tooltip href="/docs/fr-ca/glossary?term=multifactor-authentication" tip="Authentification multifacteur (MFA)
Processus d’authentification de l’utilisateur qui utilise un facteur en plus du nom d’utilisateur et du mot de passe, tel qu’un code par SMS." cta="Voir le glossaire">MFA</Tooltip> d’un utilisateur avec une [migration automatique](/docs/fr-ca/manage-users/user-migration/configure-automatic-migration-from-your-database) et des [importations d’utilisateurs en masse](/docs/fr-ca/manage-users/user-migration/bulk-user-imports). Les types d’inscription pris en charge sont :

* Courriel : pour la vérification par courriel.
* Téléphone : pour la vérification par SMS
* OTP : pour les mots de passe à usage unique (OTP) utilisés avec des applications d’authentification, telles que Google Authenticator.

L’importation des inscriptions à la MFA offre une expérience utilisateur fluide, car les utilisateurs n’auront pas à se réinscrire après la migration.

L’expérience de connexion classique ne prend pas en charge la sélection de facteurs pour les utilisateurs ayant plusieurs facteurs. Si vous prévoyez d’importer des utilisateurs avec plusieurs facteurs enregistrés, envisagez d’utiliser l’expérience de [connexion universelle](/docs/fr-ca/authenticate/login/auth0-universal-login) .

## Schéma

Le schéma s’applique aux facteurs MFA pour les deux flux de production suivants.

```json lines expandable
{
    "type": "array",
    "items": {
        "type": "object",
        "properties": {
            "totp": {
                "type": "object",
                "properties": {
                "secret": {
                    "type": "string",
                        "pattern": "^[A-Z2-7]+$",
                        "description": "The OTP secret is used for MFA authentication with Google Authenticator type apps. It must be supplied in un-padded Base32 encoding, such as: JBTWY3DPEHPK3PNP"
                    },
                },
                "additionalProperties": false,
                "required": ["secret"],
            },
            "phone": {
                "type": "object",
                "properties": {
                "value": {
                    "type": "string",
                    "pattern": "^\\+[0-9]{1,15}$",
                    "description": "The phone number for SMS or Voice MFA. The phone number should include a country code and begin with +, such as: +12125550001"
                },
                },
                "additionalProperties": false,
                "required": ["value"],
            },
            "email": {
                "type": "object",
                "properties": {
                    "value": {
                        "type": "string",
                        "format": "email",
                        "description": "The email address for MFA"
                    },
                },
                "additionalProperties": false,
                "required": ["value"],
            },
        },
        "maxProperties": 1,
        "additionalProperties": false,
    },
    "minItems": 1,
    "maxItems": 10
}
```

## Migration automatique

Les inscriptions à la MFA peuvent aussi être importées lors d’une [migration automatique](/docs/fr-ca/connections/database/custom-db/overview-custom-db-connections#automatic-migration-scenario). Vous pouvez le faire en indiquant toutes les inscriptions existantes dans le champ `mfa_factors` de l’utilisateur fourni au rappel à la fin de votre [script de connexion](/docs/fr-ca/authenticate/database-connections/custom-db/templates/login)à la base de données personnalisé.

Tous les échecs figureront dans vos journaux de locataire en tant qu’échecs de connexion et se distingueront des autres échecs par leur description : `Impossible d’importer les facteurs MFA.`. Par exemple :

```json lines
{
  "_id": "5e9df3b29ebabe00571c04a7",
  "date": "2020-04-20T19:10:42.916Z",
  "type": "fu",
  "description": "Unable to import MFA factors.",
  "connection": "Username-Password-Authentication",
  "connection_id": "con_mMkvaycgzgCS0p0z",
  "client_id": "aCbTAJNi5HbsjPJtRpSP6BIoLPOrSj2Cgg",
  "client_name": "All Applications",
  "ip": "10.12.13.1",
  "client_ip": null,
  "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36",
  "details": {
    "error": {
      "message": "Unable to import MFA factors."
    }
  },
  "user_name": "test@test.io",
  "strategy": "auth0",
  "strategy_type": "database"
}
```

## Importation d’utilisateurs en masse

1. Préparez un fichier `users.json` . Consultez les [importations d’utilisateurs en masse](/docs/fr-ca/manage-users/user-migration/bulk-user-imports) pour obtenir plus de détails.
2. Incluez les inscriptions à la MFA existantes pour chaque utilisateur.
3. Commencez une importation d’utilisateurs en masse.
4. Mettez à jour les facteurs de tout utilisateur existant en activant l’option `upsert` dans votre demande initiale.
5. Une fois l’importation terminée, vérifiez que la réponse ne contient pas d’erreurs. Si l’importation de l’un des facteurs MFA des utilisateurs a échoué, vous verrez des erreurs telles que :

Lorsque vous utilisez l’option `upsert` ,toutes les mises à jour non liées à la MFA des utilisateurs existants auront été appliquées au profil de l’utilisateur. Par exemple, le résumé des erreurs suivant montre que l’attribut `picture` de l’utilisateur a été correctement défini sur `http://example.org/jdoe.png`, cependant nous n’avons pas pu importer les facteurs MFA fournis. Dans des cas comme celui-ci, il est possible de réessayer l’importation pour les utilisateurs qui n’ont pas été importés.

```json lines expandable
[
  {
    "user": {
      "email": "antoinette@contoso.com",
      "picture": "http://example.org/jdoe.png",
      "mfa_factors": [
        {
          "totp": {
            "secret": "2PRXZWZAYYDAWCD"
          }
        },
        {
          "phone": {
            "value": "+15551112233"
          }
        },
        {
          "email": {
            "value": "antoinette@antoinette.biz"
          }
        }
      ]
    },
    "errors": [
      {
        "code": "MFA_FACTORS_FAILED",
        "message": "Unable to import factors"
      }
    ]
  }
]
```

## Code de récupération

Auth0 ne propose pas de moyen d’importer des codes de récupération. Lorsque les facteurs MFA de l’utilisateur sont importés, aucun code de récupération n’est attribué à l’utilisateur.

Pour fournir un code de récupération aux utilisateurs, vous pouvez vérifier s’ils en ont un enregistré et, si ce n’est pas le cas, utilisez le [point de terminaison de régénération de code de récupération](/docs/fr-ca/api/management/v2#!/Users/post_recovery_code_regeneration) pour en générer un nouveau.

## En savoir plus

* [Configurer la migration automatique à partir de votre base de données](/docs/fr-ca/manage-users/user-migration/configure-automatic-migration-from-your-database)
* [Importation d’utilisateurs par lot](/docs/fr-ca/manage-users/user-migration/bulk-user-imports)