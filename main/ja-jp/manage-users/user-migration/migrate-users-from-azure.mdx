---
title: "Azureからユーザーを移行する"
permalink: "migrate-users-from-azure"
'description': "AzureからAuth0にユーザーを移行する方法"
'og:title': "Azureからユーザーを移行する"
'og:description': "AzureからAuth0にユーザーを移行する方法"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Azureからユーザーを移行する"
'twitter:description': "AzureからAuth0にユーザーを移行する方法"
---

Auth0は、Azureからのユーザーインポートに対応しています。Auth0の[カスタムDBログインスクリプト](/ja-jp/authenticate/database-connections/custom-db/templates/login)内にある[Azure AD ROPCフロー](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth-ropc)を使用します。

1. アプリ内のそれぞれのテナントまたはディレクトリで、**パブリッククライアント** として[パブリッククラウドアプリの登録を作成](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)したら、APIの呼び出し用に提供されるクライアントIDとクライアントシークレットを安全に保管してください。
2. このアプリケーションは誰が利用可能であるのか、またはこのアプリに誰がアクセス可能なのかを尋ねられたら、**任意の組織ディレクトリのアカウント** を選択します。
3. Microsoft Graphセクションで、`［Directory.Read.All］`および`［User.Read］`に許可を与えます。
4. アプリがB2Cの場合、[Microsoft Entra ID B2C内で、リソースオーナーのパスワード資格情報フローをセットアップします](https://learn.microsoft.com/en-us/azure/active-directory-b2c/add-ropc-policy?tabs=app-reg-ga&pivots=b2c-user-flow)。

これで、ROPCフローが利用できるようになりました。以下は、呼び出し例の抜粋です。

##### Microsoft Entra IDログインスクリプトのテンプレート：

```javascript lines
function login(email, password, callback) {
      const axios = require('axios').default;
      const qs = require('qs');
    	const jwtDecode = require('jwt-decode').default;

       const data = { 'client_id': {{YOUR_AZURE_APP_CLIENT_ID}},
             'scope': 'user.read openid profile offline_access',
             'username': email,
             'password': password,
             'grant_type': 'password',
             'client_secret': {{YOUR_AZURE_APP_CLIENT_SECRET}}
             };
const options = {
  method: 'POST',
  headers: { 'content-type': 'application/x-www-form-urlencoded' },
  data: qs.stringify(data),
  url: 'https://login.microsoftonline.com/{{AZURE_TENANT_ID}}/oauth2/v2.0/token',
};

axios(options).then(
	response => {
  // in a production setting it would be best to validate this JWT fully before reading claims
  const claims = jwtDecode(response.data.id_token);

  if (response.statusCode === 401) return callback();

  callback(null, {
  // this is a simple example of properties that can be mapped back to the auth0 user profile
  // you are free to choose exactly what maps back over based on what data you get from the azure token
  user_id: claims.sub,
  nickname: claims.name,
  email: claims.preferred_username
});

}
      );

    }
```

##### B2Cログインスクリプトのテンプレート：

```javascript lines
function login(email, password, callback) {
      const axios = require('axios').default;
      const qs = require('qs');
    	const jwtDecode = require('jwt-decode').default;

       const data = { 'client_id': {{YOUR_B2C_APP_CLIENT_ID}},
             'scope': 'openid {{YOUR_B2C_APP_CLIENT_ID}} offline_access profile',
             'username': email,
             'password': password,
             'grant_type': 'password',
             };
const options = {
  method: 'POST',
  headers: { 'content-type': 'application/x-www-form-urlencoded' },
  data: qs.stringify(data),
  url: 'https://{{TENANT_NAME}}.b2clogin.com/{{TENANT_NAME}}.onmicrosoft.com/{{B2C_POLICY_NAME}}/oauth2/v2.0/token',
};

axios(options).then(
	response => {
  // in a production setting it would be best to validate this JWT fully before reading claims
  const claims = jwtDecode(response.data.access_token);
  if (response.statusCode === 401) return callback();

  callback(null, {
  // this is a simple example of properties that can be mapped back to the auth0 user profile
  // you are free to choose exactly what maps back over based on what data you get from the azure token
  user_id: claims.sub,
  nickname: claims.given_name,
  email: claims.emails[0]
});
}
      );
    }
```

