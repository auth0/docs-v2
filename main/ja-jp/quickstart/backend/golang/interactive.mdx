---
title: "Goアプリケーションに認可を追加する"
permalink: "interactive"
'description': "このチュートリアルは、Go APIに認可を追加する方法を説明します。"
'og:title': "Goアプリケーションに認可を追加する"
'og:description': "このチュートリアルは、Go APIに認可を追加する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/golang.png"
'twitter:title': "Goアプリケーションに認可を追加する"
'twitter:description': "このチュートリアルは、Go APIに認可を追加する方法を説明します。"
sidebarTitle: Go API
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Jwt from "/snippets/quickstart/backend/golang/jwt.go.mdx";
import Main from "/snippets/quickstart/backend/golang/main.go.mdx";

export const sections = [
  { id: "アクセス許可を定義する", title: "アクセス許可を定義する" },
  { id: "依存関係をインストールする", title: "依存関係をインストールする" },
  { id: "アプリケーションを構成する", title: "アプリケーションを構成する" },
  { id: "アクセストークンを検証するミドルウェアを作成する", title: "アクセストークンを検証するミドルウェアを作成する" },
  { id: "apiエンドポイントを保護する", title: "APIエンドポイントを保護する" }
]

<Recipe>
  <Content>
    このガイドは、新規または既存のGo APIアプリケーションに[go-jwt-middleware](https://github.com/auth0/go-jwt-middleware)パッケージを使ってAuth0を統合する方法を説明します。

    Auth0 DashboardでAPIをまだ作成していない場合は、対話型のセレクターを使ってAuth0 APIを新規作成します。そうでない場合は、プロジェクトに既存のAPIを選択することができます。

    Auth0 Dashboardを使って初めてAPIをセットアップする場合には、使用の開始ガイドを確認してください。

    それぞれのAuth0 APIにはAPI識別子があり、アプリケーションにアクセストークンの検証で使用されます。

    <Info>
    **Auth0を初めてご利用ですか？** Auth0の仕組みと、OAuth 2.0フレームワークを用いたAPI認証と認可の実装について説明します。
    </Info>

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      アクセス許可は、ユーザーの代わりに、提供されたアクセストークンを使ってどのようにしてリソースにアクセスできるのかを定義できるようにします。たとえば、ユーザーがマネージャーアクセスレベルを持つ場合には、`messages`リソースに対して読み取りアクセスを付与し、管理者アクセスレベルを持つ場合には、書き込みアクセスを付与することができます。

      Auth0 Dashboardの[［API］](https://manage.auth0.com/#/apis)セクションにある**［Permissions（権限）］** ビューで使用可能なアクセス許可を定義することができます。以下の例では`read:messages`スコープを使用します。

      <Frame>![［Auth0 Dashboard］>［Applications（アプリケーション）］>［APIs］>［Specific API（特定のAPI］>［Permissions（権限）］タブ](/images/ja-jp/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/acef814282795bef6921535f044f96e9/Quickstarts_API.png)</Frame>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      `go.mod`ファイルを追加して、必要な依存関係をすべてリストします。

      <AuthCodeBlock icon="file-code" language="mod">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      次のシェルコマンドを実行して、依存関係をダウンロードします：

      <AuthCodeBlock icon="file-code" language="sh">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      アプリの構成を保存するために、`.env`ファイルをプロジェクトディレクトリのルート内に作成します。その後、環境変数を入力します：

      <AuthCodeBlock icon="file-code">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      `EnsureValidToken`ミドルウェア関数はアクセストークンを検証します。この関数は、保護したいすべてのエンドポイントに適用することができます。トークンが有効であれば、エンドポイントがリソースを開放します。トークンが無効であれば、APIが`401 Authorization`エラーを返します。

      受信する要求のアクセストークンを検証するには、**go-jwt-middleware** ミドルウェア をセットアップします。

      APIはデフォルトで、RS256をトークン署名アルゴリズムとしてセットアップします。RS256は秘密鍵と公開鍵のペアで機能するため、トークンはAuth0アカウントの公開鍵を使用して検証することができます。この公開鍵には、[https://{yourDomain}/.well-known/jwks.json](https://%7Byourdomain%7D/.well-known/jwks.json)でアクセスすることができます。

      トークンが要求されたリソースへのアクセスに十分な**スコープ** を持っているか確認する機能を含めてください。

      `HasScope`関数を作成して、応答を返す前に、アクセストークンに正しいスコープがあることを確認します。
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      この例では、`EnsureToken`ミドルウェアを使用しない`/api/public`エンドポイントを作成して、未認証の要求にも対応できるようにします。

      `EnsureToken`ミドルウェアを必要とする`/api/private`エンドポイントを作成して、追加スコープのないアクセストークンを含む認証済み要求にのみ利用できるようにします。

      `EnsureToken`ミドルウェアと`HasScope`を必要とする`/api/private-scoped`エンドポイントを作成して、`read:messages`スコープを付与されたアクセストークンを含む認証済み要求にのみ利用できるようにします。

      <Info>
      `read:messages`スコープのみが`HasScope`関数で検査されます。状況に応じて、複数のスコープを受け付けるように拡張するか、スタンドアローンのミドルウェアにすることをお勧めします。
      </Info>

      ### APIを呼び出す

      APIを呼び出すにはアクセストークンが必要です。テスト用のアクセストークンは、[API設定](https://manage.auth0.com/#/apis)の**［Test（テスト）］** ビューから取得することができます。

      <Frame>![［Auth0 Dashboard］>［Applications（アプリケーション）］>［API］>［Specific API（特定のAPI］>［Test（テスト）］タブ](/images/ja-jp/cdy7uua7fh8z/6jeVBuypOGX5qMRXeJn5ow/dd20eb74e1e9079287762ce33dcf8e2d/Quickstart_Example_App_API.png)</Frame>

      要求の`Authorization`ヘッダーにアクセストークンを指定します。

      <CodeGroup>
      <AuthCodeBlock filename="cURL" icon="file-code" language="bash" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="C#" icon="file-code" language="csharp" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Go" icon="file-code" language="go" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Java" icon="file-code" language="java" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Node.JS" icon="file-code" language="javascript" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Obj-C" icon="file-code" language="obj-c" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="PHP" icon="file-code" language="php" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Python" icon="file-code" language="python" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Ruby" icon="file-code" language="ruby" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      <AuthCodeBlock filename="Swift" icon="file-code" language="swift" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>
      </CodeGroup>

      

      <Note>
      ##### チェックポイント
      アプリケーションの構成が完了したら、アプリケーションを実行して次の点を確認します：
      GET /api/publicが認証を必要としない要求に使用できる。
      GET /api/privateが認証された要求に使用できる。
      GET /api/private-scopedがread:messagesスコープが付与されたアクセストークンを含む認証された要求に使用できる。
      </Note>
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [go-jwt-middleware SDK](https://github.com/auth0/go-jwt-middleware) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
      <CodeGroup>
        <Jwt />
        <Main />
      </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
        <Main />
        <Jwt />
      </CodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
