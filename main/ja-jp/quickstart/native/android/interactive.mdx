---
title: "Androidアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドでは、AndroidアプリケーションにAuth0 Android SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "Androidアプリケーションにログインを追加する"
'og:description': "このガイドでは、AndroidアプリケーションにAuth0 Android SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/android.png"
'twitter:title': "Androidアプリケーションにログインを追加する"
'twitter:description': "このガイドでは、AndroidアプリケーションにAuth0 Android SDKを使ってAuth0を統合する方法を説明します。"
sidebarTitle: Android
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";


import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Build from "/snippets/quickstart/native/android/build.gradle.mdx";
import Build2 from "/snippets/quickstart/native/android/build.gradle2.mdx";
import Strings from "/snippets/quickstart/native/android/strings.xml.mdx";
import Mainactivity from "/snippets/quickstart/native/android/MainActivity.kt.mdx";
import Mainactivity2 from "/snippets/quickstart/native/android/MainActivity.kt2.mdx";
import Mainactivity3 from "/snippets/quickstart/native/android/MainActivity.kt3.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-android-sdkをインストールする", title: "Auth0 Android SDKをインストールする" },
  { id: "マニフェストのプレースホルダーを追加する", title: "マニフェストのプレースホルダーを追加する" },
  { id: "アプリケーションを構成する", title: "アプリケーションを構成する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" },
  { id: "ユーザープロファイル情報を表示する", title: "ユーザープロファイル情報を表示する" }
]

<Recipe>
  <Content>
      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、プロジェクトに認証を構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0 APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0によって認証後のユーザーをダイレクトするアプリケーションURLです。この値を設定していない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`demo://{yourDomain}/android/YOUR_APP_PACKAGE_NAME/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0によってログアウト後のユーザーをリダイレクトするアプリケーションURLです。この値を設定していない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`demo://{yourDomain}/android/YOUR_APP_PACKAGE_NAME/callback`に設定してください。
      </Info>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      [Auth0 Android](https://github.com/auth0/Auth0.Android) SDKをプロジェクトに追加します。ライブラリーはAuth0のAuthentication APIとManagement APIに要求を行います。

      アプリの`build.gradle`依存関係セクションで、以下を追加します。

      <AuthCodeBlock icon="file-code">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      AndroidとKotlinのプラグインのそれぞれに対して、Java 8+バイトコードをターゲットにするようにします。
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      SDKにはマニフェストのプレースホルダーが必要です。Auth0は内部でプレースホルダーを使用して、認証のCallback URLを捉える`intent-filter`を定義します。Auth0テナントのドメインとCallback URLスキームを設定する必要があります。

      アクティビティーに特別な`intent-filter`を宣言する必要はありません。これは、マニフェストのプレースホルダーをAuth0**ドメイン** と**スキーム** の値で定義したため、ライブラリーがリダイレクトを処理します。

      <Info>
      ここでは、`auth0Scheme`に`demo`の値を使用したため、カスタムURLスキームをログイン後にAuth0がリダイレクトするURLに使用することができます。[Androidアプリのリンク](/ja-jp/applications/enable-android-app-links)を使用したい場合は、`https`を使用する方法もあります。この値の設定に関する詳細情報は、[Auth0.Android SDKのREADME](https://github.com/auth0/Auth0.Android#a-note-about-app-deep-linking)をお読みください。
      </Info>
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      SDKが正しく機能するためには、次のプロパティを`strings.xml`で設定しなければなりません：

      - `com_auth0_domain`：Auth0テナントのドメインです。通常、Auth0 Dashboardにあるアプリケーションの［Settings（設定）］の［Domain（ドメイン）］フィールドで確認できます。[カスタムドメイン](/ja-jp/custom-domains)を使用している場合は、その値を代わりに設定してください。
      - `com_auth0_client_id`：このクイックスタートで前にセットアップしたAuth0アプリケーションのIDです。Auth0 Dashboardにあるアプリケーションの［Settings（設定）］の［Client ID（クライアントID）］フィールドで確認できます。

      `AndroidManifest.xml`ファイルが`android.permissions.INTERNET`のアクセス許可を指定していることを確認します。

      <AuthCodeBlock icon="file-code" language="html">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      Android Studio内で**Sync Project with Gradle Files** を実行するか、コマンドラインから`./gradlew clean assembleDebug`を実行します。

      <Info>
      Gradleの使用に関する詳細は、[Gradleの公式のドキュメンテーション](https://gradle.org/getting-started-android-build/)を確認してください。
      </Info>
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      アプリケーションに認証をセットアップするには、[ユニバーサルログイン](/ja-jp/hosted-pages/login)が最も手軽な方法です。最良のエクスペリエンス、高い安全性、幅広い機能を活用するためにも、ユニバーサルログインの使用をお勧めします。

      `onCreate`メソッドで、`Auth0`クラスの新しいインスタンスを作成し、ユーザー資格情報を保持します。

      `loginWithBrowser`メソッドを作成し、`WebAuthProvider`クラスを使用して、[Auth0 Dashboard](https://manage.auth0.com/#/)のアプリケーションで有効にした接続で認証します。ここでは、初期設定の一部として`auth0Scheme`マニフェストのプレースホルダーで使用されたスキーム値を渡すことができます。

      `WebAuthProvider#start`関数を呼び出した後、ブラウザーが起動し、ログインページが表示されます。ユーザーが認証を行うと、Callback URLが呼び出されます。Callback URLには、認証プロセスの最終結果が含まれています。

      <Note>
      ##### チェックポイント
      loginWithBrowserを呼び出すアプリケーションにボタンを追加します。このボタンをクリックすると、AndroidアプリケーションによってAuth0ユニバーサルログインページにリダイレクトされ、ユーザー名とパスワードまたはソーシャルプロバイダーを使ってログインまたはサインアップできるようになったことを確認します。
      完了したら、Auth0がアプリにリダイレクトで戻すことを確認します。
      </Note>
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      `WebAuthProvider`を使用して、認証時にブラウザーで設定されたクッキーを削除すると、ユーザーは次回の認証試行時に、資格情報を再入力するよう求められます。

      `logout`メソッドをアプリに追加してユーザーのセッションを削除し、アプリからログアウトします。ここでは、初期設定の一部として`auth0Scheme`マニフェストのプレースホルダーで使用されたスキーム値を渡すことができます。

      `WebAuthProvider`クラスを使用して、ログアウトを実装します。この呼び出しによってブラウザーが開き、ユーザーはログアウトエンドポイントに移動されます。ユーザーがログアウトをキャンセルする場合は、ユーザーを前のURLにリダイレクトすることを検討してください。

      <Note>
      ##### チェックポイント
      logoutを呼び出し、ユーザーをアプリケーションからログアウトするアプリにボタンを追加します。このボタンをクリックすると、Androidアプリがユーザーをログアウトページにリダイレクトしてからもう一度リダイレクトで戻すこと、そして、アプリケーションにログインしていないことを確認します。
      </Note>
      </Section>

      <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      `AuthenticationAPIClient`クラスを使用して、[Auth0からユーザーのプロファイルを取得します](/ja-jp/users/user-profiles#user-profile-management-api-access)。これには以下のものが必要です。

      - ログインフェーズから返されるアクセストークン
      - `WebAuthProvider.login`に`profile`スコープが含まれる必要がある

      ユーザーのメールアドレスを取得する必要がある場合は、`email`スコープを指定する必要があります。

      <Info>
      このクイックスタートで、上のログイン手順中にデフォルトで`openid profile email`スコープが設定されます。
      </Info>

      以下に、ユーザーのプロファイルを取得して画面上に表示するために使用できる関数を示します。

      <Note>
      ##### チェックポイント
      ログイン後にshowUserProfile関数を呼び出します。onSuccessコールバックがユーザーのプロファイル情報を返すことを確認します。
      </Note>
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Auth0.Android SDK](https://github.com/auth0/Auth0.Android) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <CodeGroup>
          <Build />
          <Strings />
          <Mainactivity />
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <CodeGroup>
          <Build2 />
          <Strings />
          <Mainactivity />
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Strings />
          <Build />
          <Mainactivity />
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Mainactivity />
          <Build />
          <Strings />
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <CodeGroup>
          <Mainactivity2 />
          <Build />
          <Strings />
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <CodeGroup>
          <Mainactivity3 />
          <Build />
          <Strings />
        </CodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
