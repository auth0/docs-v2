---
title: "Android - Facebookログイン"
permalink: "interactive"
'description': "このチュートリアルは、ネイティブFacebookログインを使用して、Androidアプリケーションにユーザーログインを追加する方法について説明します。"
'og:title': "Android - Facebookログイン"
'og:description': "このチュートリアルは、ネイティブFacebookログインを使用して、Androidアプリケーションにユーザーログインを追加する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/android.png"
'twitter:title': "Android - Facebookログイン"
'twitter:description': "このチュートリアルは、ネイティブFacebookログインを使用して、Androidアプリケーションにユーザーログインを追加する方法について説明します。"
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Performloginsimplecallback from "/snippets/quickstart/native/android-facebook-login/performLogin + SimpleCallback.mdx";
import Oncreate from "/snippets/quickstart/native/android-facebook-login/onCreate.mdx";
import Fetchsessiontoken from "/snippets/quickstart/native/android-facebook-login/fetchSessionToken.mdx";
import Fetchuserprofile from "/snippets/quickstart/native/android-facebook-login/fetchUserProfile.mdx";
import Exchangetokens from "/snippets/quickstart/native/android-facebook-login/exchangeTokens.mdx";
import Performlogin from "/snippets/quickstart/native/android-facebook-login/performLogin.mdx";

export const sections = [
  { id: "システム要件", title: "システム要件" },
  { id: "始める前に", title: "始める前に" },
  { id: "facebookのアクセス許可を要求する", title: "Facebookのアクセス許可を要求する" },
  { id: "performloginメソッドを作成する", title: "performLoginメソッドを作成する" },
  { id: "performloginメソッドを呼び出す", title: "performLoginメソッドを呼び出す" },
  { id: "facebookを統合する", title: "Facebookを統合する" },
  { id: "facebookセッションアクセストークンを取得する", title: "Facebookセッションアクセストークンを取得する" },
  { id: "facebookのユーザープロファイルを取得する", title: "Facebookのユーザープロファイルを取得する" },
  { id: "auth0を統合する", title: "Auth0を統合する" },
  { id: "受け取ったデータをauth0トークンに交換する", title: "受け取ったデータをAuth0トークンに交換する" },
  { id: "performloginメソッドを更新する", title: "performLoginメソッドを更新する" }
]

<Recipe>
  <Content>
    このチュートリアルは、ネイティブFacebookログインを使用して、Androidアプリケーションにユーザーログインを追加する方法について説明します。ログインして、アカウント用に構成された例を参考にして、このクリックスタートに従うことをお勧めします。

        <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
        - Android Studio 3.6.1
        - Android SDK 25
        - Emulator - Nexus 5X - Android 6.0

        このチュートリアルは、[Facebook SDK](https://developers.facebook.com/docs/)でログインを実装する方法について説明します。​
        </Section>

        <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
        - [FacebookログインSDK](https://developers.facebook.com/docs/facebook-login/)をインストールして構成します。[https://developers.facebook.com](https://developers.facebook.com/)でFacebookアプリの作成プロセスも行います。**この手順が終了したら、Facebookログインが統合された状態でモバイルアプリが稼働しているはずです。**

        DashboardでFacebookネイティブサインインを使用するようにAuth0アプリケーションを構成します。「[Facebookログインをネイティブアプリに追加する](/ja-jp/connections/nativesocial/facebook)」を参照してください。**この手順が終了したら、アプリケーションはFacebookネイティブログインを実装できるようになります。**
        </Section>

        <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
        アプリケーションでは既にFacebookでサインインすることができますが、リッチユーザープロファイルを確保するには、Facebookログインボタンがセットアップされたアクセス許可を更新する必要があります。

        要求されたアクセス許可を`public_profile`と`email`に設定します。これで、アクセス要求がユーザーによって受け入れられたという前提で、ユーザーメールも応答の一部に含まれます。

        `loginButton.setPermissions(Arrays.asList("public_profile", "email"));`
        </Section>

        <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
        次に、Auth0で認証プロセスを始めるために、送信するペイロードの準備を行う新しいメソッドを作成します。

        内部コールバックを処理するために、小さなインターフェイスを利用します。

        サンプルでは、メソッドの名前は`performLogin`、インターフェイスの名前は`SimpleCallback`に指定されています。両方を追加してください。
        </Section>

        <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
        次に、Facebookログインのコールバックの`onSuccess`メソッドから特定のメソッドを呼び出します。
        </Section>

        <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
        Auth0でFacebookを使ってサインインすると、バックエンドはユーザーが主張する通りの本人であることを確認するために、バックグラウンドで確認作業を実施します。これを実現するには、セッションアクセストークンを提供する必要があります。

        さらに、このFacebookユーザーを表すために、ユーザーをAuth0で作成する必要がある場合、バックエンドでは姓名やメールなどの一部の情報が必要になります。Auth0ユーザープロファイルでは、メールは（提供された場合）未検証としてフラグが付けられます。

        セッションアクセストークンとユーザープロファイルを取得するには、Facebook APIに対してさらに2つの要求を行う必要があります。
        </Section>

        <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
        Facebook APIの`/oauth/access_token`エンドポイントに対して新しいGET要求を行います。以下のクエリパラメーターを使用します：

        - `grant_type`: `fb_attenuate_token`。
        - `fb_exchange_token`：ログイン時に受け取るアクセストークンです。
        - `client_id`：アプリIDです。この値は、Facebook開発者のダッシュボードから取得したもので、Facebookログインの統合に成功している場合は、アプリケーションで既に使用されているはずです。

        この手順で得たロジックを独自のメソッドに投入します。これを前に追加したメソッドから後で呼び出します。

        サンプルはFacebook SDKの`GraphRequest`クラスを使用して、この要求を実行します。
        </Section>

        <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
        上の手順と同様に、別のGET要求を行います。エンドポイントパスは、Facebookログイン結果から得たユーザーID値（`/904636746222815`など）になります。次のパラメーターを使用します：

        - `access_token`：ログイン時に受け取るアクセストークンです。
        - `fields`：応答で取得したいユーザープロファイルからのフィールドです。これらは、初めに構成されたFacebookログインボタンのアクセス許可に直接関連付けられています。アクセス許可が任意の場合、ユーザーはまずアクセス許可を付与することに同意する必要があります。Auth0でユーザーをサインアップするには、フルネームとメールを入力するだけで十分です。
        </Section>

        <Section id={sections[8].id} title={sections[8].title} stepNumber="9">
        必要なアーティファクトを取得したら、IDやアクセストークンなどAuth0のユーザー資格情報に交換する準備ができました。しかしまず、その最後の要求を行うためにAuth0 SDKをセットアップする必要があります。

        ### アプリケーションキーを取得する

        1. [Auth0 Dashboard](https://manage.auth0.com/)の**［Applications（アプリケーション）］** セクションで、**［Sign in with Facebook（Facebookでサインイン）］** を有効にした既存のアプリケーションを選択します。この手順で不明な点があれば、この記事の上に記載された要件セクションを確認してください。
        2. アプリケーションの設定ページから**［Domain（ドメイン）］** と**［Client ID（クライアントID）］** の値をコピーします。これらはSDKで必要です。
        3. Androidアプリケーションのstrings.xmlファイルで2つの新しいリソースを作成して保存します。キーの名前は以下で使用するキーと一致しなければなりません。

          <AuthCodeBlock icon="file-code">
          AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
          APP_BASE_URL='http://localhost:3000'
          AUTH0_DOMAIN='https://{USER_DOMAIN}'
          AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
          AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
          </AuthCodeBlock>

        ### Auth0 SDKをインストールする

        Androidアプリケーションで、この行をapp/build.gradleファイルに追加します：

        <AuthCodeBlock icon="file-code">
        AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
        APP_BASE_URL='http://localhost:3000'
        AUTH0_DOMAIN='https://{USER_DOMAIN}'
        AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
        AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
        </AuthCodeBlock>

        次に、Gradle Syncタスクを実行し、プロジェクトとその依存関係を更新します。

        ### Web認証のマニフェストを更新する

        アプリケーションがSDKによって提供されるWeb認証モジュールを利用する予定がない場合は、未使用のアクティビティをAndroidManifest.xmlファイルから削除し、マニフェストのプレースホルダー問題を防ぐ必要があります。これを実現するには、アクティビティの宣言を追加し、tools:node="remove"の注釈を加えます。

        <AuthCodeBlock icon="file-code">
        AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
        APP_BASE_URL='http://localhost:3000'
        AUTH0_DOMAIN='https://{USER_DOMAIN}'
        AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
        AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
        </AuthCodeBlock>

        ただし、Web認証をサポートする予定の場合は、[ここ](/ja-jp/libraries/auth0-android#authentication-via-universal-login)でマニフェストのプレースホルダーを宣言する方法を確認してください。
        </Section>

        <Section id={sections[9].id} title={sections[9].title} stepNumber="10">
        SDKは、使用する前にインスタンス化する必要があります。クラスレベルでフィールドを定義し、`onCreate`メソッドで初期化します。上の手順で定義した資格情報が`Auth0`コンストラクターに渡されたら、`AuthenticationAPIClient`の新しいインスタンスが作成されます。

        <AuthCodeBlock icon="file-code">
        AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
        APP_BASE_URL='http://localhost:3000'
        AUTH0_DOMAIN='https://{USER_DOMAIN}'
        AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
        AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
        </AuthCodeBlock>

        ロジックを維持するメソッドを作成し、取得した2つのアーティファクトをAuth0のユーザー資格情報に交換します。サンプルでは、このメソッドの名前は`exchangeTokens`です。

        APIクライアントは、トークンとサブジェクトタイプを受け取る`loginWithNativeSocialToken`メソッドを宣言します。前者はセッショントークンに対応し、後者はバックエンドが認証しようとする接続のタイプを示します。

        ネイティブFacebookログインでは、以下の値を使用します：`"http://auth0.com/oauth/token-type/facebook-info-session-access-token"`

        構成する必要がある他の値は、ユーザープロファイル（`user_profile`キーを使用）とAuth0トークンに含まれる要求されたスコープです。

        <Info>
        変化しないことを把握している値はすべて、クラスの上部で定数として維持しておくと便利です。サンプルは、件名トークンタイプ、Facebookのアクセス許可、およびAuth0のスコープに対して定数を利用します。Auth0のスコープの詳細については、特集記事をお読みください。
        </Info>
        </Section>

        <Section id={sections[10].id} title={sections[10].title} stepNumber="11">
        すべての手順が独自のメソッドで定義されたら、`performLogin`メソッドに全部まとめて入れましょう。

        すべて正常に実行されると、FacebookログインSDKでネイティブ認証ができるようになります。つまり、Facebookアプリがデバイスにインストールされていると、認証はブラウザーアプリでなくアプリケーションを介して処理されます。
        </Section>

    ## 次のステップ
    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    - [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します

    - [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Performloginsimplecallback/>
          <Oncreate/>
          <Fetchsessiontoken/>
          <Fetchuserprofile/>
          <Exchangetokens/>
          <Performlogin/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Oncreate/>
          <Performloginsimplecallback/>
          <Fetchsessiontoken/>
          <Fetchuserprofile/>
          <Exchangetokens/>
          <Performlogin/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <CodeGroup>
          <Oncreate/>
          <Performloginsimplecallback/>
          <Fetchsessiontoken/>
          <Fetchuserprofile/>
          <Exchangetokens/>
          <Performlogin/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[7].id}>
        <CodeGroup>
          <Fetchuserprofile/>
          <Performloginsimplecallback/>
          <Oncreate/>
          <Fetchsessiontoken/>
          <Exchangetokens/>
          <Performlogin/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[8].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[9].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[10].id}>
        <CodeGroup>
          <Performlogin/>
          <Performloginsimplecallback/>
          <Oncreate/>
          <Fetchsessiontoken/>
          <Fetchuserprofile/>
          <Exchangetokens/>
        </CodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
