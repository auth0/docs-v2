---
title: "Djangoアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドでは、Python DjangoアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "Djangoアプリケーションにログインを追加する"
'og:description': "このガイドでは、Python DjangoアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/python.png"
'twitter:title': "Djangoアプリケーションにログインを追加する"
'twitter:description': "このガイドでは、Python DjangoアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
mode: wide
sidebarTitle: Django
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import HTML from "/snippets/quickstart/webapp/django/templates-index.html.mdx";
import Settings from "/snippets/quickstart/webapp/django/settings.py.mdx";
import Urls from "/snippets/quickstart/webapp/django/urls.py.mdx";
import Views from "/snippets/quickstart/webapp/django/views.py.mdx";
import Views2 from "/snippets/quickstart/webapp/django/views.py2.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "依存関係をインストールする", title: "依存関係をインストールする" },
  { id: "envファイルを構成する", title: ".envファイルを構成する" },
  { id: "アプリケーションを作成する", title: "アプリケーションを作成する" },
  { id: "settings-pyを更新する", title: "settings.pyを更新する" },
  { id: "アプリケーションをセットアップする", title: "アプリケーションをセットアップする" },
  { id: "ルートハンドラーをセットアップする", title: "ルートハンドラーをセットアップする" },
  { id: "ルートを登録する", title: "ルートを登録する" },
  { id: "テンプレートを追加する", title: "テンプレートを追加する" },
  { id: "アプリケーションを実行する", title: "アプリケーションを実行する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加して、ユーザープロファイル情報にアクセスすることができます。このガイドでは、Python [Django](https://www.djangoproject.com/)アプリケーションに[Authlib](https://authlib.org/) SDKを使ってAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/dashboard/us/auth0-dsepaid/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000``/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      この統合では、さまざまなライブラリー依存関係（Authlibなど）を追加します。プロジェクトディレクトリに`requirements.txt`ファイルを作成し、以下を含めます：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>


      シェルから以下のコマンドを実行し、依存関係が利用できるようにします：

      <AuthCodeBlock icon="file-code" language="sh" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      次に、プロジェクトのディレクトリに`.env`ファイルを作成します。このファイルにはクライアントキーやその他の構成情報が含まれます。

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      セットアップ済みのDjangoアプリケーションがある場合は、次の手順へスキップしてください。新しいアプリケーションプロジェクトには、次のコマンドを実行します：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      新しいプロジェクトフォルダに変更します：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      `webappexample/settings.py`ファイルを開いて`.env`値を確認します。

      ファイルの上部に`os`インポートと`dotenv`インポートを追加します。

      次に、`BASE_DIR`定義の下に`TEMPLATE_DIR`変数を追加します。

      次に`TEMPLATES`変数を見付けて`DIRS`値を更新し、当社の`TEMPLATE_DIR`ストリングを追加します。これにより、後の手順で作成するテンプレートファイルのパスが定義されます。この配列のすべてのコンテンツは同じにしておいてください。

      ファイルの最後にAuth0の構成を読み込むコードを追加します。
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      アプリケーションの作成を始めるには、IDEで`webappexample/views.py`ファイルを開きます。

      アプリケーションに必要なすべてのライブラリーをインポートします。

      Auth0でアプリケーションの認証を処理するために、Authlibを構成できるようになりました。

      AuthlibのOAuth`register()`メソッドで使用できる構成オプションの詳細については、[Authlibのドキュメント](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      この例では、アプリケーションにlogin、callback、logout、indexの4つのルートを追加します。

      - `login` - アプリへの訪問者は`/login`ルートを訪ねる時、Auth0に到達して認証フローを開始します。
      - `callback` -
                ユーザーはAuth0でログインを完了した後、`/callback`ルートでアプリケーションに戻ります。このルートはユーザーのためにセッションを保存し、戻ってきた時に再度ログインする必要性を回避します。
      - `logout` -
                `/logout`ルートは、ユーザーをアプリケーションからサインアウトさせます。アプリのユーザーセッションを消去し、Auth0ログアウトエンドポイントにリダイレクトして、セッションがもう保存されていないことを保証します。その後、アプリケーションは、ユーザーをホームルートにリダイレクトします。
      - `index` - ホームルートは認証されたユーザーの詳細を表示したり、訪問者のサインインを許可したりします。
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
      `webappexample/urls.py`ファイルのコンテンツを右のコードに置き換えて、新規ルートに接続します。

      これにより`/login`、`/callback`、`/logout`、`/`のルートが正しいハンドラーへルートされます。
    </Section>

    <Section id={sections[8].id} title={sections[8].title} stepNumber="9">
      次に、ホームページルートで使用するテンプレートファイルを作成します。

      `templates`と名付けた`webappexample`フォルダー内に新しいサブディレクトリを作成し、`index.html`ファイルを作成します。

      `index.html`ファイルにはテンプレートコードが含まれており、ログインした際にユーザー情報を表示したり、ログアウトした際にログインボタンを表示したりします。
    </Section>

    <Section id={sections[9].id} title={sections[9].title} stepNumber="10">
      アプリケーションを実行する準備ができました。プロジェクトディレクトリからシェルを開き、以下を使用します：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>


      アプリケーションは、[http://localhost:3000](http://localhost:3000)でブラウザーから開けるようになっています。

      <Note>
      ##### チェックポイント

      [http://localhost:3000](http://localhost:3000/)を訪問して、確認します。ログインのためにAuth0へルートするログインボタンがあり、ログイン後アプリケーションに戻るとプロファイル情報を確認できます。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <CodeGroup>
        <HTML/>
        <Settings/>
        <Urls/>
        <Views/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <CodeGroup>
        <Views/>
        <HTML/>
        <Settings/>
        <Urls/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <CodeGroup>
        <Views2/>
        <HTML/>
        <Settings/>
        <Urls/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[7].id}>
      <CodeGroup>
        <Urls/>
        <HTML/>
        <Settings/>
        <Views/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[8].id}>
      <CodeGroup>
        <HTML/>
        <Settings/>
        <Urls/>
        <Views/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[9].id}>
      <SignUpForm />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
