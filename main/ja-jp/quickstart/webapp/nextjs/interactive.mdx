---
title: "Next.jsアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、新規または既存のNext.jsアプリケーションにAuth0 Next.js SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "Next.jsアプリケーションにログインを追加する"
'og:description': "このガイドは、新規または既存のNext.jsアプリケーションにAuth0 Next.js SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/nginx-plus.png"
'twitter:title': "Next.jsアプリケーションにログインを追加する"
'twitter:description': "このガイドは、新規または既存のNext.jsアプリケーションにAuth0 Next.js SDKを使ってAuth0を統合する方法を説明します。"
sidebarTitle: Next.js
mode: wide
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import ConfigureSDK from "/snippets/quickstart/webapp/nextjs/configure-the-sdk.mdx"
import CreateAuth0SDKClient from "/snippets/quickstart/webapp/nextjs/create-the-auth0-sdk-client.mdx"
import CreateLoginPage from "/snippets/quickstart/webapp/nextjs/create-a-login-page.mdx"
import AddLandingPageContent from "/snippets/quickstart/webapp/nextjs/add-the-landing-page-content.mdx"

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-next-js-sdkをインストールする", title: "Auth0 Next.js SDKをインストールする" },
  { id: "sdkを構成する", title: "SDKを構成する" },
  { id: "動的ルートハンドラーを追加する", title: "動的ルートハンドラーを追加する" },
  { id: "userproviderコンポーネントを追加する", title: "UserProviderコンポーネントを追加する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" }
]

<Recipe>
  <Content>
    このガイドは、新規または既存のNext.jsアプリケーションにAuth0 Next.js SDKを使ってAuth0を統合する方法を説明します。アカウント用に構成された例を参考にして、このクイックスタートに従うことをお勧めします。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻されません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/auth/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      プロジェクトディレクトリで次のコマンドを実行して、Auth0 Next.js SDKをインストールします：

      <AuthCodeBlock icon="file-code" language="bash" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      SDKは、Auth0をNext.jsアプリケーションに統合するのに役立つメソッドと変数を公開します。この際、バックエンドでは[ルートハンドラー](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)を、フロントエンドでは[Reactフック](https://reactjs.org/docs/hooks-overview.html)が付いた[Reactコンテキスト](https://reactjs.org/docs/context.html)を使用します。
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      プロジェクトのルートディレクトリで、`.env.local`ファイルを追加し、以下の[変数環境](https://nextjs.org/docs/basic-features/environment-variables)を設定します：

      - `AUTH0_SECRET`：セッションクッキーの暗号化に使用する長いシークレット値です。適した文字列は、コマンドラインの`openssl rand -hex 32`で生成できます。
      - `AUTH0_BASE_URL`：アプリケーションのベースURLです。
      - `AUTH0_ISSUER_BASE_URL`：Auth0テナントドメインのURLです。[Auth0を使用したカスタムドメイン](/ja-jp/custom-domains)では、この値を［Settings（設定）］タブに反映された値でなく、カスタムドメインの値に設定します。
      - `AUTH0_CLIENT_ID`：Auth0アプリケーションのクライアントIDです。
      - `AUTH0_CLIENT_SECRET`：Auth0アプリケーションのクライアントシークレットです。

      SDKは、Node.jsプロセス環境からこれらの値を読み取り、自動構成します。
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      <Info>
      このクイックスタートは、Next.js[アプリルーター](https://nextjs.org/docs/app)を取り扱います。[ページルーター](https://nextjs.org/docs/pages)を使用している場合は、SDKの[README](https://github.com/auth0/nextjs-auth0#page-router)の例を確認してください。
      </Info>

      `app/api/auth/[auth0]/route.js`でファイルを作成します。これは、[動的ルートセグメント](https://nextjs.org/docs/app/building-your-application/routing/route-handlers#dynamic-route-segments)を持つルートハンドラーです。

      次に、SDKから`handleAuth`メソッドをインポートし、`GET`エクスポートから呼び出します。これで、以下のルートが作成されます。

      - `/api/auth/login`：Auth0でログインを実行するために使用されるルートです。
      - `/api/auth/logout`：ユーザーをログアウトするために使用されるルートです。
      - `/api/auth/callback`：ログインに成功した後、Auth0がユーザーをリダイレクトするルートです。
      - `/api/auth/me`：ユーザープロファイルを取得するためのルートです。
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      フロントエンド側では、SDKはReact Contextを使用して、ユーザーの認証状態を管理します。その状態をすべてのページで使用できるようにするには、[Root
              Layoutコンポーネント](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#root-layout-required)を上書きし、`app/layout.jsx`ファイルで`<body>`タグを`UserProvider`でラップする必要があります。

      `UserProvider`によって公開された認証状態は、`useUser()`フックを使って任意のクライアントコンポーネントでアクセスすることができます。

      <Note>
      ##### チェックポイント

      ルートハンドラーと`UserProvider`を追加したら、アプリケーションを実行してAuth0に関連したエラーを投入していないか確認します。
      </Note>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      ユーザーはSDKによって提供された`/api/auth/login`ルートハンドラーを訪れることで、アプリケーションにログインできるようになりました。**アンカータグ** を使ってログインルートを指すリンクをクリックします。クリックするとユーザーはAuth0ユニバーサルログインページにリダイレクトされ、そこで、Auth0はユーザーを認証することができます。認証に成功したら、Auth0はユーザーをアプリケーションにリダイレクトで戻します。

      <Info>
      ログアウトの機能性はすでに`src/app/page.tsx`ファイルに含まれています。ユーザーが**［Log
                        out（ログアウト）］**ボタンを選択すると、Auth0のログアウトエンドポイントにリダイレクトされ、セッションの消去後にアプリにリダイレクトで戻されます。
      </Info>

      <Note>
      ##### チェックポイント

      アプリケーションにログインリンクを追加する

      - ログインリンクをクリックすると、Next.jsアプリケーションによって[Auth0ユニバーサルログイン](https://auth0.com/universal-login)ページにリダイレクトされ、ユーザー名とパスワードまたはソーシャルプロバイダーを使ってログインまたはサインアップできるようになったことを確認します。
      - 完了したら、Auth0がアプリケーションにリダイレクトで戻すことを確認します。
      </Note>

      <Frame>
        <img src="/images/ja-jp/cdy7uua7fh8z/7L6lZ6xCi1L7sJBFZUPb9g/1012d2df62dd58a943f75092452f91d2/Login_Screen_-_Japanese.png" />
      </Frame>

      <Info>
      Auth0は、Googleソーシャルプロバイダーを新しいテナントでデフォルトで有効にし、[ソーシャルIDプロバイダー](/ja-jp/connections/identity-providers-social)でログインテストを実施するための開発者キーを提供します。ただし、これらの開発者キーにはいくつかの制限が設けられており、これによってアプリケーションが異なる動作をする場合があります。この動作の様子と修正方法については、「[Auth0開発者キーを使ってソーシャル接続をテストする](/ja-jp/connections/social/devkeys#limitations-of-developer-keys)」ドキュメントを参照してください。
      </Info>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      Next.jsアプリケーションにログインできるようになったら、[ログアウトする方法](/ja-jp/logout/log-users-out-of-auth0)が必要です。`/api/auth/logout` APIルートを指すリンクを追加します。クリックするとユーザーは、[Auth0ログアウトエンドポイント](https://auth0.com/docs/api/authentication?javascript#logout)（`https://YOUR_DOMAIN/v2/logout`）にリダイレクトされ、即座にアプリケーションにリダイレクトで戻ります。

      <Note>
      ##### チェックポイント

      アプリケーションを実行する

      - Next.jsアプリケーションが[Auth0のユニバーサルログイン](https://auth0.com/universal-login)ページにリダイレクトし、ユーザー名とパスワードまたはソーシャルプロバイダーを使ってログインまたはサインアップできるようになったことを確認します。
      - 完了したら、Auth0がアプリケーションにリダイレクトで戻すことを確認します。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [nextjs-auth0 SDK](https://github.com/auth0/nextjs-auth0/) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <CodeGroup>
        <ConfigureSDK/>
        <CreateAuth0SDKClient/>
        <CreateLoginPage/>
        <AddLandingPageContent/>
      </CodeGroup>
    </SideMenuSectionItem>  

    <SideMenuSectionItem id={sections[3].id}>
      <CodeGroup>
        <CreateAuth0SDKClient/>
        <ConfigureSDK/>
        <CreateLoginPage/>
        <AddLandingPageContent/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <CodeGroup>
        <CreateLoginPage/>
        <ConfigureSDK/>
        <CreateAuth0SDKClient/>
        <AddLandingPageContent/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <CodeGroup>
        <AddLandingPageContent/>
        <ConfigureSDK/>
        <CreateAuth0SDKClient/>
        <CreateLoginPage/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <SignUpForm />
    </SideMenuSectionItem>
  </SideMenu>
</Recipe>
