---
title: "Laravelアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドでは、新規（または既存）のLaravel 9または10アプリケーションにAuth0を統合する方法を説明します。"
'og:title': "Laravelアプリケーションにログインを追加する"
'og:description': "このガイドでは、新規（または既存）のLaravel 9または10アプリケーションにAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/php.png"
'twitter:title': "Laravelアプリケーションにログインを追加する"
'twitter:description': "このガイドでは、新規（または既存）のLaravel 9または10アプリケーションにAuth0を統合する方法を説明します。"
sidebarTitle: Laravel
mode: wide
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Web from "/snippets/quickstart/webapp/laravel/web.php.mdx";
import Web2 from "/snippets/quickstart/webapp/laravel/web.php2.mdx";
import Web3 from "/snippets/quickstart/webapp/laravel/web.php3.mdx";

export const sections = [
  { id: "laravelをインストールする", title: "Laravelをインストールする" },
  { id: "sdkをインストールする", title: "SDKをインストールする" },
  { id: "sdkを構成する", title: "SDKを構成する" },
  { id: "ログイン経路", title: "ログイン経路" },
  { id: "アクセス制御", title: "アクセス制御" },
  { id: "ユーザー情報", title: "ユーザー情報" },
  { id: "ユーザー管理", title: "ユーザー管理" },
  { id: "アプリケーションを実行する", title: "アプリケーションを実行する" }
]

<Recipe>
  <Content>
    [Auth0のLaravel
          SDK](https://github.com/auth0/laravel-auth0)を使用すると、Laravelアプリケーションに認証、ユーザープロファイル管理、ルーティングに基づくアクセスコントロールを手軽に追加できます。このガイドでは、新規（または既存）の[Laravel
          9または10](https://github.com/auth0/laravel-auth0#support-policy)アプリケーションにAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      **Laravelアプリケーションをまだセットアップしていない場合** には、シェルを開いて、新規プロジェクトに適切なディレクトリに移動し、次のコマンドを実行します：

      ```sh wrap lines
      composer create-project --prefer-dist laravel/laravel auth0-laravel-app ^9.0
      ```

      このガイドにあるすべてのコマンドは、Laravelプロジェクトディレクトリのルートから実行されていることを前提としています。必ず新規プロジェクトのディレクトリに移動（`cd`）してください：

      ```sh lines
      cd auth0-laravel-app
      ```
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      プロジェクトディレクトリで次のコマンドを実行して、[Auth0 Laravel SDK](https://github.com/auth0/laravel-auth0)をインストールします：

      ```sh wrap lines
      composer require auth0/login:^7.8 --update-with-all-dependencies
      ```

      そして、アプリケーションにSDK構成ファイルを生成します：

      ```sh lines
      php artisan vendor:publish --tag auth0
      ```
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      プロジェクトディレクトリから次のコマンドを実行して、Auth0 CLIをダウンロードします：

      ```sh wrap lines
      curl -sSfL https://raw.githubusercontent.com/auth0/auth0-cli/main/install.sh | sh -s -- -b .
      ```

      そして、Auth0アカウントを使ってCLIを認証し、プロンプトでユーザーとしてログインすることを選択します：

      ```sh lines
      ./auth0 login
      ```

      次に、Auth0で新しいアプリケーションを作成します：

      ```sh lines
      ./auth0 apps create \
        --name "My Laravel Application" \
        --type "regular" \
        --auth-method "post" \
        --callbacks "http://localhost:8000/callback" \
        --logout-urls "http://localhost:8000" \
        --reveal-secrets \
        --no-input \
        --json > .auth0.app.json
      ```

      また、新しいAPIも作成します：

      ```sh lines
      ./auth0 apis create \
        --name "My Laravel Application's API" \
        --identifier "https://github.com/auth0/laravel-auth0" \
        --offline-access \
        --no-input \
        --json > .auth0.api.json
      ```

      これで、SDKを構成するプロジェクトディレクトリ内に2つのファイルが作成されます。

      これらのファイルには資格情報が保管されているため、機密として扱うことが重要です。必ず、バージョン管理では、これらのファイルをコミットしないようにしてください。Gitを使用している場合は、必ず`.gitignore`ファイルに追加します：

      ```sh lines
      echo ".auth0.*.json" >> .gitignore
      ```
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      SDKは、アプリケーションのユーザーを認証するために必要なすべての経路を自動的に登録します。

      これらについて細かな制御が必要な場合や、アプリケーションで既存の経路と競合する場合には、SDKのコントローラーを手動で登録することができます。高度な統合について、[SDKのREADME](https://github.com/auth0/laravel-auth0)を参照してください。
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Laravelの認証機能は「guards」を使用して、それぞれの要求でユーザーがどのように認証されるのかを定義します。アプリケーションの経路へのアクセスを制約するには、Auth0 SDKの認証ガードを使用することができます。

      経路へのアクセスに先だって、ユーザーの認証を要求するには、Laravelの`auth`ミドルウェアを使用することができます。

      ```text lines
      Route::get('/private', function () {
        return response('Welcome! You are logged in.');
      })->middleware('auth');
      ```

      また、これをLaravelの`can`ミドルウェアと組み合わせると、認証済みのユーザーに特定の[権限](/ja-jp/manage-users/access-control/rbac)を要求することができます。

      ```text lines
      Route::get('/scope', function () {
        return response('You have `read:messages` permission, and can therefore access this resource.');

      })->middleware('auth')->can('read:messages');
      ```
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      認証済みのユーザーについての情報は、Laravelの`Auth`ファサードまたは`auth()`ヘルパー関数を介して利用できます。

      以下は、ユーザーの識別子とメールアドレスを取得する例です。

      ```text lines
      Route::get('/', function () {
        if (! auth()->check()) {
        return response('You are not logged in.');

        }
        $user = auth()->user();
        $name = $user->name ?? 'User';
        $email = $user->email ?? '';
        return response("Hello {$name}! Your email address is {$email}.");
      });;
      ```
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      ユーザー情報は、[Auth0 Management
              API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md)を使用して更新することができます。管理エンドポイントはすべて、SDKの`management()`メソッドでアクセスすることができます。

      **Management APIを呼び出す前に、アプリケーションがManagement APIと通信できるようにしなければなりません。** これを実行するには、[Auth0
              DashboardのAPIページ](/ja-jp/%24%7Bmanage_url%7D#/apis)で`［Auth0 Management API］`を選択してから［Machine to Machine
            Applications（M2Mアプリケーション）］タブを選択します。Laravelアプリケーションを認可してから、下矢印をクリックして、付与したいスコープを選択します。

      以下の例では、ユーザーのメタデータを更新し、好きな色をランダムに割り当てますが、必ず`read:users`と`update:users`のスコープを付与するようにします。APIエンドポイントのリストと必要なスコープについては、[Management APIのドキュメント](https://auth0.com/docs/api/management/v2)を参照してください。

      ```text lines
      use Auth0\Laravel\Facade\Auth0;
      Route::get('/colors', function () {
      $endpoint = Auth0::management()->users();
      $colors = ['red', 'blue', 'green', 'black', 'white', 'yellow', 'purple', 'orange', 'pink', 'brown'];
      $endpoint->update(
      id: auth()-&gt;id(),

      body: [

          'user_metadata' =&gt; [

              'color' =&gt; $colors[random_int(0, count($colors) - 1)]

          ]

      ]

      );
      $metadata = $endpoint->get(auth()->id());
      $metadata = Auth0::json($metadata);
      $color = $metadata['user_metadata']['color'] ?? 'unknown';
      $name = auth()->user()->name;
      return response("Hello {$name}! Your favorite color is {$color}.");
      })->middleware('auth');
      ```

      SDKにあるManagement APIの全メソッドについては、[こちら](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md)にクイックリファレンスガイドがあります。
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
      Laravelアプリケーションを起動する準備が整いました。要求を受け付けることができます：

      ```text lines
      php artisan serve
      ```

      <Note>
      ##### チェックポイント

      ブラウザーを開いて、以下の経路にアクセスしてみてください。

      - [http://localhost:8000](http://localhost:8000/)（パブリックルートを確認する）
      - [http://localhost:8000/private](http://localhost:8000/private)（認証を促す）
      - [http://localhost:8000](http://localhost:8000/)（パブリックルートを確認する、今回は認証済み）
      - [http://localhost:8000/scope](http://localhost:8000/scope)（`read:messages`[permission](/ja-jp/manage-users/access-control/rbac)があるかを確認する）
      - [http://localhost:8000/update](http://localhost:8000/update)（ユーザープロファイルを更新する）
      - [http://localhost:8000/logout](http://localhost:8000/logout)（ログアウトする）
      </Note>

      ### その他の情報

      - [ユーザーリポジトリとモデル](https://github.com/auth0/laravel-auth0/blob/main/docs/Users.md)はAuth0 Laravel
                SDKを拡張して、カスタムのユーザーモデルを使用し、データベースでユーザーの保管や取得を行う方法を指定することができます。
      - [イベントフック](https://github.com/auth0/laravel-auth0/blob/main/docs/Events.md)はAuth0 Laravel SDKで発生したイベントを聞く方法を処理して、統合の動作を完全にカスタマイズすることができます。
      - [Management API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md)対応はAuth0 Laravel SDKに組み込まれているため、LaravelアプリケーションからManagement
                APIと対話することができます。
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [laravel-auth0 SDK](https://github.com/auth0/laravel-auth0) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <Web />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <Web2 />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <Web3 />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[7].id}>
      <SignUpForm />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
