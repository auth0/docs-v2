---
title: "Java Servletアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、新規または既存のJava ServletアプリケーションにAuth0を統合する方法を説明します。"
'og:title': "Java Servletアプリケーションにログインを追加する"
'og:description': "このガイドは、新規または既存のJava ServletアプリケーションにAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/java.png"
'twitter:title': "Java Servletアプリケーションにログインを追加する"
'twitter:description': "このガイドは、新規または既存のJava ServletアプリケーションにAuth0を統合する方法を説明します。"
sidebarTitle: Java
mode: wide
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";


import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Web from "/snippets/quickstart/webapp/java/web.xml.mdx";
import Authenticationcontrollerprovider from "/snippets/quickstart/webapp/java/AuthenticationControllerProvider.java.mdx";
import Loginservlet from "/snippets/quickstart/webapp/java/LoginServlet.java.mdx";
import Callbackservlet from "/snippets/quickstart/webapp/java/CallbackServlet.java.mdx";
import Homeservlet from "/snippets/quickstart/webapp/java/HomeServlet.java.mdx";
import Logoutservlet from "/snippets/quickstart/webapp/java/LogoutServlet.java.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0をアプリケーションに統合する", title: "Auth0をアプリケーションに統合する" },
  { id: "javaアプリケーションを構成する", title: "Javaアプリケーションを構成する" },
  { id: "authenticationcontrollerを作成する", title: "AuthenticationControllerを作成する" },
  { id: "ログインにリダイレクトする", title: "ログインにリダイレクトする" },
  { id: "トークンの処理", title: "トークンの処理" },
  { id: "ホームページを表示する", title: "ホームページを表示する" },
  { id: "ログアウトを処理する", title: "ログアウトを処理する" },
  { id: "サンプルを実行する", title: "サンプルを実行する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加して、ユーザープロファイル情報にアクセスすることができます。このガイドは、新規または既存のJava ServletアプリケーションにAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000``/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/logout`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      ### 依存関係をセットアップする

      Auth0でJavaアプリケーションを統合するには、以下の依存関係を追加します：

      - **javax.servlet-api**
      ：Java Servletsの作成を許可するライブラリーです。TomcatやGrettyのようなサーバー依存関係を追加する必要があります。どれを追加するかは自己判断です。詳細はサンプルコードをご覧ください。
      - **auth0-java-mvc-commons** ：サーバー側のMVC Webアプリ用にJavaでAuth0の使用を許可する[Javaライブラリー](https://github.com/auth0/auth0-java-mvc-common)です。ユーザーを識別する[Auth0トークン](/ja-jp/tokens)を最後に取得する過程で受け取った結果を認証、検証するために呼び出す必要のある認可URLを生成します。

      Gradleを使用している場合は、`build.gradle`に追加します：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>


      Mavenを使用している場合は、`pom.xml`に追加します：

      <AuthCodeBlock icon="file-code" language="xml" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Javaアプリは、Auth0アカウントに対して認証するために、いくつかの情報を必要とします。サンプルではこの情報をデプロイメント記述子ファイル（`src/main/webapp/WEB-INF/web.xml`）から読み取っていますが、任意の場所に保存できます。

      この情報は**auth0-java-mvc-commons** ライブラリーを構成するために使用され、ユーザーがアプリケーションにログインすることを可能にします。ライブラリーや各構成オプションの詳細情報については、[ライブラリーのドキュメント](https://github.com/auth0/auth0-java-mvc-common/blob/master/README.md)をご覧ください。

      ### 入力された属性をチェックする

      このサンプルを**［Download
              Sample（サンプルをダウンロード）］**ボタンでダウンロードした場合は、`domain`、`clientId`、`clientSecret`属性が自動的に入力されます。特にアカウントに複数のAuth0アプリケーションがある場合は、値が正しいことを確認してください。

      ### プロジェクト構造

      **［Download Sample（サンプルをダウンロード）］** ボタンでダウンロードできるサンプルプロジェクトは以下の構造になっています：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>


      プロジェクトには単一のJSPがあります：`home.jsp`は、ログイン成功後にユーザーに関連付けられたトークンを表示し、ログアウトオプションを提供します。

      プロジェクトはWebFilterを含みます：`Auth0Filter.java`は、保護された`/portal/*`パスへのユーザーアクセスを付与する前に、既存のトークンを確認します。トークンが存在しない場合、要求は`LoginServlet`へリダイレクトされます。

      プロジェクトにはサーブレットも4つあります：

      - `LoginServlet.java`：ユーザーがログインしようとした時に発動します。`client_id`パラメーターと`domain`パラメーターを使って有効な認可URLを作成し、ユーザーをリダイレクトします。
      - `CallbackServlet.java`：Callback
                URLへの要求をキャッチし、データを処理して資格情報を取得するサーブレットです。資格情報はログイン成功後、要求のHttpSessionに保存されます。
      - `HomeServlet.java`：以前保存されたトークンを読み取り、`home.jsp`リソースで表示するサーブレットです。
      - `LogoutServlet.java`：ユーザーがログアウトリンクをクリックすると発動します。ユーザーセッションを無効化し、`LoginServlet`でハンドリングされたログインページにユーザーをリダイレクトします。
      - `AuthenticationControllerProvider.java`：`AuthenticationController`の単一インスタンスを作成・管理するためのものです。
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      ユーザー認証を可能にするために、`domain`、`clientId`、`clientSecret`を使って`auth0-java-mvc-commons`
            SDKから提供された`AuthenticationController`のインスタンスを作成します。サンプルでは、RS256非対称署名アルゴリズムを使って署名したトークンで使用するためのコンポーネントの構成方法が紹介されています。トークンの署名を検証するために使用された公開鍵を取得する`JwkProvider`が指定されています。その他の構成オプションについての詳細は、[jwks-rsa-javaレポジトリ](https://github.com/auth0/jwks-rsa-java)をご覧ください。HS256を使用している場合は、`JwkProvider`を構成する必要はありません。

      <Info>
      `AuthenticationController`はコンテキストを一切保存せず、再使用を意図しています。不必要な作成はリソースの追加作成を招き、パフォーマンスに影響が出る可能性があります。
      </Info>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      アプリケーションは、ユーザーがログインできるように、ユニバーサルログインページへリダイレクトします。`AuthenticationController`インスタンスを使うと、`buildAuthorizeUrl(HttpServletRequest request`、`HttpServletResponse response`、`String redirectUrl)`メソッドを呼び出すことでリダイレクトURLを生成できます。リダイレクトURLは、Auth0アプリケーションの**［Allowed
              Callback URLs（許可されているコールバックURL）］**に追加されたURLである必要があります。
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      ユーザーがログインした後、結果はGET要求またはPOST HTTP要求経由で`CallbackServlet`で受信されます。（初期設定として）Authorization Code
            Flowを使用しているため、GET要求が送信されます。ライブラリーを暗黙フロー用に構成している場合は、代わりにPOST要求が送信されます。

      認可URLを`AuthenticationController`で生成することにより、要求はライブラリーで以前設定した呼び出しコンテキストを保持します。コントローラーに渡されると、有効な`Tokens`インスタンスまたは不具合を特定するExceptionが返ってきます。呼び出しに成功した場合、後でアクセスするために資格情報をどこかに保存しておく必要があります。ライブラリーに含まれる`SessionsUtils`クラスを使って、要求の`HttpSession`を使用できます。

      <Info>
      トークンを要求した時刻と受け取った`expiresIn`値は保存することを推奨します。そうすることで、次回トークンを使用する時に、すでに有効期限が切れているか、または引き続き有効かを確認できます。このサンプルでは検証をスキップします。
      </Info>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      ユーザーは認証される（トークンが存在する）と、`Auth0Filter`によって保護されたリソースへのアクセスを許可されます。`HomeServlet`で要求セッションからトークンが取得され、`userId`属性として設定されることで、JSPコードから使用できるようになります。
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
      ログアウトを適切に処理するには、セッションを消去し、ユーザーをAuth0からログアウトさせる必要があります。この処理は、サンプルアプリケーションの`LogoutServlet`で行われます。

      まず、`request.getSession().invalidate()`を呼び出してセッションを消去します。それから、`returnTo`クエリパラメーターを含めることを念頭に置きつつ、ログアウトURLを構築します。ユーザーはログアウト後にこのURLにリダイレクトされます。最後に応答をログアウトURLにリダイレクトします。
    </Section>

    <Section id={sections[8].id} title={sections[8].title} stepNumber="9">
      ターミナルからサンプルを実行するには、ディレクトリをプロジェクトのルートフォルダーに変更して以下のラインを実行します：

      <AuthCodeBlock icon="file-code" language="text" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      数秒後、アプリケーションが`http://localhost:3000/`でアクセスできるようになります。保護されたリソース（[http://localhost:3000/portal/home](http://localhost:3000/portal/home)）にアクセスしてみて、`Auth0Filter`によるAuth0ログインページへのリダイレクト方法を観察します。ウィジェット
            が、[Dashboard](https://manage.auth0.com/#/)でこのアプリケーションに定義したソーシャル接続とデータベース接続をすべて表示します。

      <Frame>
        <img src="/images/ja-jp/cdy7uua7fh8z/7L6lZ6xCi1L7sJBFZUPb9g/b7697bfa1bc83a1072c2de2f15cec93c/Login_Screen_-_English.png" />
      </Frame>

      認証成功後、ホームページのコンテンツを見られるようになります。

      <Frame>
        <img src="/images/ja-jp/cdy7uua7fh8z/FzK3jxfSGoeIDYQamxnJl/6b608e39ff39e044644193cfd2ee0f69/java-step-9-2.png" />
      </Frame>

      ホームページ右上の**［logout（ログアウト）］** ボタン をクリックしてログアウトします。
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-java-mvc-common SDK](https://github.com/auth0/auth0-java-mvc-common) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <CodeGroup>
        <Web/>
        <Authenticationcontrollerprovider/>
        <Loginservlet/>
        <Callbackservlet/>
        <Homeservlet/>
        <Logoutservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <CodeGroup>
        <Authenticationcontrollerprovider/>
        <Web/>
        <Loginservlet/>
        <Callbackservlet/>
        <Homeservlet/>
        <Logoutservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <CodeGroup>
        <Loginservlet/>
        <Web/>
        <Authenticationcontrollerprovider/>
        <Callbackservlet/>
        <Homeservlet/>
        <Logoutservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <CodeGroup>
        <Callbackservlet/>
        <Web/>
        <Authenticationcontrollerprovider/>
        <Loginservlet/>
        <Homeservlet/>
        <Logoutservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <CodeGroup>
        <Homeservlet/>
        <Web/>
        <Authenticationcontrollerprovider/>
        <Loginservlet/>
        <Callbackservlet/>
        <Logoutservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[7].id}>
      <CodeGroup>
        <Logoutservlet/>
        <Web/>
        <Authenticationcontrollerprovider/>
        <Loginservlet/>
        <Callbackservlet/>
        <Homeservlet/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[8].id}>
      <SignUpForm />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
