---
title: "Expressアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、Node.js ExpressアプリケーションにExpress OpenID Connect SDKを使ってAuth0を統合し、ユーザーのログイン、ログアウト、およびプロファイルを追加する方法を説明します。"
'og:title': "Expressアプリケーションにログインを追加する"
'og:description': "このガイドは、Node.js ExpressアプリケーションにExpress OpenID Connect SDKを使ってAuth0を統合し、ユーザーのログイン、ログアウト、およびプロファイルを追加する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/node.png"
'twitter:title': "Expressアプリケーションにログインを追加する"
'twitter:description': "このガイドは、Node.js ExpressアプリケーションにExpress OpenID Connect SDKを使ってAuth0を統合し、ユーザーのログイン、ログアウト、およびプロファイルを追加する方法を説明します。"
sidebarTitle: Express
mode: wide
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";


import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Server from "/snippets/quickstart/webapp/express/server.js.mdx";
import Server2 from "/snippets/quickstart/webapp/express/server.js2.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "expressのopenid-connect-sdkをインストールする", title: "ExpressのOpenID Connect SDKをインストールする" },
  { id: "ユーザープロファイルを表示する", title: "ユーザープロファイルを表示する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加することができます。このガイドは、Node.js ExpressアプリケーションにExpress OpenID Connect
        SDKを使ってAuth0を統合し、ユーザーのログイン、ログアウト、およびプロファイルを追加する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000``/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/logout`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      アプリケーションには、Auth0がメンテナンスするOIDC準拠のExpress向けSDKである[express-openid-connect](https://github.com/auth0/express-openid-connect)パッケージが必要です。

      ターミナルで以下のコマンドを実行してExpress OpenID Connect SDKをインストールします：

      <AuthCodeBlock icon="file-code" language="sh" lines="true">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      ### ルーターを構成する

      Express OpenID Connect SDKライブラリーは、認証ルートをアプリケーションに結びつけるために、`auth`ルーターを提供します。以下の構成キーでルーターを構成する必要があります：

      - `authRequired` - すべてのルートに対して認証が必要かを制御します。
      - `auth0Logout` - Auth0ログアウト機能を使います。
      - `baseURL` - アプリケーションが作動するURLです。
      - `secret` - 長くて無作為な文字列です。
      - `issuerBaseURL` - 安全なURLとしてのドメインで、[アプリケーションの設定](https://manage.auth0.com/#/applications/%7ByourClientId%7D/settings)で確認できます。
      - `clientID` - [アプリケーションの設定](https://manage.auth0.com/#/applications/%7ByourClientId%7D/settings)で確認できるクライアントIDです。

      その他の構成オプションについては、[APIドキュメント](https://auth0.github.io/express-openid-connect)をご覧ください。

      <Info>
      `LONG_RANDOM_STRING`に適した文字列は、コマンドラインの`openssl rand -hex 32`で生成できます。
      </Info>

      <Note>
      ##### チェックポイント

      ユーザーはライブラリーによって提供された`/login`ルートを訪れることで、アプリケーションにログインできるようになりました。プロジェクトを`localhost:3000`で実行している場合のリンクは、[http://localhost:3000/login](http://localhost:3000/login)です。
      </Note>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      ユーザーのプロファイルを表示するには、アプリケーションに保護されたルートがなければなりません。

      認証を必要とするルートに`requiresAuth`ミドルウェアを追加してください。このミドルウェアを使用するすべてのルートは有効なユーザーセッションをチェックし、ない場合にはユーザーをログインへリダイレクトします。

      <Note>
      ##### チェックポイント

      ユーザーはライブラリーによって提供された`/logout`ルートを訪れることで、アプリケーションからログアウトできます。プロジェクトを`localhost:3000`で実行している場合のリンクは、[http://localhost:3000/logout](http://localhost:3000/logout)です。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [express-openid-connect SDK](https://github.com/auth0/express-openid-connect) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <Server />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <Server2 />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
