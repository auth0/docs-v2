---
title: "Angularアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、AngularアプリケーションにAuth0 Angular SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
'og:title': "Angularアプリケーションにログインを追加する"
'og:description': "このガイドは、AngularアプリケーションにAuth0 Angular SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/angular.png"
'twitter:title': "Angularアプリケーションにログインを追加する"
'twitter:description': "このガイドは、AngularアプリケーションにAuth0 Angular SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
mode: wide
sidebarTitle: Angular
---
import {AuthCodeBlock} from "/snippets/AuthCodeBlock.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Main from "/snippets/quickstart/spa/angular/main.mdx"
import LoginButton from "/snippets/quickstart/spa/angular/login-button.mdx"
import LogoutButton from "/snippets/quickstart/spa/angular/logout-button.mdx"
import UserProfile from "/snippets/quickstart/spa/angular/user-profile.mdx"

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-angular-sdkをインストールする", title: "Auth0 Angular SDKをインストールする" },
  { id: "auth0を登録-提供する", title: "Auth0を登録・提供する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" },
  { id: "ユーザープロファイル情報を表示する", title: "ユーザープロファイル情報を表示する" }
]

<Recipe>
  <Content>
    <Info>
    Angularでユーザー認証を実装するための詳しい情報については、「[例を挙げて説明するAngular認証ガイド](https://developer.auth0.com/resources/guides/spa/angular/basic-authentication)」を参照してください。このガイドでは、サインアップボタンを作成する方法、ルートガードを追加する方法、そして保護されたAPIをAngularから呼び出す方法が詳しく説明されています。
    </Info>

    Auth0を使用すると、アプリケーションに手軽に認証を追加することができます。このガイドは、Angularアプリケーションに[Auth0 Angular SDK](https://github.com/auth0/auth0-angular)を使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。

    このクイックスタートを使用するには、以下の手順に従います：

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:4200`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:4200`に設定してください。
      </Info>

      ### Allowed Web Origins（許可されているWebオリジン）を構成する

      ［Allowed Web
            Origin（許可されているWebオリジン）］とは、認証フローにアクセスすることを許可して欲しいURLです。これにはプロジェクトのURLが含まれている必要があります。適切に設定されていない場合、プロジェクトが認証トークンを暗黙でリフレッシュできず、ユーザーがアプリケーションを再び訪問した時、またはページを再読み込みした時にログアウトした状態になってしまいます。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:4200`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      Angularアプリで、Auth0の認証・認可を手軽に実装できるように、Auth0は[Angular SDK](https://github.com/auth0/auth0-angular)を提供しています。

      ターミナルで以下のコマンドを実行してAuth0 Angular SDKをインストールします：

      <AuthCodeBlock icon="file-code" language="bash">
      AUTH0_SECRET='use [openssl rand -hex 32] to generate a 32 bytes value'
      APP_BASE_URL='http://localhost:3000'
      AUTH0_DOMAIN='https://{USER_DOMAIN}'
      AUTH0_CLIENT_ID='{USER_CLIENT_ID}'
      AUTH0_CLIENT_SECRET='{USER_CLIENT_SECRET}'
      </AuthCodeBlock>

      SDKはモジュールや認証サービスなど、Auth0をAngularアプリケーションに慣用的に統合しやすくする種類をいくつか公開しています。
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      SDKは、SDKが機能するために必要なすべてのサービスを含んだprovide関数である、`provideAuth0`をエクスポートします。これをアプリケーションで登録するには、以下のようにします。

      1. `main.ts`ファイルを開きます。
      2. `@auth0/auth0-angular`パッケージから`provideAuth0`関数をインポートします。
      3. `provideAuth0`を`bootstrapApplication`内の`providers`に追加することで、アプリケーションに追加します。
      4. `AuthService`を`AppComponent`に注入します。

      `provideAuth0`関数は`domain`プロパティと`clientId`プロパティを取ります。これらのプロパティの値は、Auth0で登録したシングルページアプリケーション（SPA）の**［Settings（設定）］** にある**Domain（ドメイン）** と**Client
              ID（クライアントID）**の値に対応します。その上に、`authorizationParams.redirect_uri`を構成します。これによって、認証に成功した後、Auth0はユーザーを特定のURLにリダイレクトで戻すことができます。

      <Info>
      [Auth0を使用したカスタムドメイン](/ja-jp/custom-domains)では、ドメインプロパティの値は［Settings（設定）］タブに反映された値でなく、カスタムドメインの値になります。
      </Info>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Auth0アプリケーションとAuth0 Angular
            SDKの構成が完了したら、プロジェクトのためにログインをセットアップする必要があります。これを実現するには、`AuthService`クラスからSDKの`loginWithRedirect()`メソッドを使用して、ユーザーをAuth0のユニバーサルログインページにリダイレクトします。そこでAuth0はユーザーを認証することができます。ユーザーが認証に成功すると、アプリケーション、およびこのクイックスタートで前にセットアップしたCallback
            URLへリダイレクトされます。

      アプリケーションで選択時に`loginWithRedirect()`を呼び出すログインボタンを作成します。

      <Note>
      ##### チェックポイント

      アプリケーションにログインできるようになります。

      アプリケーションを実行し、ログインボタンを選択します。以下の点を確認します：

      - ユーザー名とパスワードを使って、ログインまたはサインアップできる。
      - アプリケーションによって[Auth0ユニバーサルログイン](https://auth0.com/universal-login)ページにリダイレクトされる。
      - 認証用にAuth0にリダイレクトされる。
      - 認証した後、Auth0はアプリケーションにリダイレクトで戻される。
      - コンソールでAuth0に関連したエラーを受け取らない。
      </Note>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      プロジェクトにログインしたユーザーには、[ログアウトする方法](/ja-jp/logout/guides/logout-auth0)も必要です。SDKには、`AuthService`クラスでアプリからユーザーをログアウトするのに使用できる`logout()`メソッドが用意されています。ユーザーはログアウトすると、[Auth0ログアウトエンドポイント](https://auth0.com/docs/api/authentication?javascript#logout)にリダイレクトされてから、即座に、アプリケーションとこのクイックスタートで先ほどセットアップしたログアウトURLへとリダイレクトで戻されます。

      アプリケーションで選択時に`logout()`を呼び出すログアウトボタンを作成します。

      <Info>
      SDKによって`AuthService`クラスで`isAuthenticated$`
                      Observableが公開されることで、ユーザーが認証されているかどうかを確認することができます。`isAuthenticated$`
                      Observableの値に基づいて、条件付きでログインボタンとログアウトボタンを作成することができます。または、シングルボタンを使って、ログインとログアウトの両方のボタンと条件付きレンダリングを組み合わせることができます。
      </Info>

      <Note>
      ##### チェックポイント

      アプリケーションからログアウトできるようになります。

      アプリケーションを実行し、ログインし、ログアウトボタンを選択します。以下の点を確認します：

      - Auth0のログアウトエンドポイントにリダイレクトされている。
      - Auth0がアプリケーションと正しいログアウトURLへのリダイレクトで戻される。
      - アプリケーションにログインしていない。
      - コンソールでAuth0に関連したエラーを受け取らない。
      </Note>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      ユーザーがログインやログアウトできるようになったら、認証済みのユーザーに関連付けられた[プロファイル情報](/ja-jp/users/concepts/overview-user-profile)を取得できるようにしたいと考えるはずです。たとえば、ログインしたユーザーの名前やプロフィール写真を表示することで、ユーザーインターフェイスをパーソナライズできるようになりたいかもしれません。

      Auth0 Angular SDKは、`AuthService`クラスによって公開された`user$`
            Observableを介してユーザー情報を提供します。`user$`
            Observableにはユーザーのアイデンティティに関する機密情報とアーティファクトが含まれるため、この方法が使用できるかはユーザーの認証ステータスによります。幸い、`user$`
            Observableは、`isAuthenticated$`
            Observableがtrueである場合にのみ値を出力するよう構成されています。そのため、ユーザープロファイルデータにアクセスする前に、認証状態を手動で確認する必要はありません。

      SDKは、`AuthService`クラスでユーザーが認証されているかどうかを確認することができる`isAuthenticated$`
            Observableも公開します。これを使って、たとえば、UI要素を表示・非表示にするかを判断することができます。

      インタラクティブパネルで`UserProfileComponent`コードを確認し、これらの関数の使用方法の例をチェックします。

      <Note>
      ##### チェックポイント

      ユーザープロファイル情報を表示することができるようになります。

      アプリケーションを実行して次の点を確認します：

      - ログイン後にユーザー情報が正しく表示される。
      - ログアウト後にユーザー情報が表示されない。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-angular SDK](https://github.com/auth0/auth0-angular) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <CodeGroup>
        <Main/>
        <LoginButton/>
        <LogoutButton/>
        <UserProfile/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <CodeGroup>
        <LoginButton/>
        <Main/>
        <LogoutButton/>
        <UserProfile/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <CodeGroup>
        <LogoutButton/>
        <Main/>
        <LoginButton/>
        <UserProfile/>
      </CodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <CodeGroup>
        <UserProfile/>
        <Main/>
        <LoginButton/>
        <LogoutButton/>
      </CodeGroup>
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>

