---
title: "Node 18からNode 22への移行"
permalink: "migrate-nodejs-22"
'description': "Node.js 18で影響受けるAuth0 Actionsアイテムについて説明します。"
'og:title': "Node 18からNode 22への移行"
'og:description': "Node.js 18で影響受けるAuth0 Actionsアイテムについて説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Node 18からNode 22への移行"
'twitter:description': "Node.js 18で影響受けるAuth0 Actionsアイテムについて説明します。"
---

2025年1月15日以降、Node 22の拡張ランタイムは、弊社の一連の拡張オファリングにおいて、一般利用可能（GA）です。これにはアクション、ルール、フック、データベーススクリプト、カスタムソーシャル接続が含まれます。コードセキュリティのベストプラクティスに従うために、できるだけ早くNode 22にアップデートすることを強くお勧めします。

### 一般的な考慮事項

* アクションにあるモジュールレベルのコードは、アクションのインスタンスあたり1回だけ起動され、多くの実行で必要に応じて何度も実行されます。
* 新しいランタイムに含まれる利用可能なモジュールについては、「[必要かを判断する：Auth0の拡張性](https://auth0-extensions.github.io/canirequire/)」を参照してください。
* `use npm`ディレクティブはNode 22では利用できません。
* ファイルシステムへの書き込みアクセスが無効になりました。

### Marketplaceの統合

#### ソーシャル接続の統合

Nodeランタイムバージョンの変更が影響を与える可能性があるソーシャル接続の全リストを確認するには、[Management API](/ja-jp/api/management/v2)を使用します。特に、カスタムソーシャル接続として明示的に作成されたものか、Marketplaceを通して最初に追加されたものかを問わず、影響を受ける可能性があるソーシャル接続はすべて、`oauth1`か`oauth2`のいずれかの値の`strategy`属性を持ちます。

テナントに含まれるすべてのカスタムソーシャル接続は、[全接続取得](/ja-jp/api/management/v2#!/Connections/get_connections)エンドポイントを使用すると、ページ分割して取得できます。たとえば、以下のクエリオプションは先頭から100までのカスタムソーシャル接続の名前と識別子を返します。

``` lines
/api/v2/connections?strategy=oauth1&strategy=oauth2&include_totals=true&fields=name&per_page=100
```

<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>では、Marketplaceから追加したカスタムソーシャル接続のスクリプトを更新できません。Node 22との互換性にスクリプトの変更が必要な場合は、<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=management-api" tip="Management API: 顧客が管理タスクを実行できるようにするための製品。" cta="用語集の表示">Management API</Tooltip>を使用しなければなりません。

## 移行タスク

### 新しいカスタムアクションを作成する

Node 22で新たにカスタムアクションを作成するには、Auth0 Dashboardで以下を行います。

1. [［Auth0 Dashboard］>［Actions（アクション）］>［Library（ライブラリー）］](https://manage.auth0.com/#/dashboard/actions/library)に移動します。
2. **［Create Action（アクションの作成）］>［Build from Scratch（初めから構築する）］** を選択します。
3. **［Runtime（ランタイム）］\** *フィールドで **Node 22］（推奨）** を選択します。
4. Node 22でカスタムアクションを作成し、検証と準備ができたらデプロイします。

### 既存のカスタムアクションをアップグレードする

Node 12、16、18で作成した既存のカスタムアクションをそれぞれNode 22にアップグレードできる他にも、古いランタイムを使用して[前のバージョンに戻す](/ja-jp/customize/actions/manage-versions#revert-actions)ことができます。アクションをNode 22にアップグレードするには、必要な変更を既存の実装に加えて新しいバージョンの作成とデプロイを行い、ランタイムとしてNode 22の使用を設定します。

### 他の拡張製品にNode 22を選択する

残りの（Actions以外の）拡張オファリングに使用されるランタイムは、テナントの詳細設定レベルでグローバルに定義されます。この設定を変更すると、同時に以下の機能性に影響を及ぼします。

* ルール
* フック
* カスタムデータベーススクリプト
* カスタムソーシャル接続スクリプト

テナントの拡張性ランタイムの設定を変更するには、Auth0 Dashboardで以下を行います。

1. **［Dashboard］>［Settings（設定）］>［Advanced（詳細設定）］** に移動します。
2. **［Extensibility（拡張性）］** セクションまでスクロールします。
3. **［Runtime（ランタイム）］** に **Node 22］** を選択します。
4. **［Legacy Extensibility（レガシーの拡張性）］** には、必要なランタイムのバージョンを選択します。

これはグローバルな設定で複数の拡張性に同時に影響与えるため、まず開発テナントで変更してから、関連するすべての拡張機能をテストして、問題が認められなかった場合にのみ運用テナントで変更することをお勧めします。

特にカスタムデータベーススクリプトに関しては[こちらのページにある手順](/ja-jp/authenticate/database-connections/custom-db/custom-database-connections-scripts/environment)に従って、特定のランタイムのバージョンでスクリプトを個別に検証してから、グローバルにランタイムのバージョンを変更してください。