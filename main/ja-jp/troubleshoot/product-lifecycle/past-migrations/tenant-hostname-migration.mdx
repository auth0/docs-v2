---
title: "移行テナントホスト名の確認"
permalink: "tenant-hostname-migration"
'description': "アプリケーションドメインを移行できるように、テナントログで非推奨の通知を確認する方法について説明"
'og:title': "移行テナントホスト名の確認"
'og:description': "アプリケーションドメインを移行できるように、テナントログで非推奨の通知を確認する方法について説明"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "移行テナントホスト名の確認"
'twitter:description': "アプリケーションドメインを移行できるように、テナントログで非推奨の通知を確認する方法について説明"
---

パブリッククラウドでは2022年6月9日、プライベートクラウドでは2022年9月9日の時点で、Auth0はAuthentication API （認証API）に検証レイヤーを追加しています。アプリケーションからAuthentication API （認証API）への呼び出しがこの変更の影響を受ける可能性があることをAuth0が検出した場合は、テナントログに非推奨の通知と、この変更に備えた移行フラグが用意されています。

### 影響を受けるエンドポイント

パブリッククラウドでは2022年6月9日、プライベートクラウドでは2022年9月9日の時点で、適切に検証されていない以下のAuthentication API （認証API）エンドポイントへの呼び出しはすべて拒否されます。Auth0では、その日付けよりもかなり前に、アプリケーションドメインURLまたはAPI呼び出し識別子を同じテナントに移行するアクションを実行することをお勧めします。

影響を受けるエンドポイントは次のとおりです。

* `/oauth/トークン`
* `/co/authenticate`
* `/userinfo`
* `/login`
* `/oauth/revoke`
* `/mfa/challenge`
* `/p/<connection-type>/<ticket>` （エンタープライズ接続プロビジョニングエンドポイント）

## テナントログの確認

まず、テナントログで非推奨の通知を確認し、アプリケーションを移行する必要があるかどうかを確認します。

1. [［Dashboard］>［Monitoring（モニタリング）］>［Logs（ログ）］](https://manage.auth0.com/#/logs)に移動します。

   1. ログで「`type:depnote AND description:ignore*request*host*header*`」を検索し、どのアプリケーションが影響を受けて移行する必要があるのかを記載した廃止通知を見つけます。ログエントリには影響を受けるアプリケーションのIDと以下のメッセージが含まれています。
      `Ignore request Host header: This feature is being deprecated. Please see https://auth0.com/docs/ja-jp/product-lifecycle/deprecations-and-migrations``/tenant-hostname-migration.`（要求のHostヘッダーを無視してください。この機能は廃止されました。）
   2. ログの**Details > Raw** セクションを見つけます。ここでは、更新するアプリケーションの`client_id`、またはプロビジョニングエンドポイントの場合は`connection_id`を識別できます。

      <Callout icon="file-lines" color="#0EA5E9" iconType="regular">

      `tenant_from_host`フィールドも確認してください。このフィールドには、API呼び出しで受け取ったドメインから識別されるAuth0テナントが含まれています。

      </Callout>

2. 該当するすべてのアプリケーションを変更します。

   1. テナントとドメインテナントの不整合がある場合は、送信された識別子またはドメインURLを、その他の誤って構成された要求パラメーターと共に変更する必要があります。
   2. ドメイン テナントは、`client_id`または`connection_id` に関連付けられたテナントと一致する必要があります。

該当するすべてのテナントの移行が完了すると、テナントログには、この移行に関連付けられている非推奨の通知が表示されなくなります。

## 移行を確認

アプリケーションを移行し、未検証のホスト名を設定したら、2022年6月9日または2022年9月9日より前の任意の時点で廃止の動作を無効にして変更を確認します。

1. [［Dashboard］>［Tenant Settings（テナント設定）］>［Advanced（詳細設定）］>［Migration（移行）］](https://manage.auth0.com/#/tenant/advanced)に移動します。
2. **［Ignore request Host header（要求ホストヘッダーを無視）］** トグルを無効にします** 。**このトグルを無効にすると、テナントの検証が強制され、移行が完了します。

このトグルを無効にした後にホスト名の確認が期待どおりに機能しない場合は、`client_id`または`connection_id`に関連付けられているドメインテナントとテナントが同じではないことを示す4xxエラーが表示されます。

すべてのアプリケーションの移行が正常に実行され、運用環境で確認されたら、スイッチを完全に無効にして、廃止の機能を使用できないようにすることができます。パブリッククラウドでは2022年6月9日、プライベートクラウドでは2022年9月9日以降、Auth0によってホスト名の確認が強制され、関連付けられているスイッチはテナント設定から削除されます。