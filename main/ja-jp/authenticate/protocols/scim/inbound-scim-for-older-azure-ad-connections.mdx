---
title: "古いEntra ID接続のインバウンドSCIM"
permalink: "inbound-scim-for-older-azure-ad-connections"
'description': "古いEntra ID接続のOpenIDインバウンドSCIM"
'og:title': "古いEntra ID接続のインバウンドSCIM"
'og:description': "古いEntra ID接続のOpenIDインバウンドSCIM"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "古いEntra ID接続のインバウンドSCIM"
'twitter:description': "古いEntra ID接続のOpenIDインバウンドSCIM"
---

<Card title="始める前に">

Auth0テナントは必ず、[Microsoft Entra IDの接続タイプ](https://auth0.com/docs/authenticate/identity-providers/enterprise-identity-providers/azure-active-directory/v2)を使ってEntra IDに接続するようにしてください。

この統合では2つのアプリケーションをEntra IDで登録する必要があり、それらはOpenID Connect統合とSCIM統合になります。顧客のセットアッププロセスを効率よくするために、[Microsoft Entra IDのアプリギャラリーでアプリの公開](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-howto-app-gallery-listing#step-6---submit-your-app)を検討してください。

</Card>

Auth0は、[Microsoft Entra ID接続タイプ](/ja-jp/authenticate/identity-providers/enterprise-identity-providers/azure-active-directory/v2)でMicrosoft Entra ID（旧Microsoft Azure Active Directory）と統合可能で、ユーザー認証には<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=openid" tip="OpenID: アプリケーションがログイン情報を収集および保存することなくにユーザーのIDを検証できるようにする認証用のオープン標準。" cta="用語集の表示">OpenID</Tooltip> Connect（OIDC）プロトコルを使用します。このセクションでは、ユーザーアカウントを更新および削除専用モードで管理するために、非ギャラリーエンタープライズアプリケーションを構成する方法について説明します。これにより、[ペアワイズID](https://learn.microsoft.com/en-us/entra/identity-platform/id-token-claims-reference#use-claims-to-reliably-identify-a-user)が存在する古いEntra ID接続でSCIMを使用できるようになります。

新しい接続については、「[新しい接続](/ja-jp/authenticate/protocols/scim/inbound-scim-for-new-azure-ad-connections)」をご覧ください。

### Auth0でSCIM設定を構成する

1. [Auth0 Dashboard](https://manage.auth0.com/#/)から、 **［Authentication（認証）］>［Enterprise（エンタープライズ）］>［Microsoft Entra ID］> [あなたの接続] >［Settings（設定）］** に移動します。
2. **［User ID Attribute Type（ユーザーID属性タイプ）］** が **［Pairwise Subject Identifier (sub)（ペアワイズサブジェクト識別子（sub））］** に設定され、 **［Use Common Endpoint（共通のエンドポイントの使用）］** が **［Disabled（無効）］** になっていることを確認ます。
3. **［Provisioning（プロビジョニング）］** タブを選択し、 **［Sync user profile attributes at each login（ログインの度にユーザープロファイル属性を同期する）］** と **［Sync user profiles using SCIM（SCIMを使用してユーザープロファイルを同期する）］** を両方有効にします。
4. **［Mapping（マッピング）］** タブで、 **［SCIM attribute containing the User ID（ユーザーIDを含むSCIM属性）］** が **［externalId］** に設定されていることを確認します。
5. **［Additional Mappings（追加のマッピング）］** で、拡張されたSCIM属性が任意のAuth0属性にマッピングされていることを確認します。詳しくは、「[属性マッピング](/ja-jp/authenticate/protocols/scim/configure-inbound-scim#attribute-mapping)」をご覧ください。

### SCIMエンドポイントURLとトークンを取得する

このセクションでは<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>を使用しますが、これらの手順は<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=management-api" tip="Management API: 顧客が管理タスクを実行できるようにするための製品。" cta="用語集の表示">Management API</Tooltip>でも完了することができます。ベストプラクティスについては、「[導入のガイドライン](/ja-jp/authenticate/protocols/scim/configure-inbound-scim#deployment-guidelines)」セクションをご覧ください。

1. Auth0 dashboardでSCIMの **［Setup（セットアップ）］** タブに移動し、 **［SCIM Endpoint URL（SCIMエンドポイントURL）** をコピーします。後続の手順で必要になるため、このURLを書き留めます。
2. **［Generate New Token（新しいトークンの生成）］** をクリックしてSCIMトークンを生成し、希望する場合はトークンの有効期限を設定します。
3. `get:users`、`patch:users`、および`delete:users`のスコープを選択します。

### OIDCアプリ用のSCIMをEntra IDで構成する

1. [Azureポータル](https://portal.azure.com)にある **［Microsoft Entra ID］>［App registrations（アプリ登録）］** に移動して、アプリ用にOpenID Connectアプリケーションがすでに登録されていることを確認します。
2. 次に、[Azureポータル](https://portal.azure.com)で新しい **［Non-gallery（非ギャラリー）］** アプリケーションを登録します。 **［Microsoft Entra ID］>［Enterprise applications（エンタープライズアプリケーション）］>［New application（新しいアプリケーション）］>［Create your own application（独自のアプリケーションを作成する）］** に移動して、アプリケーション名を入力したのちに、 **［Create（作成）］** を選択します。
3. **［Users and Groups（ユーザーとグループ）］** タブに移動し、現在アクセスできるEntra IDのユーザーとグループを割り当てます。
4. **［Provisioning（プロビジョニング）］** タブを選択し、 **［Get started（はじめる）］** を選択します。そして、 **［Provisioning Mode（プロビジョニングモード）］** に **［Automatic（自動）］** を選択します。
5. **［Admin Credentials（管理者の資格情報）］** を選択し、先ほど保存した **［SCIM Endpoint URL（SCIMエンドポイントURL）］** 値を **［Tenant URL（テナントURL）］** に入力します。URLの最後に、`?aadOptscim062020`クエリパラメーターを追加し、[既知のEntra IDの問題](https://learn.microsoft.com/en-us/entra/identity/app-provisioning/application-provisioning-config-problem-scim-compatibility)を修正します。
6. **［Secret Token（シークレットトークン）］** フィールドにトークン値を貼り付け、 **［Save（保存）］**
7. **［Mappings（マッピング）］** に移動し、 **［Provision Entra ID Users（Entra IDユーザーのプロビジョニング）］** を選択します。その後、 **［Provision Entra ID Users （Entra IDユーザーのプロビジョニング）］** から **［Target Object Actions（ターゲットオブジェクトアクション）］** にある **［Create（作成）］** の選択を解除します。

   <Frame>![Azure AD Mappings for Inbound SCIM ](/images/ja-jp/cdy7uua7fh8z/3ndwqpnyZvhWYSn2nvM2Qj/19e568c435d90aa8a294140f482b2257/azureadmappings.jpg)</Frame>

8. **［Attribute Mappings（属性マッピング）］** に移動し、`externalId`と`mailNickname`
9. **［Edit Attribute（属性の編集）］** 画面から、 **［Source attribute（ソース属性）］** を **objectId** に変更し、 **［OK］** を選択します。
10. **［Attribute Mappings（属性マッピング）］** に戻り、`emails[type eq "work"].value`と`mail`を含む行を選択します。
11. **［Edit Attribute（属性の編集）］** 画面から、 **［Match object usng this attribute（この属性を使用してオブジェクトを一致させる）］** を **［Yes（はい）］** に、 **［Matching precedence（一致の優先順位）］** を **［2］** に設定して、 **［OK］** を選択します。

    <Frame>![Edit Attribute in Azure AD for Inbound SCIM ](/images/ja-jp/cdy7uua7fh8z/7EbSKlTnXlpQdqw6R5blBJ/01999edb569825e07004e0c2eb11508b/editattribute.jpg)</Frame>

12. **［Save（保存）］** を選択し、属性マッピングを保存します。次の内容が表示されます。

    <Frame>![Attribute Mapping on Azure for Inbound SCIM](/images/ja-jp/cdy7uua7fh8z/2xCmuXkW7GGF8n3C84jOwI/3e70b7ab835d8dd73b36fdffbc3f5eb6/Attributemapping.jpg)</Frame>

13. 右上にある **［X］** を選択すると、 **［Provisioning（プロビジョニング）］** 画面に戻ります。

#### テスト

1. エンタープライズアプリケーションの概要画面で、 **［Manage（管理）］>［Provisioning（プロビジョニング）］** から、 **［Provision on Demand（オンデマンドプロビジョニング）］** を選択します。
2. **［Select a user or group（ユーザーまたはグループを選択）］** に移動し、アプリケーションに割り当てたユーザーの名前を入力します。その後、ユーザーを選択し、 **［Provision（プロビジョニング）］** を選択します。ユーザーがAuth0に存在しない場合、エラーを受け取ります。ユーザーがAuth0テナントに存在する場合、ユーザーが更新されたことを確認するメッセージが表示されます。
3. [Microsoftの手順](https://learn.microsoft.com/en-us/entra/identity/app-provisioning/configure-automatic-user-provisioning-portal#provisioning-status)に従い、 **［Provisioning Status（プロビジョニングステータス）］** を **［On（オン）］** にすることで、プロビジョニングを有効化できます。