---
title: "Okta WorkforceのSAML接続のインバウンドSCIM"
permalink: "inbound-scim-for-okta-workforce-saml-connections"
'description': "SAML SCIM経由のOkta WIC接続をセットアップする手順"
'og:title': "Okta WorkforceのSAML接続のインバウンドSCIM"
'og:description': "SAML SCIM経由のOkta WIC接続をセットアップする手順"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Okta WorkforceのSAML接続のインバウンドSCIM"
'twitter:description': "SAML SCIM経由のOkta WIC接続をセットアップする手順"
---

<Card title="始める前に">

Auth0テナントに[SAML接続](https://auth0.com/docs/authenticate/identity-providers/enterprise-identity-providers/saml)を作成し、Okta Workforce Identity Cloud Dashboardを使って[カスタムのSAMLアプリケーションに接続](https://help.okta.com/en-us/content/topics/apps/apps_app_integration_wizard_saml.htm)します。

</Card>

このセクションでは、Okta Workforce Identity Cloudのテナントにカスタム<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-1" href="/ja-jp/glossary?term=security-assertion-markup-language" tip="Security Assertion Markup Language（SAML）: パスワードなしに二者間で認証情報を交換できる標準化プロトコル。" cta="用語集の表示">SAML</Tooltip>とSCIMアプリ統合を構成する方法について説明します。これは、ユーザーをAuth0のSCIMエンドポイントにプロビジョニングするのに使うことができます。

### Auth0でSCIM設定を構成する

1. [Auth0 Dashboard](https://manage.auth0.com/#/)を開いて、 **［Authentication（認証）］>［Enterprise（エンタープライズ）］>［SAML］> [使用している接続] >［Provisioning（プロビジョニング）］** に移動します。
2. **［Sync user profile attributes at each login（ログインの度にユーザープロファイル属性を同期する）］** を無効にします。ただし、[ログイン時に追加の属性を同期する](/ja-jp/authenticate/protocols/scim/configure-inbound-scim)場合には有効にしておきます。
3. 同じセクションで、 **［Sync user profiles using SCIM（SCIMを使用してユーザープロファイルを同期する）］** を有効にします。
4. **［Mapping（マッピング）］** タブで、 **［SCIM attribute containing the User ID（ユーザーIDを含むSCIM属性）］** 設定が **［userName］** になっていることを確認します。
5. **［Additional Mappings（追加のマッピング）］** で、拡張されたSCIM属性が任意のAuth0属性にマッピングされていることを、[属性のマッピング](/ja-jp/authenticate/protocols/scim/configure-inbound-scim#attribute-mapping)に照らし合わせて確認します。電話番号や物理アドレスを受け取った場合には、Okta Workforceがこれらをデフォルトで`phoneNumbers[primary eq true].value`や`addresses[primary eq true].*`として送信することに注意してください。
6. SCIMの`userName`属性をAuth0の`email`属性にマッピングします。そうすることで、すでにこの接続がメールアドレスのログインIDで運用に導入されており、既存のユーザープロファイルにAuth0の`username`属性が設定されていない場合に、Oktaは[既存のユーザーを検索して合致](https://developer.okta.com/docs/reference/scim/scim-20/#create-users)させることができます。 **［Additional Mappings（追加のマッピング）］** で以下の属性のペアを見つけます。

   ```json lines
   {
       "scim": "userName",
       "auth0": "username"
     }
   ```

   

   

   それを以下と置き換えてから、`emails[primary eq true].value`へのマッピングを削除します。

   ```json lines
   {
       "scim": "userName",
       "auth0": "email"
     }
   ```

   

   
7. **［Save Changes（変更を保存）］** を選択します。

### SCIMエンドポイントURLとトークンを取得する

1. Auth0 Dashboardで、SCIMの **［Setup（セットアップ）］** タブを参照し、 **SCIMエンドポイントURL** をコピーして、安全な場所に貼り付けます。
2. **［Generate New Token（新しいトークンの生成）］** を選択し、トークンに任意の有効期限を設定します。Okta Workforceに付与したいスコープを選択することもできます。Okta Workforceがデフォルトで使用するスコープは`get:users`、`post:users`、および`put:users`です。

### SAMLアプリ用にOkta WorkforceでSCIMを構成する

1. Okta Workforce Identity CloudのSAMLアプリケーションに移動し、 **［General（一般）］** タブを選択してから、 **［App Settings（アプリ設定）］** で **［Edit（編集）］** を選択します。
2. **［Provisioning（プロビジョニング）］** セクションで、 **［SCIM］** を選択して **［Save（保存）］** をクリックします。
3. **［General（一般）］** タブで、［[Federation Broker Mode（フェデレーションブローカーモード）](https://help.okta.com/en-us/content/topics/apps/apps-fbm-main.htm)］が無効になっていることを確認します。
4. **［Provisioning（プロビジョニング）］** タブを選択してから、 **［Integration（統合）］** タブで **［Edit（編集）］** をクリックします。
5. 前の手順でコピーした **SCIMエンドポイントURL** の値を **［SCIM connector base URL（SCIMコネクターのベースURL）］** セクションに入力します。
6. **［Unique identifier field for users（ユーザーの一意の識別子フィールド）］** に「 **userName** 」と入力します。
7. **［Supported provisioning actions（サポートされているプロビジョニングアクション）］** で、［`Push New Users`（新規ユーザーをプッシュ）］と［`Push Profile Updates`（プロファイル更新をプッシュ）］を選択してから、 **［HTTP Header（HTTPヘッダー）］** を **［Authentication Mode（認証モード）］** として選択します。
8. **［Authorization（認可）］** フィールドにSCIMトークンを貼り付けてから、新しい接続をテストしたい場合には **［Test Connection Configuration（接続構成のテスト｝］** を選択します。 **［Save（保存）］** を選択します。

   <Frame>![Inbound SCIM WIC Configuration](/images/ja-jp/cdy7uua7fh8z/4kEFIeW8qbRqGb46KYuXJH/067213e99fbca35baab9bb104d1047f3/supersaas.jpg)</Frame>

9. **［Provisioning（プロビジョニング）］>［Settings（設定）］>［To App（アプリ対象）］** に移動し、 **［Edit（編集）］** を選択してから、 **［Create Users（ユーザーの作成］、［Update User Attributes（ユーザー属性の更新）］** 、および **［Deactivate users（ユーザーの非アクティブ化）］** の操作を有効にします。 **［Save（保存）］** を選択します。

   <Frame>![](/images/ja-jp/cdy7uua7fh8z/4RXROJ4amD4TpY3ozDg6wV/03c11b7ea8354a033b64d2df4f6360be/supersaasprovisioning.jpg)</Frame>

10. **［Attribute Mappings（属性のマッピング）］** セクションで、 **［X］** ボタンを使って以下の行を **削除** します。

<table class="table"><thead>
<tr>
<th>属性</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td>主なメールタイプ</td>
<td>`(user.email != null &amp;&amp; user.email != '') ? 'work' : ‘'`</td>
</tr>
<tr>
<td>主な電話タイプ</td>
<td>`(user.primaryPhone != null &amp;&amp; user.primaryPhone != '') ? 'work' : ‘'`</td>
</tr>
<tr>
<td>住所タイプ</td>
<td>`(user.streetAddress != null &amp;&amp; user.streetAddress != '') ? 'work' : ‘'`</td>
</tr>
</tbody>
</table>

他のSCIM属性をOkta WICからSCIMエンドポイントに追加で送信したい場合には、 **［Attribute Mappings（属性のマッピング）］** を使って構成します。カスタム属性を追加する際には、SCIM 2.0の有効な外部名前空間プロパティを必ず含めます。外部名前空間の詳細については、[Oktaのヘルプセクション](https://support.okta.com/help/s/article/Receiving-Invalid-externalNamespace-task-error-when-assigning-a-user-to-a-SCIMenabled-application)を参照してください。

これで、 **［Assignments（割り当て）］** タブを使ってユーザーのプロビジョニングをテストすることができます。また、Okta管理ポータルの **［Directory（ディレクトリ）］>［People（ユーザー）］** セクションでユーザー属性を編集して、更新をテストすることもできます。