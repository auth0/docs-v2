---
title: "Microsoft Entra IDとADFSのメール検証"
permalink: "azuread-adfs-email-verification"
'description': "Azure ADおよびADFSの「email_verified」フィールドの設定方法を制御する方法について説明します。"
'og:title': "Microsoft Entra IDとADFSのメール検証"
'og:description': "Azure ADおよびADFSの「email_verified」フィールドの設定方法を制御する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Microsoft Entra IDとADFSのメール検証"
'twitter:description': "Azure ADおよびADFSの「email_verified」フィールドの設定方法を制御する方法について説明します。"
---

Auth0ユーザーのプロファイルには`email_verified`フィールドがあり、接続タイプに応じてさまざまな方法で設定できます。データベース接続の場合、ユーザーはメールを検証するためにメール検証フローを実行する必要があります。フェデレーション接続の場合、IDプロバイダーは独自の基準に基づいて`email_verified`フィールドを返すことができます。

Azure ADとADFSは、返されるメールが検証済みであることを保証できません。

* ADFSでは、ADFS管理者は任意のメールを設定できます。
* Azure ADでは、Azure ADテナントの構成方法に応じて、Azure ADによって返されるメール アドレスがOfficeメールボックスに対応する場合と対応しない場合があります。Auth0は、それが実行されるかどうかを知ることができません。

ただし、Azure ADまたはADFSがどのように構成および管理されているかがわかっている場合は、それらのアカウントからのメールが検証されていると信頼することができます。

両方のニーズに対応するために、Azure ADとADFS接続には、次の2つの値を持つ **メール検証** プロパティがあります。

* `email_verified`を常に`true`に設定する
* `email_verified`を常に`false`に設定する

Azure AD接続には、**共通エンドポイントを使用する** プロパティもあります。有効にすると、ユーザーは任意のAzure ADテナントで認証できるようになります。どのAzure ADテナントも検証済みのメールを返すとは限らないため、** メール検証** プロパティの`email_verified`を`false`に **設定** する必要があります。

プロパティが**常に** `email_verified`** を **`false`に設定する、に設定されている場合、[ログインごとにユーザープロファイル属性を同期する](/ja-jp/manage-users/user-accounts/user-profiles/configure-connection-sync-with-auth0)設定が無効になっていない限り、ユーザーは次回ログイン時に`email_verified`を`false`に設定します。

## Azure AD/ADFSメール検証移行設定

以前のバージョンでは、Auth0では常に、Microsoft Entra IDおよびADFS接続の`email_verified`フィールドを`true`に設定していました。過去にAzure ADおよびADFS接続を使用していた場合は、**メール検証** の接続設定を上書きし、以前の動作を維持するテナント設定があります。

新しいテナント設定は、[［Auth0 Dashboard］ > ［Settings（設定）］ > ［Advanced（詳細）］](https://manage.auth0.com/#/tenant/advanced)で確認できます。**［Migrations（移行）］** セクションを見つけて、** Azure AD/ADFS接続の **`メール検証`の** デフォルト** 設定を見つけます。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

この設定は以下の場合にのみ使用できます。

* テナントが、移行の開始前に作成されている
* テナントにアクティブなADFSまたはEntra IDの接続がある

</Callout>

<Frame>![Dashboard - Advanced Tenant Settings - Migrations](/images/ja-jp/cdy7uua7fh8z/4K1rQIv6p96KPCYOrhjXz4/be0f7b104d743fd0d3d42d18df97e144/dashboard-tenant-edit_view-advanced_migrations_azure-adfs.png)</Frame>

この設定が無効である場合、`email_verified`は常にAzure AD/ADFS接続に対して`true`になります。有効である場合、接続レベルで`メール検証`設定を使用します。

## Azure AD/ADFS接続のメール検証フロー

アプリケーションで、Azure AD/ADF 接続のユーザーからのメールを常に検証する必要がある場合は、テナントの **［Advanced Settings（高度な設定）］** セクションで **［Enable email verification flow during login for Azure AD and ADFS connections（Azure ADおよびADFS接続のログイン中にメール検証フローを有効にする）］** オプションを有効にできます。

ユーザーが未検証のメールで初めて認証すると、Auth0はユーザーにメールアカウントに送信される1回限りのコードを入力してメールを検証するよう求めます。

<Frame>![Auth0 - Email Verification Prompt - One-Time Code](/images/ja-jp/cdy7uua7fh8z/i92GJgntVuU5QK37adugH/1fbdd130aa8f147a558bb96bfe52a62f/Verify_Email_-_JP.png)</Frame>

ユーザーがこの手順を完了すると、`email_verified`フィールドが`true`に設定され、Azure ADまたはADFSがユーザーに別のメールを返さない限り、ユーザーは再度メール検証を求められることはなくなります。

この新しい画面は、クラシックログインを使用している場合でも、ユニバーサルログインエクスペリエンスを使用してレンダリングされます。カスタマイズ方法の詳細については、「[ユニバーサルログインページのカスタマイズ](/ja-jp/customize/login-pages/universal-login/customize-templates)」をお読みください。

ユーザーに送信されるメールのカスタマイズ方法の詳細については、「[Auth0を使ってメールを検証する](/ja-jp/manage-users/user-accounts/verify-emails)」をお読みください。

<Warning>

Entra IDが`email`クレームを返さない場合、Auth0は[Azure UserPrincipalName](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-connect-userprincipalname)をそのメールとしてマッピングします。`UserPrincipalName`値がメールボックスであるという保証はないため、Auth0はメール検証プロンプトを **表示せず** 、そのユーザーの`email_verified`フィールドは`false`に設定されます。

</Warning>

