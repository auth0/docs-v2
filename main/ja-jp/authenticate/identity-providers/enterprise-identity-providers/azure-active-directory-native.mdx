---
title: "リソース所有者フローを使ってMicrosoft Entra IDにネイティブアプリを接続する"
permalink: "azure-active-directory-native"
'description': "リソース所有者フローでエンタープライズ接続を使ってMicrosoft Entra IDにアプリを接続する方法について説明します。"
'og:title': "リソース所有者フローを使ってMicrosoft Entra IDにネイティブアプリを接続する"
'og:description': "リソース所有者フローでエンタープライズ接続を使ってMicrosoft Entra IDにアプリを接続する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "リソース所有者フローを使ってMicrosoft Entra IDにネイティブアプリを接続する"
'twitter:description': "リソース所有者フローでエンタープライズ接続を使ってMicrosoft Entra IDにアプリを接続する方法について説明します。"
---

WSフェデレーションと<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=openid" tip="OpenID: アプリケーションがログイン情報を収集および保存することなくにユーザーのIDを検証できるようにする認証用のオープン標準。" cta="用語集の表示">OpenID</Tooltip> Connectフローに加えて、Microsoft Entra IDで[リソース所有者](/ja-jp/get-started/authentication-and-authorization-flow/resource-owner-password-flow)フローを使用することもできます。このフローでは、Microsoft Entra IDのログインページを表示するのでなく、ユーザーの資格情報（メールとパスワード）をキャプチャして検証することができます。セキュリティ上およびシングルサインオン（<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=single-sign-on" tip="シングルサインオン（SSO）: ユーザーが1つのアプリケーションにログインした後、そのユーザーを他のアプリケーションに自動的にログインさせるサービス。" cta="用語集の表示">SSO</Tooltip>）上の理由から、このアプローチは推奨されません。ただし、リソース所有者フローは、ネイティブモバイルシナリオ、またはMicrosoft Entra IDとの一括処理認証に役立つことがあります。

この構成には、WebアプリケーションとWeb API、ネイティブアプリケーションという2つのアプリケーションが必要です。Microsoft Entra IDの観点からすれば、ユーザーはネイティブアプリケーションによる認証を通じて、WebアプリケーションとWeb APIにアクセスします。

<Frame>![リソース所有者フローを使用するAzure ADアプリの概要図](/images/ja-jp/cdy7uua7fh8z/6Uy9Q35rn0d9rankvlJuBT/62393c99f1c85fa16b83319a66b1d173/azure-ad-native-app.png)</Frame>

## 前提条件

[Auth0にアプリケーションを登録する](/ja-jp/get-started/auth0-overview/create-applications)：

1. **アプリケーションタイプ** として **［Native（ネイティブ）］** を選択します。
2. **［Allowed Callback URL（許可されているコールバックURL）］** を追加します。コールバックURLの形式は、使用しているプラットフォームによって異なります。使用しているプラットフォームの形式の詳細については、「[ネイティブクイックスタート](/ja-jp/quickstart/native)」を参照してください。
3. アプリケーションの[［Grant Types（付与タイプ）］](/ja-jp/get-started/applications/update-grant-types)に適切なフローが必ず含まれていることを確認してください。

## ステップ

リソース所有者フローを使ってアプリケーションを接続するには、以下を行う必要があります。

1. [Microsoft Azureポータルでアプリケーションをセットアップする](#set-up-your-applications-in-the-microsoft-azure-portal)。
2. [Auth0でエンタープライズ接続を作成する](#create-an-enterprise-connection-in-auth0)。
3. [Auth0アプリケーションでエンタープライズ接続を有効にする](#enable-the-enterprise-connection-for-your-auth0-application)。
4. [接続をテストする](#test-the-connection)。

<Card title="Microsoft Entraアカウント">

事前に、有効なMicrosoft Entraアカウントと、グローバル管理者として **独自に所有** しているMicrosoft Azure ADディレクトリが必要です。

Microsoft Entraアカウントがない場合は[無料で作成](https://azure.microsoft.com/en-us/free)し、必要であれば、Microsoftの「[クイックスタート：Microsoft Entra IDで新しいテナントを作成する - 組織の新しいテナントを作成する](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-access-create-new-tenant#create-a-new-tenant-for-your-organization)」に従ってAzure ADディレクトリをセットアップします。

Office 365アカウントをお持ちの場合は、新しく作成する代わりにそのアカウントのEntra IDを使用することもできます。Office 365アカウントのEntra IDにアクセスするには：

1. [Office 365にサインイン](https://portal.office.com)してから、[Office 365管理センター](https://portal.office.com/adminportal/home#/homepage)に移動します。
2. **管理センター** の左メニューから「** Microsoft Entra**」を選択します。

</Card>

## Microsoft Azureポータルでアプリケーションをセットアップする

<Warning>

事前に、自身がグローバル管理者となっている **独自** のMicrosoft Entra IDディレクトリがセットアップされている必要があります。設定方法については、Microsoftの[「Quickstart：Microsoft Entra IDで新しいテナントを作成する」にある「組織の新しいテナントを作成する」](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-access-create-new-tenant#create-a-new-tenant-for-your-organization)の手順に従ってください。

</Warning>

### 新規Webアプリケーションを登録する

Microsoft Entra IDでアプリケーションを登録する方法については、Microsoft Docsの「[クイックスタート：Microsoft IDプラットフォームにアプリケーションを登録する](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)」を参照してください。

<Warning>

Entra IDディレクトリが2つ以上ある場合は、アプリを登録する際に正しいディレクトリを選択していることを確認してください。

</Warning>

アプリケーションのセットアップ中に、以下の設定を必ず使用してください。

* 外部組織（他のEntra IDディレクトリなど）からユーザーを許可したい場合は、**［Supported account types（サポートされているアカウントの種類）］** の設定時に、** ［Accounts in any organizational directory (Any Azure AD directory - Multitenant)（任意の組織ディレクトリ内のアカウント（任意のMicrosoft Entra ID - マルチテナント））］** を選択します。
* **［Redirect URI（リダイレクトURI）］** を設定するよう求められたら、** ［Web］** を選択し、フィールドにコールバックURL：`https://{yourDomain}/login/callback`を入力します。

<Card title="リダイレクト用のAuth0ドメイン名を見つける">

上記で、 [カスタムドメイン](/ja-jp/customize/custom-domains)機能を使っていないのにAuth0ドメイン名が表示されない場合は、ドメイン名がテナント名、地域のサブドメイン、および「`auth0.com`」をドット記号（「`.`」）で区切って連結したものだからです。

たとえば、テナント名が「`exampleco-enterprises`」でテナントがUS地域にある場合、Auth0ドメイン名は「`exampleco-enterprises.us.auth0.com`」、**Redirect URI（リダイレクトURI）** は「`https://exampleco-enterprises.us.auth0.com/login/callback`」になります。

ただし、テナントがUS地域にあり、2020年6月よりも前に作成された場合、Auth0ドメイン名は「`exampleco-enterprises.auth0.com` 」、**Redirect URI（リダイレクトURI）** は「`https://exampleco-enterprises.auth0.com/login/callback`」になります。

[カスタムドメイン](/ja-jp/customize/custom-domains)を使っている場合、**Redirect URI（リダイレクトURI）** は「`https://<YOUR CUSTOM DOMAIN>/login/callback`」になります。

</Card>

このプロセス中に、後のチュートリアルで必要になるため、アプリケーション用に生成される **［Application (client) ID（アプリケーション（クライアント）ID）］** を記録しておきます（このIDは、アプリケーションの **［Overview（概要）］** 画面に表示されます）。

### APIを公開するためにWebアプリケーションを構成する

Entra IDでAPIを公開するためにWebアプリケーションを構成する方法については、Microsoft Docsの「[クイックスタート：APIを公開するためにWebアプリケーションを構成する](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-configure-app-expose-web-apis)」を参照してください。

アプリの構成中に、以下の設定を必ず使用してください。

* **［Scope name（スコープ名）］** を設定するよう求められたら、`API.Access`と入力します。

このプロセス中に、後のチュートリアルで必要になるため、アプリケーション用に生成される **［Application ID URI（アプリケーションID URI）］** を記録しておきます。

### 新規ネイティブアプリケーションを登録する

Azureでネイティブアプリケーションを登録する方法については、Microsoft Docsの「[クイックスタート：Microsoft IDプラットフォームにアプリケーションを登録する](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)」を参照してください。

<Warning>

Entra IDディレクトリが2つ以上ある場合は、アプリを登録する際に正しいディレクトリを選択していることを確認してください。

</Warning>

アプリのセットアップ中は、以下の設定を必ず使用してください。

* 外部組織（他のEntra IDディレクトリなど）からユーザーを許可したい場合は、**［Supported account types（サポートされているアカウントの種類）］** の設定時に、** ［Accounts in any organizational directory (Any Azure AD directory - Multitenant)（任意の組織ディレクトリ内のアカウント（任意のMicrosoft Entra ID - マルチテナント））］** を選択します。
* **［Redirect URI（リダイレクトURI）］** を設定するよう求められたら、`［Public client/native (mobile & desktop)（パブリッククライアント/ネイティブ（モバイルとデスクトップ））］`を選択し、コールバックURLを入力します。コールバックURLの形式は、使用しているプラットフォームによって異なります。使用しているプラットフォームの形式の詳細については、「[ネイティブクイックスタート](/ja-jp/quickstart/native)」をお読みください。

このプロセス中に、後のチュートリアルで必要になるため、アプリケーション用に生成される **［Application (client) ID（アプリケーション（クライアント）ID）］** を記録しておきます（このIDは、アプリケーションの **［Overview（概要）］** 画面に表示されます）。

### ネイティブアプリケーション用にクライアントシークレットを作成する

クライアントシークレットを作成する方法については、Microsoft Docsの「[クイックスタート：Web APIにアクセスするようにクライアントアプリケーションを構成する」の「資格情報をWebアプリケーションに追加する」](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-configure-app-access-web-apis#add-credentials-to-your-web-application)を参照してください。

**［<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=client-secret" tip="クライアントシークレット: クライアント（アプリケーション）が認可サーバーで認証するために使用するシークレット。これはクライアントと認可サーバーだけが知っているものであり、推測できないように十分にランダムである必要があります。" cta="用語集の表示">Client secret</Tooltip>（クライアントシークレット）］** を生成し、その値を記録します。この値は、後のチュートリアルで必要になります。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

有効期限のあるシークレットを構成する場合は、必ず **有効期限を記録** してください。期限が切れる前にキーを更新して、サービスの中断を避ける必要があります。

</Callout>

### ネイティブアプリケーションに権限を追加する

**ネイティブ** アプリケーションの権限を追加する方法については、Microsoft Docsの「[クイックスタート：Web APIにアクセスするようにクライアントアプリケーションを構成する」の「Web APIにアクセスするための権限を追加する」](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-configure-app-access-web-apis#add-permissions-to-access-web-apis)を参照してください。

Auth0では、この構成が正常に機能するために（Microsoft Graph APIとAPIを公開するように構成したWebアプリケーションに）必要な最小特権アクセス許可を有効にする必要があります。Microsoft Graph APIのアクセス許可の詳細については、Microsoft Docsの「[Microsoft Graphのアクセス許可のリファレンス](https://learn.microsoft.com/en-us/graph/permissions-reference)」をお読みください。

アクセス許可のセットアップ中は、Microsoft Graph APIに以下の設定を必ず使用してください。

* アクセス許可の種類を求められたら、**［Delegated permissions（委任されたアクセス許可）］** を選択します。

  + **［User（ユーザー）］** で **［User.Read］** を選択し、ユーザーをアプリにサインインさせ、サインインしたユーザーのプロファイルを読み取れるようにします。
  + **［Directory（ディレクトリ）］** で **［Directory.Read.All］** を選択し、アプリがサインインしたユーザーの代理としてディレクトリデータを読み取れるようにします。

APIを公開するように構成したWebアプリに対しては、以下の設定を必ず使用してください。

* アクセス許可の種類を求められたら、**［Delegated permissions（委任されたアクセス許可）］** を選択します。

  + **［API］** で **［API.Access］** を選択し、アプリがユーザーの代理としてAPIにアクセスできるようにします。

## Auth0で接続を構成する

Microsoft Entra IDで両方のアプリケーションを作成したら、Auth0の接続を構成することができます。

1. [［Auth0 Dashboard］>［Authentication（認証）］>［Enterprise（エンタープライズ）］](https://manage.auth0.com/#/connections/enterprise)に移動し、**［Microsoft Entra ID］** を見つけ、追加（** +**）ボタンを選択します。

   <Frame>![Dashboard - 接続 -エンタープライズ](/images/ja-jp/cdy7uua7fh8z/1fSTcrZpkgkPR64NnI1lr8/101fc19f62d82b5c7b13d88f3a0a8e96/Enterprise_Connections_-_JP.png)</Frame>

2. 接続の詳細を入力し、 **［Create（作成）］** をクリックします。

   <table class="table"><thead>
   <tr>
   <th>フィールド</th>
   <th>説明</th>
   </tr>
   </thead>
   <tbody>
   <tr>
   <td><strong>Connection name（接続名）</strong></td>
   <td>接続の論理識別子。テナントに対して一意でなければなりません。一度設定すると、この名前は変更できません。</td>
   </tr>
   <tr>
   <td><strong>Microsoft Entra ID Domain</strong></td>
   <td>Microsoft Entra IDドメイン名。これは、Microsoft AzureポータルのMicrosoft Entra IDディレクトリの概要ページで確認できます。</td>
   </tr>
   <tr>
   <td><strong>Client ID（クライアントID）</strong></td>
   <td>登録済みMicrosoft Entra IDアプリケーションの一意の識別子。Microsoft Entra IDで登録したネイティブアプリケーションについて **Application (client) ID（アプリケーション（クライアント）ID）** の保存された値を入力します。</td>
   </tr>
   <tr>
   <td><strong>Client Secret（クライアントシークレット）</strong></td>
   <td>登録済みMicrosoft Entra IDアプリケーションにアクセスするために使用される文字列。Microsoft Entra IDで登録したネイティブアプリケーションについて ** Client secret（クライアントシークレット）** の保存された値を入力します。</td>
   </tr>
   <tr>
   <td><strong>Use common endpoint（共通のエンドポイントの使用）</strong> （任意）</td>
   <td>有効にすると、アプリケーションは新しいディレクトリからユーザーを動的に受け入れます。一般的に、Microsoft Entra IDに登録したアプリケーションの **Supported account types（サポートされているアカウントの種類）** に対して複数テナントのオプションを選択した場合は、有効にします。有効にした場合、Auth0は、ユーザーをAzureの共通のログインエンドポイントにリダイレクトし、Azureは、ユーザーのメールアドレスのドメインに基づいて、<em>ホーム領域検出</em>を行います。</td>
   </tr>
   <tr>
   <td><strong>Identity API（アイデンティティAPI）</strong></td>
   <td>Microsoft Entra IDエンドポイントとやり取りするためのAuth0が使用するAPI。動作の違いについては、Microsoftの[Microsoft IDプラットフォーム（v2.0）に更新する理由]（https://docs.microsoft.com/en-us/azure/active-directory/develop/azure-ad-endpoint-comparison）ドキュメントをご覧ください。`Azure Active Directory (v1)`を選択し、<strong>App ID URI</strong>については、APIに公開するためにWebアプリケーションを構成した時に作成された<strong>Application ID URI</strong>の保存された値を入力します。</td>
   </tr>
   <tr>
   <td><strong>Attributes（属性）</strong></td>
   <td>アプリがアクセスできるサインインしたユーザーの基本属性。Auth0ユーザープロファイルにどの程度情報を保管したいかを示します。</td>
   </tr>
   <tr>
   <td><strong>Extended Attributes（拡張属性）</strong> （任意）</td>
   <td>アプリがアクセスできるサインインしたユーザーの拡張属性。</td>
   </tr>
   <tr>
   <td><strong>Auth0 APIs</strong> （任意）</td>
   <td>選択されると、Microsoft Entra IDユーザーAPIを呼び出す権限が必要なことを示します。</td>
   </tr>
   <tr>
   <td><strong>Sync user profile attributes at each login（ログインの度にユーザープロファイル属性を同期する）</strong></td>
   <td>有効にすると、Auth0はユーザープロファイルデータと各ユーザーログインを自動的に同期するため、接続ソースでの変更が、自動的にAuth0で更新されるようになります。</td>
   </tr>
   <tr>
   <td><strong>Email Verification（メール検証）</strong></td>
   <td>Auth0がユーザープロファイルで`email_verified`フィールドを設定する方法を選択します。詳細については、<a href="/ja-jp/connections/azuread-adfs-email-verification">Microsoft Entra IDとADFSのメール検証</a>をご覧ください。</td>
   </tr>
   </tbody>
   </table>

   <Frame>![Microsoft Entra ID接続を新規作成する](/images/ja-jp/cdy7uua7fh8z/1r6WTgLJUlbiV9jligIwER/f9862dd5ba92afa7d977134b5628ff09/Enterprise_Connection_-_MSFT_-_Japanese.png)</Frame>

## Auth0アプリケーションでエンタープライズ接続を有効化する

新たなMicrosoft Entra IDエンタープライズ接続を使用するには、Auth0アプリケーションの[接続を有効](/ja-jp/authenticate/identity-providers/enterprise-identity-providers/enable-enterprise-connections)にする必要があります。

## 接続をテストする

これで[接続をテスト](/ja-jp/authenticate/identity-providers/enterprise-identity-providers/test-enterprise-connections)する準備が整いました。

## グループメンバーシップと詳細なプロファイル情報

このネイティブフローでは、Auth0は、Microsoft Entra IDからアクセストークンを受け取ります。このトークンは、Microsoft Entra IDのWebアプリケーション用に発行されたものです。この結果、グループメンバーシップや詳細なプロファイル情報の読み込みなどの機能は機能しなくなります。これは、Microsoft Entra IDから受け取ったアクセストークンを使って、Microsoft Entra ID Graph APIからこの追加情報を照会できなくなるためです。

ただし、グループメンバーシップと詳細なプロファイル情報を使用している場合は、ニーズに合わせて構成を変更することができます。

1. Azureでは、Microsoft Graph APIの追加アクセス許可を使ってネイティブアプリケーションを構成します。

   * アクセス許可の種類を求められたら、**［Delegated permissions（委任されたアクセス許可）］** を選択します。

     + **［Directory（ディレクトリ）］** で **［Directory.AccessAsUser.All］** を選択し、アプリがサインインしたユーザーとしてディレクトリにアクセスできるようにします。
2. Auth0で、Microsoft Entra IDエンタープライズ接続を変更します。

   * **［Identity API］** で `［Microsoft Entra ID (v1)］` を選択します。** ［App ID URI（アプリIDのURI）］** には、Microsoft Entra ID Graph APIのURIを入力します。

     ```
     https://graph.windows.net
     ```

     

     

## 次の手順

* [Auth0のライブラリーを使ってAuth0を統合する](/ja-jp/libraries)
* [Authentication APIを使ってAuth0を統合する](/ja-jp/api/authentication)
* [認証フローについての詳細を読む](/ja-jp/get-started/authentication-and-authorization-flow)
* [追加のパラメーターをIDプロバイダーに渡す](/ja-jp/authenticate/identity-providers/pass-parameters-to-idps)
* [アクセス許可のためにユーザーを再度プロンプトする](/ja-jp/authenticate/identity-providers/social-identity-providers/reprompt-permissions)