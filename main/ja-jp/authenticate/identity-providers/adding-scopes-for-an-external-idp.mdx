---
title: "IDプロバイダーのAPIを呼び出すためにスコープ/権限を追加する"
permalink: "adding-scopes-for-an-external-idp"
'description': "IdP接続にスコープを追加する方法について説明します。"
'og:title': "IDプロバイダーのAPIを呼び出すためにスコープ/権限を追加する"
'og:description': "IdP接続にスコープを追加する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "IDプロバイダーのAPIを呼び出すためにスコープ/権限を追加する"
'twitter:description': "IdP接続にスコープを追加する方法について説明します。"
---

ユーザーがログインすると、ユーザープロファイルを取得してから、関連付けられている`accessToken`を取得して、IDプロバイダー（<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-2" href="/ja-jp/glossary?term=idp" tip="IDプロバイダー（IdP）: デジタルIDを保存および管理するサービス。" cta="用語集の表示">IdP</Tooltip>）のAPIを呼び出すことができます。これについては、「[IDプロバイダーのAPIを呼び出す](/ja-jp/authenticate/identity-providers/calling-an-external-idp-api)」で説明されています。

しかし、IdPのAPI呼び出しで`Access Denied`（アクセス拒否）を受け取った場合には、ログインでユーザーの正しい権限が要求されていなかった可能性があります。正しい許可を要求するには、2つの方法があります。

## IDプロバイダーの設定を変更する

ユーザーからの必要なスコープ/権限を構成するには、[［Auth0 Dashboard］>［Authentication（認証）］>［Social（ソーシャル）］](https://manage.auth0.com/#/connections/social)に移動して、IdPを選択します。構成画面にあるリストから必要な権限を選択することができます。

たとえば、 **Google / Gmail** 接続を選択すると、Google特有の権限を構成することができます。

<Frame>![Googleのアクセス許可](/images/ja-jp/cdy7uua7fh8z/61ACa6hnMtO5aUjus0fCb7/93bed1134946c7bab04af1c7c643bf4a/2025-01-13_15-46-07.png)</Frame>

## スコープを認可エンドポイントに渡す

要求したいスコープ/権限をコンマ区切りのリストとして`connection_scope`パラメーターで渡し、[認可エンドポイント](/ja-jp/api/authentication#login)を呼び出すこともできます。たとえば、Googleからのスコープ「`https://www.googleapis.com/auth/contacts.readonly`」と「`https://www.googleapis.com/auth/analytics`」を要求したい場合には、これらを`connection`パラメーターとして渡し、ユーザーが確実に自分のGoogleアカウントでログインするようにします。

```sh lines
https://{yourDomain}/authorize
  ?response_type=id_token
  &client_id={yourClientId}
  &redirect_uri={https://yourApp/callback}
  &scope=openid%20profile
  &connection=google-oauth2
  &connection_scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics%2Chttps%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcontacts.readonly
  &nonce=abc
```

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

上記の要求例では、`connection_scope`パラメーターの値がURLエンコードされています。Googleには次のようにデコードされた値が渡されます：`https://www.googleapis.com/auth/analytics, https://www.googleapis.com/auth/contacts.readonly`

</Callout>

