---
title: "ステップアップ認証を追加する"
permalink: "step-up-authentication"
'description': "ユーザーがMFAを使ってログインしたことを確認し、（ログインしていない場合）特定のリソースにアクセスするためにユーザーに対してステップアップ認証を必須にする場合、APIとWebアプリでステップアップ認証がどのように機能するかについて説明します。"
'og:title': "ステップアップ認証を追加する"
'og:description': "ユーザーがMFAを使ってログインしたことを確認し、（ログインしていない場合）特定のリソースにアクセスするためにユーザーに対してステップアップ認証を必須にする場合、APIとWebアプリでステップアップ認証がどのように機能するかについて説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "ステップアップ認証を追加する"
'twitter:description': "ユーザーがMFAを使ってログインしたことを確認し、（ログインしていない場合）特定のリソースにアクセスするためにユーザーに対してステップアップ認証を必須にする場合、APIとWebアプリでステップアップ認証がどのように機能するかについて説明します。"
---

ステップアップ認証を使うと、さまざまなタイプのリソースへのアクセスを許可するアプリケーションが、機密情報にアクセスするユーザーに、より強力な認証メカニズムを使用して認証するよう要求できます。

Auth0の拡張可能な多要素認証（<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=multifactor-authentication" tip="多要素認証（MFA）: ユーザー名とパスワードに加えて、SMS経由のコードなどの要素を使用するユーザー認証プロセス。" cta="用語集の表示">MFA</Tooltip>）サポートを使って、ステップアップ認証をアプリに追加することができます。お使いのアプリで、ユーザーがMFAを使ってログインしたことを確認できます。ログインしていない場合は、特定のリソースへのアクセスをユーザーに対して必須にすることができます。

## 仕組み

例として、Fabrikamのイントラネットでは、ユーザーはユーザー名とパスワードで認証を行い、顧客データにアクセスする必要があります。ただし、（機微な給与情報が含まれた可能性のある）従業員データへのアクセスを要求する場合、MFAなどのより強力な認証メカニズムがトリガーされます。

<Frame>![MFAステップアップ認証フロー図](/images/ja-jp/cdy7uua7fh8z/3w3duzjtD5B2Nu3oVQcbh/ca235892861f9d9b9cc923c2536caece/step-up-flow.png)</Frame>

## APIのステップアップ認証

対象がAPIの場合、Auth0で[スコープ](/ja-jp/get-started/apis/scopes)、[アクセストークン](/ja-jp/secure/tokens/access-tokens)、[Actions](/ja-jp/customize/actions)を使用してステップアップ認証を実装できます。Actionを使うと、ユーザーが機微なリソースにマッピングするスコープを要求するたびに、ステップアップ認証メカニズム（MFAプロンプトなど）をトリガーできます。

弊社の例では、ユーザーはFabrikamのWebアプリにサインインします。標準のログインを使用すると、ユーザーはAPIを操作してユーザーのアカウントリストを取得することができます。つまり、ユーザー認証後にアプリケーションが受け取るアクセストークンには、`read:accounts`などのスコープが含まれます。

次に、ユーザーはあるアカウントから別のアカウントに資金を送金したいと考えます。この送金は高額な取引とみなされます。この処理を実行するには、APIでは`transfer:funds`スコープが必要です。

ユーザーの現在のアクセストークンにはこのスコープは含まれておらず、アプリケーションはこの状況を把握しています（アプリケーションは最初の認証呼び出しにおいて、要求したスコープセットをわかっているため）。アプリケーションは別の認証呼び出しを行いますが、今度は、`transfer:funds`スコープを要求します。ブラウザーがAuth0にリダイレクトされます。高価値スコープが要求されたため、FabrikamのActionに基づいて、Auth0はMFAで認証を行うようユーザーにチェレンジします。ユーザーがMFAで認証に成功すると、高価値スコープを含む新しいアクセストークンが生成、送信されます。アプリケーションはアクセストークンをAPIに渡し、検証後に破棄することで、1回限り使用できるトークンとして扱われます。

詳細については、「[API用にステップアップ認証を構成する](/ja-jp/secure/multi-factor-authentication/step-up-authentication/configure-step-up-authentication-for-apis)」をお読みください。

## Webアプリのステップアップ認証

認証レベルを検証するのがAPIでなくWebアプリである場合、アクセストークンはありません。この場合、ユーザーのIDトークンの内容を確認することで、ユーザーがMFAを使用してログインしたかをチェックできます。ユーザーがMFAを使ってログインしなかったことがIDトークンで示されている場合、機微情報を含むページへのアクセスを拒否するようにアプリケーションを構成し、Actionを使ってステップアップ認証メカニズム（MFAプロンプトなど）をトリガーできます。たとえば、ユーザー名とパスワードでユーザー認証を行う従業員アプリを持っていたとしても、給与情報にアクセスしたい場合は、モバイルプッシュ通知などの第2要素を提供する必要があります。

このアクションを実行するには、ユーザーがそのページにアクセスしようとするときにIDトークンを確認します。クレームに、ユーザーがMFAで認証済みであることが示されている場合、機微情報が表示されます。そうでない場合は、Actionを使って認証を再度トリガーし、ユーザーにMFAで認証を行うよう促します。

詳細については、「[Webアプリ用にステップアップ認証を構成する](/ja-jp/secure/multi-factor-authentication/step-up-authentication/configure-step-up-authentication-for-web-apps)」をお読みください。

## もっと詳しく

* [APIのステップアップ認証を構成する](/ja-jp/secure/multi-factor-authentication/step-up-authentication/configure-step-up-authentication-for-apis)
* [Webアプリにステップアップ認証を設定する](/ja-jp/secure/multi-factor-authentication/step-up-authentication/configure-step-up-authentication-for-web-apps)