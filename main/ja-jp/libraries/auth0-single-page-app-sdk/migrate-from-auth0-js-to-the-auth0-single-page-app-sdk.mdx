---
title: "Auth0.jsからAuth0シングルページアプリSDKに移行する"
permalink: "migrate-from-auth0-js-to-the-auth0-single-page-app-sdk"
'description': "シングルページアプリケーションをAuth0.jsからAuth0シングルページアプリSDKに移行する方法について説明します。"
'og:title': "Auth0.jsからAuth0シングルページアプリSDKに移行する"
'og:description': "シングルページアプリケーションをAuth0.jsからAuth0シングルページアプリSDKに移行する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Auth0.jsからAuth0シングルページアプリSDKに移行する"
'twitter:description': "シングルページアプリケーションをAuth0.jsからAuth0シングルページアプリSDKに移行する方法について説明します。"
---

この記事では、シングルサインアプリ（SPA）を[auth0.js](/ja-jp/libraries/auth0js)から[auth0-spa-js](/ja-jp/libraries/auth0-single-page-app-sdk)に移行する方法について説明します。以下は、auth0.jsとそれに相当するauth0-spa-jsコードを使ったシナリオです。

## 移行できない機能性

auth0.jsにある機能性のすべてが、auth0-spa-jsに直接移行できるわけではありません。直接移行できないシナリオには、以下が挙げられます。

* [ユーザー名とパスワードによるログイン](https://auth0.github.io/auth0.js/WebAuth.html#login)（埋め込み型）と[パスワードレスログイン](https://auth0.github.io/auth0.js/WebAuth.html#passwordlessLogin)
* ユーザーの[サインアップ](https://auth0.github.io/auth0.js/WebAuth.html#signup)
* [/userinfoエンドポイントからユーザープロファイルを取得する](https://auth0.github.io/auth0.js/Authentication.html#userInfo)
* [ユーザーのパスワードを変更するメールを要求する](https://auth0.github.io/auth0.js/WebAuth.html#changePassword)
* [Management APIを使ってユーザーをリンクする](https://auth0.github.io/auth0.js/Management.html#linkUser)
* [Management APIを使ってユーザーを取得する](https://auth0.github.io/auth0.js/Management.html#getUser)
* [Management APIを使ってユーザー属性を更新する](https://auth0.github.io/auth0.js/Management.html#patchUserAttributes)
* [Management APIを使ってユーザーのメタデータを更新する](https://auth0.github.io/auth0.js/Management.html#patchUserMetadata)
* Auth0.jsでは構成できても、相当するものがauth0-spa-jsにはないようなオプションもいくつかあります。`responseType`はその一例です。各オプションに1:1の直接的なマッピングが存在しないのには理由があります。この場合、`responseType`は不要です。SDKはSPA専用であるため、応答タイプを変更する必要はありません。

## 認証パラメーターは今後変更されない

Auth0.jsは設定したカスタムパラメーターを内部で`camelCase`から`snake_case`に変換します。たとえば、`deviceType:'offline'`を設定する場合、auth0.jsは実際には`device_type:'offline'`をサーバーに送信します。

auth0-spa-jsを使用する場合、カスタムパラメーターは`camelCase`から`snake_case`に**変換されません** 。送信するパラメーターがそのまま認可サーバーに渡されます。

## クライアントを作成する

### auth0.js

* [WebAuth](https://auth0.github.io/auth0.js/WebAuth.html)

codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet

```javascript lines
import { WebAuth } from 'auth0.js';

window.addEventListener('load', () => {
  var auth0 = new WebAuth({
    domain: '{yourDomain}',
    clientID: '{yourClientId}',
    redirectUri: 'https://YOUR_APP/callback'
  });
});
```

### auth0-spa-js

* [createAuth0Client()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#constructor)
* [Auth0ClientOptions](https://auth0.github.io/auth0-spa-js/interfaces/Auth0ClientOptions.html)

codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet

```javascript lines
import createAuth0Client from '@auth0/auth0-spa-js';

window.addEventListener('load', () => {
  const auth0 = await createAuth0Client({
    domain: '{yourDomain}',
    client_id: '{yourClientId}',
    redirect_uri: 'https://YOUR_APP/callback'
  });
});
```

## ユニバーサルログインページにリダイレクトする

### auth0.js

* [authorize()](https://auth0.github.io/auth0.js/WebAuth.html#authorize)

```javascript lines
document.getElementById('login').addEventListener('click', () => {
  auth0.authorize();
});
```

### auth0-spa-js

* [Auth0Client.loginWithRedirect()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#loginWithRedirect)
* [RedirectLoginOptions](https://auth0.github.io/auth0-spa-js/interfaces/RedirectLoginOptions.html)

```javascript lines
document.getElementById('login').addEventListener('click', async () => {
  await auth0.loginWithRedirect();
});
```

## リダイレクト後にハッシュを解析する

### auth0.js

* [parseHash()](https://auth0.github.io/auth0.js/WebAuth.html#parseHash)

```javascript lines
window.addEventListener('load', () => {
  auth0.parseHash({ hash: window.location.hash }, function(err, authResult) {
    if (err) {
      return console.log(err);
    }
    console.log(authResult);
  });
});
```

### auth0-spa-js

* [Auth0Client.handleRedirectCallback()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#handleRedirectCallback)

```javascript lines
window.addEventListener('load', async () => {
  await auth0.handleRedirectCallback();
});
```

## ユーザー情報を取得する

### auth0.js

`userInfo()`関数は[`/userinfo`エンドポイント](https://auth0.com/docs/api/authentication#user-profile)を呼び出して、ユーザープロファイルを返します。

* [userInfo()](https://auth0.github.io/auth0.js/Authentication.html#userInfo)

```javascript lines
window.addEventListener('load', () => {
  auth0.client.userInfo(accessToken, function(err, user) {
    console.log(user)
  });
});
```

### auth0-spa-js

auth0.jsとは異なり、Auth0 SPA SDKはユーザープロファイルのために[`/userinfo`エンドポイント](https://auth0.com/docs/api/authentication#user-profile)を呼び出しません。代わりに、`Auth0Client.getUser()`はデコードされた`id_token`からのユーザー情報を返します。

* [Auth0Client.getUser()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#getUser)

```javascript lines
window.addEventListener('load', async () => {
  const user = await auth0.getUser();
  console.log(user);
});
```

## ポップアップでユニバーサルログインページを開く

### auth0.js

```javascript lines
document.getElementById('login').addEventListener('click', () => {
  auth0.popup.authorize();
});
```

### auth0-spa-js

* [Auth0Client.loginWithPopup()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#loginWithPopup)
* [PopupLoginOptions](https://auth0.github.io/auth0-spa-js/interfaces/PopupLoginOptions.html)

```javascript lines
document.getElementById('login').addEventListener('click', async () => {
  await auth0.loginWithPopup();
});
```

## リフレッシュトークン

### auth0.js

* [checkSession()](https://auth0.github.io/auth0.js/WebAuth.html#checkSession)

```javascript lines
document.getElementById('login').addEventListener('click', () => {
  auth0.checkSession({}, function(err, authResult) {
    // Authentication tokens or error
  });
});
```

### auth0-spa-js

Auth0 SPA SDKは、アクセストークンのリフレッシュを処理します。`getTokenSilently`を呼び出すたびに、有効なアクセストークンを取得するか、Auth0でセッションがない場合はエラーが返されます。

* [Auth0Client.getTokenSilently()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#getTokenSilently)

```javascript lines
document.getElementById('login').addEventListener('click', async () => {
  await auth0.getTokenSilently();
});
```

## 別のオーディエンスまたはより多くのスコープを使ってトークンを取得する

### auth0.js

* [checkSession()](https://auth0.github.io/auth0.js/WebAuth.html#checkSession)

```javascript lines
document.getElementById('login').addEventListener('click', () => {
  auth0.checkSession({
    audience: 'https://mydomain/another-api/',
    scope: 'read:messages'
  }, function(err, authResult) {
    // Authentication tokens or error
  });
});
```

### auth0-spa-js

Auth0 SPA SDKは、アクセストークンのリフレッシュを処理します。`getTokenSilently`を呼び出すたびに、有効なアクセストークンを取得するか、Auth0でセッションがない場合はエラーが返されます。

* [Auth0Client.getTokenSilently()](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#getTokenSilently)
* [GetTokenSilentlyOptions](https://auth0.github.io/auth0-spa-js/interfaces/GetTokenSilentlyOptions.html)

```javascript lines
document.getElementById('login').addEventListener('click', async () => {
  await auth0.getTokenSilently({
    audience: 'https://mydomain/another-api/',
    scope: 'read:messages'
  });
});
```

[getTokenWithPopup](https://auth0.github.io/auth0-spa-js/classes/Auth0Client.html#getTokenWithPopup)を使ってポップアップを開き、ユーザーが新しいAPIに同意できるようにします。

```javascript lines
document.getElementById('login').addEventListener('click', async () => {
  await auth0.getTokenWithPopup({
    audience: 'https://mydomain/another-api/',
    scope: 'read:messages'
  });
});
```

