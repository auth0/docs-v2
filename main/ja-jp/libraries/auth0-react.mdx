---
title: "シングルページアプリ用Auth0 React SDK"
permalink: "auth0-react"
'description': "Reactシングルページアプリ用Auth0 SDKについて説明します。"
'og:title': "シングルページアプリ用Auth0 React SDK"
'og:description': "Reactシングルページアプリ用Auth0 SDKについて説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "シングルページアプリ用Auth0 React SDK"
'twitter:description': "Reactシングルページアプリ用Auth0 SDKについて説明します。"
---

Auth0 React SDK（auth0-react.js）は、Auth0を使用してReactアプリケーションで認証と認可を実装するためのJavaScriptライブラリです。カスタムReactフックとその他の高階コンポーネントを提供し、ベストプラクティスに従ってReactアプリをセキュリティ保護しながら、同時にコードの量を減らすことができます。

Auth0 React SDKは、付与とプロトコルの詳細、トークンの失効と更新、そして、トークンの保管とキャッシュをも処理します。内部では、[ユニバーサルログイン](/ja-jp/authenticate/login/auth0-universal-login)と[PKCEを用いた認可コード付与フロー](/ja-jp/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)を実装しています。

ライブラリは[GitHubで提供しており](https://github.com/auth0/auth0-react)、[APIに関するさらなる詳細を読むことができます](https://auth0.github.io/auth0-react/)。

## インストール

プロジェクトでauth0-react.jsを使用するには、いくつかのオプションがあります。

* [npm](https://npmjs.org/)から：

  `npm install @auth0/auth0-react`
* [yarn](https://yarnpkg.com/)から：
  `yarn add @auth0/auth0-react`

## 開始

まず、アプリケーションを1つの`Auth0Provider`コンポーネントでラップする必要があります。これにより、アプリケーションの内部に配置されたコンポーネントにReactのコンテキストが提供されます。

```javascript lines
import React from 'react';
    import ReactDOM from 'react-dom';
    import { Auth0Provider } from '@auth0/auth0-react';
    import App from './App';
    ReactDOM.render(
      <Auth0Provider
        domain="{yourDomain}"
        clientId="{yourClientId}"
        authorizationParams={{
          redirect_uri: window.location.origin
        }}
    >
      <App />
    </Auth0Provider>,
    document.getElementById('app')
 );
```

## isLoadingとerror

SDKが初期化するのを待ってから、`isLoading`状態と`error`状態ですべてのエラーを処理します。

```javascript lines
import React from 'react';
import { useAuth0 } from '@auth0/auth0-react';
function Wrapper({ children }) {
  const {
    isLoading,
    error,
  } = useAuth0();
  if (isLoading) {
    return <div>Loading...</div>;
  }
  if (error) {
    return <div>Oops... {error.message}</div>;
  }
  return <>{children}</>;
}
export default Wrapper;
```

## ログイン

`loginWithRedirect`または`loginWithPopup`を使用して、ユーザーをログインさせます。

```javascript lines
import React from 'react';
import { useAuth0 } from '@auth0/auth0-react';

function LoginButton() {
  const {
    isAuthenticated,
    loginWithRedirect,
  } = useAuth0();

  return !isAuthenticated && (
    <button onClick={loginWithRedirect}>Log in</button>
  );
}

export default LoginButton;
```

## ログアウト

`logout`を使用して、ユーザーをログアウトさせます。<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>の「Allowed Logout URLs（許可されているログアウトURL）」に`returnTo`が指定されていることを確認してください。

```javascript lines
import React from 'react';
import { useAuth0 } from '@auth0/auth0-react';

function LogoutButton() {
  const {
    isAuthenticated,
    logout,
  } = useAuth0();

  return isAuthenticated && (
    <button onClick={() => {
      logout({ 
        logoutParams: {
          returnTo: window.location.origin
        }
      });
    }}>Log out</button>
  );
}

export default LogoutButton;
```

## ［User（ユーザー）］

`user`値を使用して、ユーザープロファイル情報にアクセスします。

```javascript lines
import React from 'react';
import { useAuth0 } from '@auth0/auth0-react';

function Profile() {
  const { user } = useAuth0();

  return <div>Hello {user.name}</div>;
}

export default Profile;
```

## クラスコンポーネントと併用する

フックの代わりに`withAuth0`高階コンポーネントを使用して、`auth0`プロパティをクラスコンポーネントに追加します。

```javascript lines
import React, { Component } from 'react';
import { withAuth0 } from '@auth0/auth0-react';

class Profile extends Component {
  render() {
    const { user } = this.props.auth0;
    return <div>Hello {user.name}</div>;
  }
}

export default withAuth0(Profile);
```

## ルートを保護する

`withAuthenticationRequired`高階コンポーネントを使用して、ルートコンポーネントを保護します。認証されていない状態でこのルートにアクセスすると、ユーザーはログインページにリダイレクトされ、ログイン後にこのページに戻ってきます。

```javascript lines
import React from 'react';
import { withAuthenticationRequired } from '@auth0/auth0-react';

const PrivateRoute = () => (<div>Private</div>);

export default withAuthenticationRequired(PrivateRoute, {
  // Show a message while the user waits to be redirected to the login page.
  onRedirecting: () => (<div>Redirecting you to the login page...</div>)
});
```

**注** カスタムルーターを使用している場合、`Auth0Provider`にカスタムの`onRedirectCallback`メソッドを提供して、ユーザーを保護されたページに戻すアクションを実行する必要があります。[react-router](https://github.com/auth0/auth0-react/blob/master/EXAMPLES.md#1-protecting-a-route-in-a-react-router-dom-app)、[Gatsby](https://github.com/auth0/auth0-react/blob/master/EXAMPLES.md#2-protecting-a-route-in-a-gatsby-app)、および[Next.js](https://github.com/auth0/auth0-react/blob/master/EXAMPLES.md#3-protecting-a-route-in-a-nextjs-app-in-spa-mode)の例を参照してください。

## APIを呼び出す

アクセストークンを使用して保護されたAPIを呼び出すには、`Auth0Provider`または`getAccessTokenSilently`のいずれかで、必ず[アクセストークン](/ja-jp/secure/tokens/access-tokens/get-access-tokens)の`audience`および`scope`を指定してください。その後、これを要求の`Authorization`ヘッダーに渡して、保護されたAPIを呼び出します。

```javascript lines
import React, { useEffect, useState } from 'react';
import { useAuth0 } from '@auth0/auth0-react';

const Posts = () => {
  const { getAccessTokenSilently } = useAuth0();
  const [posts, setPosts] = useState(null);

  useEffect(() => {
    (async () => {
      try {
        const token = await getAccessTokenSilently({
          authorizationParams: {
            audience: 'https://api.example.com/', // Value in Identifier field for the API being called.
            scope: 'read:posts', // Scope that exists for the API being called. You can create these through the Auth0 Management API or through the Auth0 Dashboard in the Permissions view of your API.
          }
        });
        const response = await fetch('https://api.example.com/posts', {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });
        setPosts(await response.json());
      } catch (e) {
        console.error(e);
      }
    })();
  }, [getAccessTokenSilently]);

  if (!posts) {
    return <div>Loading...</div>;
  }

  return (
    <ul>
      {posts.map((post, index) => {
        return <li key={index}>{post}</li>;
      })}
    </ul>
  );
};

export default Posts;
```

