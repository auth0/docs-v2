---
title: "開発におけるHTTPS"
permalink: "secure-local-development"
'description': "samesiteクッキーで動作するようにローカル開発サーバーを保護する"
'og:title': "開発におけるHTTPS"
'og:description': "samesiteクッキーで動作するようにローカル開発サーバーを保護する"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "開発におけるHTTPS"
'twitter:description': "samesiteクッキーで動作するようにローカル開発サーバーを保護する"
---

ローカル開発環境は通常、そのままではhttp（つまりhttp://localhost）で実行されます。このガイドでは、ローカルサーバーをhttpsで実行する必要がある場合と、localhostでhttpsを構成する方法について説明します。

## ローカルhttpsサーバーを使用する場合

Web ブラウザーはhttpおよびhttpsで動作が異なります。これらの違いを考慮するには、開発サーバーでhttps経由でページを提供する必要があります。例：

* ページがhttpsで提供される場合、httpURLからリソースを読み込む要求はブロックされます。実稼働環境でのみ発生するバグを回避するため、または誤って機密情報を含むhttp要求を作成したくないために、この動作をローカルで実行する必要がある場合があります。
* Secure属性または[SameSite](https://auth0.com/blog/browser-behavior-changes-what-developers-need-to-know/)属性をNoneに設定して使用する Cookie は、安全でないチャネルを介して送信されず、認証やその他の機能が中断されます。

## 安全なローカルサーバーを設定する方法

ここでは、ローカル開発したサーバーの前でWebサーバーを実行し、https要求を受け入れてhttp経由でアプリケーションのWebサーバーに転送し、プロキシによってhttps経由でアプリケーションの要求を処理することを目指しています。これはhttpsリバースプロキシと呼ばれ、[Caddy](https://caddyserver.com/v2)という既製品を使用してhttpsリバースプロキシを作成できます。

これを行うプロセスは次のとおりです。

1. Caddyバイナリをダウンロードする
2. アプリケーションのWebサーバーを通常どおりhttp経由で実行する
3. Caddyバイナリをリバースプロキシとして実行し、トラフィックをアプリケーションのWebサーバーに転送するように指示する
4. https経由でリバース プロキシWebサーバーにアクセスする

### 1.Caddyバイナリをダウンロードする

[https://caddyserver.com/download](https://caddyserver.com/download)にアクセスし、プラットフォームを選択して、ファイルをコンピューターにダウンロードします。

### 2.アプリケーションのWebサーバーを通常どおりhttp経由で実行する

アプリケーションのローカル開発サーバーを通常どおり実行します（例: $ PORT=3000 npm start）

### 3.Caddyバイナリをリバースプロキシとして実行し、トラフィックをアプリケーションのWebサーバーに転送するように指示する

ダウンロードしたCaddyバイナリの場所を見つけて、次のコマンドを実行してリバースプロキシを作成し、ポート443（httpsに使用されるデフォルトのポート）からアプリケーションのポート（この場合は3000）に要求を転送します。

```bash lines
/path/to/caddy reverse-proxy --from localhost:443 --to localhost:3000
```

### 4.次に、https経由でWebサーバーにアクセスする

[https://localhost](https://localhost/)にアクセスすると、アプリケーションの要求がhttps経由で処理される

## プロキシの背後でアプリケーションを実行する

プロキシの背後でアプリケーションを実行している場合は、アプリケーションに若干の調整が必要になる場合があります。

たとえばExpress.jsでは、アプリの実行は失敗しませんが、`信頼プロキシ`が構成されていない限り、プロキシの IP アドレスがクライアント IP アドレスとして誤って登録されます。 [https://expressjs.com/en/guide/behind-proxies.html](https://expressjs.com/en/guide/behind-proxies.html)