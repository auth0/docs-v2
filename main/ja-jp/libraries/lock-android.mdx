---
title: "Lock.Android：使用を開始する"
permalink: "lock-android"
'description': "Lock for Androidを始めましょう。ネイティブAndroidアプリに対して、フリクションレスなログインおよびサインアップ体験を提供するウィジェットです。"
'og:title': "Lock.Android：使用を開始する"
'og:description': "Lock for Androidを始めましょう。ネイティブAndroidアプリに対して、フリクションレスなログインおよびサインアップ体験を提供するウィジェットです。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Lock.Android：使用を開始する"
'twitter:description': "Lock for Androidを始めましょう。ネイティブAndroidアプリに対して、フリクションレスなログインおよびサインアップ体験を提供するウィジェットです。"
---

Lock for Androidは、ネイティブAndroidアプリに組み込むことができ、ユーザーがアプリに便利な方法でログインしてサインアップできるようにします。Facebook、Google、またはXのようなソーシャルIDプロバイダーや、Active Directoryなどのエンタープライズプロバイダーをサポートします。

GitHubの[Lock.Androidレポジトリ](https://github.com/auth0/Lock.Android)をご確認ください。

## 要件

[Auth0.Androidライブラリ](https://github.com/auth0/Auth0.Android)を介してLockのUIまたはご自身のUIを使用するために最低限必要なAndroid APIレベルは21以上でJavaバージョン8以上です。また、「ネイティブ」タイプのAuth0アプリケーションも必要です。

以下に、Java 8バイトコードをAndroidとKotlinプラグインのそれぞれのターゲットにするために何が`build.gradle`に必要なのかを示します。

``` lines
android {
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = '1.8'
    }
}
```

## インストール

Lockは[Maven Central](http://search.maven.org)で利用可能です。Lockを開始するには、以下の行を`build.gradle`依存関係ファイルに追加します：

`implementation 'com.auth0.android:lock:3.+'`

最新バージョンはリポジトリの[Readme](https://github.com/auth0/Lock.Android#install)または[Maven](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22lock%22%20g%3A%22com.auth0.android%22)で確認できます。

Gradleの依存関係を追加したら、プロジェクトをGradleファイルと忘れずに同期させます。

## Dashboardの設定

開始する前に、[Auth0 Dashboard](https://manage.auth0.com/#)でいくつかの設定を行う必要があります。

### Callback URL

<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>にアクセスして、アプリケーションの設定に移動します。以下のURLをアプリケーションの **［Allowed Callback URLs（許可されているCallback URL）］** に追加します。

`https://{yourDomain}/android/{yourAppPackageName}/callback`

`{yourAppPackageName}`を、`app/build.gradle`ファイルで`applicationId`値として利用可能な実際のアプリケーションのパッケージ名に置き換えます。

### キーストアおよびキーハッシュ

Androidアプリケーションは、デバイスにインストールする前に、署名される必要があります。このため、Android Studio IDEは初めての実行時にデフォルトの「Androidデバッグキーストア」を生成し、それを使用して開発ビルドに署名します。この[キーストア](https://developer.android.com/studio/publish/app-signing)は、あなたを開発者として識別するために使用されるため、プロダクションビルドのものとはおそらく異なります。

Web Authentication機能（つまり、ソーシャル接続）を使用するとき、Lockは、Androidアプリリンクの使用を試行するようにデフォルトでセットアップされます。これは、Auth0アプリケーションのDashboardでの追加設定を必要とします。[Androidのキーストアおよびキーハッシュのガイド](/ja-jp/android-development-keystores-hashes)を使用して、このステップを完了してください。

## Lockの実装（ソーシャル、データベース、エンタープライズ）

以下では、AndroidへのClassic Lockの実装について説明しています。AndroidにパスワードレスのLockを実装する情報をお探しの場合には、「[Lock.Android：パスワードレス](/ja-jp/libraries/lock-android/lock-android-passwordless)」を参照してください。

### SDKの構成

`app/build.gradle`ファイルで、Auth0ドメインおよびAuth0スキームプロパティに[マニフェストファイル](https://developer.android.com/studio/build/manifest-build-variables.html)を追加すると、それがライブラリによって内部で使用され、認証結果を取り込むインテントフィルタを登録します。

``` lines
plugins {
    id "com.android.application"
    id "kotlin-android"
}

android {
    compileSdkVersion 30
    defaultConfig {
        applicationId "com.auth0.samples"
        minSdkVersion 21
        targetSdkVersion 30
        // ...

        // ---> Add the next line
        manifestPlaceholders = [auth0Domain: "@string/com_auth0_domain", auth0Scheme: "https"]
        // <---
    }
}
```

これらの値を、後でコードから参照可能な文字列リソースとして`strings.xml`ファイルに追加することをお勧めします。このガイドではそのプラクティスに従います。

```xml lines
<resources>
    <string name="com_auth0_client_id">{yourClientId}</string>
    <string name="com_auth0_domain">{yourDomain}</string>
</resources>
```

### SDKの使用方法

Lockを起動する予定のアクティビティで、アプリケーションの情報を用いて`Auth0`のインスタンスを作成します。最も簡単な作成方法は、AndroidのContextを渡す方法です。これは、`strings.xml`ファイルで以前定義した値を使用します。これを行うには、文字列リソースが上記のものと同じキーを使用して定義されなければなりません。

```kotlin lines
val account = Auth0(context)
```

ユーザー認証イベントを処理する`AuthenticationCallback`実装を宣言します。正常な認証シナリオで返される`Credentials`オブジェクトには、アプリケーションまたはAPIが最終的に利用するトークンが含まれます。詳細については、「[トークン](/ja-jp/secure/tokens)」をご覧ください。

```kotlin lines
private val callback = object : AuthenticationCallback() {
    override fun onAuthentication(credentials: Credentials) {
        // Authenticated
    }

    override fun onError(error: AuthenticationException) {
        // Exception occurred
    }
}
```

Builderクラスを使用して構成し、新しいLockインスタンスを準備します。アカウントの詳細と上記で宣言したCallback実装を提供します。オーディエンス、スコープ、使用可能な接続などの値は、ここで構成できます。

完了したら、Lockインスタンスをビルドします。このインスタンスは、再使用されるように意図されており、必要なくなった時に廃棄されなければなりません。これを行うのに最適な場所は、アクティビティの`onDestroy`メソッド内です。

```kotlin lines
// This activity will show Lock
class MyActivity : AppCompatActivity() {

    private lateinit var lock: Lock

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        val account = Auth0(this)
        // Instantiate Lock once
        lock = Lock.newBuilder(account, callback)
            // Customize Lock
            .build(this)
    }

    override fun onDestroy() {
        super.onDestroy()
        // Important! Release Lock and its resources
        lock.onDestroy(this)
    }

    private val callback = object : AuthenticationCallback() {
        override fun onAuthentication(credentials: Credentials) {
            // Authenticated
        }

        override fun onError(error: AuthenticationException) {
            // An exception occurred
        }
    }
}
```

最後に、アクティビティの中から`Lock`ウィジェットを起動します。

```kotlin lines
startActivity(lock.newIntent(this))
```

これで作業完了です。後はLockが処理します。

#### Androidアプリリンク - カスタムスキーム

この記事で使用されており、LockのデフォルトであるCallback URLスキームは`https`です。これは、[Androidアプリリンク](https://developer.android.com/training/app-links)を使用している場合は、Android Marshmallow（API 23）以降で最適に機能しますが、それより前のAndroidバージョンについては、ユーザーにインテント選択ダイアログを表示して、そのインテントを解決するためにアプリケーションかブラウザを選択させる場合があります。これは「曖昧さ回避ダイアログ」と呼ばれます。カスタムの固有スキームを使用して、OSがアプリで直接リンクを開くようにすることで、この動作を変更できます。

1. 既存のスキームを新規のものに変更して、`app/build.gradle`ファイル、または直接`AndroidManifest.xml`ファイルのインテントフィルタ定義の`auth0Scheme`マニフェストファイルの値を更新します。
2. Auth0 Dashboardのアプリケーションの設定の［Allowed Callback URLs（許可されているCallback URL）］を新規スキームから始まるURLに一致するように更新します。
3. ビルダーでLockを構成するときに、使用したいスキームを渡して`withScheme()`を呼び出します。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

スキーム値はすべて小文字でなければなりません。そうでない場合は、警告メッセージがログに記録され、認証が完了することはありません。

</Callout>

## ロックの構成

Lockの構成オプションの完全リストについては、「[Lock.Android：構成](/ja-jp/libraries/lock-android/lock-android-configuration)」を確認してください。

## エラーメッセージ

一般的なエラーメッセージの説明については、[エラーメッセージ](/ja-jp/troubleshoot/basic-issues/check-error-messages)のページをご覧ください。また、コールバックが`AuthenticationException`を受け取った場合は、[ソース](https://github.com/auth0/Auth0.Android/blob/main/auth0/src/main/java/com/auth0/android/authentication/AuthenticationException.kt)を確認してそれぞれのエラーシナリオを特定する方法を知ることができます。

## もっと詳しく

* [Lock.Android:カスタムテーマ設定](/ja-jp/libraries/lock-android/lock-android-custom-theming)
* [Lock.Android：構成](/ja-jp/libraries/lock-android/lock-android-configuration)
* [Lock.Android:サインアップ時のカスタムフィールド](/ja-jp/lock-android-custom-fields-at-signup)
* [Lock.Androidの国際化](/ja-jp/customize/internationalization-and-localization/lock-android-internationalization)
* [ログアウト](/ja-jp/authenticate/login/logout)