---
title: "Lock.Android:ネイティブのソーシャル認証"
permalink: "lock-android-native-social-authentication"
'description': "Lock.Android - ネイティブのソーシャル認証"
'og:title': "Lock.Android:ネイティブのソーシャル認証"
'og:description': "Lock.Android - ネイティブのソーシャル認証"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Lock.Android:ネイティブのソーシャル認証"
'twitter:description': "Lock.Android - ネイティブのソーシャル認証"
---

## ネイティブプロバイダー - Google

**Lock** を使用してもしなくても、Google AuthProviderを利用してログインできます。[セットアップ](#setup)セクションの指示に従ってください。

[Lock-Google.Android](https://github.com/auth0/Lock-Google.Android)には、
Android API 15以降とGoogle Play開発者サービス10以降が必要です。

### Lock-Googleの最新バージョン

Lock-Google[Maven Central](http://search.maven.org)と[JCenter](https://bintray.com/bintray/jcenter)から入手可能です。`build.gradle`に以下のラインを追加するだけでインストールできます：

`compile 'com.auth0.android:lock-google:1.+'`

[Maven](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22lock-google%22%20g%3A%22com.auth0.android%22)または[JCenter](https://bintray.com/auth0/android/lock-google)のリポジトリ[Readme](https://github.com/auth0/Lock-Google.Android#install)で最新バージョンを確認できます。

### Lock-Googleの設定

#### Google開発者コンソール

1. [Google開発者コンソール](https://console.developers.google.com/)に移動して新規プロジェクトを作成します。
2. [OAuth同意画面](https://console.developers.google.com/apis/credentials/consent)に、最低でも有効な電子メールアドレスと名前を入力します。
3. 左側のナビゲーションドロワーで、[［Credentials（資格情報）］](https://console.developers.google.com/apis/credentials)をクリックします。
4. [［Create Credentials（資格情報を作成）］](https://console.developers.google.com/apis/credentials/oauthclient)ボタンをクリックし、**［OAuth client ID（OAuthクライアントID）］** を選択して新しい資格情報を作成します。次に、**［Web Application（ウェブアプリケーション）］** を選択し、「Auth0 Server Google-OAuth」などの名前を付けます。**［Authorized redirect URI（認可されたリダイレクトURI］** フィールドにCallback URL（`https://{yourDomain}/login/callback`など）を入力します。フィールドから離れる前に、必ずENTERキーを押し、［Create （作成）］ボタンをクリックします。`CLIENT ID（クライアントID）`と`CLIENT SECRET（クライアントシークレット）`は後で使うので、覚えておいてください。
5. [［Create Credentials（資格情報を作成）］](https://console.developers.google.com/apis/credentials/oauthclient)ボタンをクリックし、**［OAuth client ID（OAuthクライアントID）］** を選択して新しい資格情報を作成します。次に、［**Android**］を選択し、「Auth0 Android Google-OAuth」などの名前を付けます。アプリケーションに署名するために使う証明書の **SHA-1** を取得して、最初のフィールドにそれを入力します。SHA-1の取得に関してヘルプが必要な場合は [この](#certificate-fingerprints)セクションを参照してください。最後に、最後のフィールドにAndroidアプリケーションの **パッケージ名** を入力し、［Create（作成）］ボタンをクリックします。`CLIENT ID（クライアントID）`は後で使うので、覚えておいてください。

#### Auth0 Dashboard

1. Auth0 Dashboardに移動して[［Social Connections（ソーシャル接続）］](https://manage.auth0.com/#/connections/social)）をクリックします。
2. **Google** をクリックするとダイアログが表示されます。
3. 上記の**Google開発者コンソール** セクション手順4に従って取得した`CLIENT ID`値を［Client ID（クライアントID）］フィールドに入力します。
4. 上記の**Google開発者コンソール** セクション手順4に従って取得した`CLIENT SECRET`値を［Client Secret（クライアントシークレット）］フィールドに入力します。
5. 上記の**Google開発者コンソール** セクション手順4に従って取得した`CLIENT ID`値を［Allowed Mobile Client IDs（許可されるモバイルクライアントID）］フィールドに入力します。
6. ［Save（保存）］ボタンをクリックします。
7. Auth0 Dashboardに移動して[［Applications（アプリケーション）］](https://manage.auth0.com/#/applications)をクリックします。作成がまだの場合は、まずは作成してからアプリケーションの構成ページに移動します。
8. ページの一番下にある［Show Advanced Settings（詳細設定を表示）］リンクをクリックして［Device Settings（デバイス設定）］タブに移動します。
9. Androidのセクションで、［**Package Name（パッケージ名）］** フィールドにアプリケーションのパッケージ名を入力します。最後に、**［Key Hashes（鍵ハッシュ）］** フィールドにアプリケーションに署名する際に使うSHA-256を入力します。SHA-256の取得に関してヘルプが必要な場合は [この](#certificate-fingerprints)セクションを参照してください。［Save Changes（変更を保存）］ボタンをクリックします。

#### Androidアプリケーション

1. Androidアプリケーションの中で、`res/strings.xml`ファイル内に新しい文字列リソースを作成します。「`google_server_client_id`」という名前を付けて、上記の**Google開発者コンソール** 手順5で取得した`CLIENT_ID`を値に設定します。
2. アプリケーションタグ内の`AndroidManifest.xml`ファイルにGoogle Play開発者サービスのバージョンメタデータを追加します。

   ``` lines
   <meta-data
       android:name="com.google.android.gms.version"
       android:value="@integer/google_play_services_version" />
   ```

   

   
3. `AndroidManifest.xml`ファイルにAndroidのInternet権限を追加します。

   ```xml lines
   <uses-permission android:name="android.permission.INTERNET" />
   ```

   

   
4. `GoogleAuthProvider`の新たなインスタンスを作成する際は、以前に最初のパラメーターとして取得した`google_server_client_id`値を渡します。

   ``` lines
   public class MainActivity extends AppCompatActivity {
     private GoogleAuthProvider provider;
     // ...

     @Override
     protected void onCreate(Bundle savedInstanceState) {
       Auth0 auth0 = new Auth0(getString(R.string.com_auth0_client_id), getString(R.string.com_auth0_domain));
       auth0.setOIDCConformant(true);
       AuthenticationAPIClient client = new AuthenticationAPIClient(auth0);
       provider = new GoogleAuthProvider(getString(R.string.google_server_client_id), client);
     }

     // ...
   }
   ```

   

   

Google SDK設定についてヘルプが必要な場合は、Googleの「[Sign-In for Android Guide（Android用サインインガイド）](https://developers.google.com/identity/sign-in/android)」を参照してください。

### Lockを使用しない場合

このプロバイダーを**Lock** なしで使用するつもりであれば、必ず`onActivityResult()`メソッドを上書きして、呼び出しをプロバイダーインスタンスにリダイレクトするようにしてください。最後に、「start」を呼び出して認証プロセスを開始します。

```java lines
// Define your own request codes
private static final int RC_PERMISSIONS = 101;
private static final int RC_AUTHENTICATION = 102;

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (provider.authorize(requestCode, resultCode, data)) {
        return;
    }
    super.onActivityResult(requestCode, resultCode, data);
}

private void beginAuthentication(){
  provider.start(this, callback, RC_PERMISSIONS, RC_AUTHENTICATION);
}
```

これでアプリケーションを実行し、Googleネイティブプロバイダーを使ってログインする準備ができました。

### 追加オプション

#### カスタム接続名を使う

Auth0に対してカスタムソーシャル接続名を使って認可するには、2番目のコンストラクターを使ってGoogleAuthProviderインスタンスを作成します。

```java lines
GoogleAuthProvider provider = new GoogleAuthProvider("my-connection", "google-server-client-id", client);
```

#### 追加の認証パラメーターを送信する

認証で追加のパラメーターを送信するには、`setParameters`を呼び出します。

```java lines
Map<String, Object> parameters = new HashMap<>();
//Add entries
provider.setParameters(parameters);
```

#### Googleカスタムスコープを要求する

デフォルトでは、`Scopes.PLUS_LOGIN`スコープが要求されます。スコープをカスタマイズするには、`setScopes`とスコープのリストを呼び出します。各Google API（Auth、Drive、Plus..）がそれぞれのGoogleスコープのリストを指定します。

```java lines
provider.setScopes(Arrays.asList(new Scope(Scopes.PLUS_ME), new Scope(Scopes.PLUS_LOGIN)));
```

#### Androidカスタムランタイム権限を要求する

このプロバイダーは、ユーザーの認証に特別なAndroid Manifest権限を必要としません。しかし、ユースケースによってそれが必要な場合は、 AuthProviderにこれを処理させることができます。`setRequiredPermissions`メソッドを使います。

```java lines
provider.setRequiredPermissions(new String[]{"android.permission.GET_ACCOUNTS"});
```

Lockを使わない場合は、権限要求結果を自分で処理する必要があります。そのためには、アクティビティに`ActivityCompat.OnRequestPermissionsResultCallback`インターフェイスを実装させます。`onRequestPermissionsResult`メソッドが呼び出されたら、`provider.onRequestPermissionsResult`を呼び出して結果をプロバイダーに渡します。.

#### アカウントからログアウト/クリアします。

ユーザーをログアウトさせて、次回資格情報の入力を求めるようにするには、`clearSession`を呼び出します。その後、プロバイダーの状態が無効になるため、結果を`認可`する前にもう一度`start`を呼び出す必要があります。`stop`を呼び出しても同じ効果があります。

`provider.clearSession();`

#### 前回のログインを記憶

デフォルトでは、このプロバイダーは前回のログインで使われたアカウントを記憶します。その動作を変更するには、以下の方法を使います。

`provider.rememberLastLogin(false);`

#### 証明書のフィンガープリント

Google開発者コンソールで<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=oath2" tip="OAuth 2.0: 認可プロトコルとワークフローを定義する認可フレームワーク。" cta="用語集の表示">OAuth</Tooltip>資格情報を新たに作成する場合は、アプリケーションにサインする際に使う証明書のSHA-1を提供する必要があります。<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>でアプリケーションの構成を完了する際は、SHA-256値も提供する必要があります。以下に、値を取得するためのターミナルコマンド例とその結果例を示します。

コマンド：

`keytool -exportcert -alias androiddebugkey -keystore <PATH_TO_YOUR_KEYSTORE> -storepass android | openssl sha1 -binary | openssl base64`

出力例：

`no71633JAC3qgzQYCbskprUr55k=`

ヘルプが必要な場合は、この[Keystores ガイド](/ja-jp/android-development-keystores-hashes)に従って、これらの値を取得してください。

## ネイティブプロバイダー - Facebook

FacebookAuthProviderを使って、**Lock** のあるなしにかかわらずログインすることができます。[セットアップ](#setup)セクションの指示に従ってください。

[Lock-Facebook](https://github.com/auth0/Lock-Facebook.Android)では、Android API 15以降およびFacebook Android SDK 4.+が必要です。

## 最新バージョン

Lock-Facebookは、[Maven Central](http://search.maven.org)および[JCenter](https://bintray.com/bintray/jcenter)から入手可能です。`build.gradle`に以下の行を追加するだけでインストールできます：

`compile 'com.auth0.android:lock-facebook:3.+'`

[Maven](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22lock-facebook%22%20g%3A%22com.auth0.android%22)または[JCenter](https://bintray.com/auth0/android/lock-facebook)のリポジトリ[Readme](https://github.com/auth0/Lock-Facebook.Android#install)で最新バージョンを確認できます。

### Lock-Facebookのセットアップ

#### Facebook開発者コンソール

1. [Facebook開発者コンソール](https://developers.facebook.com/)に移動して新たなアプリを作成します。［Android］を選んで、有効な名前を付けます。［Create new Facebook App ID（新しいFacebookアプリIDを作成）］をクリックします。
2. アプリケーションの**パッケージ名** と、プロバイダーを使用する**アクティビティクラス** の名前を追加し、［Next（次へ）］ボタンをクリックします。
3. アプリケーションの署名に使う証明書の**SHA-1** Base64エンコードされた鍵ハッシュを追加して、［Next（次へ）］ボタンをクリックします。SHA-1の取得に関してヘルプが必要な場合は [この](#certificate-fingerprints)セクションを参照してください。
4. 最後に、ページの一番上までスクロールして［Skip Quickstart（クイックスタートを省略）］ボタンを押し、Facebookアプリのページに移動します。
5. ページの一番上に、`APP ID`と`APP SECRET`値が表示されます。これらは後で必要になるので、保存しておきます。
6. 左側にはナビゲーションドロワーがあります。［Settings（設定）］、次に［Basic（ベーシック）］の順にクリックします。**［Single Sign-On（シングルサインオン）］** のスイッチをオンにして、［Save（保存）］ボタンをクリックします。
7. ［Settings（設定）］、［Advanced（詳細）］の順にクリックします。**［Native or desktop app?（ネイテイブアプリまたはデスクトップアプリ）］** のスイッチをオンにします。

#### Auth0 dashboard

1. Auth0 Dashboardに移動して[［Social Connections（ソーシャル接続）］](https://manage.auth0.com/#/connections/social)）をクリックします。
2. **Facebook** をクリックするとダイアログが表示されます。
3. ［App ID（アプリID）］フィールドに上記の**Facebook開発者コンソール** セクションの手順5で取得した`APP ID`値を入力します。
4. ［App Secret（アプリシークレット）］フィールドに上記の**Facebook開発者コンソール** セクションの手順5で取得した`APP SECRET`値を入力します。
5. ［Save（保存）］ボタンをクリックします。
6. Auth0 Dashboardに移動して[［Applications（アプリケーション）］](https://manage.auth0.com/#/applications)をクリックします。作成がまだの場合は、まずは作成してからアプリケーションの構成ページに移動します。
7. ページの一番下にある［Show Advanced Settings（詳細設定を表示）］リンクをクリックして［Device Settings（デバイス設定）］タブに移動します。
8. Androidのセクションで、［**Package Name（パッケージ名）］** フィールドにアプリケーションのパッケージ名を入力します。最後に、**［Key Hashes（鍵ハッシュ）］** フィールドにアプリケーションに署名する際に使うSHA-256を入力します。SHA-256の取得に関してヘルプが必要な場合は [この](#certificate-fingerprints)セクションを参照してください。［Save Changes（変更を保存）］ボタンをクリックします。

#### Androidアプリケーション

1. Androidアプリケーションの中で、`res/strings.xml`ファイル内に新しい文字列リソースを作成します。`facebook_app_id`という名前を付け、**Facebook開発者コンソール** セクションの手順5で取得した`APP ID`値をセットします。
2. アプリケーションタグ内の`FacebookActivity`と`facebook_app_id`メタデータを`AndroidManifest.xml`ファイルに追加します。

   ``` lines
   <activity
       android:name="com.facebook.FacebookActivity"
       android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
       android:label="@string/app_name"/>
   <meta-data
       android:name="com.facebook.sdk.ApplicationId"
       android:value="@string/facebook_app_id" />
   ```

   

   
3. `AndroidManifest.xml`ファイルにAndroidのInternet権限を追加します。

   ```xml lines
   <uses-permission android:name="android.permission.INTERNET" />
   ```

   

   
4. `FacebookAuthProvider`の新しいインスタンスを作成します。

   ``` lines
   public class MainActivity extends AppCompatActivity {
     private FacebookAuthProvider provider;
     // ...

     @Override
     protected void onCreate(Bundle savedInstanceState) {
       super.onCreate(savedInstanceState);
       Auth0 auth0 = new Auth0(getString(R.string.com_auth0_client_id), getString(R.string.com_auth0_domain));
       auth0.setOIDCConformant(true);
       AuthenticationAPIClient client = new AuthenticationAPIClient(auth0);
       provider = new FacebookAuthProvider(client);
     }

     // ...
   }
   ```

   

   

Facebook SDKセットアップに関してヘルプが必要な場合は、Facebookの[Getting Started Guide（入門ガイド）](https://developers.facebook.com/docs/android/getting-started)を参照してください。

### Lockを使用しない場合

このプロバイダーを**Lock** なしで使用するつもりであれば、必ず`onActivityResult()`メソッドを上書きして、呼び出しをプロバイダーインスタンスにリダイレクトするようにしてください。最後に、「start」を呼び出して認証プロセスを開始します。

```java lines
// Define your own request codes
private static final int RC_PERMISSIONS = 101;
private static final int RC_AUTHENTICATION = 102;

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (provider.authorize(requestCode, resultCode, data)) {
        return;
    }
    super.onActivityResult(requestCode, resultCode, data);
}

private void beginAuthentication(){
  provider.start(this, callback, RC_PERMISSIONS, RC_AUTHENTICATION);
}
```

これでアプリケーションを実行し、Facebookネイティブプロバイダーを使ってログインする準備ができました。

### 追加オプション

#### カスタム接続名を使う

Auth0に対してカスタムソーシャル接続名を使って認可するには、新たな接続名を使って`setConnection`を呼び出します。

```java lines
FacebookAuthProvider provider = new FacebookAuthProvider("my_connection_name", client);
```

#### 追加の認証パラメーターを送信する

認証で追加のパラメーターを送信するには、`setParameters`を呼び出します。

```java lines
Map<String, Object> parameters = new HashMap<>();
//Add entries
provider.setParameters(parameters);
```

#### カスタムFacebook権限を要求する

デフォルトでは、`public_profile`権限が要求されます。カスタマイズするには、 `setPermissions`とFacebook権限のリストを呼び出します。

```java lines
provider.setPermissions(Arrays.asList("public_profile", "user_photos"));
```

#### Androidカスタムランタイム権限を要求する

このプロバイダーは、ユーザーの認証に特別なAndroid Manifest権限を必要としません。しかし、ユースケースによってそれが必要な場合は、 AuthProviderが処理できます。`setRequiredPermissions`メソッドを使ってそれらを指定します。

```java lines
provider.setRequiredPermissions(new String[]{"android.permission.GET_ACCOUNTS"});
```

Lockを使わない場合は、権限要求結果を自分で処理する必要があります。そのためには、アクティビティに`ActivityCompat.OnRequestPermissionsResultCallback`インターフェイスを実装させます。`onRequestPermissionsResult`メソッドが呼び出されたら、`provider.onRequestPermissionsResult`を呼び出して結果をプロバイダーに渡します。.

#### アカウントからログアウト/クリアします。

ユーザーをログアウトさせて、次回資格情報の入力を求めるようにするには、`clearSession`を呼び出します。その後、プロバイダーの状態が無効になるため、結果を`認可`する前にもう一度`start`を呼び出す必要があります。`stop`を呼び出しても同じ効果があります。

`provider.clearSession();`

#### 前回のログインを記憶する

デフォルトでは、このプロバイダーは前回のログインで使われたアカウントを記憶します。その動作を変更するには、以下の方法を使います。

`provider.rememberLastLogin(false);`

### 証明書のフィンガープリント

Facebook開発者コンソールでOAuth資格情報を新たに作成する場合は、アプリケーションにサインする際に使う証明書のSHA-1を提供する必要があります。Auth0 Dashboardでアプリケーションの構成を完了する際は、SHA-256値も提供する必要があります。以下に、値を取得するためのターミナルコマンド例とその結果例を示します。

コマンド：

`keytool -exportcert -alias androiddebugkey -keystore <PATH_TO_YOUR_KEYSTORE> -storepass android | openssl sha1 -binary | openssl base64`

出力例：

SHA1：BB:0D:AC:74:D3:21:E1:43:07:71:9B:62:90:AF:A1:66:6E:44:5D:75
SHA256:15:B9:F9:33:9F:E4:E3:68:C2:10:49:17:5D:A8:77:12:7C:8E:57:E9:FF:B7:23:EA:CC:DD:56:08:06:C9:5E:33

ヘルプが必要な場合は、この[Keystores ガイド](/ja-jp/android-development-keystores-hashes)に従って、これらの値を取得してください。