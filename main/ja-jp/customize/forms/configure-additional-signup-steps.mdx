---
title: "ユースケース：Formsを使用して追加のサインアップ手順を構成する"
permalink: "configure-additional-signup-steps"
'description': "Forms for Actionsを使用して追加のサインアップ手順を構成する方法を説明します。"
'og:title': "ユースケース：Formsを使用して追加のサインアップ手順を構成する"
'og:description': "Forms for Actionsを使用して追加のサインアップ手順を構成する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "ユースケース：Formsを使用して追加のサインアップ手順を構成する"
'twitter:description': "Forms for Actionsを使用して追加のサインアップ手順を構成する方法を説明します。"
---

<Card title="始める前に">

1. 以下のスコープを有効にして、[マシンツーマシンアプリケーション](https://auth0.com/docs/get-started/auth0-overview/create-applications/machine-to-machine-apps)を作成します。

* `read:users`
* `update:users`
* `create:users`
* `read:users_app_metadata`
* `update:users_app_metadata`
* `create:users_app_metadata`

2. マシンツーマシンアプリケーションの資格情報を使って[Vault接続](/ja-jp/customize/forms/vault)を追加します。

</Card>

Forms for Actionsを使用すると、サインアップまたはログインフローに追加のステップを作成し、ユーザーがアプリケーションにアクセスできるようにする前にそれらのステップを必須にすることができます。

<Frame>![Dashboard > Actions > Forms > Use Case Custom Signup Form](/images/ja-jp/cdy7uua7fh8z/ZOQNi6SrEC9OREcBbdiJ3/d79f84fb61acd5473bdf932527e26d58/custom-signup-form.png)</Frame>

以下のセクションでは、ノードとフローを使用して追加のサインアップステップフォームを作成する方法と、フォームを[ポストログイン](/ja-jp/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger)アクションに追加する手順について説明します。

## フォームをゼロから作成する

情報を収集するためのフォームを作成するには、次の手順に従ってください。

1. **［Auth0 Dashboard］>［Actions（アクション）］>［Forms（フォーム）］** の順に選択して、フォームエディターを開きます。
2. **［Create Form（フォームを作成）］** > **［Start from scratch（初めから作成する）］** の順に選択します。

特に設定を変更しない限り、新しいフォームには開始ノード、ステップノード、および終了スクリーンノードが含まれます。

<Frame>![Dashboard > Forms > Use Cases > Form](/images/ja-jp/cdy7uua7fh8z/2TZ9jSjgEcARFpULI6hz4R/a4319a1bd482f2ee5cc23100fdb2f42c/New-form-Forms-for-action-use-case.png)</Frame>

### ステップノードを構成する

ステップノードは、ユーザーに表示されるグラフィカルインターフェースです。次の手順に従って、ステップノードに[フィールド](/ja-jp/customize/forms/nodes-and-components)を追加し、ユーザーのフルネームと役職の値を収集します。

1. **［Components menu（コンポーネントメニュー）］** から **［Rich text（リッチテキスト）］** フィールドを **［Step（ステップ）］** ノードにドラッグします。

   * **［Rich text（リッチテキスト）］** ：カスタムメッセージを入力します。。
   * **［Save（保存）］** を選択します。
2. **［Text（テキスト）］** フィールドを **［Step（ステップ）］** ノードにドラッグします。

   * **Id** ：`full_name`を入力します。
   * **［Label（ラベル）］** ：`フルネーム`を入力します。
   * **［Label（ラベル）］** ：チェックボックスを有効にします。
   * **［Required（必要）］** ：チェックボックスを有効にします。
   * **［Save（保存）］** を選択します。
3. **［Text（テキスト）］** フィールドを **［Step（ステップ）］** ノードにドラッグします。

   * **Id** ：`job_title`を入力します。
   * **［Label（ラベル）］** ：`役職`を入力します。
   * **［Label（ラベル）］** ：チェックボックスを有効にします。
   * **［Required（必要）］** ：チェックボックスを有効にします。
   * **［Save（保存）］** を選択します。
4. **［Publish（公開）］** を選択し、保存します。

<Frame>![Dashboard > Actions > Forms > Use Case Custom Signup Steps Step node](/images/ja-jp/cdy7uua7fh8z/6Kcn0ai9fsVsqHwZpTGByG/37cbf4ffee63a7010926b15f06dd20ac/custom-signup-step-node.png)</Frame>

### フローノードの構成

次の手順に従って、 **［Step（ステップ）］** ノードの後に​​ **［Flow（フロー）］** ノードを追加し、`user_metadata`を更新して認証フローを再開します。

1. フォームエディターの下にある **［Flow（フロー）］** を選択します。
2. **［Step（ステップ）］** と **［Ending Screen（終了スクリーン）］** ノードの間にある既存のリンクを削除します。
3. 新しい **［Flow（フロー）］** > **［Click to add a flow（クリックして、フローを追加する）］** > **［Create a new flow（新しいフローを作成する）］** を選択します。

   * **［Name（名前）］** フィールドに`Update user_metadata`を入力します。
   * **［Create（作成）］** を選択します。
   * **［Save（保存）］** を選択します。
4. 下の画像のように **［Step（ステップ）］** と **［Ending Screen（終了スクリーン）** ノードに **［Flow（フロー）］** ノードをリンクします。
5. **［Publish（公開）］** を選択し、保存します。

<Frame>![Dashboard > Actions > Forms > Use Case Custom Signup Step Update User metadata flow](/images/ja-jp/cdy7uua7fh8z/4nTdYdA2Hu5vK65smkdvJg/db3294ebc25a7c2636be96362a3ea56e/custom-signup-step-flow.png)</Frame>

Auth0ユーザーの更新アクションをフローに追加するには、次の手順に従います。

1. **［Flow（フロー）］** の **［Update user_metadata（user_metadataの更新）］** > **［Edit flow（フローの編集）］** を選択し、新しいタブでフローエディターを開きます。
2. アクションの開始の下にある **［+］** アイコンを選択し、 **Update user（ユーザーの更新）** アクションを追加します。以下のフィールドに記入して、 **［Save（保存）］** を選択し、続けてください。

   * **Connection（接続）** ：ドロップダウンからM2MアプリケーションへのVault接続を選択します。
   * **User ID（ユーザーID）** ：`{{context.user.user_id}}`と入力します。
   * **［Body（ボディ）］** ：次のコードをコピーして貼り付け、`full_name`および`job_title`プロパティを使用してuser_metadataを更新します。

     ```json lines
     {
       "user_metadata": {
         "full_name": "{{fields.full_name}}",
         "job_title": "{{fields.job_title}}"
       }
     }
     ```

     

     
   * **［Save（保存）］** を選択します。
3. ［Publish（公開）］を選択し、保存します。

## フォームレンダーコードを取得する

次の手順に従って、フォームレンダーコードを取得して、カスタムのログイン後アクションを使ったフォームを視覚的にレンダリングします。

* Formディターから **`<>`［Render（レンダー）］** を選択します。
* **［Copy（コピー）］** を選択します。

<Frame>![Dashboard > Actions > Forms > Form > Embed](/images/ja-jp/cdy7uua7fh8z/2EIUzc539sq9lwoTKbjoJv/496a864c0fc44a782c9cadca119dbfb0/embed.png)</Frame>

## ポストログインアクションの作成

ポストログインアクションを作成してフォームをレンダリングするには、次の手順に従います。

1. **［Auth0 Dashboard（Auth0ダッシュボード）］>［Actions（アクション）］>［Flows（フロー）］>［Login（ログイン）］** に移動します。
2. **+** アイコンを選択し、 **［Build from scratch（初めから構築する）］** を選択します。

   * **［Name（名前）］** ：`［Render Additional Signup Form（追加サインアップフォームのレンダリング）］`を入力します。
   * **［Trigger（トリガー）］** ：`［Login / Post Login（ログイン/ログイン後）］`を選択します。
   * **［Runtime（ランタイム）］** ：推奨バージョンを選択します。
3. **［Create（作成）］** を選択します。

ログイン後アクションを構成するには：

1. 既存のコードをコードエディターから削除します。
2. フォームレンダリングコードをコードエディターにペーストします。
3. コードを編集して、フォームをレンダリングする条件ロジックを定義します。

   ```javascript lines
   /**
   * @param {Event} event - Details about the user and the context in which they are logging in.
   * @param {PostLoginAPI} api - Interface whose methods can be used to change the behavior of the login.
   */
   exports.onExecutePostLogin = async (event, api) => {
     const FORM_ID = 'REPLACE_WITH_YOUR_FORM_ID';

     if (
       !event.user.user_metadata.full_name &&
       !event.user.user_metadata.job_title
     ) {
       api.prompt.render(FORM_ID);
     }
   }

   exports.onContinuePostLogin = async (event, api) => { }
   ```

   

   

   <Callout icon="file-lines" color="#0EA5E9" iconType="regular">

   上の例にあるコードでは、ユーザーのメタデータにfull_nameプロパティとjob_titleプロパティがない場合にフォームが表示されます。

   </Callout>

4. **［Deploy（導入）］** を選択します。
5. **［Render Additional Signup Form（追加サインアップフォームのレンダリング）］** アクションを **［Login（ログイン）］** フローにドラッグ＆ドロップします。

   <Frame>![Dashboard > Forms > Use Cases Custom Signup Steps Login Flow](/images/ja-jp/cdy7uua7fh8z/1WBOicIOcH98hKj6Lq9HF2/4951e30a0cc08c7c5daa0116eaa17e11/Screenshot_2024-03-01_at_15.48.00.png)</Frame>

6. **［Apply（適用）］** を選択します。

### 実装のテスト

次の手順に従って実装をテストします。

* 新規ユーザーでアプリケーションにサインアップします。
* ログインフローのログイン後アクションでは、フォームがレンダリングされ、情報の入力が求められます。
* **［<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>（Auth0ダッシュボード）］>［User Management（ユーザー管理）］>［Users（ユーザー）］** を選択し、新しいユーザーを見つけ、その属性`full_name`および`job_title`が追加サインアップステップからの情報を含んでいることを検証します。