---
title: "リバースプロキシとしてロードバランシングを使用してGoogle Cloud Platformを構成する"
permalink: "configure-gcp-as-reverse-proxy"
'description': "Auth0のカスタムドメインプロキシとして使用するためにロードバランシングを使用してGoogle Cloud Platform（GCP）をセットアップする方法を説明します。"
'og:title': "リバースプロキシとしてロードバランシングを使用してGoogle Cloud Platformを構成する"
'og:description': "Auth0のカスタムドメインプロキシとして使用するためにロードバランシングを使用してGoogle Cloud Platform（GCP）をセットアップする方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "リバースプロキシとしてロードバランシングを使用してGoogle Cloud Platformを構成する"
'twitter:description': "Auth0のカスタムドメインプロキシとして使用するためにロードバランシングを使用してGoogle Cloud Platform（GCP）をセットアップする方法を説明します。"
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Auth0のカスタムドメインは、すべての有料[サブスクリプションプラン](https://manage.auth0.com/#/tenant/billing/subscription)で利用できます。SSL/TLS証明書を独自に管理したい場合は、 **エンタープライズ** サブスクリプションが必要です。詳細については、[Auth0の価格設定](https://auth0.com/pricing)を参照してください。

</Callout>

リバースプロキシとしてロードバランシングを使用してGoogle Cloud Platform（GCP）をセットアップできます。下の図は、構成内のコンポーネントを示しています。

* **Google Cloud Platform Load Balancer** は、アプリケーションの複数のインスタンスにトラフィックを分散します。
* **インターネットネットワークエンドポイントグループ（NEG）** は、Google Cloudの外部にあるバックエンドです。詳細については、「[インターネットネットワークエンドポイントグループの概要](https://cloud.google.com/load-balancing/docs/negs/internet-neg-concepts)」をご覧ください。

<Frame>![Google Cloud Platform with Load Balancing as Reverse Proxy flow diagram](/images/ja-jp/cdy7uua7fh8z/62abKXSoxy0b7uxBfmoWjs/eb997a05feef9627d02f1cc6fcb9392c/gcp-load-balancing-reverse-proxy-diagram.png)</Frame>

1. [自己管理証明書を使ってカスタムドメインを構成する](/ja-jp/customize/custom-domains/self-managed-certificates)作業がまだ済んでいない場合は、ここで行います。 **［Origin Domain Name（オリジンのドメイン名）］** と`cname-api-key`の値を後で使用するためにメモしておきます。
2. [［Auth0 Dashboard］>［Tenant Settings（テナント設定）］>［Custom Domains（カスタムドメイン）］](https://manage.auth0.com/#/tenant/custom_domains)に移動して、DNSサーバーにTXTレコードを追加し、 **［Verify（検証）］** をクリックしてドメインの所有権を確認します。
3. GCPがドメインを確認したら、[GCPコンソール](https://console.cloud.google.com)にログインします。
4. **［ネットワークサービス］>［ロードバランシング］** に移動します。 **［Create Load Balancer（ロードバランサーを作成）］** をクリックします。詳細については、Google Cloudのドキュメントで「[Cloud Load Balancingのドキュメント](https://cloud.google.com/load-balancing/docs)」をお読みください。

   1. **［HTTP（S）ロードバランシング］** を選択します。
   2. トラフィックをインターネットからAuth0にルーティングする必要があるため、 **［インターネットからVMへ］** を選択します。 **［Continue（続行）］** をクリックします。
   3. ロードバランサの名前を`auth0-reverse-proxy`などに指定して、 **［作成］** をクリックします。
5. バックエンドを構成します。

   1. Google Cloudの外部にあるバックエンド、インターネットネットワークエンドポイントグループ（NEG）を作成します。詳細については、Google Cloudドキュメントの「[インターネットネットワークエンドポイントグループの概要](https://cloud.google.com/load-balancing/docs/negs/internet-neg-concepts)」を参照してください。
   2. バックエンドサービス構成で、新しく作成したインターネットNEGをバックエンドとして選択し、Auth0テナントから`cname-api-key`と`host`値（オリジンのドメイン名）を設定します。
   3. **［Done（完了）］** をクリックします。
6. `host`と`path`のルールをセットアップします。

   1. **［アクション］** で［ **Route traffic to a single backend（トラフィックを単一のバックエンドにルーティングする）］** を選択します。
   2. **［Host rewrite（ホストの書き換え）］** で、先ほど保存したAuth0テナントのオリジンのドメイン名を入力します。
   3. **［Create（作成）］** をクリックします。
7. フロントエンドを構成します。

   1. 証明書を作成します。最も簡単な方法は、GoogleがSSL証明書を自動的にプロビジョニングする **Googleマネージドの証明書** を選択することです。
   2. Googleマネージドの証明書を選択しない場合は、有効期限が切れる前にSSL証明書を更新して認証局にアップロードする必要があります。
8. 構成を確認して確定します。
   GCPがロードバランサを構成するのに1分ほどかかります。エラーの原因となる一般的な問題は次のとおりです。

   * **Invalid API key（無効なAPIキー）** ：`cname-api-key`がGCPからAuth0に設定されていません。
   * **403 Forbidden（禁止）** ：`host`ヘッダーがGCPからAuth0に送信されませんでした。
9. DNSレコードを更新して、[ドメインをロードバランサに接続](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-external-backend#update_dns)します。

## もっと詳しく

* [機能にカスタムドメインの使用を構成する](/ja-jp/customize/custom-domains/configure-features-to-use-custom-domains)
* [カスタムドメインのトラブルシューティング](/ja-jp/troubleshoot/integration-extensibility-issues/troubleshoot-custom-domains)
* [TLS（SSL）のバージョンと暗号](/ja-jp/customize/custom-domains/self-managed-certificates/tls-ssl)