---
title: "プロバイダーがホストするアプリをSharePoint Onlineに接続"
permalink: "connecting-provider-hosted-apps-to-sharepoint-online"
'description': "プロバイダーがホストするアプリをSharePoint Onlineに接続する方法です。"
'og:title': "プロバイダーがホストするアプリをSharePoint Onlineに接続"
'og:description': "プロバイダーがホストするアプリをSharePoint Onlineに接続する方法です。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "プロバイダーがホストするアプリをSharePoint Onlineに接続"
'twitter:description': "プロバイダーがホストするアプリをSharePoint Onlineに接続する方法です。"
---

Auth0を使用すると、SharePointアプリの認証プロセスを大幅に簡素化できます。Auth0は、SharePoint APIを呼び出すために使用できるアクセストークンをネゴシエートします。

特別なライブラリは必要ありません。Auth0でサポートされているSDKのいずれかを使用できます。

## 1.Auth0にアプリケーションを登録する

通常どおり、Auth0に新しいアプリケーションを登録するだけです。 **［Applications（アプリケーション）］ > ［NEW（新規）］** 。詳細なステップについては、利用可能なSDKのいずれかを選択してください。次のステップで必要になるので、`client_id`を手元に置いてください。

## 2.アプリケーションのパッケージを作成する

アプリケーションの **クライアントID** と **クライアントシークレット** を取得する必要があります。想定される使用方法に応じて、アプリケーションを登録する方法は多数あります。

[SharePointアドインの登録（Microsoft Docs）](https://docs.microsoft.com/en-us/sharepoint/dev/sp-add-ins/register-sharepoint-add-ins)では、SharePointにアプリケーションを登録するさまざまな方法について説明しています。このチュートリアルステップでは、最も単純な形式、つまり特定のテナント（自分のテナント）での自己登録を使用します。

### SharePoint Onlineを開く

ダッシュボードのURLは`https://{your Office365 tenant}.sharepoint.com/_layouts/15/appregnew.aspx`です。

### Client_IdおよびClientSecretを生成します。

<Frame>![SharePoint - generate client id - generate client secret](/images/ja-jp/cdy7uua7fh8z/2BLGIJdnfbknayoyF4U5wP/70e66c7d10a001e0eb7ffa7aaebfb035/90SvG.png)</Frame>

### フォームに情報を入力します。

Auth0はアプリとOffice 365インフラストラクチャの間にあるため、アプリにはこのURLを使用する必要があります。

**アプリドメイン** :

{yourDomain}

**リダイレクトURI** :

`[https://{yourDomain}/login/callback?SP_APP_TOKEN&connection=CONNECTION&client_id={yourClientId}&redirect_uri={https://yourApp/callback}](https://{yourDomain}/login/callback?SP_APP_TOKEN&connection=CONNECTION&client_id={yourClientId}&redirect_uri={https://yourApp/callback})`

* `connection`は、Auth0の接続で使用する名前です（「sharepoint」など）。
* `client_id`は、Auth0でアプリを識別します（ステップ1で作成）。
* `redirect_uri`は、すべてのネゴシエーションが完了した後にユーザーが最終的にアクセスする実際のアプリ内の場所です。指定しない場合は、常にAuth0で定義されたアプリのコールバックURLになります（localhostの場合もあります）

### アプリをパッケージ化してSharePointにアップロードします。

Visual Studioでアプリマニフェストの情報を入力します:

<Frame>![SharePoint - Visual Studio - Application Manifest](/images/ja-jp/cdy7uua7fh8z/36dscLHlLHZjJx1rLgrQ7N/8d64ec7a51f4e053627ecb5dfd3c7707/90SEc.png)</Frame>

`Query文字列`は、前に入力した`リダイレクトURI`とまったく同じになることに注意してください。次に、プロジェクトを右クリックして`［Publish（発行）］`を選択します。

**Publishing Profile（発行プロファイル）** を作成します（SharePointダッシュボードで取得した同じ **クライアントID** と **クライアントシークレット** を入力する必要があります）。

**［Package（パッケージ）］** をクリックし、結果のファイルをSharePointにアップロードします。

## 3.Auth0で接続を作成する

統合の最後のステップは、Auth0でSharePoint接続を追加することです。

次のものが必要です。

* `Connection Name（接続名）`。これは任意の名前です。ステップ2で入力したものと一致する必要があります。
* `クライアントID`および`クライアントシークレット`。ステップ2で入力したものと一致する必要があります。
* `テスト用SharePointサイトURL`。これは、接続をテストするために使用されるSPサイトURLです。（ダッシュボードの［試す］ボタンを押したときなど）。ユーザーは常にSharePoint内からサイトへのリンクをたどるため、実行時には使用されません。

ユーザーはOffice Marketplaceからアプリをインストールします。リンクをクリックするとAuth0にリダイレクトされ、Auth0がアクセストークンをネゴシエートして、最終的にアプリにリダイレクトされます。アプリは次のような`ユーザープロファイル`を受け取ります。

<Frame>![Office Marketplace - Redirect -  User Profile Example](/images/ja-jp/cdy7uua7fh8z/4piqwmx1ONWMd3kjTFMq4I/714545f5cda3ab1d1dd5c620bc96b083/8Xp6x.png)</Frame>

次のプロパティが含まれます。`cacheKey`、`refresh_token`、`host`、および`site`。これらにより、SharePoint API（リストなど）をコールバックできます。